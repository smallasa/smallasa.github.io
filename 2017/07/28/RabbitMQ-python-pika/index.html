<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>RabbitMQ python pika | smallasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="RabbitMQ python pika RabbitMQ 安装和用户权限设置 123456789101112131415161718192021222324252627282930* RabbitMQ 安装,此步骤忽略* 创建vhost  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl add_vhost /test  Cre">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ python pika">
<meta property="og:url" content="http://www.smallasa.com/2017/07/28/RabbitMQ-python-pika/index.html">
<meta property="og:site_name" content="smallasa">
<meta property="og:description" content="RabbitMQ python pika RabbitMQ 安装和用户权限设置 123456789101112131415161718192021222324252627282930* RabbitMQ 安装,此步骤忽略* 创建vhost  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl add_vhost /test  Cre">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://www.smallasa.com/2017/07/28/RabbitMQ-python-pika/RabbitMQ-python-pika/RabbitMQ.单向发送消息.jpg">
<meta property="og:image" content="http://www.smallasa.com/2017/07/28/RabbitMQ-python-pika/RabbitMQ-python-pika/RabbitMQ.工作队列.jpg">
<meta property="og:image" content="http://www.smallasa.com/2017/07/28/RabbitMQ-python-pika/RabbitMQ-python-pika/RabbitMQ.交换机.jpg">
<meta property="og:updated_time" content="2017-12-07T01:54:03.876Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RabbitMQ python pika">
<meta name="twitter:description" content="RabbitMQ python pika RabbitMQ 安装和用户权限设置 123456789101112131415161718192021222324252627282930* RabbitMQ 安装,此步骤忽略* 创建vhost  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl add_vhost /test  Cre">
<meta name="twitter:image" content="http://www.smallasa.com/2017/07/28/RabbitMQ-python-pika/RabbitMQ-python-pika/RabbitMQ.单向发送消息.jpg">
  
    <link rel="alternate" href="/atom.xml" title="smallasa" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">smallasa</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I known what i do !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.smallasa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-RabbitMQ-python-pika" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/28/RabbitMQ-python-pika/" class="article-date">
  <time datetime="2017-07-28T02:58:20.000Z" itemprop="datePublished">2017-07-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RabbitMQ python pika
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="RabbitMQ-python-pika"><a href="#RabbitMQ-python-pika" class="headerlink" title="RabbitMQ python pika"></a>RabbitMQ python pika</h3><ol>
<li><p>RabbitMQ 安装和用户权限设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">* RabbitMQ 安装,此步骤忽略</span><br><span class="line"></span><br><span class="line">* 创建vhost</span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl add_vhost /<span class="built_in">test</span></span><br><span class="line">  Creating vhost <span class="string">"/test"</span></span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_vhosts|grep <span class="built_in">test</span></span><br><span class="line">  /<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">* 对创建的vhost设置高可用</span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl set_policy -p /<span class="built_in">test</span> ha-all <span class="string">"^"</span> <span class="string">'&#123;"ha-mode":"all"&#125;'</span></span><br><span class="line">  Setting policy <span class="string">"ha-all"</span> <span class="keyword">for</span> pattern <span class="string">"^"</span> to <span class="string">"&#123;\"ha-mode\":\"all\"&#125;"</span> with priority <span class="string">"0"</span></span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_policies -p /<span class="built_in">test</span>               Listing policies</span><br><span class="line">  /<span class="built_in">test</span>   ha-all  all     ^       &#123;<span class="string">"ha-mode"</span>:<span class="string">"all"</span>&#125;       0</span><br><span class="line"></span><br><span class="line">* 创建用户</span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl add_user <span class="built_in">test</span> test123</span><br><span class="line">  Creating user <span class="string">"test"</span></span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_users|grep <span class="built_in">test</span></span><br><span class="line">  <span class="built_in">test</span>    []</span><br><span class="line"></span><br><span class="line">* 为用户设置角色</span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl set_user_tags <span class="built_in">test</span> administrator monitoring  </span><br><span class="line">  Setting tags <span class="keyword">for</span> user <span class="string">"test"</span> to [administrator,monitoring]</span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_users|grep <span class="built_in">test</span>                 <span class="built_in">test</span>    [administrator, monitoring]</span><br><span class="line"></span><br><span class="line">* 为用户设置权限</span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl set_permissions -p /<span class="built_in">test</span> <span class="built_in">test</span> <span class="string">'.*'</span> <span class="string">'.*'</span> <span class="string">'.*'</span>      </span><br><span class="line">  Setting permissions <span class="keyword">for</span> user <span class="string">"test"</span> <span class="keyword">in</span> vhost <span class="string">"/test"</span></span><br><span class="line">  [wisdom@rabbitmq188 ~]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_permissions -p /<span class="built_in">test</span>            Listing permissions <span class="keyword">in</span> vhost <span class="string">"/test"</span></span><br><span class="line">  <span class="built_in">test</span>    .*      .*      .*</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="http://pika.readthedocs.io/en/latest/_modules/pika/connection.html#ConnectionParameters" target="_blank" rel="noopener">Python pika install</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@rabbitmq188 ~]<span class="comment"># pip install pika</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>RabbitMQ 单向发送消息<br><img src="RabbitMQ-python-pika/RabbitMQ.单向发送消息.jpg" alt="RabbitMQ 单向发送消息"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_queues -p /<span class="built_in">test</span></span><br><span class="line">Listing queues</span><br><span class="line"></span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布消息</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">""</span>,</span><br><span class="line">                    routing_key=<span class="string">"queue_hello"</span>,</span><br><span class="line">                    body=<span class="string">'Hello World!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"msg_send 'Hello World!'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py</span><br><span class="line">msg_send <span class="string">'Hello World!'</span></span><br><span class="line">[wisdom@rabbitmq188 web]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_queues -p /<span class="built_in">test</span> |grep hello</span><br><span class="line">queue_hello     1</span><br><span class="line">[wisdom@rabbitmq188 web]$ /mnt/app/rabbitmq/sbin/rabbitmqctl list_exchanges -p /<span class="built_in">test</span> |grep hello</span><br><span class="line">exchange_hello  direct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_receive.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % body)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_hello'</span>,</span><br><span class="line">                      no_ack=True)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_receive.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//执行msg_send.py 脚本,然后观察 msg_receive.py</span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_receive.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[x] Received <span class="string">'Hello World!'</span></span><br><span class="line">[x] Received <span class="string">'Hello World!'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>RabbitMQ 工作队列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">消息也可以理解为任务,消息发送者可以理解为任务分配者,消息接收者可以理解为工作者,当工作者接收到一个任务,还没完成的时候,任务分配者又发一个任务过来,那就忙不过来了,于是就需要多个工作者来共同处理这些任务,这些工作者,就称为工作队列</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="RabbitMQ-python-pika/RabbitMQ.工作队列.jpg" alt="RabbitMQ 工作队列"><br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">message = <span class="string">' '</span>.join(sys.argv[1:]) or <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布消息</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">""</span>,</span><br><span class="line">                    routing_key=<span class="string">"queue_hello"</span>,</span><br><span class="line">                    body=message)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"[x] Sent %r"</span> % (message,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者(worker_1.py和worker_2 内容一致)</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; worker_1.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line">    time.sleep(body.count(<span class="string">'.'</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Done"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_hello'</span>,</span><br><span class="line">                      no_ack=True)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//启动worker_1.py和worker_2.py</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_1.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_2.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line"></span><br><span class="line">//执行 msg_send.py向队列写入数据</span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py First message.</span><br><span class="line">[x] Sent <span class="string">'First message.'</span></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py Second message.</span><br><span class="line">[x] Sent <span class="string">'Second message.'</span></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py Third message.</span><br><span class="line">[x] Sent <span class="string">'Third message.'</span></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py Fourth message.</span><br><span class="line">[x] Sent <span class="string">'Fourth message.'</span></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py Fifth message.</span><br><span class="line">[x] Sent <span class="string">'Fifth message.'</span></span><br><span class="line"></span><br><span class="line">//worker_1.py返回状态</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_1.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[x] Received <span class="string">'Second message.'</span></span><br><span class="line">[x] Done</span><br><span class="line">[x] Received <span class="string">'Fourth message.'</span></span><br><span class="line">[x] Done</span><br><span class="line"></span><br><span class="line">//worker_2.py返回状态</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_2.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[x] Received <span class="string">'First message.'</span></span><br><span class="line">[x] Done</span><br><span class="line">[x] Received <span class="string">'Third message.'</span></span><br><span class="line">[x] Done</span><br><span class="line">[x] Received <span class="string">'Fifth message.'</span></span><br><span class="line">[x] Done</span><br><span class="line"></span><br><span class="line">综上,每个工作者,都会依次分配到任务.如果一个工作者,在处理任务的时候挂掉,这个任务就没有完成,应当交由其他工作者处理.所以应当有一种机制,当一个工作者完成任务时,会反馈消息.</span><br></pre></td></tr></table></figure></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">消息确认就是当工作者完成任务后,会反馈给rabbitmq.修改worker.py中的回调函数:</span><br><span class="line"></span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; worker_1.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Done"</span>)</span><br><span class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)   <span class="comment">#消息确认</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_hello'</span>,</span><br><span class="line">                      no_ack=False)   <span class="comment"># no_ack 关闭</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//启动work_1.py和worker_2.py</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_1.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_2.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line"></span><br><span class="line">//执行 msg_send.py向队列写入数据</span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_send.py First message.  </span><br><span class="line">[x] Sent <span class="string">'First message.'</span></span><br><span class="line"></span><br><span class="line">//执行向队列发送消息后,我发现woker_1.py收到消息,我立即中断woker_1.py程序</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_1.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[x] Received <span class="string">'First message.'</span></span><br><span class="line">^CTraceback (most recent call last):   <span class="string">"Ctrl+C 退出"</span></span><br><span class="line"></span><br><span class="line">//在5秒中内停止worker_1.py后,worker_2.py接收消息并继续处理</span><br><span class="line">[wisdom@rabbitmq188 web]$ python worker_2.py</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br><span class="line">[x] Received <span class="string">'First message.'</span></span><br><span class="line">[x] Done</span><br><span class="line"></span><br><span class="line">综上,通过消息确认,即使其中一个工作者ctrl+c退出后,正在执行的任务也不会丢失,rabbitmq会将任务重新分配给其他工作者</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">虽然有了消息反馈机制,正在执行的任务不会丢失,但是如果rabbitmq本身服务挂掉的话,那么任务还是会丢失.所以需要将任务持久化存储起来.声明持久化存储:</span><br><span class="line"></span><br><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">message = <span class="string">' '</span>.join(sys.argv[1:]) or <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>,durable=True)  <span class="comment">#创建队列,声明持久化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布消息</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">""</span>,</span><br><span class="line">                    routing_key=<span class="string">"queue_hello"</span>,</span><br><span class="line">                    body=message,</span><br><span class="line">                    properties=pika.BasicProperties(</span><br><span class="line">                        delivery_mode = 2,    <span class="comment"># 持久化参数</span></span><br><span class="line">                    ))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"[x] Sent %r"</span> % (message,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; worker_1.py &lt;&lt;EOF    </span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>,durable=True)  <span class="comment"># 声明持久化队列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Done"</span>)</span><br><span class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_hello'</span>,</span><br><span class="line">                      no_ack=False)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">声明队列的时候,需要添加<span class="string">"durable=True"</span>参数,如果队列已经存在,程序执行会报错.rabbitmq不允许使用不同的参数来重新定义存在的队列,所以需要定义一个新的队列.</span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>,durable=True)</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">公平调度:</span><br><span class="line">上面实例中,虽然每个工作者是依次分配到任务,但是每个任务不一定一样.可能有的任务比较重,执行时间比较久;有的任务比较轻,执行时间比较短.如果能公平调度就最好了,使用basic_qos设置prefetch_count=1,使得rabbitmq不会在同一时间给工作者分配多个任务,即只有工作者完成任务之后,才会再次接收到任务.</span><br><span class="line"></span><br><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF     </span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">message = <span class="string">' '</span>.join(sys.argv[1:]) or <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>,durable=True)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布消息</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">""</span>,</span><br><span class="line">                    routing_key=<span class="string">"queue_hello"</span>,</span><br><span class="line">                    body=message,</span><br><span class="line">                    properties=pika.BasicProperties(</span><br><span class="line">                        delivery_mode = 2,</span><br><span class="line">                    ))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"[x] Sent %r"</span> % (message,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; worker_1.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列(消息发送到队列)</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_hello'</span>,durable=True)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Done"</span>)</span><br><span class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 公平调度</span></span><br><span class="line">channel.basic_qos(prefetch_count=1)  <span class="comment"># 公平调度</span></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_hello'</span>,</span><br><span class="line">                      no_ack=False)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">注意,公平调度主要是在消费者上进行设置:</span><br><span class="line">channel.basic_qos(prefetch_count=1)</span><br></pre></td></tr></table></figure>
<ol>
<li>RabbitMQ 交换器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">工作队列,每次消息都只会发送给其中一个接收端,如果需要将消息广播出去,让每个接收端都能收到,那么就要使用交换机</span><br><span class="line"></span><br><span class="line">交换机的工作原理: 消息发送端先将消息发送给交换机,交换机再将消息发送到绑定的消息队列,而后每个接收端都能从各自的消息队列里接收到信息</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="RabbitMQ-python-pika/RabbitMQ.交换机.jpg" alt="RabbitMQ 工作队列"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">message = <span class="string">' '</span>.join(sys.argv[1:]) or <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交换机</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">"exchange_hello"</span>,<span class="built_in">type</span>=<span class="string">'fanout'</span>)   <span class="comment">#创建交换机</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布消息</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">"exchange_hello"</span>,   <span class="comment">#发布消息到交换机</span></span><br><span class="line">                    routing_key=<span class="string">""</span>,</span><br><span class="line">                    body=<span class="string">'Hello World!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"[x] Sent 'Hello World!'"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">1.生产者要将消息发送到交换机,而不是队列.</span><br><span class="line">2.basic_publish方法的参数exchange被设定为相应交换机,因为是要广播出去,发送到所有队列,所以routing_key就不需要设定了</span><br><span class="line">3.exchange如果为空,表示是使用匿名的交换机(例如:amq.*这样的交换机,就是系统默认的交换机).routing_key在使用匿名交换机的时候才需要指定,表示发送到哪个队列的意思</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_receive.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交换机</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'exchange_hello'</span>, <span class="built_in">type</span>=<span class="string">'fanout'</span>)  <span class="comment"># 创建交换机</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建随机队列,并绑定到交换机上</span></span><br><span class="line"><span class="comment"># "exclusive=True"表示当接收端退出时,销毁临时产生的队列</span></span><br><span class="line">queue_random = channel.queue_declare(exclusive=True)                <span class="comment"># 创建随机队列,并绑定到交换机.</span></span><br><span class="line">queue_name = queue_random.method.queue</span><br><span class="line">channel.queue_bind(exchange=<span class="string">'exchange_hello'</span>,queue=queue_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=queue_name,</span><br><span class="line">                      no_ack=True)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>RabbitMQ 路由键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">交换机已经能实现给所有接收端发送消息,但是如果需要自由定制,有的消息发给其中一些接收端,有些消息发送给另外一些接收端,这种情况就需要用到路由键了</span><br><span class="line"></span><br><span class="line">路由键的工作原理: 每个接收端的消息队列在绑定交换机的时候,可以设定相应的路由键.发送端通过交换机发送信息时,可以指明路由键,交换机会根据路由键把消息发送到相应的消息队列,这样接收端就能接收到消息了</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交换机</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">"exchange_hello"</span>,<span class="built_in">type</span>=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义三个路由键</span></span><br><span class="line">routings = [<span class="string">'info'</span>,<span class="string">'warning'</span>,<span class="string">'error'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将消息发布到交换机,并设置路由键</span></span><br><span class="line"><span class="keyword">for</span> routing <span class="keyword">in</span> routings:</span><br><span class="line">    message = <span class="string">'%s message.'</span> % routing</span><br><span class="line">    channel.basic_publish(exchange=<span class="string">"exchange_hello"</span>,</span><br><span class="line">                        routing_key=routing,</span><br><span class="line">                        body=message)</span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_receive.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交换机</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'exchange_hello'</span>, <span class="built_in">type</span>=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从命令行获取路由键参数,如果没有,默认为info</span></span><br><span class="line">routings = sys.argv[1:]</span><br><span class="line"><span class="keyword">if</span> not routings:</span><br><span class="line">    routings = [<span class="string">'info'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建随机队列,并绑定到交换机上,设置路由键</span></span><br><span class="line">queue_random = channel.queue_declare(exclusive=True)</span><br><span class="line">queue_name = queue_random.method.queue</span><br><span class="line"><span class="keyword">for</span> routing <span class="keyword">in</span> routings:</span><br><span class="line">    channel.queue_bind(exchange=<span class="string">'exchange_hello'</span>,</span><br><span class="line">                    queue=queue_name,</span><br><span class="line">                    routing_key=routing)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=queue_name,</span><br><span class="line">                      no_ack=True)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//执行msg_receive.py</span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_receive.py warning error</span><br><span class="line">[*] Waiting <span class="keyword">for</span> messages. To <span class="built_in">exit</span> press CTRL+C</span><br></pre></td></tr></table></figure>
</li>
<li><p>RabbitMQ 路由键模糊匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过设置路由键,可以将消息发送到相应的队列,这里的路由键是要完全匹配,比如: info消息的只能发到路由键为info的消息队列</span><br><span class="line">路由键模糊匹配,就是可以使用正则表达式.和常用的正则表示式不同,这里的话&quot;#&quot;表示所有,全部的意思;&quot;*&quot;只匹配到一个词</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">message = <span class="string">' '</span>.join(sys.argv[1:]) or <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交换机</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">"exchange_hello"</span>,<span class="built_in">type</span>=<span class="string">'topic'</span>)  <span class="comment"># 设置为topic类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义三个路由键</span></span><br><span class="line">routings = [<span class="string">'happy.work'</span>,<span class="string">'happy.life'</span>,<span class="string">'sad.work'</span>,<span class="string">'sad.life'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将消息发布到交换机,并设置路由键</span></span><br><span class="line"><span class="keyword">for</span> routing <span class="keyword">in</span> routings:</span><br><span class="line">    message = <span class="string">'%s message.'</span> % routing</span><br><span class="line">    channel.basic_publish(exchange=<span class="string">"exchange_hello"</span>,</span><br><span class="line">                        routing_key=routing,</span><br><span class="line">                        body=message)</span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭与RabbitMQ建立连接</span></span><br><span class="line">conn_broker.close()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_receive.py &lt;&lt;EOF     </span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交换机</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'exchange_hello'</span>, <span class="built_in">type</span>=<span class="string">'topic'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从命令行获取路由键参数,如果没有,则报错退出</span></span><br><span class="line">routings = sys.argv[1:]</span><br><span class="line"><span class="keyword">if</span> not routings:</span><br><span class="line">    <span class="built_in">print</span> &gt;&gt; sys.stderr,<span class="string">"Usage: %s [routing_key]..."</span> % (sys.argv[0])</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建随机队列,并绑定到交换机上,设置路由键</span></span><br><span class="line">queue_random = channel.queue_declare(exclusive=True)</span><br><span class="line">queue_name = queue_random.method.queue</span><br><span class="line"><span class="keyword">for</span> routing <span class="keyword">in</span> routings:</span><br><span class="line">    channel.queue_bind(exchange=<span class="string">'exchange_hello'</span>,</span><br><span class="line">                    queue=queue_name,</span><br><span class="line">                    routing_key=routing)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[x] Received %r"</span> % (body,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=queue_name,</span><br><span class="line">                      no_ack=True)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//运行接收端</span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_receive.py <span class="string">"*.work"</span></span><br><span class="line">[wisdom@rabbitmq188 web]$ python msg_receive.py <span class="string">"happy.*"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">补充说明:</span><br><span class="line">1.发送信息时,如果不设置路由键,那么路由键设置为<span class="string">"*"</span>的接收端是否能接收到消息?</span><br><span class="line">发送信息时,如果不设置路由键,默认是表示广播出去,理论上所有接收端都可以收到消息,但经测试,路由键设置为<span class="string">"*"</span>的接收端收不到任何消息.只有发送消息时,设置路由键为一个词,路由键设置为<span class="string">"*"</span>的接收端才能收到消息.在这里,每个词使用<span class="string">"."</span>符号分开的</span><br><span class="line"></span><br><span class="line">2.发送消息时,如果路由键设置为<span class="string">".."</span>,那么路由键设置为<span class="string">"#."</span>的接收端是否能接收到消息?如果发送消息时,路由键设置为一个词呢?</span><br><span class="line">两种情况,测试都可以</span><br><span class="line"></span><br><span class="line">3.<span class="string">"a.*.#"</span> 和<span class="string">"a.#"</span>的区别</span><br><span class="line"><span class="string">"a.#"</span>只要字符串开头的一个词是a就可以了,比如a,a.haha,a.haha.haha;而这样的词是不行的,如abs,abc,abc.haha</span><br><span class="line"><span class="string">"a.*.#"</span>必须要满足a.*的字符串才可以,比如a.,a.haha,a.haha.haha.而这样的词是不行的,如a</span><br></pre></td></tr></table></figure>
<ol>
<li><p>RabbitMQ 远程结果返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">前面的例子都有个共同点,就是发送端发送消息出去后没有结果返回.如果只是单纯发送消息,当然没有问题了.但是在实际中,常常会需要接收端将收到的消息进行处理之后,返回给发送端.</span><br><span class="line"></span><br><span class="line">处理方法描述: 发送端在发送信息前,产生一个接收消息的临时队列,该队列用来接收返回的结果.其实在这里接收端,发送端的概念已经比较模糊了,因为发送端也同样要接收消息,接收端同样也要发送消息</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">示例内容: 假设有一个控制中心和一个计算节点,控制中心会将一个自然数N发送给计算节点,计算节点将N值加1后,返回给控制中心.这里用center.py模拟控制中心,compute.py模拟计算节点</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF     </span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Center(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        <span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">        self.credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line">        self.conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                                    5672,</span><br><span class="line">                                                    <span class="string">"/test"</span>,</span><br><span class="line">                                                    credentials = self.credentials)</span><br><span class="line">        self.conn_broker = pika.BlockingConnection(self.conn_params)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">        self.channel = self.conn_broker.channel()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义接收到返回消息处理方法</span></span><br><span class="line">    def on_response(self,ch,method,props,body):</span><br><span class="line">        self.response = body</span><br><span class="line"></span><br><span class="line">    def request(self,n):</span><br><span class="line">        self.response = None</span><br><span class="line">        <span class="comment">#发送计算请求,并声明返回队列</span></span><br><span class="line">        self.channel.basic_publish(exchange=<span class="string">''</span>,</span><br><span class="line">                                routing_key=<span class="string">'queue_compute'</span>,</span><br><span class="line">                                properties=pika.BasicProperties(</span><br><span class="line">                                    reply_to = self.callback_queue,</span><br><span class="line">                                ),</span><br><span class="line">                                body=str(n))    </span><br><span class="line">        <span class="comment">#接收返回的数据</span></span><br><span class="line">        <span class="keyword">while</span> self.response is None:</span><br><span class="line">            self.conn_broker.process_data_events()</span><br><span class="line">        <span class="built_in">return</span> int(self.response)</span><br><span class="line"></span><br><span class="line">center = Center()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">" [x] Requesting increase(30)"</span></span><br><span class="line">response = center.request(30)</span><br><span class="line"><span class="built_in">print</span> <span class="string">" [.] Got %r"</span> % (response,)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_receive.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_compute'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将n值加1</span></span><br><span class="line">def increase(n):</span><br><span class="line">    <span class="built_in">return</span> n + 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[.] increase(%s)"</span> % (body,))</span><br><span class="line">    response = increase(int(body))</span><br><span class="line">    <span class="comment"># 将计算结果返回生产者</span></span><br><span class="line">    ch.basic_publish(exchange=<span class="string">''</span>,</span><br><span class="line">                    routing_key=properties.reply_to,</span><br><span class="line">                    body=str(response))</span><br><span class="line">    ch.basic_ack(delivery_tag=method.delivery_tag)</span><br><span class="line"></span><br><span class="line">channel.basic_qos(prefetch_count=1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_compute'</span>,</span><br><span class="line">                      no_ack=False)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>RabbitMQ 相互关联编号”correlation id”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">远程结果中有一个没有提到,就是&quot;correlation id&quot;,这是什么呢?</span><br><span class="line"></span><br><span class="line">假设有多个计算节点,控制中心开启多个线程,往这些计算节点发送数字,要求计算结果并返回,但是控制中心只开启了一个队列,所有线程都是从这个队列里获取消息,每个线程如何确定收到的消息就是该线程对应的呢?这个就是&quot;correlation id&quot;的用处了.correlation翻译成中文就是相互关联,也表达了这个意思</span><br><span class="line"></span><br><span class="line">&quot;correlation id&quot;运行原理: 控制中心发送计算请求时设置&quot;correlation id&quot;,而后计算节点将计算结果,连同接收到的&quot;correlation id&quot;一起返回,这样控制中心就能通过&quot;correlation id&quot;来标识请求.其实&quot;correlation id&quot;也可以理解为请求的唯一标识码</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">示例内容: 控制中心开启多个线程,每个线程都发起一次计算请求,通过<span class="string">"correlation id"</span>,每个线程都能准确收到相应的计算结果</span><br><span class="line"></span><br><span class="line">//生产者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_send.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import threading</span><br><span class="line">import uuid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义线程类,继承threading.Thread</span></span><br><span class="line">class MyThread(threading.Thread):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        super(MyThread,self).__init()</span><br><span class="line">        self.func = func</span><br><span class="line">        self.num = num</span><br><span class="line">    def run(self):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[x] Requesting increase(%d)"</span> % self.num)</span><br><span class="line">        response = self.func(self.num)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">"[.] increase(%d)=%d"</span> % (self.num, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制中心类</span></span><br><span class="line">class Center(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        <span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">        self.credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line">        self.conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                                    5672,</span><br><span class="line">                                                    <span class="string">"/test"</span>,</span><br><span class="line">                                                    credentials = self.credentials)</span><br><span class="line">        self.conn_broker = pika.BlockingConnection(self.conn_params)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">        self.channel = self.conn_broker.channel()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 定义接收返回消息队列</span></span><br><span class="line">        result = self.channel.queue_declare(exclusive=True)</span><br><span class="line">        self.callback_queue = result.method.queue</span><br><span class="line">        self.channel.basic_consume(self.on_response,</span><br><span class="line">                                   no_ack=True,</span><br><span class="line">                                   queue=self.callback_queue)</span><br><span class="line">        <span class="comment">#返回的结果都会存储在该字典里</span></span><br><span class="line">        self.response = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义接收到返回消息处理方法</span></span><br><span class="line">    def on_response(self,ch,method,props,body):</span><br><span class="line">        self.response[props.correlation_id] = body</span><br><span class="line"></span><br><span class="line">    def request(self,n):</span><br><span class="line">        corr_id = str(uuid.uuid4())</span><br><span class="line">        self.response[corr_id] = None</span><br><span class="line">        <span class="comment">#发送计算请求,并声明返回队列</span></span><br><span class="line">        self.channel.basic_publish(exchange=<span class="string">''</span>,</span><br><span class="line">                                routing_key=<span class="string">'queue_compute'</span>,</span><br><span class="line">                                properties=pika.BasicProperties(</span><br><span class="line">                                    reply_to = self.callback_queue,</span><br><span class="line">                                    correlation_id = corr_id,</span><br><span class="line">                                ),</span><br><span class="line">                                body=str(n))    </span><br><span class="line">        <span class="comment">#接收返回的数据</span></span><br><span class="line">        <span class="keyword">while</span> self.response is None:</span><br><span class="line">            self.conn_broker.process_data_events()</span><br><span class="line">        <span class="built_in">return</span> int(self.response[corr_id])</span><br><span class="line"></span><br><span class="line">center = Center()</span><br><span class="line"><span class="comment">#发起5次计算请求</span></span><br><span class="line">nums= [10, 20, 30, 40 ,50]</span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    threads.append(MyThread(center.request, num))</span><br><span class="line"><span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">    thread.start()</span><br><span class="line"><span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">    thread.join()</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">//消费者</span><br><span class="line">[wisdom@rabbitmq188 web]$ cat &gt; msg_receive.py &lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pika</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立与RabbitMQ建立连接</span></span><br><span class="line">credentials = pika.PlainCredentials(<span class="string">"test"</span>,<span class="string">"test123"</span>)</span><br><span class="line"></span><br><span class="line">conn_params = pika.ConnectionParameters(<span class="string">"192.168.13.188"</span>,</span><br><span class="line">                                        5672,</span><br><span class="line">                                        <span class="string">"/test"</span>,</span><br><span class="line">                                        credentials = credentials)</span><br><span class="line"></span><br><span class="line">conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建信道(生产者和消费者与RabbitMQ建立一条通道)</span></span><br><span class="line">channel = conn_broker.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建队列</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'queue_compute'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将n值加1</span></span><br><span class="line">def increase(n):</span><br><span class="line">    <span class="built_in">return</span> n + 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消费消息</span></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[.] increase(%s)"</span> % (body,))</span><br><span class="line">    response = increase(int(body))</span><br><span class="line">    <span class="comment"># 将计算结果返回生产者,增加"correlation_id"的设定</span></span><br><span class="line">    ch.basic_publish(exchange=<span class="string">''</span>,</span><br><span class="line">                    routing_key=properties.reply_to,</span><br><span class="line">                    properties=pika.BasicProperties(correlation_id= \</span><br><span class="line">                                                    props.correlation_id),</span><br><span class="line">                    body=str(response))</span><br><span class="line">    ch.basic_ack(delivery_tag=method.delivery_tag)</span><br><span class="line"></span><br><span class="line">channel.basic_qos(prefetch_count=1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅消息</span></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue=<span class="string">'queue_compute'</span>,</span><br><span class="line">                      no_ack=False)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'[*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始消费</span></span><br><span class="line">channel.start_consuming()</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/28/RabbitMQ-python-pika/" data-id="cjavy9jtr000p0coqnsw6hnv7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/08/01/salt-info/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          salt info
        
      </div>
    </a>
  
  
    <a href="/2017/07/26/command-tr/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">command tr</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/">AliCloud</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/">SDK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/Python-SDK/">Python SDK</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/">Android install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/Android-studio-install/">Android studio install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/">Doc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP-严格传输安全HSTS/">HTTP 严格传输安全HSTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP协议/">HTTP协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP-协议详解/">TCP 协议详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP与socket区别/">TCP与socket区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件描述符与打开文件之间的关系/">linux 文件描述符与打开文件之间的关系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件系统inode/">linux 文件系统inode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/一次完整的HTTP请求/">一次完整的HTTP请求</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/">Disk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-io-performance/">disk io performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-iostat/">disk iostat</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/">Distributed storage</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/">GlusterFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-architecture/">GlusterFS architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-info/">GlusterFS info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-install/">GlusterFS install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-workflow/">GlusterFS workflow</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/">DRBD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/">keepalived</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/">Intellij</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/Intellij-setting/">Intellij setting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/">vim</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-shortcut-key/">vim shortcut key</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-vimrc/">vim vimrc</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/">Kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/">kernel memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/kernel-共享内存/">kernel 共享内存</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/">ganglia</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/ganglia-install/">ganglia install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/">hmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/">htmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/">smokeping</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/">zabbix</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/">monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-cpu/">zabbix monitor cpu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-mem/">zabbix monitor mem</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-auto-discover/">zabbix auto discover</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-grafana-install/">zabbix grafana install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install/">zabbix install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-item-and-tigger/">zabbix item and tigger</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-java-gateway/">zabbix java gateway</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-modify-login-user-passwd/">zabbix modify login user passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-proxy-install/">zabbix proxy install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-server-support-chinese/">zabbix server support chinese</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-windows-agent/">zabbix windows agent</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/树莓派-GSM-语音短信报警/">树莓派 GSM 语音短信报警</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/">监控</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/监控知识体系/">监控知识体系</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/">Python Framework</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django/">Python Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django-setting/">Python Django setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/">Python Learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-内存管理/">python 内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-函数编程/">python 函数编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-变量/">python 变量</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象使用/">python 对象使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象的属性/">python 对象的属性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象编程/">python 对象编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-数据类型/">python 数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-流程控制/">python 流程控制</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-爬虫/">python 爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊方法/">python 特殊方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊说明/">python 特殊说明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-装饰器/">python 装饰器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-过程编程/">python 过程编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-进阶/">python 进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-闭包/">python 闭包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/">Python install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-error-info/">python error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-source-image/">python pip source image</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-use/">python pip use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pyenv-install/">python pyenv install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-setup-py/">python setup.py</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-source-install/">python source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-virtualenv/">python virtualenv</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/">Python library</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/MySQLdb/">MySQLdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/memory-profiler/">memory_profiler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/">Python modules</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-path/">python modules path</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-pylint-and-ipython/">python modules pylint and ipython</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/">Python other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/python-import-and-reload/">python import and reload</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/">Ruby install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP.IP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-状态/">TCP 状态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-IP模型/">TCP/IP模型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/Wireshark-use/">Wireshark use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/">WeChat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/">WeChat enterprise</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/WeChat-enterprise-API/">WeChat enterprise API</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/">automation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/">git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-command/">git command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-error/">git error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitlab/">git gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitolite/">git gitolite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs/">git gogs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs-source-install/">git gogs source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-init/">git init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-workflow/">git workflow</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/">jenkins</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-info/">jenkins info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-install/">jenkins install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/">kvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/kvm-install/">kvm install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/">maven</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/maven-install/">maven install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/">nexus</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-install/">nexus install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-proxy-maven/">nexus proxy maven</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/">rpm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/">salt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-info/">salt info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install/">salt install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-HA/">salt install HA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-standard/">salt install standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-jinja2-grain-pillar-module/">salt jinja2 grain pillar module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-event-reactor/">salt manage event reactor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-grains/">salt manage grains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-job/">salt manage job</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-module/">salt manage module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-pillar/">salt manage pillar</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-return/">salt manage return</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-states/">salt manage states</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-target/">salt manage target</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-syndic-install/">salt master syndic install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-conf/">salt master.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-minion-conf/">salt minion.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-raet/">salt raet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-state-module/">salt state module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-syndic-conf/">salt syndic.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-write-module-code/">salt write module code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/">svn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-auto-update/">svn auto update</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/">yum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/yum-server-install/">yum server install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/">Mongo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-auth/">mongo auth</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-error/">mongo error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-auth-install/">mongo replication auth install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-standard-install/">mongo replication standard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-standard-install/">mongo standard install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/">Mysql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-command/">mysql command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-error-info/">mysql error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-explain/">mysql explain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-grant/">mysql grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-index-options/">mysql index options</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave/">mysql master slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave-switch/">mysql master slave switch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-partition/">mysql partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-select-join/">mysql select join</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-slow-log/">mysql slow log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-standard/">mysql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-table-size/">mysql table size</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/">Postgresql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-book-use/">postgresql book use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave-info/">postgresql master slave info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave/">postgresql master/slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-plugin-install/">postgresql plugin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-standard/">postgresql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-tablespace-database-schema-table-user-role-relation/">postgresql tablespace database schema table user role relation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-yum-install/">postgresql yum install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-常用命令/">postgresql 常用命令</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库对象/">postgresql 数据库对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库管理/">postgresql 数据库管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/">Redis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-error/">redis error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-install/">redis install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-redis-trib-rb/">redis redis-trib.rb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-status/">redis status</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-use/">redis use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/">influxDB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang/go-env/">go env</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-high-availability/">RabbitMQ high availability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-install/">RabbitMQ install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-working-principle/">RabbitMQ working principle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/">beats</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/beats-install/">beats install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/">datax</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-info/">datax info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-install/">datax install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-job/">datax job</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-command/">elasticsearch command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-core-component/">elasticsearch core component</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-cluster/">elasticsearch exploring your cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-data/">elasticsearch exploring your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-four-search-type/">elasticsearch four search type</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-full-cluster-restart-upgrade/">elasticsearch full cluster restart upgrade</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-install/">elasticsearch install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-modifying-your-data/">elasticsearch modifying your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-rolling-upgrades/">elasticsearch rolling upgrades</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-safe-restart/">elasticsearch safe restart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-shard/">elasticsearch shard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-indexing-speed/">how to tune for indexing speed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-search-speed/">how to tune for search speed</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/">flume</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-info/">flume info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-install/">flume install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/">grafana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/grafana-install/">grafana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/hadoop-简介/">hadoop 简介</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/">kafka</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-install/">kafka install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-manage-web/">kafka manage web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-offset-monitor/">kafka offset monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-optimize/">kafka optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-web-console/">kafka web console</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/">kibana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/kibana-install/">kibana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/">logstash</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-config-file/">logstash config file</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-filter-grok/">logstash filter grok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-info/">logstash info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-install/">logstash install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/">mycat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-web-install/">mycat web install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/">nsq</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-command/">nsq command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-info/">nsq info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-install/">nsq install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/">zookeeper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-install/">zookeeper install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-monitor/">zookeeper monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-optimize/">zookeeper optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-use/">zookeeper use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-zab-protocol/">zookeeper zab protocol</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-env/">java env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-optimize/">java jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-opts/">java jvm opts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/">java learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/java-学习笔记/">java 学习笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-log4j/">java log4j</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/">java performance analysis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/jps/">jps</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-dashboard-install/">k8s dashboard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-install/">k8s install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-registry-install/">k8s registry install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/node-install/">node install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/other/ACID/">ACID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/分布式二阶段和三阶段提交协议/">分布式二阶段和三阶段提交协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/开源许可协议/">开源许可协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/网络带宽/">网络带宽</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/">system service</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/">Atlassian</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-https/">confluence https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-install/">confluence install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-reset-passwd/">confluence reset passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-update/">confluence update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-https/">jira https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-install/">jira install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-update/">jira update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/mariadb-install/">mariadb install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/Base-env/">Base env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-common-use-scripts/">linux common use scripts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-history-info-setting/">linux history info setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-login-info/">linux login info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-nginx-install/">linux nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-skill/">linux skill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-system-init/">linux system init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-内存插槽-内存信息/">linux 内存插槽 内存信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-扩容swap分区/">linux 扩容swap分区</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-物理CPU-CPU核数-逻辑CPU/">linux 物理CPU CPU核数 逻辑CPU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-磁盘系统block区别/">linux 磁盘系统block区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-设置-包含头文件路径-和-动态库链接路径/">linux 设置 包含头文件路径 和 动态库链接路径</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/">NFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/">Samba</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-conf/">samba conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-install/">samba install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/">command</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/grep/">grep</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/pigz/">pigz</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/sed/">sed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/split/">split</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/tr/">tr</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/">haproxy</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/haproxy-install/">haproxy install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-install/">nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-location/">nginx location</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-rewrite/">nginx rewrite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-status/">nginx status</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/">ntpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/ntpd-install/">ntpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/">openssl</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/openssl-certificate/">openssl certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/">openvpn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/openvpn-install/">openvpn install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/">rsync</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/rsync-install/">rsync install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/">supersord</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/supersord-install/">supersord install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/">vsftpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-error/">vsftpd error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-info/">vsftpd info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-install/">vsftpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/">windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/cygwin-install/">cygwin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/ipsec-set/">ipsec set</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/windows-modify-hosts/">windows modify hosts</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/">SSL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/">angular</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/angular-install/">angular install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/hexo-install/">hexo install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/">sass</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/sass-install/">sass install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/">xml</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/xml-format/">xml format</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/hello-everyone/">Hello Everyone</a>
          </li>
        
          <li>
            <a href="/2017/11/28/kafka-web-console/">kafka web console</a>
          </li>
        
          <li>
            <a href="/2017/11/27/svn-auto-update/">svn auto update</a>
          </li>
        
          <li>
            <a href="/2017/11/15/salt-manage-event-reactor/">salt manage event reactor</a>
          </li>
        
          <li>
            <a href="/2017/11/15/salt-manage-job/">salt manage job</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 penn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>