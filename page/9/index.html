<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>smallasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="smallasa">
<meta property="og:url" content="http://www.smallasa.com/page/9/index.html">
<meta property="og:site_name" content="smallasa">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="smallasa">
  
    <link rel="alternate" href="/atom.xml" title="smallasa" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">smallasa</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I known what i do !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.smallasa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-SSL-certificate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/18/SSL-certificate/" class="article-date">
  <time datetime="2017-07-18T01:25:19.000Z" itemprop="datePublished">2017-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>►<a class="article-category-link" href="/categories/web/SSL/">SSL</a>►<a class="article-category-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/18/SSL-certificate/">SSL certificate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="SSL-证书相关信息"><a href="#SSL-证书相关信息" class="headerlink" title="SSL 证书相关信息"></a>SSL 证书相关信息</h3><ol>
<li><p>SSL专用名词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* HTTPS</span><br><span class="line">  HTTPS=HTTP+SSL,是 HTTP 基于 SSL 协议的网站加密传输协议,网站安装 SSL 证书后,使用 HTTPS 加密协议访问,可激活客户端浏览器到网站服务器之间的&quot;SSL 加密通道&quot;(SSL 协议),实现高强度双向加密传输,以保护传输数据的隐私性与完整性</span><br><span class="line"></span><br><span class="line">* SSL</span><br><span class="line">  SSL（Secure Sockets Layer）即安全套接层,利用数据加密(Encryption)技术,可确保数据在网络上传输过程中不会被截取.SSL 协议位于 TCP/IP 协议与各种应用层协议之间,为数据通讯提供安全支持</span><br><span class="line"></span><br><span class="line">* SSL 证书</span><br><span class="line">  SSL 证书就是遵守 SSL 协议的服务器数字证书,由受信任的数字证书颁发机构CA颁发,具有服务器身份验证和数据传输加密等功能</span><br><span class="line"></span><br><span class="line">* CA</span><br><span class="line">  数字证书授权机构(CA，Certificate Authority)是负责发放和管理数字证书的权威机构</span><br><span class="line"></span><br><span class="line">* RSA</span><br><span class="line">  RSA 公钥加密算法是 1977 年由 Ron Rivest、Adi Shamir、Leonard Adleman 一起提出的,它是第一个能同时用于加密和数字签名的算法,从提出到现今经历了各种攻击的考验,能够抵抗到目前为止已知的绝大多数密码攻击,已被 ISO 推荐为公钥数据加密标准</span><br><span class="line"></span><br><span class="line">* ECC</span><br><span class="line">  ECC(Elliptic Curves Cryptography，椭圆曲线加密算法)也是一种公钥加密算法,与主流的 RSA 算法相比,ECC 算法可以使用较短的密钥达到相同的安全程度,其安全性更高、处理速度更快</span><br></pre></td></tr></table></figure>
</li>
<li><p>SSL域名证书类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* DV</span><br><span class="line">  信任等级一般只需验证网站的真实性便可颁发证书保护网站 普通加锁标记(一般免费)</span><br><span class="line">  适用于个人网站</span><br><span class="line"></span><br><span class="line">* OV</span><br><span class="line">  信任等级强须要验证企业的身份，审核严格，安全性更高 普通加锁标记(收费)</span><br><span class="line">  适用于企业官网,一般网店,电商</span><br><span class="line"></span><br><span class="line">* EV</span><br><span class="line">  信任等级最高须要验证企业的身份，审核严格，安全性最高 绿色安全地址栏(收费)</span><br><span class="line">  适用于金融行业</span><br><span class="line"></span><br><span class="line">补充:</span><br><span class="line">标准域名: www.qiniu.com；qiniu.com；abc.qiniu.com</span><br><span class="line">泛域名:  *.qiniu.com；.abc.qiniu.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>SSL域名证书验证方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* 邮箱验证</span><br><span class="line">  系统会向你选择的管理员邮箱 发送验证邮件，能够收到验证邮件，并点击邮件中验证链接 即可完成验证</span><br><span class="line">  域名管理员邮箱须符合以下任意规则:</span><br><span class="line">  1.域名 whois 管理联系人邮箱</span><br><span class="line">  2.域名 whois 技术联系人邮箱</span><br><span class="line">  3.默认管理员前缀的邮箱：</span><br><span class="line">    admin@domain.com</span><br><span class="line">    administrator@domain.com</span><br><span class="line">    hostmaster@domain.com</span><br><span class="line">    webmaster@domain.com</span><br><span class="line">    postmaster@domain.com</span><br><span class="line"></span><br><span class="line">* DNS验证</span><br><span class="line">  通过解析指定的DNS记录验证域名所有权</span><br><span class="line">  例如: sr5jtl17ng5dfzjvx2lg9fxm90dygdps.domain.com ---CName--&gt; s20150112110645.domain.com</span><br><span class="line">       系统会定时检查 sr5jtl17ng5dfzjvx2lg9fxm90dygdps.domain.com 的CName纪录，若能检测到 并且与指定的值匹配 即可完成域名所有权验证</span><br><span class="line"></span><br><span class="line">* 文件验证</span><br><span class="line">  通过在域名根目录下创建指定的文件验证域名所有权</span><br><span class="line">  例如：创建文件 irmvo302.htm 文件内容 NtdutxbskfhWvP3OffXW</span><br><span class="line">       系统会定时尝试访问 http://xxx.domain/irmvo302.htm 这个文件,若能访问到 并且内容匹配即可完成域名所有权验证</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/18/SSL-certificate/" data-id="cjavy9jtw000t0coq0ibkydyy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-smokeping-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/14/smokeping-install/" class="article-date">
  <time datetime="2017-07-14T04:03:02.000Z" itemprop="datePublished">2017-07-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Monitor/">Monitor</a>►<a class="article-category-link" href="/categories/Monitor/smokeping/">smokeping</a>►<a class="article-category-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/14/smokeping-install/">smokeping install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="smokeping-install"><a href="#smokeping-install" class="headerlink" title="smokeping install"></a>smokeping install</h3><ol>
<li><p>smokeping 简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Smokeping 是一款用于网络性能监测的监控软件,通过它可以检测IDC的网络状况(如:延时,丢包率,是否BGP多线等),通过rrdtool制图方式,图形化地展示网络的时延情况,进而能够清楚的判断出网络的即时通信情况.</span><br></pre></td></tr></table></figure>
</li>
<li><p>smokeping install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//基础环境安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install gcc gcc-c++ make cmake bison libtool autoconf automake zip unzip bzip2 zlib zlib-devel openssl openssl-devel pcre pcre-devel bison-devel ncurses-devel tcl tcl-devel perl-Digest-SHA1 GeoIP GeoIP-devel gperftools gperftools-devel libatomic_ops-devel gtest gtest-devel glibc-devel unixODBC-devel fop libperl libpython readline readline-devel python2-pip readline readline-devel readline-static openssl openssl-devel openssl-static sqlite-devel bzip2-devel bzip2-libs openldap-devel</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install git lftp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span></span><br><span class="line"></span><br><span class="line">//perl版本</span><br><span class="line">[root@localhost ~]<span class="comment"># perl -v|head -2|tail -1</span></span><br><span class="line">This is perl 5, version 16, subversion 3 (v5.16.3) built <span class="keyword">for</span> x86_64-linux-thread-multi</span><br><span class="line"></span><br><span class="line">//curl版本</span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># curl -V</span></span><br><span class="line">curl 7.29.0 (x86_64-redhat-linux-gnu) libcurl/7.29.0 NSS/3.15.4 zlib/1.2.7 libidn/1.28 libssh2/1.4.3</span><br><span class="line"></span><br><span class="line">//ssh版本</span><br><span class="line">[root@localhost ~]<span class="comment"># ssh -V</span></span><br><span class="line">OpenSSH_6.4p1, OpenSSL 1.0.1e-fips 11 Feb 2013</span><br><span class="line"></span><br><span class="line">//fping安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install fping</span></span><br><span class="line"></span><br><span class="line">//echoping安装</span><br><span class="line">[root@localhost app]<span class="comment"># yum -y install popt popt-devel libidn libidn-devel</span></span><br><span class="line">[root@localhost app]<span class="comment"># wget https://fossies.org/linux/misc/old/echoping-6.0.2.tar.gz</span></span><br><span class="line">[root@localhost app]<span class="comment"># tar xzf echoping-6.0.2.tar.gz</span></span><br><span class="line">[root@localhost app]<span class="comment"># cd echoping-6.0.2</span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># ./configure --prefix=/mnt/app/echoping</span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># make</span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># make install</span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># echo "ECHOPING_HOME=/mnt/app/echoping" |tee /etc/profile.d/echoping.sh</span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># echo "ECHOPING_BIN=\$&#123;ECHOPING_HOME&#125;/bin" |tee -a /etc/profile.d/echoping.sh      </span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># echo "export PATH=\$&#123;ECHOPING_BIN&#125;:\$PATH" |tee -a /etc/profile.d/echoping.sh</span></span><br><span class="line">[root@localhost echoping-6.0.2]<span class="comment"># source /etc/profile.d/echoping.sh</span></span><br><span class="line"></span><br><span class="line">//dig安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum install bind-utils   //dig命令</span></span><br><span class="line"></span><br><span class="line">//rrdtool安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install rrdtool rrdtool-perl</span></span><br><span class="line"></span><br><span class="line">//httpd安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install httpd</span></span><br><span class="line"></span><br><span class="line">//smokeping安装</span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install smokeping</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>smokeping config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># useradd -s /sbin/nologin smokeping</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/smokeping/config</span></span><br><span class="line">*** General ***</span><br><span class="line">owner    = &#123;姓名&#125;</span><br><span class="line">contact  = &#123;邮箱&#125;</span><br><span class="line">mailhost = &#123;邮箱服务器地址&#125;</span><br><span class="line">sendmail = /usr/sbin/sendmail</span><br><span class="line">imgcache = /mnt/data/smokeping/images</span><br><span class="line">imgurl   = /smokeping/images</span><br><span class="line">datadir  = /mnt/data/smokeping/rrd</span><br><span class="line">piddir   = /var/run/smokeping</span><br><span class="line">cgiurl   = http://&#123;192.168.13.202&#125;/smokeping/sm.cgi</span><br><span class="line">smokemail = /etc/smokeping/smokemail</span><br><span class="line">tmail     = /etc/smokeping/tmail</span><br><span class="line">syslogfacility = local0</span><br><span class="line">*** Alerts ***</span><br><span class="line">to = &#123;接收邮箱地址&#125;</span><br><span class="line">from = &#123;发送邮箱地址&#125;</span><br><span class="line">+someloss</span><br><span class="line"><span class="built_in">type</span> = loss</span><br><span class="line">pattern = &gt;0%,*12*,&gt;0%,*12*,&gt;0%</span><br><span class="line">comment = loss 3 <span class="built_in">times</span>  <span class="keyword">in</span> a row</span><br><span class="line">*** Database ***</span><br><span class="line">step     = 60</span><br><span class="line">pings    = 20</span><br><span class="line">AVERAGE  0.5   1  1008</span><br><span class="line">AVERAGE  0.5  12  4320</span><br><span class="line">    MIN  0.5  12  4320</span><br><span class="line">    MAX  0.5  12  4320</span><br><span class="line">AVERAGE  0.5 144   720</span><br><span class="line">    MAX  0.5 144   720</span><br><span class="line">    MIN  0.5 144   720</span><br><span class="line">*** Presentation ***</span><br><span class="line">template = /etc/smokeping/basepage.html</span><br><span class="line">charset = utf-8</span><br><span class="line">+ charts</span><br><span class="line">menu = Charts</span><br><span class="line">title = The most interesting destinations</span><br><span class="line">++ stddev</span><br><span class="line">sorter = StdDev(entries=&gt;4)</span><br><span class="line">title = Top Standard Deviation</span><br><span class="line">menu = Std Deviation</span><br><span class="line">format = Standard Deviation %f</span><br><span class="line">++ max</span><br><span class="line">sorter = Max(entries=&gt;5)</span><br><span class="line">title = Top Max Roundtrip Time</span><br><span class="line">menu = by Max</span><br><span class="line">format = Max Roundtrip Time %f seconds</span><br><span class="line">++ loss</span><br><span class="line">sorter = Loss(entries=&gt;5)</span><br><span class="line">title = Top Packet Loss</span><br><span class="line">menu = Loss</span><br><span class="line">format = Packets Lost %f</span><br><span class="line">++ median</span><br><span class="line">sorter = Median(entries=&gt;5)</span><br><span class="line">title = Top Median Roundtrip Time</span><br><span class="line">menu = by Median</span><br><span class="line">format = Median RTT %f seconds</span><br><span class="line">+ overview</span><br><span class="line">width = 600</span><br><span class="line">height = 50</span><br><span class="line">range = 10h</span><br><span class="line">+ detail</span><br><span class="line">width = 600</span><br><span class="line">height = 200</span><br><span class="line">unison_tolerance = 2</span><br><span class="line"><span class="string">"Last 3 Hours"</span>    3h</span><br><span class="line"><span class="string">"Last 30 Hours"</span>   30h</span><br><span class="line"><span class="string">"Last 10 Days"</span>    10d</span><br><span class="line"><span class="string">"Last 400 Days"</span>   400d</span><br><span class="line">*** Probes ***</span><br><span class="line">+ FPing</span><br><span class="line">binary = /usr/sbin/fping</span><br><span class="line">*** Slaves ***</span><br><span class="line">secrets=/etc/smokeping/smokeping_secrets</span><br><span class="line">+boomer</span><br><span class="line">display_name=boomer</span><br><span class="line">color=0000ff</span><br><span class="line">+slave2</span><br><span class="line">display_name=another</span><br><span class="line">color=00ff00</span><br><span class="line">*** Targets ***</span><br><span class="line">probe = FPing</span><br><span class="line">menu = Top</span><br><span class="line">title = Network Latency Grapher</span><br><span class="line">remark = Welcome to the SmokePing website of &lt;b&gt;众荟&lt;/b&gt;. \</span><br><span class="line">         Here you will learn all about the latency of our network.</span><br><span class="line">+ Ping</span><br><span class="line">menu  = &#123;XX机房&#125;</span><br><span class="line">title = &#123;&#125;监控统计&#125;</span><br><span class="line">++ AliCloud</span><br><span class="line">menu  = 阿里云网络监控</span><br><span class="line">title = 阿里云网络监控列表</span><br><span class="line">host  = /Ping/AliCloud/&#123;xx1&#125; /Ping/AliCloud/&#123;xx2&#125;</span><br><span class="line">+++ &#123;xx1&#125;</span><br><span class="line">menu   = &#123;xx1&#125;</span><br><span class="line">title  = &#123;xx1&#125;</span><br><span class="line">alerts = someloss</span><br><span class="line">host   = &#123;xx1 服务器地址&#125;</span><br><span class="line">+++ &#123;xx2&#125;</span><br><span class="line">menu   = &#123;xx2&#125;</span><br><span class="line">title  = &#123;xx2&#125;</span><br><span class="line">alerts = someloss</span><br><span class="line">host   = &#123;xx2 服务器地址&#125;</span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir -p /mnt/data/smokeping/&#123;images,rrd&#125;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chown -R apache /mnt/data/smokeping/images</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>smokeping 中文显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum -y install wqy-zenhei-fonts</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/smokeping/config</span></span><br><span class="line">*** Presentation ***</span><br><span class="line">charset = utf-8</span><br><span class="line">[root@localhost ~]<span class="comment">#  vim /usr/share/smokeping/Smokeping/Graphs.pm</span></span><br><span class="line">在第147行下边插入下边一行:</span><br><span class="line"><span class="string">'--font TITLE:20:"WenQuanYi Zen Hei Mono"'</span>,</span><br><span class="line">例如:</span><br><span class="line">my (<span class="variable">$graphret</span>,<span class="variable">$xs</span>,<span class="variable">$ys</span>) = RRDs::graph</span><br><span class="line">(<span class="string">"dummy"</span>,</span><br><span class="line"><span class="string">'--start'</span>, <span class="variable">$tasks</span>[0][1],</span><br><span class="line"><span class="string">'--end'</span>, <span class="variable">$tasks</span>[0][2],</span><br><span class="line"><span class="string">'--font TITLE:20:"WenQuanYi Zen Hei Mono"'</span>,</span><br><span class="line"><span class="string">"DEF:maxping=<span class="variable">$cfg</span>-&gt;&#123;General&#125;&#123;datadir&#125;<span class="variable">$&#123;host&#125;</span>.rrd:median:AVERAGE"</span>,</span><br><span class="line"><span class="string">'PRINT:maxping:MAX:%le'</span> );</span><br></pre></td></tr></table></figure>
</li>
<li><p>httpd配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-company ~]<span class="comment"># cat /etc/httpd/conf.d/smokeping.conf</span></span><br><span class="line">&lt;Directory <span class="string">"/usr/share/smokeping"</span> &gt;</span><br><span class="line">  Require <span class="built_in">local</span></span><br><span class="line">  Require ip 0.0.0.0</span><br><span class="line">  <span class="comment"># Require host example.org</span></span><br><span class="line">  Options Indexes FollowSymLinks  </span><br><span class="line">  Options +ExecCGI  </span><br><span class="line">  AllowOverride None</span><br><span class="line">  DirectoryIndex smokeping.fcgi</span><br><span class="line">  Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/mnt/data/smokeping"</span> &gt;</span><br><span class="line">  Require <span class="built_in">local</span></span><br><span class="line">  Require ip 0.0.0.0</span><br><span class="line">  <span class="comment"># Require host example.org</span></span><br><span class="line">  AllowOverride None</span><br><span class="line">  Require all granted   </span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># .fcgi : smokeping by mod_fcgid aka fastcgi</span></span><br><span class="line"><span class="comment"># _cgi  : plain old fashion cgi</span></span><br><span class="line">ScriptAlias /smokeping/sm.cgi  /usr/share/smokeping/cgi/smokeping.fcgi</span><br><span class="line"><span class="comment">#ScriptAlias /smokeping/sm.cgi  /usr/share/smokeping/cgi/smokeping_cgi</span></span><br><span class="line"></span><br><span class="line">Alias       /smokeping/images  /mnt/data/smokeping/images</span><br><span class="line">Alias       /smokeping         /usr/share/smokeping/htdocs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">1.httpd 版本是2.4</span><br><span class="line">2.每次更新完smokeping的配置文件conf后,需要重启httpd服务</span><br></pre></td></tr></table></figure>
</li>
<li><p>做软连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ln -s /usr/share/smokeping/cgi/smokeping_cgi /usr/share/smokeping/htdocs/smokeping.fcgi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl start smokeping</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/14/smokeping-install/" data-id="cjavy9k7700av0coq3d6iuyd7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-zabbix-optimization" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/13/zabbix-optimization/" class="article-date">
  <time datetime="2017-07-13T01:10:03.000Z" itemprop="datePublished">2017-07-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Monitor/">Monitor</a>►<a class="article-category-link" href="/categories/Monitor/zabbix/">zabbix</a>►<a class="article-category-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/13/zabbix-optimization/">zabbix optimization</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="zabbix-优化"><a href="#zabbix-优化" class="headerlink" title="zabbix 优化"></a>zabbix 优化</h3><ol>
<li><p>zabbix Poller 调整</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* Option: StartPollers              处理监控项</span><br><span class="line">* Option: StartIPMIPollers          处理IPMI,暂时未用,设置为0</span><br><span class="line">* Option: StartPollersUnreachable   获取数据遇到不可到达时,交给这些进程处理</span><br><span class="line">* Option: StartHTTPPollers          监控HTTP,WEB,设置为10</span><br><span class="line">* Option: StartJavaPollers          监控JAVA专用进程,设置为10</span><br><span class="line">* Option: StartProxyPollers         处理代理的进程,设置为30</span><br><span class="line">* Option: StartDiscoverers          处理自动发现的,设置为30</span><br><span class="line">* Option: StartPingers              如果用了ICMP PING那个模板的,这个值要调大一些</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">StartPollers,然配置文件写是可用范围是0-1000,但这个1000是所有的进程的值,也就是说上面那些进程的总数不能超过1000,设的时候要注意一下这点</span><br></pre></td></tr></table></figure>
</li>
<li><p>关于Cache的调整</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* Option: CacheSize               zabbix初始化时占用多少系统共享内存用于存储配置信息(HOST,ITEM,TRIGGER数据，视监控主机数量和监控项调整)</span><br><span class="line">* Option: CacheUpdateFrequency    zabbix更新操作系统CACHE频率,若管理页面操作不频繁,可以考虑加大参数值       </span><br><span class="line">* Option: HistoryCacheSize        用于设置划分多少系统共享内存用于存储采集的历史数据，此数值越大，数据库读压力越小</span><br><span class="line">* Option: TrendCacheSize          用于设置划分多少系统共享内存用于存储计算出来的趋势数据，此参数值从一定程度上可影响数据库读压力</span><br><span class="line">* Option: HistoryIndexCacheSize   历史数据索引缓存</span><br><span class="line">* Option: ValueCacheSize          划出系统多少共享内存用于已请求的存储监控项信息，若监控项较多，建议加大此数值</span><br><span class="line"></span><br><span class="line">注意: 关于内存的参数有这么多,都是要根据机器数量和item数量的增加而增加,这些内存的值不能大于系统内核的kernel.shmall这个值,否则申请不了内存程序启动不了</span><br></pre></td></tr></table></figure>
</li>
<li><p>内核共享内存优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql ~]# echo kernel.shmmax=15461882265 | tee -a /etc/sysctl.conf</span><br><span class="line">[root@zabbix-server-mysql ~]# echo kernel.shmall=3774873 | tee -a /etc/sysctl.conf</span><br><span class="line">[root@zabbix-server-mysql ~]# echo kernel.msgmax=65535 | tee -a /etc/sysctl.conf</span><br><span class="line">[root@zabbix-server-mysql ~]# echo kernel.msgmnb=65535 | tee -a /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">shmall是全部允许使用的共享内存大小,shmmax是单个段允许使用的大小.这两个可以设置为内存的90%</span><br><span class="line">例如:16G内存,shmmax的大小为 16*1024*1024*1024*90% = 15461882265,shmall的大小为 15461882265/4k(getconf PAGESIZE可得到) = 3774873</span><br><span class="line"></span><br><span class="line">msgmax该文件指定了从一个进程发送到另一个进程的消息的最大长度(bytes).进程间的消息传递是在内核的内存中进行的,不会交换到磁盘上,所以如果增加该值,则将增加操作系统所使用的内存数量</span><br><span class="line">msgmnb该文件指定一个消息队列的最大长度(bytes)</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库配置参数优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql ~]# cat /mnt/app/mysql/conf/3306.M.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">user    = mysql</span><br><span class="line">port    = 3306</span><br><span class="line">basedir = /mnt/app/mysql</span><br><span class="line">datadir = /mnt/data/mysql/3306</span><br><span class="line">socket  = /mnt/data/mysql/3306/mysql.sock</span><br><span class="line">default-storage-engine = InnoDB</span><br><span class="line">character_set_server   = utf8</span><br><span class="line">max_connections        = 5000</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line">server-id               = 210</span><br><span class="line">max_allowed_packet      = 32m</span><br><span class="line">max_heap_table_size     = 128m</span><br><span class="line">read_rnd_buffer_size    = 8m</span><br><span class="line">sort_buffer_size        = 4m</span><br><span class="line">join_buffer_size        = 4m</span><br><span class="line">query_cache_type        = 1</span><br><span class="line">query_cache_size        = 512m</span><br><span class="line">query_cache_limit       = 4m</span><br><span class="line">innodb_open_files       = 3000</span><br><span class="line">innodb_buffer_pool_size = 12G</span><br><span class="line">innodb_file_per_table   = 1</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/mnt/log/mysql/3306/mysqld.log</span><br><span class="line">pid-file =/mnt/app/mysql/mysqld.3306.pid</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket=/mnt/data/mysql/3306/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket=/mnt/data/mysql/3306/mysql.sock</span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql ~]# /etc/init.d/mysql.3306M restart</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="https://www.zabbix.org/wiki/Docs/howto/mysql_partition" target="_blank" rel="noopener">zabbix mysql 表分区优化</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">机器数量多的时候,mysql里面的history表就会越来越大,虽然zabbix本身有删除功能(就是那个housekeeper的功能),但这东西太影响性能,所以网上的做法都是关闭这个东西,用mysql的表分区功能来实现清理历史数据还可以提升mysql的性能</span><br><span class="line"></span><br><span class="line">补充: zabbix 3.2 版本数据库不需要重新执行创建索引过程；2.0,3.0版本都需要</span><br><span class="line">mysql&gt; Alter table history_text drop primary key, add index (id), drop index history_text_2, add index history_text_2 (itemid, id);</span><br><span class="line">mysql&gt; Alter table history_log drop primary key, add index (id), drop index history_log_2, add index history_log_2 (itemid, id);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql data]# vim partition_call.sql</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE `partition_create`(SCHEMANAME varchar(64), TABLENAME varchar(64), PARTITIONNAME varchar(64), CLOCK int)</span><br><span class="line">BEGIN</span><br><span class="line">        /*</span><br><span class="line">           SCHEMANAME = The DB schema in which to make changes</span><br><span class="line">           TABLENAME = The table with partitions to potentially delete</span><br><span class="line">           PARTITIONNAME = The name of the partition to create</span><br><span class="line">        */</span><br><span class="line">        /*</span><br><span class="line">           Verify that the partition does not already exist</span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">        DECLARE RETROWS INT;</span><br><span class="line">        SELECT COUNT(1) INTO RETROWS</span><br><span class="line">        FROM information_schema.partitions</span><br><span class="line">        WHERE table_schema = SCHEMANAME AND table_name = TABLENAME AND partition_description &gt;= CLOCK;</span><br><span class="line"></span><br><span class="line">        IF RETROWS = 0 THEN</span><br><span class="line">                /*</span><br><span class="line">                   1. Print a message indicating that a partition was created.</span><br><span class="line">                   2. Create the SQL to create the partition.</span><br><span class="line">                   3. Execute the SQL from #2.</span><br><span class="line">                */</span><br><span class="line">                SELECT CONCAT( &quot;partition_create(&quot;, SCHEMANAME, &quot;,&quot;, TABLENAME, &quot;,&quot;, PARTITIONNAME, &quot;,&quot;, CLOCK, &quot;)&quot; ) AS msg;</span><br><span class="line">                SET @sql = CONCAT( &apos;ALTER TABLE &apos;, SCHEMANAME, &apos;.&apos;, TABLENAME, &apos; ADD PARTITION (PARTITION &apos;, PARTITIONNAME, &apos; VALUES LESS THAN (&apos;, CLOCK, &apos;));&apos; );</span><br><span class="line">                PREPARE STMT FROM @sql;</span><br><span class="line">                EXECUTE STMT;</span><br><span class="line">                DEALLOCATE PREPARE STMT;</span><br><span class="line">        END IF;</span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE `partition_drop`(SCHEMANAME VARCHAR(64), TABLENAME VARCHAR(64), DELETE_BELOW_PARTITION_DATE BIGINT)</span><br><span class="line">BEGIN</span><br><span class="line">        /*</span><br><span class="line">           SCHEMANAME = The DB schema in which to make changes</span><br><span class="line">           TABLENAME = The table with partitions to potentially delete</span><br><span class="line">           DELETE_BELOW_PARTITION_DATE = Delete any partitions with names that are dates older than this one (yyyy-mm-dd)</span><br><span class="line">        */</span><br><span class="line">        DECLARE done INT DEFAULT FALSE;</span><br><span class="line">        DECLARE drop_part_name VARCHAR(16);</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">           Get a list of all the partitions that are older than the date</span><br><span class="line">           in DELETE_BELOW_PARTITION_DATE.  All partitions are prefixed with</span><br><span class="line">           a &quot;p&quot;, so use SUBSTRING TO get rid of that character.</span><br><span class="line">        */</span><br><span class="line">        DECLARE myCursor CURSOR FOR</span><br><span class="line">                SELECT partition_name</span><br><span class="line">                FROM information_schema.partitions</span><br><span class="line">                WHERE table_schema = SCHEMANAME AND table_name = TABLENAME AND CAST(SUBSTRING(partition_name FROM 2) AS UNSIGNED) &lt; DELETE_BELOW_PARTITION_DATE;</span><br><span class="line">        DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">           Create the basics for when we need to drop the partition.  Also, create</span><br><span class="line">           @drop_partitions to hold a comma-delimited list of all partitions that</span><br><span class="line">           should be deleted.</span><br><span class="line">        */</span><br><span class="line">        SET @alter_header = CONCAT(&quot;ALTER TABLE &quot;, SCHEMANAME, &quot;.&quot;, TABLENAME, &quot; DROP PARTITION &quot;);</span><br><span class="line">        SET @drop_partitions = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">           Start looping through all the partitions that are too old.</span><br><span class="line">        */</span><br><span class="line">        OPEN myCursor;</span><br><span class="line">        read_loop: LOOP</span><br><span class="line">                FETCH myCursor INTO drop_part_name;</span><br><span class="line">                IF done THEN</span><br><span class="line">                        LEAVE read_loop;</span><br><span class="line">                END IF;</span><br><span class="line">                SET @drop_partitions = IF(@drop_partitions = &quot;&quot;, drop_part_name, CONCAT(@drop_partitions, &quot;,&quot;, drop_part_name));</span><br><span class="line">        END LOOP;</span><br><span class="line">        IF @drop_partitions != &quot;&quot; THEN</span><br><span class="line">                /*</span><br><span class="line">                   1. Build the SQL to drop all the necessary partitions.</span><br><span class="line">                   2. Run the SQL to drop the partitions.</span><br><span class="line">                   3. Print out the table partitions that were deleted.</span><br><span class="line">                */</span><br><span class="line">                SET @full_sql = CONCAT(@alter_header, @drop_partitions, &quot;;&quot;);</span><br><span class="line">                PREPARE STMT FROM @full_sql;</span><br><span class="line">                EXECUTE STMT;</span><br><span class="line">                DEALLOCATE PREPARE STMT;</span><br><span class="line"></span><br><span class="line">                SELECT CONCAT(SCHEMANAME, &quot;.&quot;, TABLENAME) AS `table`, @drop_partitions AS `partitions_deleted`;</span><br><span class="line">        ELSE</span><br><span class="line">                /*</span><br><span class="line">                   No partitions are being deleted, so print out &quot;N/A&quot; (Not applicable) to indicate</span><br><span class="line">                   that no changes were made.</span><br><span class="line">                */</span><br><span class="line">                SELECT CONCAT(SCHEMANAME, &quot;.&quot;, TABLENAME) AS `table`, &quot;N/A&quot; AS `partitions_deleted`;</span><br><span class="line">        END IF;</span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE `partition_maintenance`(SCHEMA_NAME VARCHAR(32), TABLE_NAME VARCHAR(32), KEEP_DATA_DAYS INT, HOURLY_INTERVAL INT, CREATE_NEXT_INTERVALS INT)</span><br><span class="line">BEGIN</span><br><span class="line">        DECLARE OLDER_THAN_PARTITION_DATE VARCHAR(16);</span><br><span class="line">        DECLARE PARTITION_NAME VARCHAR(16);</span><br><span class="line">        DECLARE OLD_PARTITION_NAME VARCHAR(16);</span><br><span class="line">        DECLARE LESS_THAN_TIMESTAMP INT;</span><br><span class="line">        DECLARE CUR_TIME INT;</span><br><span class="line"></span><br><span class="line">        CALL partition_verify(SCHEMA_NAME, TABLE_NAME, HOURLY_INTERVAL);</span><br><span class="line">        SET CUR_TIME = UNIX_TIMESTAMP(DATE_FORMAT(NOW(), &apos;%Y-%m-%d 00:00:00&apos;));</span><br><span class="line"></span><br><span class="line">        SET @__interval = 1;</span><br><span class="line">        create_loop: LOOP</span><br><span class="line">                IF @__interval &gt; CREATE_NEXT_INTERVALS THEN</span><br><span class="line">                        LEAVE create_loop;</span><br><span class="line">                END IF;</span><br><span class="line"></span><br><span class="line">                SET LESS_THAN_TIMESTAMP = CUR_TIME + (HOURLY_INTERVAL * @__interval * 3600);</span><br><span class="line">                SET PARTITION_NAME = FROM_UNIXTIME(CUR_TIME + HOURLY_INTERVAL * (@__interval - 1) * 3600, &apos;p%Y%m%d%H00&apos;);</span><br><span class="line">                IF(PARTITION_NAME != OLD_PARTITION_NAME) THEN</span><br><span class="line">                        CALL partition_create(SCHEMA_NAME, TABLE_NAME, PARTITION_NAME, LESS_THAN_TIMESTAMP);</span><br><span class="line">                END IF;</span><br><span class="line">                SET @__interval=@__interval+1;</span><br><span class="line">                SET OLD_PARTITION_NAME = PARTITION_NAME;</span><br><span class="line">        END LOOP;</span><br><span class="line"></span><br><span class="line">        SET OLDER_THAN_PARTITION_DATE=DATE_FORMAT(DATE_SUB(NOW(), INTERVAL KEEP_DATA_DAYS DAY), &apos;%Y%m%d0000&apos;);</span><br><span class="line">        CALL partition_drop(SCHEMA_NAME, TABLE_NAME, OLDER_THAN_PARTITION_DATE);</span><br><span class="line"></span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE `partition_verify`(SCHEMANAME VARCHAR(64), TABLENAME VARCHAR(64), HOURLYINTERVAL INT(11))</span><br><span class="line">BEGIN</span><br><span class="line">        DECLARE PARTITION_NAME VARCHAR(16);</span><br><span class="line">        DECLARE RETROWS INT(11);</span><br><span class="line">        DECLARE FUTURE_TIMESTAMP TIMESTAMP;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">         * Check if any partitions exist for the given SCHEMANAME.TABLENAME.</span><br><span class="line">         */</span><br><span class="line">        SELECT COUNT(1) INTO RETROWS</span><br><span class="line">        FROM information_schema.partitions</span><br><span class="line">        WHERE table_schema = SCHEMANAME AND table_name = TABLENAME AND partition_name IS NULL;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">         * If partitions do not exist, go ahead and partition the table</span><br><span class="line">         */</span><br><span class="line">        IF RETROWS = 1 THEN</span><br><span class="line">                /*</span><br><span class="line">                 * Take the current date at 00:00:00 and add HOURLYINTERVAL to it.  This is the timestamp below which we will store values.</span><br><span class="line">                 * We begin partitioning based on the beginning of a day.  This is because we don&apos;t want to generate a random partition</span><br><span class="line">                 * that won&apos;t necessarily fall in line with the desired partition naming (ie: if the hour interval is 24 hours, we could</span><br><span class="line">                 * end up creating a partition now named &quot;p201403270600&quot; when all other partitions will be like &quot;p201403280000&quot;).</span><br><span class="line">                 */</span><br><span class="line">                SET FUTURE_TIMESTAMP = TIMESTAMPADD(HOUR, HOURLYINTERVAL, CONCAT(CURDATE(), &quot; &quot;, &apos;00:00:00&apos;));</span><br><span class="line">                SET PARTITION_NAME = DATE_FORMAT(CURDATE(), &apos;p%Y%m%d%H00&apos;);</span><br><span class="line"></span><br><span class="line">                -- Create the partitioning query</span><br><span class="line">                SET @__PARTITION_SQL = CONCAT(&quot;ALTER TABLE &quot;, SCHEMANAME, &quot;.&quot;, TABLENAME, &quot; PARTITION BY RANGE(`clock`)&quot;);</span><br><span class="line">                SET @__PARTITION_SQL = CONCAT(@__PARTITION_SQL, &quot;(PARTITION &quot;, PARTITION_NAME, &quot; VALUES LESS THAN (&quot;, UNIX_TIMESTAMP(FUTURE_TIMESTAMP), &quot;));&quot;);</span><br><span class="line"></span><br><span class="line">                -- Run the partitioning query</span><br><span class="line">                PREPARE STMT FROM @__PARTITION_SQL;</span><br><span class="line">                EXECUTE STMT;</span><br><span class="line">                DEALLOCATE PREPARE STMT;</span><br><span class="line">        END IF;</span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql data]# mysql -S /mnt/data/mysql/3306/mysql.sock zabbix &lt; partition_call.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建调用存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql data]# vim partition_call_call.sql</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE `partition_maintenance_all`(SCHEMA_NAME VARCHAR(32))</span><br><span class="line">BEGIN</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;history&apos;, 30, 24, 14);</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;history_log&apos;, 30, 24, 14);</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;history_str&apos;, 30, 24, 14);</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;history_text&apos;, 30, 24, 14);</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;history_uint&apos;, 30, 24, 14);</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;trends&apos;, 730, 24, 14);</span><br><span class="line">                CALL partition_maintenance(SCHEMA_NAME, &apos;trends_uint&apos;, 730, 24, 14);</span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">mysql&gt; CALL partition_maintenance(&apos;&lt;zabbix_db_name&gt;&apos;, &apos;&lt;table_name&gt;&apos;, &lt;days_to_keep_data&gt;, &lt;hourly_interval&gt;, &lt;num_future_intervals_to_create&gt;)</span><br><span class="line">说明:</span><br><span class="line">zabbix_db_name    库名</span><br><span class="line">table_name        表名</span><br><span class="line">days_to_keep_data 保存多少天的数据</span><br><span class="line">hourly_interval   每隔多久生成一个分区</span><br><span class="line">num_future_intervals_to_create  本次一共生成多少个分区</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行调用存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql data]# mysql -S /mnt/data/mysql/3306/mysql.sock zabbix -e &quot;CALL partition_maintenance_all(&apos;zabbix&apos;);&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将”执行调用存储过程”命令,加入计划任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql data]# crontab -l</span><br><span class="line">5 1 * * *     /mnt/app/mysql/bin/mysql -S /mnt/data/mysql/3306/mysql.sock zabbix -e &quot;CALL partition_maintenance_all(&apos;zabbix&apos;);&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>关掉Zabbix的HouseKeeper功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">administration -&gt; general -&gt; HouseKeeping -&gt; &quot;取消勾选框,保存&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决表依赖关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET foreign_key_checks=0;</span><br><span class="line">mysql&gt; truncate table events;</span><br><span class="line">mysql&gt; SET foreign_key_checks=1;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/13/zabbix-optimization/" data-id="cjavy9k8j00bz0coqqu5dyr2w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-angular-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/10/angular-install/" class="article-date">
  <time datetime="2017-07-10T02:43:32.000Z" itemprop="datePublished">2017-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>►<a class="article-category-link" href="/categories/web/angular/">angular</a>►<a class="article-category-link" href="/categories/web/angular/angular-install/">angular install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/10/angular-install/">angular install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="angular-install"><a href="#angular-install" class="headerlink" title="angular install"></a>angular install</h3><ol>
<li><p>nodejs install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@dev app]<span class="comment"># xz -d node-v8.1.3-linux-x64.tar.xz</span></span><br><span class="line">[root@dev app]<span class="comment"># tar xf node-v8.1.3-linux-x64.tar</span></span><br><span class="line">[root@dev app]<span class="comment"># mv node-v8.1.3-linux-x64 /mnt/app/node</span></span><br><span class="line">[root@dev app]<span class="comment"># chown -R root.root /mnt/app/node</span></span><br><span class="line"></span><br><span class="line">[root@dev app]<span class="comment"># echo 'NODE_HOME=/mnt/app/node' |tee  /etc/profile.d/node.sh</span></span><br><span class="line">[root@dev app]<span class="comment"># echo 'NODE_PATH=$&#123;NODE_HOME&#125;/lib/node_modules' |tee -a /etc/profile.d/node.sh</span></span><br><span class="line">[root@dev app]<span class="comment"># echo 'export PATH=$&#123;PATH&#125;:$&#123;NODE_HOME&#125;/bin' |tee -a /etc/profile.d/node.sh</span></span><br><span class="line">[root@dev app]<span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line">[root@dev app]<span class="comment"># node -v</span></span><br><span class="line">v8.1.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改npm源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dev app]<span class="comment"># echo 'registry = https://registry.npm.taobao.org' &gt; ~/.npmrc</span></span><br><span class="line">[root@dev app]<span class="comment"># npm -v</span></span><br><span class="line">5.0.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>angular install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev app]<span class="comment"># npm install -g @angular/cli</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>angular 创建新项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># ng new my-app</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>angular 启动开发服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># cd my-app/</span></span><br><span class="line">[root@dev my-app]<span class="comment"># ng server --open --host 192.168.13.208 --port 4000</span></span><br><span class="line"></span><br><span class="line">浏览器中输入:http://192.168.13.208:4000/</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/10/angular-install/" data-id="cjavy9juv001n0coqlhs7w3e2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sass-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/10/sass-install/" class="article-date">
  <time datetime="2017-07-10T02:25:42.000Z" itemprop="datePublished">2017-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>►<a class="article-category-link" href="/categories/web/sass/">sass</a>►<a class="article-category-link" href="/categories/web/sass/sass-install/">sass install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/10/sass-install/">sass install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="sass-install"><a href="#sass-install" class="headerlink" title="sass install"></a>sass install</h3><ol>
<li><p>ruby install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB</span></span><br><span class="line">[root@dev ~]<span class="comment"># curl -sSL https://get.rvm.io | bash -s stable</span></span><br><span class="line">[root@dev ~]<span class="comment"># source /etc/profile.d/rvm.sh</span></span><br><span class="line">[root@dev ~]<span class="comment"># sed -i 's!ftp.ruby-lang.org/pub/ruby!cache.ruby-china.org/pub/ruby!g' $rvm_path/config/db</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># rvm install 2.4</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm --default use 2.4</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>sass install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># gem install sass</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem install compass</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># sass -v</span></span><br><span class="line">Sass 3.4.25 (Selective Steve)</span><br><span class="line">[root@dev ~]<span class="comment"># compass -v</span></span><br><span class="line">Compass 1.0.3 (Polaris)</span><br></pre></td></tr></table></figure>
</li>
<li><p>sass 编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># sass input.scss output.css  //单文件转换命令</span></span><br><span class="line">[root@dev ~]<span class="comment"># sass --watch input.scss:output.css  //单文件监听命令</span></span><br><span class="line">[root@dev ~]<span class="comment"># sass --watch app/sass:public/stylesheets  //sass监听整个目录</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># sass --watch input.scss:output.css --style compact  //编译格式</span></span><br><span class="line">[root@dev ~]<span class="comment"># sass --watch input.scss:output.css --sourcemap  //编译添加调试map</span></span><br><span class="line">[root@dev ~]<span class="comment"># sass --watch input.scss:output.css --style expanded --sourcemap  //选择编译格式并添加调试map</span></span><br><span class="line">[root@dev ~]<span class="comment"># sass --watch input.scss:output.css --debug-info  //开启debug信息</span></span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">1.sass内置有四种编译格式:nested``expanded``compact``compressed</span><br><span class="line">2.-sourcemap表示开启sourcemap调试.开启sourcemap调试后,会生成一个后缀名为.css.map文件</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/10/sass-install/" data-id="cjavy9k7600at0coq5ph66an4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ruby-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/10/ruby-install/" class="article-date">
  <time datetime="2017-07-10T01:09:10.000Z" itemprop="datePublished">2017-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Ruby/">Ruby</a>►<a class="article-category-link" href="/categories/Ruby/Ruby-install/">Ruby install</a>►<a class="article-category-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/10/ruby-install/">ruby install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Ruby-install"><a href="#Ruby-install" class="headerlink" title="Ruby install"></a>Ruby install</h3><ol>
<li><p><a href="http://rvm.io/" target="_blank" rel="noopener">rvm安装</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB</span></span><br><span class="line">[root@dev ~]<span class="comment"># curl -sSL https://get.rvm.io | bash -s stable</span></span><br><span class="line">[root@dev ~]<span class="comment"># source /etc/profile.d/rvm.sh</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="http://ruby-china.org/wiki/ruby-mirror" target="_blank" rel="noopener">修改rvm源</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># grep ftp.ruby-lang.org $rvm_path/config/db</span></span><br><span class="line">ruby_url_fallback_1=https://ftp.ruby-lang.org/pub/ruby</span><br><span class="line">[root@dev ~]<span class="comment"># sed -i 's!ftp.ruby-lang.org/pub/ruby!cache.ruby-china.org/pub/ruby!g' $rvm_path/config/db</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Ruby install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># rvm list known</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm install 2.4</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm docs generate-ri</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm --default use 2.4     //指定默认版本</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># ruby -v</span></span><br><span class="line">ruby 2.4.0p0 (2016-12-24 revision 57164) [x86_64-linux]</span><br><span class="line">[root@dev ~]<span class="comment"># gem -v</span></span><br><span class="line">2.6.12</span><br><span class="line"></span><br><span class="line">补充:</span><br><span class="line">[root@dev ~]<span class="comment"># rvm list                  //列出所有ruby版本</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm list default          //列出默认版本</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm reset                 //恢复系统默认设置</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm reinstall 2.4         //重新安装</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm uninstall 2.4         //卸载,但保留源数据</span></span><br><span class="line">[root@dev ~]<span class="comment"># rvm remove 2.4            //卸载,删除源数据,比uninstall更彻底</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="http://gems.ruby-china.org/" target="_blank" rel="noopener">修改gem源</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@dev ~]<span class="comment"># gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem sources -l</span></span><br><span class="line">https://gems.ruby-china.org/</span><br><span class="line"></span><br><span class="line">补充:</span><br><span class="line">[root@dev ~]<span class="comment"># gem update --system      //更新gem</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem update               //更新所有gem包</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem list --local         //显示本地安装的gem包</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem uninstall rake                           //卸载旧的gem包,保留最新</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem uninstall rake --version=&#123;version&#125;       //卸载指定gem包</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem cleanup              //清除所有包旧版本,保留最新版本</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem search -r &#123;关键字&#125;        //从远程服务器上查找包含"关键字"的gem包</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem search &#123;关键字&#125; --remoter //从远程服务器上查找包含"关键字"的gem包</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem search &#123;关键字&#125; --both    //从本地和远程服务器上查找包含"关键字"的gem包</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem install &#123;gem_package&#125;              //安装最新版本的gem包(本地+远程)</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem install &#123;gem_package&#125; --remoter    //安装最新版本的gem包(远程)</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem install &#123;gem_package&#125; -v &#123;version&#125; //安装指定版本的gem包(本地+远程)</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem query -n ''[0-9]'' --local  //查找本地含有数字的gem包</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem build rake.gemspec  //把rake.gemspec编译成rake.gem</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem check -v pkg/rake-0.4.0.gem #检测rake是否有效</span></span><br><span class="line"></span><br><span class="line">[root@dev ~]<span class="comment"># gem contents rake //显示rake包中所包含的文件</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem dependency rails -v 0.10.1 //列出与rails相互依赖的包</span></span><br><span class="line">[root@dev ~]<span class="comment"># gem environment //查看gem的环境</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/10/ruby-install/" data-id="cjavy9k5q009m0coq4814eow2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-开源许可协议" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/08/开源许可协议/" class="article-date">
  <time datetime="2017-07-08T09:46:27.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>►<a class="article-category-link" href="/categories/other/开源许可协议/">开源许可协议</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/开源许可协议/">开源许可协议</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="开源许可协议"><a href="#开源许可协议" class="headerlink" title="开源许可协议"></a>开源许可协议</h3><p><img src="开源许可协议/开源许可协议.png" alt="开源许可协议"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/08/开源许可协议/" data-id="cjavy9k9300cf0coqc88mly60" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rpmbuild-spec" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/08/rpmbuild-spec/" class="article-date">
  <time datetime="2017-07-08T08:41:17.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/rpm/">rpm</a>►<a class="article-category-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/rpmbuild-spec/">rpmbuild spec</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="rpmbuild-spec说明"><a href="#rpmbuild-spec说明" class="headerlink" title="rpmbuild spec说明"></a>rpmbuild spec说明</h3><ol>
<li><p>rpmbuild介绍</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">顾名思义创建rpm包,它是用来指示转换的源码不定编译成二进制文件的包</span><br><span class="line"></span><br><span class="line">rpm对打包目录有一些严格的层次上的要求.比如:</span><br><span class="line">如果你的rpm的版本&lt;=4.4.x,那么rpmbuid工具其默认的工作路径是/usr/src/redhat,这就使得普通用户不能制作rpm包,因为权限的问题,在制作rpm软件包时必须切换到root身份才可以.所以,rpm从4.5.x版本开始,将rpmbuid的默认工作路径移动到用户家目录下的rpmbuild目录里,即$HOME/rpmbuild,并且推荐用户在制作rpm软件包时尽量不要以root身份进行操作</span><br><span class="line"></span><br><span class="line">关于rpmbuild默认工作路径的确定,通常由在/usr/lib/rpm/macros这个文件里的一个叫做%_topdir的宏变量来定义.</span><br><span class="line">如果用户想更改这个目录名(rpm官方并不推荐直接更改这个目录),可以在用户家目录下建立一个名为.rpmmacros的隐藏文件,然后在里面重新定义%_topdir,指向一个新的目录名.例如: &quot;%_topdir    $HOME/myrpmbuild&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>rpmbuild 目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在%_topdir目录下一般需要建立6个目录:</span><br><span class="line">* BUILD	    编译rpm包的临时目录	             %_builddir</span><br><span class="line">* BUILDROOT	编译后生成的软件临时安装目录	    %_buildrootdir</span><br><span class="line">* RPMS	    最终生成的可安装rpm包的所在目录	  %_rpmdir</span><br><span class="line">* SOURCES	  所有源代码和补丁文件的存放目录    %_sourcedir</span><br><span class="line">* SPECS	    存放SPEC文件的目录(重要)	        %_specdir</span><br><span class="line">* SRPMS	    软件最终的rpm源码格式存放路径	   %_srcrpmdir</span><br><span class="line"></span><br><span class="line">提示:</span><br><span class="line">1.执行rpmdev-setuptree会在当前用户家目录下的rpmbuild目录(如果该目录不存在也会被自动创建)里自动建立上述目录</span><br><span class="line">2.一般我们都把源码打包成tar.gz格式然后存放于SOURCES路径下,而在SPECS路径下编写spec文档.通过命令打包后,默认会把打包后的rpm包放在RPMS下,而源码包会被放置在SRPMS下</span><br></pre></td></tr></table></figure>
</li>
<li><p>rpmbuild相关命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">基本格式: rpmbuild [options] [spec文档|tarball包|源码包]</span><br><span class="line"></span><br><span class="line">//从spec文档建立有以下选项:</span><br><span class="line">-bp  #只执行spec的%pre段(解开源码包并打补丁,即只做准备)</span><br><span class="line">-bc  #执行spec的%pre和%build段(准备并编译)</span><br><span class="line">-bi  #执行spec中%pre,%build与%install(准备,编译并安装)</span><br><span class="line">-bl  #检查spec中的%file段(查看文件是否齐全)</span><br><span class="line">-ba  #建立源码与二进制包(常用)</span><br><span class="line">-bb  #只建立二进制包(最常用)</span><br><span class="line">-bs  #只建立源码包</span><br><span class="line"></span><br><span class="line">//从tarball包建立,与spec类似</span><br><span class="line">-tp #对应-bp</span><br><span class="line">-tc #对应-bc</span><br><span class="line">-ti #对应-bi</span><br><span class="line">-ta #对应-ba</span><br><span class="line">-tb #对应-bb</span><br><span class="line">-ts #对应-bs</span><br><span class="line"></span><br><span class="line">//从源码包建立</span><br><span class="line">--rebuild    #建立二进制包,通-bb</span><br><span class="line">--recompile  #同-bi</span><br><span class="line"></span><br><span class="line">//其他的一些选项</span><br><span class="line">--buildroot=DIRECTORY   #确定以root目录建立包</span><br><span class="line">--clean                 #完成打包后清除BUILD下的文件目录</span><br><span class="line">--nobuild               #不进行%build的阶段</span><br><span class="line">--nodeps                #不检查建立包时的关联文件</span><br><span class="line">--nodirtokens</span><br><span class="line">--rmsource              #完成打包后清除SOURCES</span><br><span class="line">--rmspec                #完成打包后清除SPEC</span><br><span class="line">--short-cricuit</span><br><span class="line">--target=CPU-VENDOR-OS  #确定包的最终使用平台</span><br></pre></td></tr></table></figure>
</li>
<li><p>SPEC文档的编写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">Name:    软件包的名字,后面可使用%&#123;name&#125;的方式引用,具体命令需跟源包一致</span><br><span class="line">Version: 软件的实际版本号,具体命令需跟源包一致</span><br><span class="line">Release: 发布序列号,具体命令需跟源包一致</span><br><span class="line">Summary: 软件包的内容概要</span><br><span class="line">Group: 软件分组，建议使用标准分组</span><br><span class="line">-----------------------------------------</span><br><span class="line">软件包所属类别，具体类别有：</span><br><span class="line">Amusements/Games           （娱乐/游戏）</span><br><span class="line">Amusements/Graphics        （娱乐/图形）</span><br><span class="line">Applications/Archiving     （应用/文档）</span><br><span class="line">Applications/Communications（应用/通讯）</span><br><span class="line">Applications/Databases     （应用/数据库）</span><br><span class="line">Applications/Editors       （应用/编辑器）</span><br><span class="line">Applications/Emulators     （应用/仿真器）</span><br><span class="line">Applications/Engineering   （应用/工程）</span><br><span class="line">Applications/File          （应用/文件）</span><br><span class="line">Applications/Internet      （应用/因特网）</span><br><span class="line">Applications/Multimedia    （应用/多媒体）</span><br><span class="line">Applications/Productivity  （应用/产品）</span><br><span class="line">Applications/Publishing    （应用/印刷）</span><br><span class="line">Applications/System        （应用/系统）</span><br><span class="line">Applications/Text          （应用/文本）</span><br><span class="line">Development/Debuggers      （开发/调试器）</span><br><span class="line">Development/Languages      （开发/语言）</span><br><span class="line">Development/Libraries      （开发/函数库）</span><br><span class="line">Development/System         （开发/系统）</span><br><span class="line">Development/Tools          （开发/工具）</span><br><span class="line">Documentation              （文档）</span><br><span class="line">System Environment/Base    （系统环境/基础）</span><br><span class="line">System Environment/Daemons （系统环境/守护）</span><br><span class="line">System Environment/Kernel  （系统环境/内核）</span><br><span class="line">System Environment/Libraries （系统环境/函数库）</span><br><span class="line">System Environment/Shells    （系统环境/接口）</span><br><span class="line">User Interface/Desktops      （用户界面/桌面）</span><br><span class="line">User Interface/X             （用户界面/X窗口）</span><br><span class="line">User Interface/X Hardware Support （用户界面/X硬件支持）</span><br><span class="line">----------------------------------------------------</span><br><span class="line">License:   软件授权方式,通常就是GPL</span><br><span class="line">Source:    源代码包,可以带多个用Source1、Source2等源,后面也可以用%&#123;source1&#125;,%&#123;source2&#125;引用</span><br><span class="line">BuildRoot: 这个是安装或编译时使用的&quot;虚拟目录&quot;,考虑到多用户的环境,一般定义为:</span><br><span class="line">%&#123;_tmppath&#125;/%&#123;name&#125;-%&#123;version&#125;-%&#123;release&#125;-root</span><br><span class="line">或</span><br><span class="line">%&#123;_tmppath&#125;/%&#123;name&#125;-%&#123;version&#125;-%&#123;release&#125;-buildroot-%(%&#123;__id_u&#125; -n&#125;</span><br><span class="line">该参数非常重要,因为在生成rpm的过程中,执行make install时就会把软件安装到上述的路径中,在打包的时候,同样依赖&quot;虚拟目录&quot;为&quot;&quot;根目录&quot;进行操作.后面可使用$RPM_BUILD_ROOT方式引用</span><br><span class="line">URL:           软件的主页</span><br><span class="line">Vendor:        发行商或打包组织的信息,例如RedFlag Co,Ltd</span><br><span class="line">Disstribution: 发行版标识</span><br><span class="line">Patch:         补丁源码,可使用Patch1,Patch2等标识多个补丁,使用%patch0或%&#123;patch0&#125;引用</span><br><span class="line">Prefix: %&#123;_prefix&#125;这个主要是为了解决今后安装rpm包时,并不一定把软件安装到rpm中打包的目录的情况.这样,必须在这里定义该标识,并在编写%install脚本的时候引用,才能实现rpm安装时重新指定位置的功能</span><br><span class="line">Prefix: %&#123;_sysconfdir&#125; 这个原因和上面的一样,但由于%&#123;_prefix&#125;指/usr,而对于其他的文件,例如/etc下的配置文件,则需要用%&#123;_sysconfdir&#125;标识</span><br><span class="line">Build Arch:   指编译的目标处理器架构,noarch标识不指定,但通常都是以/usr/lib/rpm/marcros中的内容为默认值</span><br><span class="line">Requires:     该rpm包所依赖的软件包名称,可以用&gt;=或&lt;=表示大于或小于某一特定版本,不同软件名用空格分开,例如:libpng-devel &gt;= 1.0.20 zlib</span><br><span class="line"></span><br><span class="line">还有例如PreReq、Requires(pre)、Requires(post)、Requires(preun)、Requires(postun)、BuildRequires等都是针对不同阶段的依赖指定</span><br><span class="line">Provides: 指明本软件一些特定的功能,以便其他rpm识别</span><br><span class="line">Packager: 打包者的信息</span><br><span class="line">scription 软件的详细说明</span><br><span class="line"></span><br><span class="line">#spec脚本主体</span><br><span class="line">spec脚本的主体中也包括了很多关键字和描述:</span><br><span class="line">%prep 预处理脚本</span><br><span class="line">%setup -n %&#123;name&#125;-%&#123;version&#125; 把源码包解压并放好</span><br><span class="line">注:可根据你的源码的名字格式,来确认解压后名字的格式,否则可能导致install的时候找不到对应的目录</span><br><span class="line">通常是从/usr/src/redhat/SOURCES里的包解压到/usr/src/redhat/BUILD/%&#123;name&#125;-%&#123;version&#125;中</span><br><span class="line">一般用%setup -c就可以了,但有两种情况:一就是同时编译多个源码包;二就是源码的tar包的名称与解压出来的目录不一致.此时，就需要使用-n参数指定一下了</span><br><span class="line">%patch 打补丁,通常补丁都会一起在源码tar.gz包中,或放到SOURCES目录下.一般参数为:</span><br><span class="line">%patch -p1 使用前面定义的Patch补丁进行,-p1是忽略patch的第一层目录</span><br><span class="line">%Patch2 -p1 -b xxx.patch 打上指定的补丁,-b是指生成备份文件</span><br><span class="line">◎补充一下</span><br><span class="line">%setup 不加任何选项，仅将软件包打开。</span><br><span class="line">%setup -n newdir 将软件包解压在newdir目录。</span><br><span class="line">%setup -c 解压缩之前先产生目录。</span><br><span class="line">%setup -b num 将第num个source文件解压缩。</span><br><span class="line">%setup -T 不使用default的解压缩操作。</span><br><span class="line">%setup -T -b 0 将第0个源代码文件解压缩。</span><br><span class="line">%setup -c -n newdir 指定目录名称newdir，并在此目录产生rpm套件。</span><br><span class="line">%patch 最简单的补丁方式，自动指定patch level。</span><br><span class="line">%patch 0 使用第0个补丁文件，相当于%patch ?p 0。</span><br><span class="line">%patch -s 不显示打补丁时的信息。</span><br><span class="line">%patch -T 将所有打补丁时产生的输出文件删除。</span><br><span class="line"></span><br><span class="line">%build 开始构建包</span><br><span class="line">在/usr/src/redhat/BUILD/%&#123;name&#125;-%&#123;version&#125;目录中进行make的工作,常见写法：</span><br><span class="line">make %&#123;?_smp_mflags&#125; OPTIMIZE=&quot;%&#123;optflags&#125;&quot;</span><br><span class="line">都是一些优化参数，定义在/usr/lib/rpm/marcros中</span><br><span class="line">%install 开始把软件安装到虚拟的根目录中</span><br><span class="line">在/usr/src/redhat/BUILD/%&#123;name&#125;-%&#123;version&#125;目录中进行make install的操作.这个很重要,因为如果这里的路径不对的话,则下面%file中寻找文件的时候就会失败.</span><br><span class="line">常见内容有：</span><br><span class="line">%makeinstall 这不是关键字,而是rpm定义的标准宏命令.也可以使用非标准写法:</span><br><span class="line">make DESTDIR=$RPM_BUILD_ROOT install</span><br><span class="line">或</span><br><span class="line">make prefix=$RPM_BUILD_ROOT install</span><br><span class="line"></span><br><span class="line">需要说明的是,这里的%install主要就是为了后面的%file服务的.所以,还可以使用常规的系统命令:</span><br><span class="line">install -d $RPM_BUILD_ROOT/ #建立目录</span><br><span class="line">cp -a * $RPM_BUILD_ROOT/</span><br><span class="line"></span><br><span class="line">%clean 清理临时文件</span><br><span class="line">通常内容为:引用</span><br><span class="line">[ &quot;$RPM_BUILD_ROOT&quot; != &quot;/&quot; ] &amp;&amp; rm -rf &quot;$RPM_BUILD_ROOT&quot;</span><br><span class="line">rm -rf $RPM_BUILD_DIR/%&#123;name&#125;-%&#123;version&#125;</span><br><span class="line">※注意区分$RPM_BUILD_ROOT和$RPM_BUILD_DIR：</span><br><span class="line">$RPM_BUILD_ROOT是指开头定义的BuildRoot,而$RPM_BUILD_DIR通常就是指/usr/src/redhat/BUILD.其中,前面的才是%file需要的.</span><br><span class="line">%pre    rpm安装前执行的脚本</span><br><span class="line">%post   rpm安装后执行的脚本</span><br><span class="line">%preun  rpm卸载前执行的脚本</span><br><span class="line">%postun rpm卸载后执行的脚本</span><br><span class="line"></span><br><span class="line">%preun %postun 的区别是什么呢？</span><br><span class="line">前者在升级的时候会执行,后者在升级rpm包的时候不会执行</span><br><span class="line"></span><br><span class="line">%files 定义那些文件或目录会放入rpm中</span><br><span class="line">这里会在虚拟根目录下进行,千万不要写绝对路径,而应用宏或变量表示相对路径.如果描述为目录,表示目录中除%exclude外的所有文件.</span><br><span class="line">%defattr(文件权限,用户名,组名,目录权限)   默认是 %defattr(-,root,root,-)</span><br><span class="line">%exclude 列出不想打包到rpm中的文件</span><br><span class="line">注意:</span><br><span class="line">1.%&#123;buildroot&#125;里的所有文件都要明确被指定是否要被打包到rpm里</span><br><span class="line">2.如果声明了%&#123;buildroot&#125;里不存在的文件或者目录也会报错</span><br><span class="line">3.如果%exclude指定的文件不存在,也会出错的</span><br><span class="line"></span><br><span class="line">%doc</span><br><span class="line">关于%doc宏，所有跟在这个宏后面的文件都来自%&#123;_builddir&#125;目录，当用户安装rpm时，由这个宏所指定的文件都会安装到/usr/share/doc/name-version/目录里。</span><br><span class="line"></span><br><span class="line">%changelog 变更日志</span><br><span class="line">* date +&quot;%a %b %d %Y&quot; 修改人 邮箱 本次版本x.y.z-p</span><br><span class="line">- 本次变更修改了那些内容</span><br></pre></td></tr></table></figure>
</li>
<li><p>SPEC文档中常用的几个宏(变量)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. RPM_BUILD_DIR:    /usr/src/redhat/BUILD</span><br><span class="line">2. RPM_BUILD_ROOT:   /usr/src/redhat/BUILDROOT</span><br><span class="line">3. %&#123;_sysconfdir&#125;:   /etc</span><br><span class="line">4. %&#123;_sbindir&#125;：     /usr/sbin</span><br><span class="line">5. %&#123;_bindir&#125;:       /usr/bin</span><br><span class="line">6. %&#123;_datadir&#125;:      /usr/share</span><br><span class="line">7. %&#123;_mandir&#125;:       /usr/share/man</span><br><span class="line">8. %&#123;_libdir&#125;:       /usr/lib64</span><br><span class="line">9. %&#123;_prefix&#125;:       /usr</span><br><span class="line">10. %&#123;_localstatedir&#125;:   /usr/var</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/08/rpmbuild-spec/" data-id="cjavy9k5m009j0coq0kbus6uq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rpm-package-build" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/08/rpm-package-build/" class="article-date">
  <time datetime="2017-07-08T07:32:19.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/rpm/">rpm</a>►<a class="article-category-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/rpm-package-build/">rpm package build</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="rpm-包创建"><a href="#rpm-包创建" class="headerlink" title="rpm 包创建"></a>rpm 包创建</h3><ol>
<li><p>安装 rpmbuild 和 rpmdevtools工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum -y install rpm-build</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum -y install rpmdevtools</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看rpm包版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm --version</span></span><br><span class="line">RPM version 4.11.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看rpmbuild的默认位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//查看rpmbuild位置</span><br><span class="line">[root@localhost ~]<span class="comment"># grep -w '%_topdir' /usr/lib/rpm/macros</span></span><br><span class="line">%_topdir                %&#123;getenv:HOME&#125;/rpmbuild</span><br><span class="line"></span><br><span class="line">//手动指定rpmbuild位置</span><br><span class="line">[root@localhost ~]<span class="comment"># echo "%_topdir    $HOME/rpmbuild" | tee ~/.rpmmacros</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成rpmbuild目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpmdev-setuptree</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tree rpmbuild/</span></span><br><span class="line">rpmbuild/</span><br><span class="line">├── BUILD</span><br><span class="line">├── RPMS</span><br><span class="line">├── SOURCES</span><br><span class="line">├── SPECS</span><br><span class="line">└── SRPMS</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成SPEC配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpmdev-newspec -o rpmbuild/SPECS/wisdom-nginx-1.10.2.spec</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>SPEC配置文件说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim rpmbuild/SPECS/wisdom-nginx-1.10.2.spec</span><br><span class="line"># 定义变量</span><br><span class="line">%define realname wisdom-nginx</span><br><span class="line">%define realver  1.10.2</span><br><span class="line"></span><br><span class="line">%if 0%&#123;?suse_version&#125;</span><br><span class="line">  %define USER  apache</span><br><span class="line">  %define GROUP apache</span><br><span class="line">  %define PREFIX /mnt/app/nginx</span><br><span class="line">%else</span><br><span class="line">  %define USER  apache</span><br><span class="line">  %define GROUP apache</span><br><span class="line">  %define PREFIX /mnt/app/nginx</span><br><span class="line">%endif</span><br><span class="line"></span><br><span class="line"># 第一阶段:设置基础信息</span><br><span class="line"># 1.软件包信息</span><br><span class="line">Name:           %&#123;realname&#125;</span><br><span class="line">Version:        %&#123;realver&#125;</span><br><span class="line">Release:        1%&#123;?dist&#125;</span><br><span class="line">Summary:        wisdom nginx</span><br><span class="line">Group:          Applications/Archiving</span><br><span class="line">License:        GPLv2</span><br><span class="line">URL:            http://nginx.org/en/download.html</span><br><span class="line">Packager:       刘朋 &lt;smallasa@sina.com&gt;</span><br><span class="line">Vendor:         众荟</span><br><span class="line"></span><br><span class="line"># 2.源码包和文件</span><br><span class="line">Source0:        nginx-1.10.2.tar.gz</span><br><span class="line">Source1:        init.nginx</span><br><span class="line">Source2:        nginx.conf</span><br><span class="line"></span><br><span class="line"># 3.安装位置</span><br><span class="line">BuildRoot:      %&#123;PREFIX&#125;</span><br><span class="line"></span><br><span class="line"># 4.软件依赖包</span><br><span class="line">BuildRequires:  gcc</span><br><span class="line">Requires:       openssl,openssl-devel,pcre,pcre-devel</span><br><span class="line"></span><br><span class="line"># 5.软件详细信息</span><br><span class="line">%description</span><br><span class="line">众荟 慧通 nginx 软件包 wisdom-nginx-1.10.2.tar.gz</span><br><span class="line"></span><br><span class="line"># 第二阶段: 准备阶段(解压,并进入目录)</span><br><span class="line">%prep</span><br><span class="line">%setup -q</span><br><span class="line"></span><br><span class="line"># 第三阶段: 编译阶段</span><br><span class="line">%build</span><br><span class="line">./configure \</span><br><span class="line">--prefix=%&#123;PREFIX&#125; \</span><br><span class="line">--user=%&#123;USER&#125; \</span><br><span class="line">--group=%&#123;GROUP&#125; \</span><br><span class="line">--with-select_module \</span><br><span class="line">--with-poll_module \</span><br><span class="line">--with-threads \</span><br><span class="line">%if 0%&#123;?suse_version&#125; || 0%&#123;?fedora&#125; || 0%&#123;?rhel_version&#125; || 0%&#123;?centos_version&#125; &gt;= 600</span><br><span class="line"> --with-file-aio \</span><br><span class="line">%endif</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_realip_module \</span><br><span class="line">--with-http_addition_module \</span><br><span class="line">--with-http_geoip_module \</span><br><span class="line">--with-http_gunzip_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-http_auth_request_module \</span><br><span class="line">--with-http_degradation_module \</span><br><span class="line">--with-google_perftools_module \</span><br><span class="line">--with-pcre \</span><br><span class="line">--with-libatomic</span><br><span class="line"></span><br><span class="line">make %&#123;?_smp_mflags&#125;</span><br><span class="line"></span><br><span class="line"># 第四阶段: 安装阶段</span><br><span class="line">%install</span><br><span class="line">rm -rf $RPM_BUILD_ROOT</span><br><span class="line">make install DESTDIR=%&#123;buildroot&#125;</span><br><span class="line">%&#123;__install&#125; -p -D -m 0755 %&#123;SOURCE1&#125; %&#123;buildroot&#125;/etc/rc.d/init.d/nginx</span><br><span class="line">%&#123;__install&#125; -p -D %&#123;SOURCE2&#125; %&#123;buildroot&#125;/usr/local/nginx/conf/nginx.conf</span><br><span class="line">%&#123;__install&#125; -p -D %&#123;SOURCE3&#125; %&#123;buildroot&#125;/usr/local/nginx/conf/fastcgi_params</span><br><span class="line"></span><br><span class="line"># 第五阶段: 将文件拷贝到相应目录,并授权</span><br><span class="line">%files</span><br><span class="line">%defattr(-,root,root,0755) /usr/local/nginx/</span><br><span class="line">%attr(0755,root,root) /etc/rc.d/init.d/nginx</span><br><span class="line">%config(noreplace) /usr/local/nginx/conf/nginx.conf</span><br><span class="line">%config(noreplace) /usr/local/nginx/conf/fastcgi_params</span><br><span class="line"></span><br><span class="line">%doc</span><br><span class="line">%dir</span><br><span class="line"></span><br><span class="line"># 第六阶段: 在安装/卸载 rpm包 前/后 执行的脚本</span><br><span class="line"># 1.rpm 安装前执行的脚本</span><br><span class="line">%pre</span><br><span class="line"># 1:表示安装;2:表示升级;3:表示卸载</span><br><span class="line">if [ $1 == 1 ];then</span><br><span class="line">  /usr/sbin/useradd -s /sbin/nologin nginx 2&gt;/dev/null</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 2.rpm 安装后执行的脚本</span><br><span class="line">%post</span><br><span class="line">if [ $1 == 1 ];then</span><br><span class="line">  echo &apos;# Add sysctl.conf</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 65536</span><br><span class="line">net.core.netdev_max_backlog =  32768</span><br><span class="line">net.core.somaxconn = 32768</span><br><span class="line"></span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.ipv4.tcp_synack_retries = 2</span><br><span class="line">net.ipv4.tcp_syn_retries = 2</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_mem = 94500000 915000000927000000</span><br><span class="line">net.ipv4.tcp_max_orphans = 3276800</span><br><span class="line"></span><br><span class="line">#net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">#net.ipv4.tcp_keepalive_time = 120</span><br><span class="line">net.ipv4.ip_local_port_range = 1024  65535&apos; |tee -a /etc/sysctl.conf</span><br><span class="line">sysctl -p 2&gt;&amp;1 /dev/null</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 3.rpm卸载前执行的脚本</span><br><span class="line">%preun</span><br><span class="line">if [ $1 == 0 ];then</span><br><span class="line">  /etc/init.d/nginx stop &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">  userdel -r nginx 2&gt;/dev/null</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 4.rpm卸载后执行的脚本</span><br><span class="line">%postun</span><br><span class="line"></span><br><span class="line">第七阶段: 更新日志</span><br><span class="line">%changelog</span><br><span class="line">*  Thu Wed 26 2014 smallasa &lt;smallasa@sina.com&gt; - 1.10.2</span><br><span class="line">- Initial version</span><br></pre></td></tr></table></figure>
</li>
<li><p>制作rpm包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpmbuild -bp nginx.spec 制作到%prep段</span><br><span class="line">rpmbuild -bc nginx.spec 制作到%build段</span><br><span class="line">rpmbuild -bi nginx.spec 执行spec文件的 <span class="string">"%install"</span> 阶段(在执行了%prep和%build阶段之后).这通常等价于执行了一次 <span class="string">"make install"</span></span><br><span class="line">rpmbuild -bb nginx.spec 制作二进制包</span><br><span class="line">rpmbuild -ba nginx.spec 表示既制作二进制包又制作src格式包</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="rpm包的签名"><a href="#rpm包的签名" class="headerlink" title="rpm包的签名"></a>rpm包的签名</h3><ol>
<li><p>查询软件包信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -qi nginx</span></span><br><span class="line">Name        : nginx                        Relocations: (not relocatable)</span><br><span class="line">Version     : 1.7.7                             Vendor: smallasa</span><br><span class="line">Release     : 3.el6                         Build Date: Wed 26 Nov 2014 06:39:00 PM CST</span><br><span class="line">Install Date: Wed 26 Nov 2014 06:42:19 PM CST      Build Host: localhost</span><br><span class="line">Group       : Applications/Archiving        Source RPM: nginx-1.7.7-3.el6.src.rpm</span><br><span class="line">Size        : 793593                           License: GPLv2</span><br><span class="line">Signature   : (none)    <span class="comment"># rpm包未签名状态</span></span><br><span class="line">Packager    : nmshuishui &lt;353025240@qq.com&gt;</span><br><span class="line">URL         : http://nmshuishui.blog.51cto.com/</span><br><span class="line">Summary     : nginx-1.7.7.tar.gz to nginx-1.7.7.rpm</span><br><span class="line">Description :</span><br><span class="line">Custom a rpm by yourself!Build nginx-1.7.7.tar.gz to nginx-1.7.7.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用gpg方式生成签名密钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># gpg --gen-key</span></span><br><span class="line">Your selection?1&lt;Enter&gt;  <span class="comment">#默认即可</span></span><br><span class="line">What keysize <span class="keyword">do</span> you want? (2048) 1024&lt;Enter&gt;  <span class="comment">#选择密钥长度</span></span><br><span class="line">Key is valid <span class="keyword">for</span>? (0) 1y&lt;Enter&gt;  <span class="comment">#有效期</span></span><br><span class="line">Is this correct? (y/N) y&lt;Enter&gt;  <span class="comment">#确认</span></span><br><span class="line">Real name: smallasa&lt;Enter&gt;  <span class="comment">#密钥名称</span></span><br><span class="line">Email address: smallasa@sina.com&lt;Enter&gt;  <span class="comment">#邮件</span></span><br><span class="line">Comment: GPG-RPM-KEY&lt;Enter&gt;  <span class="comment">#备注</span></span><br><span class="line">Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O&lt;ENTER&gt; <span class="comment">#okay确认</span></span><br><span class="line">Enter passphrase  OK &lt;Enter&gt;  <span class="comment">#按Enter输入密码                    </span></span><br><span class="line">&lt;Take this one anyway&gt; &lt;Enter&gt; <span class="comment">#确认使用此密码</span></span><br><span class="line"><span class="comment">#####</span></span><br><span class="line">在生成密钥的时候,会报这么一个信息：can<span class="string">'t connect to `/root/.gnupg/S.gpg-agent'</span>: No such file or directory,可以不用理会它.接下来就是一些随机数的说明了:We need to generate a lot of random bytes. It is a good idea to perform</span><br><span class="line">some other action (<span class="built_in">type</span> on the keyboard, move the mouse, utilize the</span><br><span class="line">disks) during the prime generation; this gives the random number</span><br><span class="line">generator a better chance to gain enough entropy.</span><br><span class="line">就狂敲键盘和移动鼠标吧,也可以链接一个伪随机数(不过不安全),接下来就是等待了</span><br><span class="line">生成密钥后会是这样的：</span><br><span class="line">gpg: checking the trustdb</span><br><span class="line">gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model</span><br><span class="line">gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u</span><br><span class="line">pub   2048R/DF63EDFB 2014-11-26</span><br><span class="line">      Key fingerprint = 338D 476F 29C9 E2D6 6604  1D96 6F73 1E81 DF63 EDFB</span><br><span class="line">uid                  smallasa (gen-key) &lt;smallasa@sina.com&gt;</span><br><span class="line">sub   2048R/263FB359 2014-11-26</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看生成的密钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># gpg --list-keys</span></span><br><span class="line">/root/.gnupg/pubring.gpg</span><br><span class="line">------------------------</span><br><span class="line">pub   2048R/DF63EDFB 2014-11-26</span><br><span class="line">uid                  smallasa (gen-key) &lt;smallasa@sina.com&gt;</span><br><span class="line">sub   2048R/263FB359 2014-11-26</span><br></pre></td></tr></table></figure>
</li>
<li><p>导出公钥以供验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># gpg --export -a "smallasa" &gt; RPM-GPG-KEY-smallasa</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在~/.rpmmacros宏中定义加密密钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim ~/.rpmmacros</span></span><br><span class="line">%_gpg_name smallasa</span><br></pre></td></tr></table></figure>
</li>
<li><p>为rpm包签名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm --addsign /home/hero/rpmbuild/RPMS/x86_64/nginx-1.7.7-3.el6.x86_64.rpm</span></span><br><span class="line">Enter pass phrase:</span><br><span class="line">Pass phrase is good.</span><br><span class="line">/home/hero/rpmbuild/RPMS/x86_64/nginx-1.7.7-3.el6.x86_64.rpm:</span><br></pre></td></tr></table></figure>
</li>
<li><p>将公钥导入rpm包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm --import RPM-GPG-KEY-smallasa</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm --checksig /home/hero/rpmbuild/RPMS/x86_64/nginx-1.7.7-3.el6.x86_64.rpm</span></span><br><span class="line">/home/hero/rpmbuild/RPMS/x86_64/nginx-1.7.7-3.el6.x86_64.rpm: rsa sha1 (md5) pgp md5 OK</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新安装nginx，验证安装包的签名信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -ivh /home/hero/rpmbuild/RPMS/x86_64/nginx-1.7.7-3.el6.x86_64.rpm</span></span><br><span class="line">Preparing...                <span class="comment">########################################### [100%]</span></span><br><span class="line">   1:nginx                  <span class="comment">########################################### [100%]</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -qi nginx</span></span><br><span class="line">Name        : nginx                        Relocations: (not relocatable)</span><br><span class="line">Version     : 1.7.7                             Vendor: smallasa</span><br><span class="line">Release     : 3.el6                         Build Date: Wed 26 Nov 2014 06:39:00 PM CST</span><br><span class="line">Install Date: Thu 27 Nov 2014 10:58:44 AM CST      Build Host: localhost</span><br><span class="line">Group       : Applications/Archiving        Source RPM: nginx-1.7.7-3.el6.src.rpm</span><br><span class="line">Size        : 793593                           License: GPLv2</span><br><span class="line">Signature   : RSA/SHA1, Thu 27 Nov 2014 10:40:02 AM CST, Key ID 6f731e81df63edfb   <span class="comment"># 与 1 比起来，多了签名信息</span></span><br><span class="line">Packager    : nmshuishui &lt;353025240@qq.com&gt;</span><br><span class="line">URL         : http://nmshuishui.blog.51cto.com/</span><br><span class="line">Summary     : nginx-1.7.7.tar.gz to nginx-1.7.7.rpm</span><br><span class="line">Description :</span><br><span class="line">Custom a rpm by yourself!Build nginx-1.7.7.tar.gz to nginx-1.7.7.rpm</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/08/rpm-package-build/" data-id="cjavy9k5l009i0coqijx02otw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-yum-server-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/05/yum-server-install/" class="article-date">
  <time datetime="2017-07-05T15:05:41.000Z" itemprop="datePublished">2017-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/yum/">yum</a>►<a class="article-category-link" href="/categories/automation/yum/yum-server-install/">yum server install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/05/yum-server-install/">yum server install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="yum-源服务器搭建"><a href="#yum-源服务器搭建" class="headerlink" title="yum 源服务器搭建"></a>yum 源服务器搭建</h3><ol>
<li><p>基础软件安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//修改主机名</span><br><span class="line">[root@localhost ~]<span class="comment"># echo yum |tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># hostname yum</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line"></span><br><span class="line">//安装基础软件包</span><br><span class="line">[root@yum ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@yum ~]<span class="comment"># yum -y install gcc gcc-c++ make cmake bison libtool autoconf automake zip unzip bzip2 zlib zlib-devel openssl openssl-devel pcre pcre-devel bison-devel ncurses-devel tcl tcl-devel perl-Digest-SHA1 GeoIP GeoIP-devel gperftools gperftools-devel libatomic_ops-devel gtest gtest-devel glibc-devel unixODBC-devel fop libperl libpython readline readline-devel python2-pip readline readline-devel readline-static openssl openssl-devel openssl-static sqlite-devel bzip2-devel bzip2-libs openldap-devel</span></span><br><span class="line">[root@yum ~]<span class="comment"># yum -y install git lftp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span></span><br><span class="line"></span><br><span class="line">//关闭selinux</span><br><span class="line">[root@yum ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@yum ~]<span class="comment"># sed -i s/'SELINUX=enforcing'/'SELINUX=disabled'/g /etc/selinux/config</span></span><br><span class="line"></span><br><span class="line">//关闭防火墙</span><br><span class="line">[root@yum ~]<span class="comment"># systemctl stop firewalld.service</span></span><br><span class="line">[root@yum ~]<span class="comment"># systemctl disable firewalld.service</span></span><br><span class="line"></span><br><span class="line">//关闭ntpd服务,定时同步时间</span><br><span class="line">[root@yum ~]<span class="comment"># systemctl stop ntpd</span></span><br><span class="line">[root@yum ~]<span class="comment"># systemctl disable ntpd</span></span><br><span class="line">[root@yum ~]<span class="comment"># echo '1 1 * * *     /usr/sbin/ntpdate -s cn.pool.ntp.org' | tee /var/spool/cron/root</span></span><br><span class="line"></span><br><span class="line">//创建基础目录</span><br><span class="line">[root@yum ~]<span class="comment"># mkdir -p /mnt/&#123;app,data,log,web,ops/&#123;app,data,cron&#125;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装createrepo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># yum -y install createrepo</span></span><br><span class="line"></span><br><span class="line">//createrepo主要用来创建yum仓库</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装yum-utils</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># yum -y install yum-utils</span></span><br><span class="line"></span><br><span class="line">//yum-utils主要用来使用reposync命令同步</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@yum app]<span class="comment"># useradd -s /sbin/nologin nginx</span></span><br><span class="line">[root@yum app]<span class="comment"># tar xzf nginx-1.10.2.tar.gz</span></span><br><span class="line">[root@yum app]<span class="comment"># cd nginx-1.10.2</span></span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># ./configure \</span></span><br><span class="line">&gt; --prefix=/mnt/app/nginx \</span><br><span class="line">&gt; --user=nginx \</span><br><span class="line">&gt; --group=nginx \</span><br><span class="line">&gt; --with-select_module \</span><br><span class="line">&gt; --with-poll_module \</span><br><span class="line">&gt; --with-threads \</span><br><span class="line">&gt; --with-file-aio \</span><br><span class="line">&gt; --with-http_ssl_module \</span><br><span class="line">&gt; --with-http_stub_status_module \</span><br><span class="line">&gt; --with-http_v2_module \</span><br><span class="line">&gt; --with-http_realip_module \</span><br><span class="line">&gt; --with-http_addition_module \</span><br><span class="line">&gt; --with-http_geoip_module \</span><br><span class="line">&gt; --with-http_gunzip_module \</span><br><span class="line">&gt; --with-http_gzip_static_module \</span><br><span class="line">&gt; --with-http_auth_request_module \</span><br><span class="line">&gt; --with-http_degradation_module \</span><br><span class="line">&gt; --with-google_perftools_module \</span><br><span class="line">&gt; --with-pcre \</span><br><span class="line">&gt; --with-libatomic</span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># make -j 2</span></span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># make -j 2 install</span></span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># mkdir -p /mnt/log/nginx</span></span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># chown -R nginx.nginx /mnt/log/nginx</span></span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># mkdir /mnt/data/yum.repo</span></span><br><span class="line">[root@yum nginx-1.10.2]<span class="comment"># chown -R nginx.nginx /mnt/data/yum.repo</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改nginx配置文件,调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># vim /mnt/app/nginx/conf/nginx.conf</span></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  2;</span><br><span class="line">worker_cpu_affinity 01 10;</span><br><span class="line">worker_rlimit_nofile 65536;</span><br><span class="line">error_log  /mnt/<span class="built_in">log</span>/nginx/nginx_error.log  info;</span><br><span class="line">pid        /mnt/<span class="built_in">log</span>/nginx/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    accept_mutex on;</span><br><span class="line">    multi_accept on;</span><br><span class="line">    worker_connections  10240;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    server_tokens off;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">    access_log  /mnt/<span class="built_in">log</span>/nginx/nginx_access.log  main;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65 60;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  yum.domain.cn;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /mnt/data/yum.repo;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            autoindex on;                <span class="comment">#nginx打开目录浏览功能</span></span><br><span class="line">            autoindex_exact_size on;     <span class="comment">#显示文件具体大小</span></span><br><span class="line">            autoindex_localtime on;      <span class="comment">#显示系统时间</span></span><br><span class="line">        &#125;</span><br><span class="line">        error_page   404              /404.html;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@yum ~]<span class="comment"># /mnt/app/nginx/sbin/nginx -c /mnt/app/nginx/conf/nginx.conf -t</span></span><br><span class="line">[root@yum ~]<span class="comment"># /mnt/app/nginx/sbin/nginx -c /mnt/app/nginx/conf/nginx.conf</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="使用-rsync-进行同步"><a href="#使用-rsync-进行同步" class="headerlink" title="使用 rsync 进行同步"></a>使用 rsync 进行同步</h3><ol>
<li><p>建立yum同步目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># mkdir -p /mnt/data/yum.repo/&#123;centos,epel&#125;</span></span><br><span class="line">[root@yum ~]<span class="comment"># chmod -R 755 /mnt/data/yum.repo</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改nginx index.html配置文件,指向创建的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># vim /mnt/data/yum.repo/index.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;众荟YUM源&lt;/title&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt;  </span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;p style=<span class="string">"font-weight:bolder;color:green;font-size:16px;"</span>&gt;众荟YUM源仓库:</span><br><span class="line">&lt;!-- &lt;font size=<span class="string">"3"</span> color=<span class="string">"red"</span>&gt;众荟YUM源仓库:&lt;/fon&gt; &lt;br/&gt; --&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=<span class="string">"http://&#123;yum.domain.com&#125;/centos"</span>&gt;&lt;font size=<span class="string">"3"</span> color=<span class="string">"blue"</span>&gt;centos&lt;/font&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=<span class="string">"http://&#123;yum.domain.com&#125;/epel"</span>&gt;&lt;font size=<span class="string">"3"</span> color=<span class="string">"blue"</span>&gt;epel&lt;/font&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;&lt;a href=<span class="string">"http://&#123;yum.domain.com&#125;/wisdom"</span>&gt;&lt;font size=<span class="string">"3"</span> color=<span class="string">"blue"</span>&gt;wisdom&lt;/font&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;p style=<span class="string">"font-weight:bolder;color:green;font-size:12px;"</span>&gt;更新命令:</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li&gt;centos 6:</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;rpm --import http://&#123;yum.domain.com&#125;/epel/RPM-GPG-KEY-EPEL-6&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;curl -o /etc/yum.repos.d/epel.repo http://&#123;yum.domain.com&#125;/epel-6.repo&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;rpm --import http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-6&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;curl -o /etc/yum.repos.d/CentOS-Base.repo http://&#123;yum.domain.com&#125;/centos-6.repo&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">  &lt;li&gt;centos 7:</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;rpm --import http://&#123;yum.domain.com&#125;/epel/RPM-GPG-KEY-EPEL-7&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;curl -o /etc/yum.repos.d/epel.repo http://&#123;yum.domain.com&#125;/epel-7.repo&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;rpm --import http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-7&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;font size=<span class="string">"1"</span> color=<span class="string">"blue"</span>&gt;curl -o /etc/yum.repos.d/CentOS-Base.repo http://&#123;yum.domain.com&#125;/centos-7.repo&lt;/font&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建yum源配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">epel-6:</span><br><span class="line">[root@yum ~]<span class="comment"># cat /mnt/data/yum.repo/epel-6.repo</span></span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 6 - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/epel/6/<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span><br><span class="line"></span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 6 - <span class="variable">$basearch</span> - Debug</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/epel/6/<span class="variable">$basearch</span>/debug</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 6 - <span class="variable">$basearch</span> - Source</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/epel/6/SRPMS</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span><br><span class="line">gpgcheck=0</span><br><span class="line">------------------------</span><br><span class="line">epel-7:</span><br><span class="line">[root@yum ~]<span class="comment"># cat /mnt/data/yum.repo/epel-7.repo</span></span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/epel/7/<span class="variable">$basearch</span></span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line"></span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Debug</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/epel/7/<span class="variable">$basearch</span>/debug</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Source</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/epel/7/SRPMS</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=0</span><br><span class="line">------------------------</span><br><span class="line">centos-6:</span><br><span class="line">[root@yum ~]<span class="comment"># cat /mnt/data/yum.repo/centos-6.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-6 - Base - &#123;yum.domain.com&#125;</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/6/os/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-6 - Updates - &#123;yum.domain.com&#125;</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/6/updates/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-6 - Extras - &#123;yum.domain.com&#125;</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/6/extras/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-6 - Plus - &#123;yum.domain.com&#125;</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/6/centosplus/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line"></span><br><span class="line"><span class="comment">#contrib - packages by Centos Users</span></span><br><span class="line">[contrib]</span><br><span class="line">name=CentOS-6 - Contrib - &#123;yum.domain.com&#125;</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/6/contrib/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=http://&#123;yum.domain.com&#125;/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line">------------------------</span><br><span class="line">centos-7:</span><br><span class="line">[root@yum ~]<span class="comment"># cat /mnt/data/yum.repo/centos-7.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-7 - Base</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/7/os/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-7 - Updates</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/7/updates/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-7 - Extras</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/7/extras/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-7 - Plus</span><br><span class="line">baseurl=http://&#123;yum.domain.com&#125;/centos/7/centosplus/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>
</li>
<li><p>同步yum源脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># cat /mnt/ops/cron/yum.rsync.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">/usr/bin/rsync -av --delete --exclude=debug --exclude=aarch64 --exclude=i386 --exclude=ppc64 --exclude=ppc64le --exclude=SRPMS rsync://mirrors.ustc.edu.cn/epel/&#123;6,7&#125; /mnt/data/yum.repo/epel/</span><br><span class="line">/usr/bin/rsync -av --delete --exclude=debug --exclude=i386 --exclude=isos rsync://mirrors.ustc.edu.cn/centos/&#123;6*,7*&#125; /mnt/data/yum.repo/centos/</span><br><span class="line"></span><br><span class="line">curl -o /mnt/data/yum.repo/epel/RPM-GPG-KEY-EPEL-6 http://mirrors.ustc.edu.cn/epel/RPM-GPG-KEY-EPEL-6</span><br><span class="line">curl -o /mnt/data/yum.repo/epel/RPM-GPG-KEY-EPEL-7 http://mirrors.ustc.edu.cn/epel/RPM-GPG-KEY-EPEL-7</span><br><span class="line">curl -o /mnt/data/yum.repo/centos/RPM-GPG-KEY-CentOS-6 http://mirrors.ustc.edu.cn/centos/RPM-GPG-KEY-CentOS-6</span><br><span class="line">curl -o /mnt/data/yum.repo/centos/RPM-GPG-KEY-CentOS-7 http://mirrors.ustc.edu.cn/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[root@yum ~]<span class="comment"># crontab  -l|grep yum</span></span><br><span class="line">3 0 * * 6     /mnt/ops/cron/yum.rsync.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">注意: 使用rsync同步时,没有必要在使用createrepo创建仓库了.同步的时候已经默认将repo仓库同步到本地了</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir –p /etc/yum.repos.d/back</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mv /etc/yum.repos.d/* /etc/yum.repos.d/back/</span></span><br><span class="line"></span><br><span class="line">centos 6:</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm --import http://yum.jwops.cn/epel/RPM-GPG-KEY-EPEL-6</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o /etc/yum.repos.d/epel.repo http://yum.jwops.cn/epel-6.repo</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm --import http://yum.jwops.cn/centos/RPM-GPG-KEY-CentOS-6</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http://yum.jwops.cn/centos-6.repo</span></span><br><span class="line"></span><br><span class="line">centos 7:</span><br><span class="line">[root@localhost ~]<span class="comment"># rpm --import http://yum.jwops.cn/epel/RPM-GPG-KEY-EPEL-7</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o /etc/yum.repos.d/epel.repo http://yum.jwops.cn/epel-7.repo</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm --import http://yum.jwops.cn/centos/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@localhost ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http://yum.jwops.cn/centos-7.repo</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># yum clean all</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum makecache</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="使用-reposync-进行同步"><a href="#使用-reposync-进行同步" class="headerlink" title="使用 reposync 进行同步"></a>使用 reposync 进行同步</h3><ol>
<li><p>建立yum同步目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># mkdir -p /mnt/data/yum.repo/wisdom/centos/6</span></span><br><span class="line">[root@yum ~]<span class="comment"># mkdir -p /mnt/data/yum.repo/wisdom/centos/7</span></span><br><span class="line">[root@yum ~]<span class="comment"># chmod -R 755 /mnt/data/yum.repo</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改nginx index.html配置文件,指向创建的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># cp /mnt/data/yum.repo/index.html /mnt/data/yum.repo/index.html.bak</span></span><br><span class="line">[root@yum ~]<span class="comment"># vim /mnt/data/yum.repo/index.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p style=<span class="string">"font-weight:bolder;color:green;font-size:30px;"</span>&gt;ALL of the packages <span class="keyword">in</span> the below:&lt;/p&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;a href=<span class="string">"http://192.168.13.213/centos/Aliyun"</span>&gt;Aliyun&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">        These packagers from of CentOS ISO.&lt;br/&gt;</span><br><span class="line">&lt;p style=<span class="string">"font-weight:bolder;color:red;font-size:18px;"</span>&gt;Please replace the file and fill <span class="keyword">in</span> the following content:&lt;/p&gt;</span><br><span class="line">&lt;p style=<span class="string">"font-weight:bolder;color:blue;font-size:15px;"</span>&gt;Way: /etc/yum.repos.d/CentOS-Base.repo&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载centos repo配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># wget -O /mnt/ops/cron/Centos-6.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span></span><br><span class="line">[root@yum ~]<span class="comment"># sed -i s/\$releasever/6/g /mnt/ops/cron/Centos-6.repo</span></span><br><span class="line">[root@yum ~]<span class="comment"># sed -i s/\$basearch/x86_64/g /mnt/ops/cron/Centos-6.repo</span></span><br><span class="line"></span><br><span class="line">[root@yum ~]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>同步yum源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># reposync -c /mnt/ops/cron/Centos-6.repo -d -n -p /mnt/data/yum.repo/wisdom/centos/6/</span></span><br><span class="line">[root@yum ~]<span class="comment"># reposync -p /mnt/data/yum.repo/wisdom/centos/7/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>软件包手动同步下来后,yum建立仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/6/base/ /mnt/data/yum.repo/wisdom/centos/6/base/</span></span><br><span class="line">[root@yum ~]<span class="comment"># createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/6/extras/ /mnt/data/yum.repo/wisdom/centos/6/extras/</span></span><br><span class="line">[root@yum ~]<span class="comment"># createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/6/updates/ /mnt/data/yum.repo/wisdom/centos/6/updates/</span></span><br><span class="line"></span><br><span class="line">[root@yum ~]<span class="comment"># createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/7/base/ /mnt/data/yum.repo/wisdom/centos/7/base/</span></span><br><span class="line">[root@yum ~]<span class="comment"># createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/7/extras/ /mnt/data/yum.repo/wisdom/centos/7/extras/</span></span><br><span class="line">[root@yum ~]<span class="comment"># createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/7/updates/ /mnt/data/yum.repo/wisdom/centos/7/updates/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写同步脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># vim /mnt/ops/cron/yum.reposync.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">reposync -c /mnt/ops/cron/Centos-6.repo -d -n -p /mnt/data/yum.repo/wisdom/centos/6/</span><br><span class="line">createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/6/base/ /mnt/data/yum.repo/wisdom/centos/6/base/</span><br><span class="line">createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/6/extras/ /mnt/data/yum.repo/wisdom/centos/6/extras/</span><br><span class="line">createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/6/updates/ /mnt/data/yum.repo/wisdom/centos/6/updates/</span><br><span class="line"><span class="comment">#wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">reposync -n -p /mnt/data/yum.repo/wisdom/centos/7/</span><br><span class="line">createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/7/base/ /mnt/data/yum.repo/wisdom/centos/7/base/</span><br><span class="line">createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/7/extras/ /mnt/data/yum.repo/wisdom/centos/7/extras/</span><br><span class="line">createrepo -p -d -o /mnt/data/yum.repo/wisdom/centos/7/updates/ /mnt/data/yum.repo/wisdom/centos/7/updates/</span><br><span class="line"><span class="comment">#reposync -c /mnt/ops/cron/Centos-7.repo -d -p /mnt/data/yum.repo/wisdom/centos/7/</span></span><br><span class="line"></span><br><span class="line">[root@yum ~]<span class="comment"># chmod +x /mnt/ops/cron/yum.reposync.sh</span></span><br><span class="line">[root@yum ~]<span class="comment"># sh /mnt/ops/cron/yum.reposync.sh</span></span><br><span class="line"></span><br><span class="line">[root@yum ~]<span class="comment"># echo '1 2 * * *     /mnt/ops/cron/yum.reposync.sh &gt;/dev/null 2&gt;&amp;1' |tee -a /var/spool/cron/root</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建repo文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># mkdir /mnt/data/yum.repo/repo</span></span><br><span class="line"></span><br><span class="line">//CentOS-6.repo   </span><br><span class="line">[root@yum repo]<span class="comment"># cat /mnt/data/yum.repo/repo/centos-6.repo    </span></span><br><span class="line">[CentOS_6_base]</span><br><span class="line">name=centos 6 x64</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://yum.domain.cn/centos/6/base</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=1</span><br><span class="line"></span><br><span class="line">[CentOS_6_updates]</span><br><span class="line">name=centos 6 x64</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://yum.domain.cn/centos/6/updates</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=3</span><br><span class="line"></span><br><span class="line">[CentOS_6_extras]</span><br><span class="line">name=centos 6 x64</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://yum.domain.cn/centos/6/extras</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=5</span><br><span class="line">[root@yum repo]<span class="comment"># cat /mnt/data/yum.repo/repo/wisdom-centos-7.repo</span></span><br><span class="line">[CentOS_7_base]</span><br><span class="line">name=centos 7 x64</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://yum.domain.cn/centos/7/base</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=1</span><br><span class="line"></span><br><span class="line">[CentOS_7_updates]</span><br><span class="line">name=centos 7 x64</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://yum.domain.cn/centos/7/updates</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=3</span><br><span class="line"></span><br><span class="line">[CentOS_7_extras]</span><br><span class="line">name=centos 7 x64</span><br><span class="line">failovermethod=priority</span><br><span class="line">baseurl=http://yum.domain.cn/centos/7/extras</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">priority=5</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端安装 yum-plugin-priorities</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum -y install yum-plugin-priorities</span></span><br><span class="line"></span><br><span class="line">//yum-plugin-priorities主要用来控制yum源更新优先级,控制进行yum源检索的先后顺序</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir –p /etc/yum.repos.d/back</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mv /etc/yum.repos.d/* /etc/yum.repos.d/back/</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo http://yum.domain.cn/repo/CentOS-6.repo</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo http://yum.domain.cn/repo/CentOS-7.repo</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># yum clean all</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum makecache</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum repolist</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="YUM-rsync-public-source"><a href="#YUM-rsync-public-source" class="headerlink" title="YUM rsync public source"></a>YUM rsync public source</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[root@yum ~]<span class="comment"># mkdir -p /mnt/data/yum.repo/centos</span></span><br><span class="line">[root@yum ~]<span class="comment"># mkdir -p /mnt/ops/cron/yum.repo.sync.log</span></span><br><span class="line">[root@yum ~]<span class="comment"># echo '1 2 * * *     /mnt/ops/cron/yum.repo.sync.sh &gt;/dev/null 2&gt;&amp;1' |tee -a /var/spool/cron/root</span></span><br><span class="line">[root@yum ~]<span class="comment"># vim /mnt/ops/cron/yum.repo.sync.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># YUM 源地址</span></span><br><span class="line">YUM_SITE=<span class="string">"rsync://mirrors.kernel.org/centos"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># YUM 同步位置</span></span><br><span class="line">YUM_LOCAL=<span class="string">"/mnt/data/yum.repo/centos"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># YUM 同步版本</span></span><br><span class="line">YUM_LOCAL_VER=<span class="string">"6 6* 7 7*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RSYNC 限速</span></span><br><span class="line">RSYNC_BW=10240</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录脚本执行PID</span></span><br><span class="line">LOCK_FILE=<span class="string">"/mnt/ops/cron/yum.repo.sync.pid"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录脚本同步日志</span></span><br><span class="line">LOG_FILE=<span class="string">"/mnt/ops/cron/yum.repo.sync.log/<span class="variable">$(date +"%Y%m%d")</span>.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定rsync命令位置,为空表示系统默认</span></span><br><span class="line">RSYNC_PATH=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将PID记录到文件中</span></span><br><span class="line">MY_PID=$$</span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$LOCK_FILE</span> ];<span class="keyword">then</span></span><br><span class="line">  get_pid=$(cat <span class="variable">$LOCK_FILE</span>)</span><br><span class="line">  get_system_pid=$(ps -ef|grep -v grep|grep <span class="variable">$get_pid</span>|wc -l)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$get_system_pid</span> -eq 0];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$MY_PID</span> |tee <span class="variable">$LOCK_FILE</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"正在同步中...!"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$MY_PID</span> |tee <span class="variable">$LOCK_FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查rsync工具</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$RSYNC_PATH</span> ];<span class="keyword">then</span></span><br><span class="line">  RSYNC_PATH=`whereis rsync|awk <span class="string">' '</span><span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="variable">$RSYNC_PATH</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'没有找到 rsync 命令'</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'安装: yum -y install rsync'</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用rsync同步YUM源</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"--------------------------------------------------"</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line"><span class="built_in">echo</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"rsync 开始时间: <span class="variable">$(date +'%Y-%m-%d %H:%M:%S')</span>"</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> VER <span class="keyword">in</span> <span class="variable">$YUM_LOCAL_VER</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$YUM_LOCAL</span>/<span class="variable">$VER</span>"</span> ];<span class="keyword">then</span></span><br><span class="line">    mkdir -p <span class="variable">$YUM_LOCAL</span>/<span class="variable">$VER</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"rsync 开始同步: <span class="variable">$VER</span> =&gt; <span class="variable">$YUM_LOCAL</span>/<span class="variable">$VER</span>"</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line">  <span class="variable">$RSYNC_PATH</span> -avrtH --delete --bwlimit=<span class="variable">$RSYNC_BW</span> --exclude=i386 <span class="variable">$YUM_SITE</span>/<span class="variable">$VER</span> <span class="variable">$YUM_LOCAL</span>/<span class="variable">$VER</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line">  <span class="built_in">echo</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"rsync 结束时间: <span class="variable">$(date +'%Y-%m-%d %H:%M:%S')</span>"</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"--------------------------------------------------"</span> |tee -a <span class="variable">$LOG_FILE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除PID文件</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$LOCK_FILE</span> ];<span class="keyword">then</span></span><br><span class="line">  rm -rf <span class="variable">$LOCK_FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/07/05/yum-server-install/" data-id="cjavy9k8100bg0coq5015lobp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/10/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/">AliCloud</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/">SDK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/Python-SDK/">Python SDK</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/">Android install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/Android-studio-install/">Android studio install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/">Doc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP-严格传输安全HSTS/">HTTP 严格传输安全HSTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP协议/">HTTP协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP-协议详解/">TCP 协议详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP与socket区别/">TCP与socket区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件描述符与打开文件之间的关系/">linux 文件描述符与打开文件之间的关系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件系统inode/">linux 文件系统inode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/一次完整的HTTP请求/">一次完整的HTTP请求</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/">Disk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-io-performance/">disk io performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-iostat/">disk iostat</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/">Distributed storage</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/">GlusterFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-architecture/">GlusterFS architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-info/">GlusterFS info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-install/">GlusterFS install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-workflow/">GlusterFS workflow</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/">DRBD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/">keepalived</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/">Intellij</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/Intellij-setting/">Intellij setting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/">vim</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-shortcut-key/">vim shortcut key</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-vimrc/">vim vimrc</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/">Kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/">kernel memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/kernel-共享内存/">kernel 共享内存</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/">ganglia</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/ganglia-install/">ganglia install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/">hmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/">htmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/">smokeping</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/">zabbix</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/">monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-cpu/">zabbix monitor cpu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-mem/">zabbix monitor mem</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-auto-discover/">zabbix auto discover</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-grafana-install/">zabbix grafana install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install/">zabbix install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-item-and-tigger/">zabbix item and tigger</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-java-gateway/">zabbix java gateway</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-modify-login-user-passwd/">zabbix modify login user passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-proxy-install/">zabbix proxy install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-server-support-chinese/">zabbix server support chinese</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-windows-agent/">zabbix windows agent</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/树莓派-GSM-语音短信报警/">树莓派 GSM 语音短信报警</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/">监控</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/监控知识体系/">监控知识体系</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/">Python Framework</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django/">Python Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django-setting/">Python Django setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/">Python Learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-内存管理/">python 内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-函数编程/">python 函数编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-变量/">python 变量</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象使用/">python 对象使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象的属性/">python 对象的属性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象编程/">python 对象编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-数据类型/">python 数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-流程控制/">python 流程控制</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-爬虫/">python 爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊方法/">python 特殊方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊说明/">python 特殊说明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-装饰器/">python 装饰器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-过程编程/">python 过程编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-进阶/">python 进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-闭包/">python 闭包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/">Python install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-error-info/">python error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-source-image/">python pip source image</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-use/">python pip use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pyenv-install/">python pyenv install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-setup-py/">python setup.py</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-source-install/">python source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-virtualenv/">python virtualenv</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/">Python library</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/MySQLdb/">MySQLdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/memory-profiler/">memory_profiler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/">Python modules</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-path/">python modules path</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-pylint-and-ipython/">python modules pylint and ipython</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/">Python other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/python-import-and-reload/">python import and reload</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/">Ruby install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP.IP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-状态/">TCP 状态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-IP模型/">TCP/IP模型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/Wireshark-use/">Wireshark use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/">WeChat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/">WeChat enterprise</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/WeChat-enterprise-API/">WeChat enterprise API</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/">automation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/">git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-command/">git command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-error/">git error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitlab/">git gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitolite/">git gitolite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs/">git gogs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs-source-install/">git gogs source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-init/">git init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-workflow/">git workflow</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/">jenkins</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-info/">jenkins info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-install/">jenkins install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/">kvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/kvm-install/">kvm install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/">maven</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/maven-install/">maven install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/">nexus</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-install/">nexus install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-proxy-maven/">nexus proxy maven</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/">rpm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/">salt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-info/">salt info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install/">salt install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-HA/">salt install HA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-standard/">salt install standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-jinja2-grain-pillar-module/">salt jinja2 grain pillar module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-event-reactor/">salt manage event reactor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-grains/">salt manage grains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-job/">salt manage job</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-module/">salt manage module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-pillar/">salt manage pillar</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-return/">salt manage return</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-states/">salt manage states</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-target/">salt manage target</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-syndic-install/">salt master syndic install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-conf/">salt master.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-minion-conf/">salt minion.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-raet/">salt raet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-state-module/">salt state module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-syndic-conf/">salt syndic.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-write-module-code/">salt write module code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/">svn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-auto-update/">svn auto update</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/">yum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/yum-server-install/">yum server install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/">Mongo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-auth/">mongo auth</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-error/">mongo error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-auth-install/">mongo replication auth install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-standard-install/">mongo replication standard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-standard-install/">mongo standard install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/">Mysql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-command/">mysql command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-error-info/">mysql error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-explain/">mysql explain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-grant/">mysql grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-index-options/">mysql index options</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave/">mysql master slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave-switch/">mysql master slave switch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-partition/">mysql partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-select-join/">mysql select join</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-slow-log/">mysql slow log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-standard/">mysql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-table-size/">mysql table size</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/">Postgresql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-book-use/">postgresql book use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave-info/">postgresql master slave info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave/">postgresql master/slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-plugin-install/">postgresql plugin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-standard/">postgresql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-tablespace-database-schema-table-user-role-relation/">postgresql tablespace database schema table user role relation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-yum-install/">postgresql yum install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-常用命令/">postgresql 常用命令</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库对象/">postgresql 数据库对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库管理/">postgresql 数据库管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/">Redis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-error/">redis error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-install/">redis install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-redis-trib-rb/">redis redis-trib.rb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-status/">redis status</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-use/">redis use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/">influxDB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang/go-env/">go env</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-high-availability/">RabbitMQ high availability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-install/">RabbitMQ install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-working-principle/">RabbitMQ working principle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/">beats</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/beats-install/">beats install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/">datax</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-info/">datax info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-install/">datax install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-job/">datax job</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-command/">elasticsearch command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-core-component/">elasticsearch core component</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-cluster/">elasticsearch exploring your cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-data/">elasticsearch exploring your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-four-search-type/">elasticsearch four search type</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-full-cluster-restart-upgrade/">elasticsearch full cluster restart upgrade</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-install/">elasticsearch install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-modifying-your-data/">elasticsearch modifying your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-rolling-upgrades/">elasticsearch rolling upgrades</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-safe-restart/">elasticsearch safe restart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-shard/">elasticsearch shard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-indexing-speed/">how to tune for indexing speed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-search-speed/">how to tune for search speed</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/">flume</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-info/">flume info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-install/">flume install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/">grafana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/grafana-install/">grafana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/hadoop-简介/">hadoop 简介</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/">kafka</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-install/">kafka install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-manage-web/">kafka manage web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-offset-monitor/">kafka offset monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-optimize/">kafka optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-web-console/">kafka web console</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/">kibana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/kibana-install/">kibana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/">logstash</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-config-file/">logstash config file</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-filter-grok/">logstash filter grok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-info/">logstash info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-install/">logstash install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/">mycat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-web-install/">mycat web install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/">nsq</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-command/">nsq command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-info/">nsq info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-install/">nsq install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/">zookeeper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-install/">zookeeper install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-monitor/">zookeeper monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-optimize/">zookeeper optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-use/">zookeeper use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-zab-protocol/">zookeeper zab protocol</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-env/">java env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-optimize/">java jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-opts/">java jvm opts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/">java learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/java-学习笔记/">java 学习笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-log4j/">java log4j</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/">java performance analysis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/jps/">jps</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-dashboard-install/">k8s dashboard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-install/">k8s install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-registry-install/">k8s registry install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/node-install/">node install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/other/ACID/">ACID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/分布式二阶段和三阶段提交协议/">分布式二阶段和三阶段提交协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/开源许可协议/">开源许可协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/网络带宽/">网络带宽</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/">system service</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/">Atlassian</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-https/">confluence https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-install/">confluence install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-reset-passwd/">confluence reset passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-update/">confluence update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-https/">jira https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-install/">jira install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-update/">jira update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/mariadb-install/">mariadb install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/Base-env/">Base env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-common-use-scripts/">linux common use scripts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-history-info-setting/">linux history info setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-login-info/">linux login info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-nginx-install/">linux nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-skill/">linux skill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-system-init/">linux system init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-内存插槽-内存信息/">linux 内存插槽 内存信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-扩容swap分区/">linux 扩容swap分区</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-物理CPU-CPU核数-逻辑CPU/">linux 物理CPU CPU核数 逻辑CPU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-磁盘系统block区别/">linux 磁盘系统block区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-设置-包含头文件路径-和-动态库链接路径/">linux 设置 包含头文件路径 和 动态库链接路径</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/">NFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/">Samba</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-conf/">samba conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-install/">samba install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/">command</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/grep/">grep</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/pigz/">pigz</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/sed/">sed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/split/">split</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/tr/">tr</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/">haproxy</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/haproxy-install/">haproxy install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-install/">nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-location/">nginx location</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-rewrite/">nginx rewrite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-status/">nginx status</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/">ntpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/ntpd-install/">ntpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/">openssl</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/openssl-certificate/">openssl certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/">openvpn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/openvpn-install/">openvpn install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/">rsync</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/rsync-install/">rsync install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/">supersord</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/supersord-install/">supersord install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/">vsftpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-error/">vsftpd error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-info/">vsftpd info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-install/">vsftpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/">windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/cygwin-install/">cygwin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/ipsec-set/">ipsec set</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/windows-modify-hosts/">windows modify hosts</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/">SSL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/">angular</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/angular-install/">angular install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/hexo-install/">hexo install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/">sass</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/sass-install/">sass install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/">xml</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/xml-format/">xml format</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/hello-everyone/">Hello Everyone</a>
          </li>
        
          <li>
            <a href="/2017/11/28/kafka-web-console/">kafka web console</a>
          </li>
        
          <li>
            <a href="/2017/11/27/svn-auto-update/">svn auto update</a>
          </li>
        
          <li>
            <a href="/2017/11/15/salt-manage-event-reactor/">salt manage event reactor</a>
          </li>
        
          <li>
            <a href="/2017/11/15/salt-manage-job/">salt manage job</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 penn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>