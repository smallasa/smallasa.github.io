<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>smallasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="smallasa">
<meta property="og:url" content="http://www.smallasa.com/page/14/index.html">
<meta property="og:site_name" content="smallasa">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="smallasa">
  
    <link rel="alternate" href="/atom.xml" title="smallasa" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">smallasa</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I known what i do !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.smallasa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-git-command" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/02/git-command/" class="article-date">
  <time datetime="2017-05-02T09:10:02.000Z" itemprop="datePublished">2017-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/git/">git</a>►<a class="article-category-link" href="/categories/automation/git/git-command/">git command</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/02/git-command/">git command</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="git-command"><a href="#git-command" class="headerlink" title="git command"></a>git command</h3><ol>
<li><p>git 删除分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//查看当前分支</span><br><span class="line">$ git branch</span><br><span class="line">* master</span><br><span class="line">  release</span><br><span class="line"></span><br><span class="line">//删除本地分支</span><br><span class="line">$ git branch -d release</span><br><span class="line">$ git branch -D release</span><br><span class="line"></span><br><span class="line">//删除远程分支</span><br><span class="line">$ git push origin :release</span><br><span class="line">说明:</span><br><span class="line">git push [远程名] [本地分支]:[远程分支] 语法,如果省略[本地分支],那就等于是在说<span class="string">"在这里提取空白然后把它变成[远程分支]"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>git 创建分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//查看当前分支</span><br><span class="line">$ git branch</span><br><span class="line">* master</span><br><span class="line"></span><br><span class="line">//创建一个新的分支,并切换到分支</span><br><span class="line">$ git checkout -b release</span><br><span class="line">$ git branch</span><br><span class="line">  master</span><br><span class="line">* release</span><br></pre></td></tr></table></figure>
</li>
<li><p>git push 分支到远程仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push --<span class="built_in">set</span>-upstream origin release</span><br></pre></td></tr></table></figure>
</li>
<li><p>git pull 远程某个分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git branch release</span><br><span class="line">$ git checkout release</span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream-to=origin/&lt;branch&gt; release</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure>
</li>
<li><p>合并分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//合并某分支到当前分支</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git merge &lt;branch&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>克隆指定分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> -b &lt;branch_name&gt; http://&lt;user&gt;:&lt;passwd&gt;@&lt;git&gt;/&lt;project&gt;/&lt;project.git&gt;</span><br><span class="line">$ git <span class="built_in">clone</span> -b lp http://<span class="built_in">test</span>:test123@git.hub.io/ops/cmdb.git</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/05/02/git-command/" data-id="cjazexzdb002xqcoqg4gh5jyb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ftp-proxy-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/27/ftp-proxy-install/" class="article-date">
  <time datetime="2017-04-27T01:32:47.000Z" itemprop="datePublished">2017-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/system-service/">system service</a>►<a class="article-category-link" href="/categories/system-service/vsftpd/">vsftpd</a>►<a class="article-category-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/27/ftp-proxy-install/">ftp proxy install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="FTP-proxy-install"><a href="#FTP-proxy-install" class="headerlink" title="FTP proxy install"></a><a href="http://www.ftpproxy.org/" target="_blank" rel="noopener">FTP proxy install</a></h3><ol>
<li><p>ftpproxy install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@59 ~]<span class="comment"># yum -y install ctags</span></span><br><span class="line">[root@59 ~]<span class="comment"># wget http://www.ftpproxy.org/download/ftpproxy-1.2.3.tgz</span></span><br><span class="line">[root@59 ~]<span class="comment"># tar xzf ftpproxy-1.2.3.tgz</span></span><br><span class="line">[root@59 ~]<span class="comment"># cd ftpproxy-1.2.3</span></span><br><span class="line">[root@59 ftpproxy-1.2.3]<span class="comment"># make</span></span><br><span class="line">[root@59 ftpproxy-1.2.3]<span class="comment"># make install</span></span><br><span class="line"></span><br><span class="line">[root@59 ftpproxy-1.2.3]<span class="comment"># mkdir -p /mnt/app/ftp_proxy</span></span><br><span class="line">[root@59 ftpproxy-1.2.3]<span class="comment"># cp /usr/local/sbin/ftp.proxy /mnt/app/ftp_proxy</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ftpproxy start</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@59 ~]<span class="comment"># /mnt/app/ftp_proxy/ftp.proxy -D 10021 -e -l -m -t 1800</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="http://www.ftpproxy.org/en/ftp.proxy-1.html" target="_blank" rel="noopener">ftp.proxy help</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">说明:</span><br><span class="line">-D 10021  指定端口为10021</span><br><span class="line">-e        启用客户端服务器选择(非常重要),通常我们的ftp账号为ftpuser这种,那么使用此参数后,我们可以访问后端的某台服务器,比如192.168.1.15,使用的账号名变成:ftpuser@192.168.1.15</span><br><span class="line">-l        Logging</span><br><span class="line">-m        monitor mod</span><br><span class="line">-t 1800   超时时间</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过ftp.proxy登录FTP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">文件协议 : FTP</span><br><span class="line">主机名   : &#123;ftp.proxy.ipaddr&#125;:&#123;ftp.proxy.port&#125;</span><br><span class="line">用户名   : &#123;ftp.user&#125;@&#123;ftp.real.ipaddr&#125;</span><br><span class="line">密码     : &#123;ftp.user.passwd&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="ftp-proxy-install/ftp.proxy.login.png" alt="ftp.proxy.login"></p>
<ol>
<li>将ftp.proxy加入到systemd<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@59 ftp_proxy]<span class="comment"># cat &gt; /mnt/app/ftp_proxy/ftpproxy.conf &lt;&lt;EOF</span></span><br><span class="line">&gt; <span class="comment">#代理服务器监听端口。</span></span><br><span class="line">&gt; BIND_PORT=10021</span><br><span class="line">&gt; <span class="comment">#其他选项</span></span><br><span class="line">&gt; <span class="comment">#-e 启用客户端服务器选择（非常重要），通常我们的ftp账号为ftpuser这种，那么使用此参数后，我们可以访问后端的某台服务器，比如192.168.1.15,使用的账号名变成:ftpuser@192.168.1.15</span></span><br><span class="line">&gt; <span class="comment">#-l Logging</span></span><br><span class="line">&gt; <span class="comment">#-t 1800 超时时间</span></span><br><span class="line">&gt; OPTIONS=<span class="string">'-e -l -m -t 1800'</span></span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">[root@59 ftp_proxy]<span class="comment"># cat &gt; /usr/lib/systemd/system/ftpproxy.service &lt;&lt;EOF</span></span><br><span class="line">&gt; [Unit]</span><br><span class="line">&gt; Description=Ftp proxy server daemon</span><br><span class="line">&gt; After=network.target</span><br><span class="line">&gt;</span><br><span class="line">&gt; [Service]</span><br><span class="line">&gt; Type=forking</span><br><span class="line">&gt; EnvironmentFile=/mnt/app/ftp_proxy/ftpproxy.conf</span><br><span class="line">&gt; ExecStart=/mnt/app/ftp_proxy/ftp.proxy  -D <span class="variable">$BIND_PORT</span> <span class="variable">$OPTIONS</span></span><br><span class="line">&gt;</span><br><span class="line">&gt; [Install]</span><br><span class="line">&gt; WantedBy=multi-user.target</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">[root@59 ftp_proxy]<span class="comment"># systemctl enable ftpproxy.service</span></span><br><span class="line">[root@59 ftp_proxy]<span class="comment"># systemctl start  ftpproxy.service</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/27/ftp-proxy-install/" data-id="cjazexzcv002sqcoqdg85f7ox" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mycat-jvm-optimize" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/24/mycat-jvm-optimize/" class="article-date">
  <time datetime="2017-04-24T02:27:57.000Z" itemprop="datePublished">2017-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/mycat/">mycat</a>►<a class="article-category-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/24/mycat-jvm-optimize/">mycat jvm optimize</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="mycat-jvm-优化"><a href="#mycat-jvm-优化" class="headerlink" title="mycat jvm 优化"></a>mycat jvm 优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//优化前(8核16G)</span><br><span class="line">[root@10 ~]<span class="comment"># vim /mnt/app/mycat/conf/wrapper.conf</span></span><br><span class="line"><span class="comment"># Java Additional Parameters</span></span><br><span class="line"><span class="comment">#wrapper.java.additional.1=</span></span><br><span class="line">wrapper.java.additional.1=-DMYCAT_HOME=.</span><br><span class="line">wrapper.java.additional.2=-server</span><br><span class="line">wrapper.java.additional.3=-XX:MaxPermSize=128M</span><br><span class="line">wrapper.java.additional.4=-XX:+AggressiveOpts</span><br><span class="line">wrapper.java.additional.5=-XX:MaxDirectMemorySize=4G</span><br><span class="line">wrapper.java.additional.6=-Dcom.sun.management.jmxremote</span><br><span class="line">wrapper.java.additional.7=-Dcom.sun.management.jmxremote.port=1984</span><br><span class="line">wrapper.java.additional.8=-Dcom.sun.management.jmxremote.authenticate=<span class="literal">false</span></span><br><span class="line">wrapper.java.additional.9=-Dcom.sun.management.jmxremote.ssl=<span class="literal">false</span></span><br><span class="line">wrapper.java.additional.10=-Xmx4G</span><br><span class="line">wrapper.java.additional.11=-Xms1G</span><br><span class="line"></span><br><span class="line">//优化后(8核16G)</span><br><span class="line">[root@10 ~]<span class="comment"># vim /mnt/app/mycat/conf/wrapper.conf</span></span><br><span class="line"><span class="comment"># Java Additional Parameters</span></span><br><span class="line"><span class="comment">#wrapper.java.additional.1=</span></span><br><span class="line">wrapper.java.additional.1=-DMYCAT_HOME=.</span><br><span class="line">wrapper.java.additional.2=-server</span><br><span class="line">wrapper.java.additional.3=-XX:MaxPermSize=512M</span><br><span class="line">wrapper.java.additional.4=-XX:+AggressiveOpts</span><br><span class="line">wrapper.java.additional.5=-XX:MaxDirectMemorySize=12G</span><br><span class="line">wrapper.java.additional.6=-Dcom.sun.management.jmxremote</span><br><span class="line">wrapper.java.additional.7=-Dcom.sun.management.jmxremote.port=1984</span><br><span class="line">wrapper.java.additional.8=-Dcom.sun.management.jmxremote.authenticate=<span class="literal">false</span></span><br><span class="line">wrapper.java.additional.9=-Dcom.sun.management.jmxremote.ssl=<span class="literal">false</span></span><br><span class="line">wrapper.java.additional.10=-Xmx10G</span><br><span class="line">wrapper.java.additional.11=-Xms5G</span><br><span class="line">wrapper.java.additional.12=-XX:+UseG1GC</span><br><span class="line">wrapper.java.additional.13=-XX:NewRatio=3</span><br><span class="line">wrapper.java.additional.14=-XX:SurvivorRatio=3</span><br><span class="line">wrapper.java.additional.15=-XX:ParallelGCThreads=8</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">-XX:MaxPermSize  Perm,持久代.用于存放静态文件,如今Java类,方法等.持久代对垃圾回收没有显著影响,但是有些应用可能动态生成或者调用一些class,例如hibernate等,在这种时候需要设置一个比较大的持久代空间来存放这些运行过程中新增的类</span><br><span class="line">-XX:+AggressiveOpts  加快编译</span><br><span class="line">-XX:MaxDirectMemorySize  此参数的含义是当Direct ByteBuffer分配的堆外内存到达指定大小后,即触发Full GC.注意该值是有上限的，默认是64M，最大为sun.misc.VM.maxDirectMemory()，在程序中中可以获得-XX:MaxDirectMemorySize的设置的值</span><br><span class="line">-Xmx和-Xms 类对象分配在JVM的堆内存里面,直接由Java虚拟机负责垃圾回收</span><br><span class="line">-XX:+UseG1GC 使用G1垃圾处理器</span><br><span class="line">-XX:NewRatio 设置年轻代和年老代的比值。例如:值为3，则表示年轻代与年老代比值为1：3，年轻代占整个年轻代年老代和的1/4</span><br><span class="line">-XX:SurvivorRatio 年轻代中Eden区与两个Survivor区的比值。注意Survivor区有两个。如：3，表示Eden：Survivor=3：2，一个Survivor区占整个年轻代的1/5</span><br><span class="line">-XX:ParallelGCThreads 配置并行收集器的线程数，即：同时多少个线程一起进行垃圾回收。此值最好配置与处理器数目相等。</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/24/mycat-jvm-optimize/" data-id="cjazexzgr0069qcoqor0a1csc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-jvm-原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/24/java-jvm-原理/" class="article-date">
  <time datetime="2017-04-24T00:46:19.000Z" itemprop="datePublished">2017-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/24/java-jvm-原理/">java jvm 原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="JVM-原理"><a href="#JVM-原理" class="headerlink" title="JVM 原理"></a>JVM 原理</h3><ol>
<li><p>JVM简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JVM是虚拟机,也是一种规范,他遵循着冯·诺依曼体系结构的设计原理(冯·诺依曼体系结构中,指出计算机处理的数据和指令都是二进制数,采用存储程序方式不加区分的存储在同一个存储器里,并且顺序执行,指令由操作码和地址码组成,操作码决定了操作类型和所操作的数的数字类型,地址码则指出地址码和操作数).</span><br><span class="line"></span><br><span class="line">从DOS到window8,从unix到ubuntu和CentOS,还有MAC OS等等,不同的操作系统指令集以及数据结构都有着差异,而JVM通过在操作系统上建立虚拟机,自己定义出来的一套统一的数据结构和操作指令,把同一套语言翻译给各大主流的操作系统,实现了跨平台运行,可以说JVM是Java的核心,是java可以一次编译到处运行的本质所在.</span><br></pre></td></tr></table></figure>
</li>
<li><p>JVM的组成和运行原理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JVM的毕竟是个虚拟机,是一种规范,虽说符合冯诺依曼的计算机设计理念,但是他并不是实体计算机,所以他的组成也不是什么存储器,控制器,运算器,输入输出设备.</span><br><span class="line"></span><br><span class="line">在我看来,JVM放在运行在真实的操作系统中表现的更像应用或者说是进程,他的组成可以理解为JVM这个进程有哪些功能模块,而这些功能模块的运作可以看做是JVM的运行原理.</span><br><span class="line"></span><br><span class="line">JVM有多种实现,例如: Oracle的JVM,HP的JVM和IBM的JVM等,而在本文中研究学习的则是使用最广泛的Oracle的HotSpot JVM.</span><br></pre></td></tr></table></figure>
</li>
<li><p>JVM在JDK中的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JDK是Java开发的必备工具箱,JDK其中有一部分是JRE,JRE是JAVA运行环境,JVM则是JRE最核心的部分.</span><br><span class="line">如图:JDK Standard Edtion</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="java-jvm-原理/jdk.standard.edtion.jpg" alt="JDK Standard Edtion"><br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">从最底层的位置可以看出来JVM有多重要,而实际项目中JAVA应用的性能优化,OOM等异常的处理最终都得从JVM这儿来解决</span><br><span class="line"></span><br><span class="line">HotSpot是Oracle关于JVM的商标,区别于IBM,HP等厂商开发的JVM</span><br><span class="line"></span><br><span class="line">Java HotSpot Client VM和Java HotSpot Server VM是JDK关于JVM的两种不同的实现,前者可以减少启动时间和内存占用,而后者则提供更加优秀的程序运行速度</span><br><span class="line"></span><br><span class="line">例如:</span><br><span class="line">[root@10 ~]# java -version</span><br><span class="line">java version &quot;1.8.0_73&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_73-b02)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.73-b02, mixed mode)</span><br><span class="line"></span><br><span class="line">HotSpot的版本号是25.73-b02,类型是Java HotSpot Server VM</span><br></pre></td></tr></table></figure></p>
<ol>
<li>JVM的组成<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JVM由4大部分组成: ClassLoader,Runtime Data Area,Execution Engine,Native Interface</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="java-jvm-原理/jvm.组成.png" alt="jvm.组成"><br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">JVM组成部分说明:</span><br><span class="line">* ClassLoader</span><br><span class="line">  ClassLoader是负责加载class文件,class文件在文件开头有特定的文件标示,并且ClassLoader只负责class文件的加载,至于它是否可以运行,则由Execution Engine决定</span><br><span class="line"></span><br><span class="line">* Native Interface</span><br><span class="line">  Native Interface是负责调用本地接口的.它的作用是调用不同语言的接口给JAVA用,他会在Native Method Stack中记录对应的本地方法,然后调用该方法时就通过Execution Engine加载对应的本地lib</span><br><span class="line"></span><br><span class="line">* Execution Engine</span><br><span class="line">  Execution Engine是执行引擎,也叫Interpreter.Class文件被加载后,会把指令和数据信息放入内存中,Execution Engine则负责把这些命令解释给操作系统</span><br><span class="line"></span><br><span class="line">* Runtime Data Area</span><br><span class="line">  Runtime Data Area则是存放数据的,分为五部分:Stack,Heap,Method Area,PC Register,Native Method Stack.几乎所有的关于java内存方面的问题,都是集中在这块</span><br><span class="line">  * Stack</span><br><span class="line">    Stack是java栈内存,它等价于C语言中的栈,栈的内存地址是不连续的,每个线程都拥有自己的栈.</span><br><span class="line">    栈里面存储着的是StackFrame,在《JVM Specification》中文版中被译作java虚拟机框架,也叫做栈帧.</span><br><span class="line">    StackFrame包含三类信息: 局部变量,执行环境,操作数栈</span><br><span class="line">    * 局部变量用来存储一个类的方法中所用到的局部变量</span><br><span class="line">    * 执行环境用于保存解析器对于java字节码进行解释过程中需要的信息,包括:上次调用的方法,局部变量指针和操作数栈的栈顶和栈底指针</span><br><span class="line">    * 操作数栈用于存储运算所需要的操作数和结果</span><br><span class="line">    StackFrame在方法被调用时创建,在某个线程中,某个时间点上,只有一个框架是活跃的,该框架被称为Current Frame,而框架中的方法被称为Current Method,其中定义的类为Current Class.局部变量和操作数栈上的操作总是引用当前框架.当Stack Frame中方法被执行完之后,或者调用别的StackFrame中的方法时,则当前栈变为另外一个StackFrame.Stack的大小是由两种类型:固定和动态的,动态类型的栈可以按照线程的需要分配</span><br><span class="line">  * Heap</span><br><span class="line">    Heap是用来存放对象信息的,和Stack不同,Stack代表着一种运行时的状态.换句话说,栈是运行时单位,解决程序该如何执行的问题,而堆是存储的单位,解决数据存储的问题.</span><br><span class="line">    Heap是伴随着JVM的启动而创建,负责存储所有对象实例和数组的.堆的存储空间和栈一样是不需要连续的,它分为Young Generation和Old Generation(也叫Tenured Generation)两大部分.Young Generation分为Eden和Survivor,Survivor又分为From Space和 ToSpace.</span><br><span class="line"></span><br><span class="line">    和Heap经常一起提及的概念是PermanentSpace,它是用来加载类对象的专门的内存区,是非堆内存,和Heap一起组成JAVA内存,它包含MethodArea区(在没有CodeCache的HotSpotJVM实现里,则MethodArea就相当于GenerationSpace)</span><br><span class="line"></span><br><span class="line">    在JVM初始化的时候,我们可以通过参数来分别指定,PermanentSpace的大小,堆的大小,以及Young Generation和Old Generation的比值,Eden区和From Space的比值,从而来细粒度的适应不同JAVA应用的内存需求</span><br><span class="line">  * PC Register</span><br><span class="line">    PC Register是程序计数寄存器,每个JAVA线程都有一个单独的PC Register,他是一个指针,由Execution Engine读取下一条指令.如果该线程正在执行java方法,则PC Register存储的是正在被执行的指令的地址;如果是本地方法,PC Register的值没有定义.PC寄存器非常小,只占用一个字宽,可以持有一个returnAdress或者特定平台的一个指针</span><br><span class="line">  * Method Area</span><br><span class="line">    Method Area在HotSpot JVM的实现中属于非堆区,非堆区包括两部分:Permanet Generation和Code Cache,而Method Area属于Permanert Generation的一部分.</span><br><span class="line">    Permanent Generation用来存储类信息,比如说:class definitions,structures,methods,field,method(data and code)和constants.</span><br><span class="line">    Code Cache用来存储Compiled Code,即编译好的本地代码,在HotSpot JVM中通过JIT(Just In Time)Compiler生成,JIT是即时编译器,他是为了提高指令的执行效率,把字节码文件编译成本地机器代码</span><br><span class="line">  * Native Method Stack</span><br><span class="line">    Native Method Stack是供本地方法(非java)使用的栈.每个线程持有一个Native Method Stack</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>JVM的运行原理简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Java程序被javac工具编译为.class字节码文件之后,我们执行java命令,该class文件便被JVM的Class Loader加载,可以看出JVM的启动是通过JAVA Path下的java.exe或者java进行的.</span><br><span class="line"></span><br><span class="line">JVM的初始化,运行到结束大概包括这么几步:</span><br><span class="line">调用操作系统API判断系统的CPU架构,根据对应CPU类型寻找位于JRE目录下的/lib/jvm.cfg文件,然后通过该配置文件找到对应的jvm.dll文件(如果我们参数中有-server或者-client,则加载对应参数所指定的jvm.dll,启动指定类型的JVM),初始化jvm.dll并且挂接到JNIENV结构的实例上,之后就可以通过JNIENV实例装载并且处理class文件了.class文件是字节码文件,它按照JVM的规范,定义了变量,方法等的详细信息,JVM管理并且分配对应的内存来执行程序,同时管理垃圾回收.直到程序结束,一种情况是JVM的所有非守护线程停止,一种情况是程序调用System.exit(),JVM的生命周期也结束</span><br></pre></td></tr></table></figure>
</li>
<li><p>JVM的内存管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JVM中的内存管理主要是指JVM对于Heap的管理,这是因为Stack,PC Register和Native Method Stack都是和线程一样的生命周期,在线程结束时自然可以被再次使用.虽然说Stack的管理不是重点,但是也不是完全不讲究的</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 栈的管理</span><br><span class="line">  JVM允许栈的大小是固定的或者是动态变化的.Stack的设置是通过-Xss来设置其大小.</span><br><span class="line"></span><br><span class="line">  我们一般通过减少常量,参数的个数来减少栈的增长,在程序设计时,我们把一些常量定义到一个对象中,然后来引用他们可以体现这一点.另外,少用递归调用也可以减少栈的占用</span><br><span class="line"></span><br><span class="line">  栈是不需要垃圾回收的,尽管说垃圾回收是java内存管理的一个很热的话题,栈中的对象如果用垃圾回收的观点来看,他永远是live状态,是可以reachable的,所以也不需要回收,他占有的空间随着Thread的结束而释放</span><br><span class="line"></span><br><span class="line">  另外栈上有一点得注意的是,对于本地代码调用,可能会在栈中申请内存,比如C调用malloc(),而这种情况下,GC是管不着的,需要我们在程序中,手动管理栈内存,使用free()方法释放内存</span><br><span class="line"></span><br><span class="line">  关于栈一般会发生以下两种异常:</span><br><span class="line">  1.当线程中的计算所需要的栈超过所允许大小时,会抛出StackOverflowError</span><br><span class="line">  2.当Java栈试图扩展时,没有足够的存储器来实现扩展,JVM会报OutOfMemoryError</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 堆的管理</span><br><span class="line">  堆的管理要比栈管理复杂的多,我通过堆的各部分的作用,设置,以及各部分可能发生的异常,以及如何避免各部分异常</span><br><span class="line"></span><br><span class="line">  下图是Heap和PermanentSapce的组合图,其中Eden区里面存着是新生的对象,From Space和To Space中存放着是每次垃圾回收后存活下来的对象,所以每次垃圾回收后,Eden区会被清空.存活下来的对象先是放到From Space,当From Space满了之后移动到To Space.当To Space满了之后移动到Old Space.</span><br><span class="line"></span><br><span class="line">  Survivor的两个区是对称的,没先后关系,所以同一个区中可能同时存在从Eden复制过来对象,和从前一个Survivor复制过来的对象,而复制到年老区的只有从第一个Survivor复制过来的对象.而且,Survivor区总有一个是空的.同时,根据程序需要,Survivor区是可以配置为多个的(多于两个),这样可以增加对象在年轻代中的存在时间,减少被放到年老代的可能</span><br><span class="line"></span><br><span class="line">  Old Space中则存放生命周期比较长的对象,而且有些比较大的新生对象也放在Old Space中</span><br><span class="line"></span><br><span class="line">  堆的大小通过-Xms和-Xmx来指定最小值和最大值,通过-Xmn来指定Young Generation的大小(一些老版本也用-XX:NewSize指定(即下图中的Eden加FromSpace和ToSpace的总大小)),然后通过-XX:NewRatio来指定Eden区的大小,在Xms和Xmx相等的情况下,该参数不需要设置.通过-XX:SurvivorRatio来设置Eden和一个Survivor区的比值</span><br><span class="line"></span><br><span class="line">  堆异常分为两种:</span><br><span class="line">  1.Out of Memory(OOM)</span><br><span class="line">  2.Memory Leak(ML)</span><br><span class="line">  Memory Leak最终将导致OOM.实际应用中表现为:从Console看,内存监控曲线一直在顶部,程序响应慢,从线程看,大部分的线程在进行GC,占用比较多的CPU,最终程序异常终止,报OOM.OOM发生的时间不定,有短的一个小时,有长的10天一个月的.</span><br><span class="line">  关于异常的处理,确定OOM/ML异常后,一定要注意保护现场,可以dump heap,如果没有现场则开启GCFlag收集垃圾回收日志,然后进行分析,确定问题所在.如果问题不是ML的话,一般通过增加Heap,增加物理内存来解决问题,是的话,就修改程序逻辑</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="java-jvm-原理/jvm.heap.png" alt="jvm.heap"></p>
<ol>
<li>JVM垃圾回收<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">JVM中会在以下情况触发回收: 对象没有被引用,作用域发生未捕捉异常,程序正常执行完毕,程序执行了System.exit(),程序发生意外终止</span><br><span class="line"></span><br><span class="line">JVM中标记垃圾使用的算法是一种根搜索算法.简单的说,就是从一个叫GC Roots的对象开始,向下搜索,如果一个对象不能达到GC Roots对象的时候,说明它可以被回收了.这种算法比一种叫做引用计数法的垃圾标记算法要好,因为它避免了当两个对象啊互相引用时无法被回收的现象</span><br><span class="line"></span><br><span class="line">JVM中对于被标记为垃圾的对象进行回收时又分为了一下3种算法:</span><br><span class="line">* 标记清除算法</span><br><span class="line">  该算法是从根集合扫描整个空间,标记存活的对象,然后在扫描整个空间对没有被标记的对象进行回收,这种算法在存活对象较多时比较高效,但会产生内存碎片</span><br><span class="line">* 复制算法</span><br><span class="line">  该算法是从根集合扫描,并将存活的对象复制到新的空间,这种算法在存活对象少时比较高效</span><br><span class="line">* 标记整理算法</span><br><span class="line">  标记整理算法和标记清除算法一样都会扫描并标记存活对象,在回收未标记对象的同时会整理被标记的对象,解决了内存碎片的问题</span><br><span class="line"></span><br><span class="line">JVM中,不同的内存区域作用和性质不一样,使用的垃圾回收算法也不一样,所以JVM中又定义了几种不同的垃圾回收器:</span><br><span class="line">* Serial GC</span><br><span class="line">  从名字上看,串行GC意味着是一种单线程的,所以它要求收集的时候所有的线程暂停.这对于高性能的应用是不合理的,所以串行GC一般用于Client模式的JVM中</span><br><span class="line">* ParNew GC</span><br><span class="line">  是在Serial GC的基础上,增加了多线程机制.但是如果机器是单CPU的,这种收集器是比Serial GC效率还低</span><br><span class="line">* Parrallel Scavenge GC</span><br><span class="line">  这种收集器又叫吞吐量优先收集器,而吞吐量=程序运行时间/(JVM执行回收的时间+程序运行时间),假设程序运行了100分钟,JVM的垃圾回收占用1分钟,那么吞吐量就是99%.Parallel Scavenge GC由于可以提供比较不错的吞吐量,所以被作为了server模式JVM的默认配置</span><br><span class="line">* ParallelOld</span><br><span class="line">  ParallelOld是老生代并行收集器的一种,使用了标记整理算法,是JDK1.6中引进的,在之前老生代只能使用串行回收收集器</span><br><span class="line">* Serial Old</span><br><span class="line">  Serial Old是老生代client模式下的默认收集器,单线程执行,同时也作为CMS收集器失败后的备用收集器</span><br><span class="line">* CMS</span><br><span class="line">  CMS又称响应时间优先回收器,使用标记清除算法.他的回收线程数为(CPU核心数+3)/4,所以当CPU核心数为2时比较高效些.CMS分为4个过程:初始标记,并发标记,重新标记,并发清除</span><br><span class="line">* GarbageFirst(G1)</span><br><span class="line">  比较特殊的是G1回收器既可以回收Young Generation,也可以回收Tenured Generation.它是在JDK6的某个版本中才引入的,性能比较高,同时注意了吞吐量和响应时间</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">默认的GC种类可以通过jvm.cfg或者通过jmap dump出heap来查看,一般我们通过jstat -gcutil [pid] 1000可以查看每秒gc的大体情况,或者可以在启动参数中加入:-verbose:gc -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -Xloggc:./gc.log来记录GC日志</span><br><span class="line"></span><br><span class="line">GC中有一种情况叫做Full GC,以下几种情况会触发Full GC也叫MajorGC:</span><br><span class="line">* Tenured Space空间不足以创建打的对象或者数组,会执行FullGC,并且当FullGC之后空间如果还不够,那么会OOM:java heap space</span><br><span class="line">* Permanet Generation的大小不足,存放了太多的类信息,在非CMS情况下回触发FullGC.如果之后空间还不够,会OOM:PermGen space。</span><br><span class="line">* CMS GC时出现promotion failed和concurrent mode failure时,也会触发FullGC.promotion failed是在进行Minor GC时,survivor space放不下,对象只能放入旧生代,而此时旧生代也放不下造成的;concurrent mode failure是在执行CMS GC的过程中同时有对象要放入旧生代,而此时旧生代空间不足造成的</span><br><span class="line">* 判断MinorGC后,要晋升到TenuredSpace的对象大小大于TenuredSpace的大小,也会触发FullGC</span><br><span class="line">可以看出，当FullGC频繁发生时，一定是内存出问题了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意: 下图中连线代表两个回收器可以同时使用</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="java-jvm-原理/jvm.gc.png" alt="jvm.gc"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/24/java-jvm-原理/" data-id="cjazexzel0045qcoqcgz5yat5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-high-throughput" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/19/kafka-high-throughput/" class="article-date">
  <time datetime="2017-04-19T08:17:46.000Z" itemprop="datePublished">2017-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/19/kafka-high-throughput/">kafka high throughput</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kafka高性能吞吐"><a href="#kafka高性能吞吐" class="headerlink" title="kafka高性能吞吐"></a>kafka高性能吞吐</h3><ol>
<li><p>kafka涉及到的架构和名词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* Topic</span><br><span class="line">  用于划分Message的逻辑概念,一个Topic可以分布在多个Broker上 |</span><br><span class="line">* Partition</span><br><span class="line">  是Kafka中横向扩展和一切并行化的基础,每个Topic都至少被切分为1个Partition    |</span><br><span class="line">* Offset</span><br><span class="line">  消息在Partition中的编号,编号顺序不跨Partition</span><br><span class="line">* Consumer</span><br><span class="line">  用于从Broker中取出/消费Message</span><br><span class="line">* Producer</span><br><span class="line">  用于往Broker中发送/生产Message</span><br><span class="line">* Replication</span><br><span class="line">  Kafka支持以Partition为单位对Message进行冗余备份,每个Partition都可以配置至少1个Replication(当仅1个Replication时即仅该Partition本身)</span><br><span class="line">* Leader</span><br><span class="line">  每个Replication集合中的Partition都会选出一个唯一的Leader,所有的读写请求都由Leader处理.其他Replicas从Leader处把数据更新同步到本地.</span><br><span class="line">* Broker</span><br><span class="line">  Kafka中使用Broker来接受Producer和Consumer的请求,并把Message持久化到本地磁盘.&lt;br&gt;每个Cluster当中会选举出一个Broker来担任Controller,负责处理Partition的Leader选举,协调Partition迁移等工作</span><br><span class="line">* ISR(In-Sync Replica)</span><br><span class="line">  是Replicas的一个子集,表示目前Alive且与Leader能够&quot;Catch-up&quot;的Replicas集合.</span><br><span class="line">  由于读写都是首先落到Leader上,所以一般来说通过同步机制从Leader上拉取数据的Replica都会和Leader有一些延迟(包括了延迟时间和延迟条数两个维度),任意一个超过阈值都会把该Replica踢出ISR.每个Partition都有它自己独立的ISR</span><br></pre></td></tr></table></figure>
</li>
<li><p>Kafka优异的吞吐性能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">1.Broker</span><br><span class="line">  不同于Redis和MemcacheQ等内存消息队列,Kafka的设计是把所有的Message都要写入速度低容量大的硬盘,以此来换取更强的存储能力.实际上,Kafka使用硬盘并没有带来过多的性能损失,&quot;规规矩矩&quot;的超了一条&quot;近道&quot;</span><br><span class="line"></span><br><span class="line">  首先,说&quot;规规矩矩&quot;是因为Kafka在磁盘上只做Sequence I/O,由于消息系统读写的特殊性,这并不存在什么问题.所以通过只做Sequence I/O的限制,规避了磁盘访问速度低下对性能可能造成的影响.</span><br><span class="line"></span><br><span class="line">  其次,说超&quot;近道&quot;是因为Kafka重度依赖底层操作系统提供的PageCache功能.</span><br><span class="line"></span><br><span class="line">  当上层有写操作时,操作系统只是将数据写入PageCache,同时标记Page属性为Dirty.当读操作发生时,先从PageCache中查找,如果发生缺页才进行磁盘调度,最终返回需要的数据.实际上PageCache是把尽可能多的空闲内存都当做了磁盘缓存来使用.同时如果有其他进程申请内存,回收PageCache的代价又很小,所以现代的OS都支持PageCache.</span><br><span class="line"></span><br><span class="line">  使用PageCache功能同时可以避免在JVM内部缓存数据,JVM为我们提供了强大的GC能力,同时也引入了一些问题不适用与Kafka的设计.</span><br><span class="line">  * 如果在Heap内管理缓存,JVM的GC线程会频繁扫描Heap空间,带来不必要的开销.如果Heap过大,执行一次Full GC对系统的可用性来说将是极大的挑战</span><br><span class="line">  * 所有在在JVM内的对象都不免带有一个Object Overhead(千万不可小视),内存的有效空间利用率会因此降低.</span><br><span class="line">  * 所有的In-Process Cache在OS中都有一份同样的PageCache.所以通过将缓存只放在PageCache,可以至少让可用缓存空间翻倍</span><br><span class="line">  * 如果Kafka重启,所有的In-Process Cache都会失效,而OS管理的PageCache依然可以继续使用</span><br><span class="line"></span><br><span class="line">  PageCache还只是第一步,Kafka为了进一步的优化性能还采用了Sendfile技术.</span><br><span class="line">  在解释Sendfile之前,首先介绍一下传统的网络I/O操作流程,大体上分为以下4步:</span><br><span class="line">  1.OS从硬盘把数据读到内核区的PageCache</span><br><span class="line">  2.用户进程把数据从内核区Copy到用户区</span><br><span class="line">  3.用户进程再把数据写入到Socket,数据流入内核区的Socket Buffer上</span><br><span class="line">  4.OS再把数据从Buffer中Copy到网卡的Buffer上,这样完成一次发送</span><br><span class="line"></span><br><span class="line">  整个过程共经历两次Context Switch,四次System Call.同一份数据在内核Buffer与用户Buffer之间重复拷贝,效率低下.其中2,3两步没有必要,完全可以直接在内核区完成数据拷贝.这也正是Sendfile所解决的问题,经过Sendfile优化后,整个I/O过程就变成了下面这个样子:</span><br><span class="line">  1.OS从硬盘把数据读到内核区的PageCache</span><br><span class="line">  2.Sendfile把数据copy到Socket</span><br><span class="line">  3.OS再把数据从Buffer中Copy到网卡的Buffer上,这样完成一次发送</span><br><span class="line"></span><br><span class="line">  Kafka的设计初衷是尽一切努力在内存中完成数据交换,无论是对外作为一整个消息系统,或是内部同底层操作系统的交互.如果Producer和Consumer之间生产和消费进度上配合得当,完全可以实现数据交换零I/O.这也就是我为什么说Kafka使用&quot;硬盘&quot;并没有带来过多性能损失的原因</span><br><span class="line"></span><br><span class="line">  拓展1:</span><br><span class="line">  * Kafka官方并不建议通过Broker端的log.flush.interval.messages和log.flush.interval.ms来强制写盘,认为数据的可靠性应该通过Replica来保证,而强制Flush数据到磁盘会对整体性能产生影响.</span><br><span class="line">  * 可以通过调整/proc/sys/vm/dirty_background_ratio和/proc/sys/vm/dirty_ratio来调优性能</span><br><span class="line">    a.脏页率超过第一个指标会启动pdflush开始Flush Dirty PageCache</span><br><span class="line">    b.脏页率超过第二个指标会阻塞所有的写操作来进行Flush</span><br><span class="line">    c.根据不同的业务需求可以适当的降低dirty_background_ratio和提高dirty_ratio</span><br><span class="line">  * 建议值</span><br><span class="line">    log.flush.interval.messages=100000</span><br><span class="line">    log.flush.interval.ms=60000</span><br><span class="line">    log.flush.scheduler.interval.ms = 5000</span><br><span class="line"></span><br><span class="line">    vm.dirty_background_ratio = 5</span><br><span class="line">    vm.dirty_ratio = 20</span><br><span class="line"></span><br><span class="line">  拓展2:</span><br><span class="line">  //查看内核参数</span><br><span class="line">  [root@10 ~]# sysctl -a | grep dirty</span><br><span class="line">  vm.dirty_background_bytes = 0</span><br><span class="line">  vm.dirty_background_ratio = 10</span><br><span class="line">  vm.dirty_bytes = 0</span><br><span class="line">  vm.dirty_expire_centisecs = 3000</span><br><span class="line">  vm.dirty_ratio = 20</span><br><span class="line">  vm.dirty_writeback_centisecs = 500</span><br><span class="line"></span><br><span class="line">  //查看脏数据</span><br><span class="line">  [root@10 ~]# cat /proc/vmstat | egrep &quot;dirty|writeback&quot;</span><br><span class="line">  nr_dirty 16696</span><br><span class="line">  nr_writeback 0</span><br><span class="line">  nr_writeback_temp 0</span><br><span class="line">  nr_dirty_threshold 51787</span><br><span class="line">  nr_dirty_background_threshold 25893</span><br><span class="line"></span><br><span class="line">  vm.dirty_background_ratio is the percentage of system memory that can be filled with &quot;dirty&quot; pages — memory pages that still need to be written to disk — before the pdflush/flush/kdmflush background processes kick in to write it to disk. My example is 10%, so if my virtual server has 32 GB of memory that’s 3.2 GB of data that can be sitting in RAM before something is done.</span><br><span class="line"></span><br><span class="line">  vm.dirty_ratio is the absolute maximum amount of system memory that can be filled with dirty pages before everything must get committed to disk. When the system gets to this point all new I/O blocks until dirty pages have been written to disk. This is often the source of long I/O pauses, but is a safeguard against too much data being cached unsafely in memory.</span><br><span class="line"></span><br><span class="line">  vm.dirty_background_bytes and vm.dirty_bytes are another way to specify these parameters. If you set the _bytes version the _ratio version will become 0, and vice-versa</span><br><span class="line"></span><br><span class="line">  vm.dirty_expire_centisecs is how long something can be in cache before it needs to be written. In this case it’s 30 seconds. When the pdflush/flush/kdmflush processes kick in they will check to see how old a dirty page is, and if it’s older than this value it’ll be written asynchronously to disk. Since holding a dirty page in memory is unsafe this is also a safeguard against data loss.</span><br><span class="line"></span><br><span class="line">  vm.dirty_writeback_centisecs is how often the pdflush/flush/kdmflush processes wake up and check to see if work needs to be done.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2.Partition</span><br><span class="line">  Partition是Kafka可以很好的横向扩展和提供高并发处理以及实现Replication的基础</span><br><span class="line"></span><br><span class="line">  扩展性方面:</span><br><span class="line">  首先,Kafka允许Partition在集群内的Broker之间任意移动,以此来均衡可能存在的数据倾斜问题.</span><br><span class="line">  其次,Partition支持自定义的分区算法,例如可以将同一个Key的所有消息都路由到同一个Partition上去.同时Leader也可以在In-Sync的Replica中迁移.由于针对某一个Partition的所有读写请求都是只由Leader来处理,所以Kafka会尽量把Leader均匀的分散到集群的各个节点上,以免造成网络流量过于集中</span><br><span class="line"></span><br><span class="line">  并发方面:</span><br><span class="line">  任意Partition在某一个时刻只能被一个Consumer Group内的一个Consumer消费(反过来一个Consumer则可以同时消费多个Partition),Kafka非常简洁的Offset机制最小化了Broker和Consumer之间的交互,这使Kafka并不会像同类其他消息队列一样,随着下游Consumer数目的增加而成比例的降低性能.此外,如果多个Consumer恰巧都是消费时间序上很相近的数据,可以达到很高的PageCache命中率,因而Kafka可以非常高效的支持高并发读操作,实践中基本可以达到单机网卡上限</span><br><span class="line"></span><br><span class="line">  不过,Partition的数量并不是越多越好,Partition的数量越多,平均到每一个Broker上的数量也就越多.考虑到Broker宕机(Network Failure, Full GC)的情况下,需要由Controller来为所有宕机的Broker上的所有Partition重新选举Leader,假设每个Partition的选举消耗10ms,如果Broker上有500个Partition,那么在进行选举的5s的时间里,对上述Partition的读写操作都会触发LeaderNotAvailableException</span><br><span class="line"></span><br><span class="line">  再进一步,如果挂掉的Broker是整个集群的Controller,那么首先要进行的是重新任命一个Broker作为Controller.新任命的Controller要从Zookeeper上获取所有Partition的Meta信息,获取每个信息大概3-5ms,那么如果有10000个Partition这个时间就会达到30s-50s.而且不要忘记这只是重新启动一个Controller花费的时间,在这基础上还要再加上前面说的选举Leader的时间.</span><br><span class="line"></span><br><span class="line">  此外,在Broker端,对Producer和Consumer都使用了Buffer机制.其中Buffer的大小是统一配置的,数量则与Partition个数相同.如果Partition个数过多,会导致Producer和Consumer的Buffer内存占用过大.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  拓展:</span><br><span class="line">  * Partition的数量尽量提前预分配,虽然可以在后期动态增加Partition,但是会冒着可能破坏Message Key和Partition之间对应关系的风险</span><br><span class="line">  * Replica的数量不要过多,如果条件允许尽量把Replica集合内的Partition分别调整到不同的Rack</span><br><span class="line">  * 尽一切努力保证每次停Broker时都可以Clean Shutdown,否则问题就不仅仅是恢复服务所需时间长,还可能出现数据损坏或其他很诡异的问题</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">3.Producer</span><br><span class="line">  在Producer端的优化大部分消息系统采取的方式都比较单一,无非也就化零为整,同步变异步这么几种</span><br><span class="line"></span><br><span class="line">  Kafka系统默认支持MessageSet,把多条Message自动地打成一个Group后发送出去,均摊后拉低了每次通信的RTT.而且在组织MessageSet的同时,还可以把数据重新排序,从爆发流式的随机写入优化成较为平稳的线性写入.</span><br><span class="line"></span><br><span class="line">  此外,还要着重介绍的一点是,Producer支持End-to-End的压缩.数据在本地压缩后放到网络上传输,在Broker一般不解压(除非指定要Deep-Iteration),直至消息被Consume之后在客户端解压.当然用户也可以选择自己在应用层上做压缩和解压的工作(毕竟Kafka目前支持的压缩算法有限，只有GZIP和Snappy)，不过这样做反而会意外的降低效率！！！！ Kafka的End-to-End压缩与MessageSet配合在一起工作效果最佳,上面的做法直接割裂了两者间联系.至于道理其实很简单,压缩算法中一条基本的原理&quot;重复的数据量越多,压缩比越高&quot;.无关于消息体的内容,无关于消息体的数量,大多数情况下输入数据量大一些会取得更好的压缩比.</span><br><span class="line"></span><br><span class="line">  不过Kafka采用MessageSet也导致在可用性上一定程度的妥协.每次发送数据时,Producer都是send()之后就认为已经发送出去了,但其实大多数情况下消息还在内存的MessageSet当中,尚未发送到网络,这时候如果Producer挂掉,那就会出现丢数据的情况</span><br><span class="line"></span><br><span class="line">  为了解决这个问题,Kafka在0.8版本的设计借鉴了网络当中的ack机制.如果对性能要求较高,又能在一定程度上允许Message的丢失,那就可以设置request.required.acks=0 来关闭ack,以全速发送.如果需要对发送的消息进行确认,就需要设置request.required.acks为1或-1,那么1和-1又有什么区别呢？这里又要提到前面聊的有关Replica数量问题.如果配置为1,表示消息只需要被Leader接收并确认即可,其他的Replica可以进行异步拉取无需立即进行确认,在保证可靠性的同时又不会把效率拉得很低.如果设置为-1,表示消息要Commit到该Partition的ISR集合中的所有Replica后,才可以返回ack,消息的发送会更安全,而整个过程的延迟会随着Replica的数量正比增长,这里就需要根据不同的需求做相应的优化</span><br><span class="line"></span><br><span class="line">  拓展:</span><br><span class="line">  * Producer的线程不要配置过多,尤其是在Mirror或者Migration中使用的时候,会加剧目标集群Partition消息乱序的情况(如果你的应用场景对消息顺序很敏感的话)</span><br><span class="line">  * 0.8版本的request.required.acks默认是0(同0.7)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">4.Consumer</span><br><span class="line">  Consumer端的设计大体上还算是比较常规的</span><br><span class="line">  通过Consumer Group,可以支持生产者消费者和队列访问两种模式:</span><br><span class="line"></span><br><span class="line">  Consumer API分为High level和Low level两种:</span><br><span class="line">  第一种重度依赖Zookeeper,所以性能差一些且不自由,但是超省心.</span><br><span class="line">  第二种不依赖Zookeeper服务,无论从自由度和性能上都有更好的表现,但是所有的异常(Leader迁移、Offset越界、Broker宕机等)和Offset的维护都需要自行处理</span><br><span class="line"></span><br><span class="line">  发布的0.9 Release。开发人员又用Java重写了一套Consumer.把两套API合并在一起,同时去掉了对Zookeeper的依赖.据说性能有大幅度提升</span><br><span class="line"></span><br><span class="line">  拓展:</span><br><span class="line">  强烈推荐使用Low level API,虽然繁琐一些,但是目前只有这个API可以对Error数据进行自定义处理,尤其是处理Broker异常或由于Unclean Shutdown导致的Corrupted Data时,否则无法Skip只能等着&quot;坏消息&quot;在Broker上被Rotate掉,在此期间该Replica将会一直处于不可用状态</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/19/kafka-high-throughput/" data-id="cjazexzf1004mqcoq5gdayoyy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-use-memory-as-disk" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/19/mysql-use-memory-as-disk/" class="article-date">
  <time datetime="2017-04-19T07:08:01.000Z" itemprop="datePublished">2017-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>►<a class="article-category-link" href="/categories/database/Mysql/">Mysql</a>►<a class="article-category-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/19/mysql-use-memory-as-disk/">mysql use memory as disk</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="mysql使用内存作为磁盘存储"><a href="#mysql使用内存作为磁盘存储" class="headerlink" title="mysql使用内存作为磁盘存储"></a>mysql使用内存作为磁盘存储</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.创建挂载点</span><br><span class="line">  mkdir -p /path/to/ram_data</span><br><span class="line">2.挂载目录</span><br><span class="line">  mount tmpfs /path/to/ram_data -t tmpfs -o size=160G	(size指定的是能供使用的内存的上限)</span><br><span class="line">3.授权</span><br><span class="line">  chown mysql.mysql /path/to/ram_data</span><br><span class="line">4.修改数据库配置文件</span><br><span class="line">  在mysql配置文件中将mysql的数据目录路径配置为上面新建的文件路径下.这样,向/path/to/ram_data里写的文件其实都是写在内存而不是硬盘上了.</span><br><span class="line">  这会极大的提升mysql数据库中文件的IO性能.</span><br><span class="line">5.开机自启动</span><br><span class="line">  将&quot;mount tmpfs /path/to/ram_data -t tmpfs -o size=160G&quot;添加到&quot;/etc/rc.local&quot;,这样每次开机就会自动挂载该目录</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">由于是内存盘存储的mysql数据,所以系统重启后mysql中的数据会全部丢失,需要手动将数据文件重新复制到指定挂载目录下再启动数据库,切记！</span><br><span class="line"></span><br><span class="line">简单的讲就是把内存当作磁盘分区挂载上可以大大提高数据库的IO</span><br><span class="line">这样做的好处是,数据库的速度不存在io瓶颈,但是服务器不能重启</span><br><span class="line">上面的示例已经在生产环境中经过长期使用验证了其实际性能是可靠的！！！</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/19/mysql-use-memory-as-disk/" data-id="cjazexzi2006wqcoquorkr0qd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-drbd-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/18/drbd-install/" class="article-date">
  <time datetime="2017-04-18T03:41:46.000Z" itemprop="datePublished">2017-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/HA/">HA</a>►<a class="article-category-link" href="/categories/HA/DRBD/">DRBD</a>►<a class="article-category-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/18/drbd-install/">drbd install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="DRBD-介绍"><a href="#DRBD-介绍" class="headerlink" title="DRBD 介绍"></a>DRBD 介绍</h3><ol>
<li><p>DRBD是什么</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DRBD,叫做分布式复制块设备,这是一种基于软件,无共享,复制的解决方案.在服务器之间的块设备(包括硬盘,分区,逻辑卷)进行镜像.也就是说当某一个应用程序完成写操作后,它提交的数据不仅仅会保存在本地块设备上,DRBD也会将这份数据复制一份,通过网络传输到另一个节点的块设备上,这样,两个节点上的块设备上的数据将会保存一致,这就是镜像功能</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD特性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 实时性: 当某个应用程序完成对数据的修改时,复制功能立即发生</span><br><span class="line">* 透明性: 应用程序的数据存储在镜像块设备上是独立透明的,他们的数据在两个节点上都保存一份,因此,无论哪一台服务器宕机,都不会影响应用程序读取数据的操作,所以说是透明的</span><br><span class="line">* 同步镜像和异步镜像: 同步镜像表示当应用程序提交本地的写操作后,数据后会同步写到两个节点上去;异步镜像表示当应用程序提交写操作后,只有当本地的节点上完成写操作后,另一个节点才可以完成写操作</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD用户空间管理工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">为了能够配置和管理DRBD的资源,DRBD提供了一些管理工具与内核模块进行通信:</span><br><span class="line">* drbdadm: 高级的DRBD程序管理套件工具.它从配置文件/etc/drbd.conf中获取所有配置参数.drbdadm为drbdsetup和drbdmeta两个命令充当程序的前端应用,执行drbdadm实际是执行的drbdsetup和drbdeta两个命令</span><br><span class="line">* drbdsetup: drbdsetup可以让用户配置已经加载在内核中运行的DRBD模块,它是底层的DRBD程序管理套件工具.使用该命令时,所有的配置参数都需要直接在命令行中定义,虽然命令很灵活,但是大大的降低了命令的简单易用性,因此很多的用户很少使用drbdsetup</span><br><span class="line">* drbdmeta: drbdmeta允许用户创建、转储、还原和修改drbd的元数据结构.这个命令也是用户极少用到</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DRBD有2中模式: 一种是DRBD的主从模式;另一种是DRBD的双主模式</span><br><span class="line">1.DRBD的主从模式</span><br><span class="line">  这种模式下,其中一个节点作为主节点,另一个节点作为从节点.其中主节点可以执行读,写操作;从节点不可以挂载文件系统,因此,也不可以执行读写操作.在这种模式下,资源在任何时间只能存储在主节点上.这种模式可用在任何的文件系统上(EXT3、EXT4、XFS等等).默认这种模式下,一旦主节点发生故障,从节点需要手工将资源进行转移,且主节点变成从节点和从节点变成主节点需要手动进行切换.不能自动进行转移,因此比较麻烦.</span><br><span class="line">  为了解决手动将资源和节点进行转移,可以将DRBD做成高可用集群的资源代理(RA),这样一旦其中的一个节点宕机,资源会自动转移到另一个节点,从而保证服务的连续性</span><br><span class="line">2.DRBD的双主模式</span><br><span class="line">  这是DRBD8.0之后的新特性</span><br><span class="line">  在双主模式下,任何资源在任何特定的时间都存在两个主节点.这种模式需要一个共享的集群文件系统,利用分布式的锁机制进行管理,如GFS和OCFS2.部署双主模式时,DRBD可以是负载均衡的集群,这就需要从两个并发的主节点中选取一个首选的访问数据.这种模式默认是禁用的,如果要是用的话必须在配置文件中进行声明.</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD同步协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DRBD的复制功能就是将应用程序提交的数据一份保存在本地节点,一份复制传输保存在另一个节点上.但是DRBD需要对传输的数据进行确认以便保证另一个节点的写操作完成,就需要用到DRBD的同步协议,DRBD同步协议有三种:</span><br><span class="line"></span><br><span class="line">* 协议A: 数据在本地完成写操作且数据已经发送到TCP/IP协议栈的队列中,则认为写操作完成.如果本地节点的写操作完成,此时本地节点发生故障,而数据还处在TCP/IP队列中,则数据不会发送到对端节点上.因此,两个节点的数据将不会保持一致.这种协议虽然高效,但是并不能保证数据的可靠性</span><br><span class="line"></span><br><span class="line">* 协议B: 数据在本地完成写操作且数据已到达对端节点则认为写操作完成.如果两个节点同时发生故障,即使数据到达对端节点,这种方式同样也会导致在对端节点和本地节点的数据不一致现象,也不具有可靠性</span><br><span class="line"></span><br><span class="line">* 协议C: 只有当本地节点的磁盘和对端节点的磁盘都完成了写操作,才认为写操作完成.这是集群流行的一种方式,应用也是最多的,这种方式虽然不高效,但是最可靠</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在DRBD中,资源是所有可复制移动存储设备的总称,它包括:</span><br><span class="line">* 资源名称: 资源名称可以是除了空白字符以外的任意ASCII码字符</span><br><span class="line">* DRBD设备: DRBD的虚拟块设备.在双方节点上,DRBD设备的设备文件命名方式,一般为/dev/drbdN,其主设备号147,N是次设备号</span><br><span class="line">* 磁盘配置：DRBD内部应用需要本地数据副本,元数据.在双方节点上,为各自提供的存储设备</span><br><span class="line">* 网络配置: 双方数据同步时所使用的网络属性</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DRBD的主配置文件为/etc/drbd.conf</span><br><span class="line">为了管理的便捷性,目前通常会将些配置文件分成多个部分,且都保存至/etc/drbd.d目录中,主配置文件中仅使用&quot;include&quot;指令将这些配置文件片断整合起来.通常,/etc/drbd.d目录中的配置文件为global_common.conf和所有以.res结尾的文件.其中global_common.conf中主要定义global段和common段,而每一个.res的文件用于定义一个资源.</span><br><span class="line"></span><br><span class="line">在配置文件中,global段仅能出现一次,且如果所有的配置信息都保存至同一个配置文件中而不分开为多个文件的话,global段必须位于配置文件的最开始处.目前global段中可以定义的参数仅有minor-count, dialog-refresh, disable-ip-verification和usage-count</span><br><span class="line"></span><br><span class="line">common段则用于定义被每一个资源默认继承的参数,可以在资源定义中使用的参数都可以在common段中定义.实际应用中,common段并非必须,但建议将多个资源共享的参数定义为common段中的参数以降低配置文件的复杂度</span><br><span class="line"></span><br><span class="line">resource段则用于定义drbd资源,每个资源通常定义在一个单独的位于/etc/drbd.d目录中的以.res结尾的文件中.资源在定义时必须为其命名,名字可以由非空白的ASCII字符组成.每一个资源段的定义中至少要包含两个host子段,以定义此资源关联至的节点,其它参数均可以从common段或drbd的默认中进行继承而无须定义</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD配置文件信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">[root@ha1 ~]<span class="comment"># cat /etc/drbd.d/global_common.conf</span></span><br><span class="line">global &#123;</span><br><span class="line"> usage-count yes;   //DRBD用于统计应用各个版本的信息.当新的版本的drbd被安装就会和http server进行联系.当然也可以禁用该选项,默认情况下是启动</span><br><span class="line"> <span class="comment"># minor-count dialog-refresh disable-ip-verification  //这里是global可以使用的参数</span></span><br><span class="line"> <span class="comment"># minor-count：32     //从（设备）个数，取值范围1~255，默认值为32。该选项设定了允许定义的resource个数，当要定义的resource超过了此选项的设定时，需要重新载入drbd内核模块。</span></span><br><span class="line"> <span class="comment">#disable-ip-verification：no   //是否禁用ip检查</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">common &#123;</span><br><span class="line"> protocol C;    //指定复制协议,复制协议共有三种，为协议A，B，C，默认协议为协议C</span><br><span class="line"> handlers &#123;     //该配置段用来定义一系列处理器，用来回应特定事件。</span><br><span class="line">  <span class="comment"># These are EXAMPLE handlers only.</span></span><br><span class="line">  <span class="comment"># They may have severe implications,</span></span><br><span class="line">  <span class="comment"># like hard resetting the node under certain circumstances.</span></span><br><span class="line">  <span class="comment"># Be careful when chosing your poison.</span></span><br><span class="line">  <span class="comment"># pri-on-incon-degr "/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f";</span></span><br><span class="line">  <span class="comment"># pri-lost-after-sb "/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f";</span></span><br><span class="line">  <span class="comment"># local-io-error "/usr/lib/drbd/notify-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f";</span></span><br><span class="line">  <span class="comment"># fence-peer "/usr/lib/drbd/crm-fence-peer.sh";</span></span><br><span class="line">  <span class="comment"># split-brain "/usr/lib/drbd/notify-split-brain.sh root";</span></span><br><span class="line">  <span class="comment"># out-of-sync "/usr/lib/drbd/notify-out-of-sync.sh root";</span></span><br><span class="line">  <span class="comment"># before-resync-target "/usr/lib/drbd/snapshot-resync-target-lvm.sh -p 15 -- -c 16k";</span></span><br><span class="line">  <span class="comment"># after-resync-target /usr/lib/drbd/unsnapshot-resync-target-lvm.sh;</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> startup &#123;   //该配置段用来更加精细地调节drbd属性，它作用于配置节点在启动或重启时。常用选项有：</span><br><span class="line">  <span class="comment"># wfc-timeout degr-wfc-timeout outdated-wfc-timeout wait-after-sb</span></span><br><span class="line">  // wfc-timeout：该选项设定一个时间值，单位是秒。在启用DRBD块时，初始化脚本drbd会阻塞启动进程的运行，直到对等节点的出现。该选项就是用来限制这个等待时间的，默认为0，即不限制，永远等待。</span><br><span class="line">  // degr-wfc-timeout：该选项也设定一个时间值，单位为秒。也是用于限制等待时间，只是作用的情形不同：它作用于一个降级集群（即那些只剩下一个节点的集群）在重启时的等待时间。</span><br><span class="line">  // outdated-wfc-timeout：同上，也是用来设定等待时间，单位为秒。它用于设定等待过期节点的时间</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> disk &#123;</span><br><span class="line">  <span class="comment"># on-io-error fencing use-bmbv no-disk-barrier no-disk-flushes   这里是disk段内可以定义的参数</span></span><br><span class="line">  <span class="comment"># no-disk-drain no-md-flushes max-bio-bvecs                      这里是disk段内可以定义的参数</span></span><br><span class="line">  on-io-error： detach   </span><br><span class="line">  //此选项设定了一个策略,如果底层设备向上层设备报告发生I/O错误,将按照该策略进行处理.有效的策略包括：</span><br><span class="line">  //detach: 发生I/O错误的节点将放弃底层设备,以diskless mode继续工作.在diskless mode下,只要还有网络连接,drbb从secondary node读写数据,而不需要failover（故障转移）.该策略会导致一定的损失,但好处也很明显,drbd服务不会中断.官方推荐和默认策略。</span><br><span class="line">  //pass_on: 把I/O错误报告给上层设备.如果错误发生在primary节点,把它报告给文件系统,由上层设备处理这些错误(例如,它会导致文件系统以只读方式重新挂载),它可能会导致drbd停止提供服务;如果发生在secondary节点,则忽略该错误(因为secondary节点没有上层设备可以报告).该策略曾经是默认策略,但现在已被detach所取代</span><br><span class="line">  //call-local-io-error: 调用预定义的本地<span class="built_in">local</span>-io-error脚本进行处理.该策略需要在resource(或common)配置段的handlers部分,预定义一个相应的<span class="built_in">local</span>-io-error命令调用.该策略完全由管理员通过<span class="built_in">local</span>-io-error命令(或脚本)调用来控制如何处理I/O错误</span><br><span class="line"></span><br><span class="line">  fencing：dont-care</span><br><span class="line">  //该选项设定一个策略来避免split brain的状况。有效的策略包括：</span><br><span class="line">  //dont-care：默认策略。不采取任何隔离措施。</span><br><span class="line">  //resource-only：在此策略下，如果一个节点处于split brain状态，它将尝试隔离对端节点的磁盘。这个操作通过调用fence-peer处理器来实现。fence-peer处理器将通过其它通信路径到达对等节点，并在这个对等节点上调用drbdadm outdate res命令</span><br><span class="line">  //resource-and-stonith：在此策略下，如果一个节点处于split brain状态，它将停止I/O操作，并调用fence-peer处理器。处理器通过其它通信路径到达对等节点，并在这个对等节点上调用drbdadm outdate res命令。如果无法到达对等节点，它将向对等端发送关机命令。一旦问题解决，I/O操作将重新进行。如果处理器失败，你可以使用resume-io命令来重新开始I/O操作</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> net &#123;     //该配置段用来精细地调节drbd的属性，网络相关的属性。常用的选项有：</span><br><span class="line">  <span class="comment"># sndbuf-size rcvbuf-size timeout connect-int ping-int ping-timeout max-buffers     这里是net段内可以定义的参数</span></span><br><span class="line">  <span class="comment"># max-epoch-size ko-count allow-two-primaries cram-hmac-alg shared-secret   这里是net段内可以定义的参数</span></span><br><span class="line">  <span class="comment"># after-sb-0pri after-sb-1pri after-sb-2pri data-integrity-alg no-tcp-cork   这里是net段内可以定义的参数</span></span><br><span class="line">  sndbuf-size：该选项用来调节TCP send buffer的大小，drbd 8.2.7以前的版本，默认值为0，意味着自动调节大小；新版本的drbd的默认值为128KiB。高吞吐量的网络（例如专用的千兆网卡，或负载均衡中绑定的连接）中，增加到512K比较合适，或者可以更高，但是最好不要超过2M。</span><br><span class="line"></span><br><span class="line">  timeout：该选项设定一个时间值，单位为0.1秒。如果搭档节点没有在此时间内发来应答包，那么就认为搭档节点已经死亡，因此将断开这次TCP/IP连接。默认值为60，即6秒。该选项的值必须小于connect-int和ping-int的值。</span><br><span class="line"></span><br><span class="line">  connect-int：如果无法立即连接上远程DRBD设备，系统将断续尝试连接。该选项设定的就是两次尝试间隔时间。单位为秒，默认值为10秒。</span><br><span class="line"></span><br><span class="line">  ping-timeout：该选项设定一个时间值，单位是0.1秒。如果对端节点没有在此时间内应答keep-alive包,它将被认为已经死亡.默认值是500ms</span><br><span class="line"></span><br><span class="line">  max-buffers：该选项设定一个由drbd分配的最大请求数，单位是页面大小（PAGE_SIZE），大多数系统中，页面大小为4KB。这些buffer用来存储那些即将写入磁盘的数据。最小值为32（即128KB）。这个值大一点好。</span><br><span class="line"></span><br><span class="line">  max-epoch-size：该选项设定了两次write barriers之间最大的数据块数。如果选项的值小于10，将影响系统性能。大一点好</span><br><span class="line"></span><br><span class="line">  ko-count：该选项设定一个值，把该选项设定的值 乘以 timeout设定的值，得到一个数字N，如果secondary节点没有在此时间内完成单次写请求，它将从集群中被移除（即，primary node进入StandAlong模式）。取值范围0~200，默认值为0，即禁用该功能。</span><br><span class="line"></span><br><span class="line">  allow-two-primaries：这个是drbd8.0及以后版本才支持的新特性，允许一个集群中有两个primary node。该模式需要特定文件系统的支撑，目前只有OCFS2和GFS可以，传统的ext3、ext4、xfs等都不行！</span><br><span class="line"></span><br><span class="line">  cram-hmac-alg：该选项可以用来指定HMAC算法来启用对端节点授权。drbd强烈建议启用对端点授权机制。可以指定/proc/crypto文件中识别的任一算法。必须在此指定算法，以明确启用对端节点授权机制，实现数据加密传输。</span><br><span class="line"></span><br><span class="line">  shared-secret：该选项用来设定在对端节点授权中使用的密码，最长64个字符。</span><br><span class="line"></span><br><span class="line">  data-integrity-alg：该选项设定内核支持的一个算法，用于网络上的用户数据的一致性校验。通常的数据一致性校验，由TCP/IP头中所包含的16位校验和来进行，而该选项可以使用内核所支持的任一算法。该功能默认关闭。</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> syncer &#123;   该配置段用来更加精细地调节服务的同步进程。常用选项有</span><br><span class="line">  <span class="comment"># rate after al-extents use-rle cpu-mask verify-alg csums-alg</span></span><br><span class="line">  rate：设置同步时的速率，默认为250KB。默认的单位是KB/sec，也允许使用K、M和G，如40M。注意：syncer中的速率是以bytes，而不是bits来设定的。配置文件中的这个选项设置的速率是永久性的，但可使用下列命令临时地改变rate的值：drbdsetup /dev/drbdN syncer -r 100M。如果想重新恢复成drbd.conf配置文件中设定的速率，执行如下命令： drbdadm adjust resource</span><br><span class="line"></span><br><span class="line">  verify-alg：该选项指定一个用于在线校验的算法，内核一般都会支持md5、sha1和crc32c校验算法。在线校验默认关闭，必须在此选项设定参数，以明确启用在线设备校验。DRBD支持在线设备校验，它以一种高效的方式对不同节点的数据进行一致性校验。在线校验会影响CPU负载和使用，但影响比较轻微。drbd 8.2.5及以后版本支持此功能。一旦启用了该功能，你就可以使用下列命令进行一个在线校验： drbdadm verify resource。该命令对指定的resource进行检验，如果检测到有数据块没有同步，它会标记这些块，并往内核日志中写入一条信息。这个过程不会影响正在使用该设备的程序。</span><br><span class="line">  如果检测到未同步的块，当检验结束后，你就可以如下命令重新同步它们：drbdadm disconnect resource   or   drbdadm connetc resource</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">common段是用来定义共享的资源参数，以减少资源定义的重复性。common段是非必须的。resource段一般为DRBD上每一个节点来定义其资源参数的。</span><br><span class="line">资源配置文件详解</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ha1 ~]<span class="comment"># cat /etc/drbd.d/web.res</span></span><br><span class="line">resource web &#123;            web为资源名称</span><br><span class="line"> on ha1.xsl.com &#123;         on后面为节点的名称,有几个节点就有几个on段，这里是定义节点ha1.xsl.com上的资源</span><br><span class="line">  device   /dev/drbd0;    定义DRBD虚拟块设备，这个设备不要事先不要格式化</span><br><span class="line">  disk /dev/sda6;         定义存储磁盘为/dev/sda6,该分区创建完成之后就行了，不要进行格式化操作</span><br><span class="line">  address 192.168.108.199:7789;  定义DRBD监听的地址和端口，以便和对端进行通信</span><br><span class="line">  meta-disk  internal;      该参数有2个选项：internal和externally，其中internal表示将元数据和数据存储在同一个磁盘上,而externally表示将元数据和数据分开存储，元数据被放在另一个磁盘上。</span><br><span class="line"> &#125;</span><br><span class="line"> on ha2.xsl.com &#123;      这里是定义节点ha2.xsl.com上的资源</span><br><span class="line">  device /dev/drbd0;</span><br><span class="line">  disk /dev/sda6;</span><br><span class="line">  address 192.168.108.201:7789;</span><br><span class="line">  meta-disk internal;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD安装步骤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 安装drbd</span><br><span class="line">* 配置资源文件（定义资料名称，磁盘，节点信息，同步限制等）</span><br><span class="line">* 将drbd加入到系统服务chkconfig --add drbd  </span><br><span class="line">* 初始化资源组drbdadm create-md resource_name</span><br><span class="line">* 启动服务 service drbd start</span><br><span class="line">* 设置primary主机，并同步数据</span><br><span class="line">* 分区、格式化/dev/drbd*</span><br><span class="line">* 一个节点进行挂载</span><br><span class="line">* 查看状态</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="DRBD-install"><a href="#DRBD-install" class="headerlink" title="DRBD install"></a>DRBD install</h3><ol>
<li><p>DRBD安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install drbd84 kmod-drbd84</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD主配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vim /etc/drbd.conf #查看主配置文件</span></span><br><span class="line"><span class="comment"># You can find an example in  /usr/share/doc/drbd.../drbd.conf.example</span></span><br><span class="line">include <span class="string">"drbd.d/global_common.conf"</span>;</span><br><span class="line">include <span class="string">"drbd.d/*.res"</span>;</span><br><span class="line">[root@node1 ~]<span class="comment"># cat /etc/drbd.d/global_common.conf #查看主配置文件</span></span><br><span class="line">global &#123;  </span><br><span class="line">    usage-count yes;  </span><br><span class="line">    <span class="comment"># minor-count dialog-refresh disable-ip-verification  </span></span><br><span class="line">&#125;</span><br><span class="line">common &#123;</span><br><span class="line">    handlers &#123;  </span><br><span class="line">        pri-on-incon-degr <span class="string">"/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"</span>;  </span><br><span class="line">        pri-lost-after-sb <span class="string">"/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"</span>;  </span><br><span class="line">        <span class="built_in">local</span>-io-error <span class="string">"/usr/lib/drbd/notify-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f"</span>;  </span><br><span class="line">        <span class="comment"># fence-peer "/usr/lib/drbd/crm-fence-peer.sh";  </span></span><br><span class="line">        <span class="comment"># split-brain "/usr/lib/drbd/notify-split-brain.sh root";  </span></span><br><span class="line">        <span class="comment"># out-of-sync "/usr/lib/drbd/notify-out-of-sync.sh root";  </span></span><br><span class="line">        <span class="comment"># before-resync-target "/usr/lib/drbd/snapshot-resync-target-lvm.sh -p 15 -- -c 16k";  </span></span><br><span class="line">        <span class="comment"># after-resync-target /usr/lib/drbd/unsnapshot-resync-target-lvm.sh;  </span></span><br><span class="line">    &#125;</span><br><span class="line">    startup &#123;</span><br><span class="line">        <span class="comment"># wfc-timeout degr-wfc-timeout outdated-wfc-timeout wait-after-sb  </span></span><br><span class="line">    &#125;</span><br><span class="line">    options &#123;</span><br><span class="line">        <span class="comment"># cpu-mask on-no-data-accessible  </span></span><br><span class="line">    &#125;</span><br><span class="line">    disk &#123;</span><br><span class="line">        <span class="comment"># size max-bio-bvecs on-io-error fencing disk-barrier disk-flushes  </span></span><br><span class="line">        <span class="comment"># disk-drain md-flushes resync-rate resync-after al-extents  </span></span><br><span class="line">                <span class="comment"># c-plan-ahead c-delay-target c-fill-target c-max-rate  </span></span><br><span class="line">                <span class="comment"># c-min-rate disk-timeout  </span></span><br><span class="line">    &#125;</span><br><span class="line">    net &#123;</span><br><span class="line">        <span class="comment"># protocol timeout max-epoch-size max-buffers unplug-watermark  </span></span><br><span class="line">        <span class="comment"># connect-int ping-int sndbuf-size rcvbuf-size ko-count  </span></span><br><span class="line">        <span class="comment"># allow-two-primaries cram-hmac-alg shared-secret after-sb-0pri  </span></span><br><span class="line">        <span class="comment"># after-sb-1pri after-sb-2pri always-asbp rr-conflict  </span></span><br><span class="line">        <span class="comment"># ping-timeout data-integrity-alg tcp-cork on-congestion  </span></span><br><span class="line">        <span class="comment"># congestion-fill congestion-extents csums-alg verify-alg  </span></span><br><span class="line">        <span class="comment"># use-rle  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD 全局配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vim /etc/drbd.d/global_common.conf  </span></span><br><span class="line">global &#123;  </span><br><span class="line">    usage-count no; <span class="comment">#让linbit公司收集目前drbd的使用情况，yes为参加，我们这里不参加设置为no  </span></span><br><span class="line">    <span class="comment"># minor-count dialog-refresh disable-ip-verification  </span></span><br><span class="line">&#125;</span><br><span class="line">common &#123;</span><br><span class="line">    handlers &#123;  </span><br><span class="line">        pri-on-incon-degr <span class="string">"/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"</span>;  </span><br><span class="line">        pri-lost-after-sb <span class="string">"/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"</span>;  </span><br><span class="line">        <span class="built_in">local</span>-io-error <span class="string">"/usr/lib/drbd/notify-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f"</span>;  </span><br><span class="line">        <span class="comment"># fence-peer "/usr/lib/drbd/crm-fence-peer.sh";  </span></span><br><span class="line">        <span class="comment"># split-brain "/usr/lib/drbd/notify-split-brain.sh root";  </span></span><br><span class="line">        <span class="comment"># out-of-sync "/usr/lib/drbd/notify-out-of-sync.sh root";  </span></span><br><span class="line">        <span class="comment"># before-resync-target "/usr/lib/drbd/snapshot-resync-target-lvm.sh -p 15 -- -c 16k";  </span></span><br><span class="line">        <span class="comment"># after-resync-target /usr/lib/drbd/unsnapshot-resync-target-lvm.sh;  </span></span><br><span class="line">    &#125;</span><br><span class="line">    startup &#123;</span><br><span class="line">        <span class="comment"># wfc-timeout degr-wfc-timeout outdated-wfc-timeout wait-after-sb  </span></span><br><span class="line">    &#125;</span><br><span class="line">    options &#123;</span><br><span class="line">        <span class="comment"># cpu-mask on-no-data-accessible  </span></span><br><span class="line">    &#125;</span><br><span class="line">    disk &#123;</span><br><span class="line">        <span class="comment"># size max-bio-bvecs on-io-error fencing disk-barrier disk-flushes  </span></span><br><span class="line">        <span class="comment"># disk-drain md-flushes resync-rate resync-after al-extents  </span></span><br><span class="line">                <span class="comment"># c-plan-ahead c-delay-target c-fill-target c-max-rate  </span></span><br><span class="line">                <span class="comment"># c-min-rate disk-timeout  </span></span><br><span class="line">        on-io-error detach; <span class="comment">#同步错误的做法是分离  </span></span><br><span class="line">    &#125;</span><br><span class="line">    net &#123;</span><br><span class="line">        <span class="comment"># protocol timeout max-epoch-size max-buffers unplug-watermark  </span></span><br><span class="line">        <span class="comment"># connect-int ping-int sndbuf-size rcvbuf-size ko-count  </span></span><br><span class="line">        <span class="comment"># allow-two-primaries cram-hmac-alg shared-secret after-sb-0pri  </span></span><br><span class="line">        <span class="comment"># after-sb-1pri after-sb-2pri always-asbp rr-conflict  </span></span><br><span class="line">        <span class="comment"># ping-timeout data-integrity-alg tcp-cork on-congestion  </span></span><br><span class="line">        <span class="comment"># congestion-fill congestion-extents csums-alg verify-alg  </span></span><br><span class="line">        <span class="comment"># use-rle  </span></span><br><span class="line">        cram-hmac-alg <span class="string">"sha1"</span>; <span class="comment">#设置加密算法sha1  </span></span><br><span class="line">        shared-secret <span class="string">"mydrbdlab"</span>; <span class="comment">#设置加密key  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD 增加资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 drbd.d]<span class="comment"># cat web.res  </span></span><br><span class="line">resource web &#123;  </span><br><span class="line">  on node1.test.com &#123;  </span><br><span class="line">    device    /dev/drbd0;  </span><br><span class="line">    disk      /dev/sdb;  </span><br><span class="line">    address   192.168.1.201:7789;  </span><br><span class="line">    meta-disk internal;  </span><br><span class="line">  &#125;  </span><br><span class="line">  on node2.test.com &#123;  </span><br><span class="line">    device    /dev/drbd0;  </span><br><span class="line">    disk      /dev/sdb;  </span><br><span class="line">    address   192.168.1.202:7789;  </span><br><span class="line">    meta-disk internal;  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将配置文件global_common.conf web.res同步到node2</p>
</li>
<li><p>node1与node2上初始化资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nodex ~]<span class="comment"># drbdadm create-md web</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>node1与node2上启动DRBD服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nodex ~]<span class="comment"># systemctl start drbd</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>node1与node2查看状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nodex ~]<span class="comment"># cat /proc/drbd</span></span><br><span class="line">[root@nodex ~]<span class="comment"># drbd-overview</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将node1设置为主节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># drbdsetup /dev/drbd0 primary –o</span></span><br><span class="line">or</span><br><span class="line">[root@node1 ~]<span class="comment"># drbdadm -- --overwrite-data-of-peer primary web</span></span><br><span class="line"></span><br><span class="line">[root@node1 ~]<span class="comment"># drbd-overview</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD格式化并挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># mke2fs -j /dev/drbd0</span></span><br><span class="line"></span><br><span class="line">[root@node1 ~]<span class="comment"># mkdir /drbd  </span></span><br><span class="line">[root@node1 ~]<span class="comment"># mount /dev/drbd0 /drbd/  </span></span><br><span class="line">[root@node1 ~]<span class="comment"># mount  |grep drdb0</span></span><br><span class="line">/dev/drbd0 on /drbd <span class="built_in">type</span> ext3 (rw)</span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD 主从切换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">对主Primary/Secondary模型的drbd服务来讲,在某个时刻只能有一个节点为Primary.因此,要切换两个节点的角色,只能在先将原有的Primary节点设置为Secondary后,才能原来的Secondary节点设置为Primary</span><br><span class="line"></span><br><span class="line">node1:</span><br><span class="line">[root@node1 ~]<span class="comment"># umount /drbd/</span></span><br><span class="line">[root@node1 ~]<span class="comment"># drbdadm secondary web</span></span><br><span class="line">[root@node1 ~]<span class="comment"># drbd-overview  </span></span><br><span class="line">  0:web/0  Connected Secondary/Secondary UpToDate/UpToDate C r-----</span><br><span class="line"></span><br><span class="line">node2:</span><br><span class="line">[root@node2 ~]<span class="comment"># drbdadm primary web</span></span><br><span class="line">[root@node2 ~]<span class="comment"># drbd-overview   </span></span><br><span class="line">  0:web/0  Connected Primary/Secondary UpToDate/UpToDate C r-----   </span><br><span class="line">[root@node2 ~]<span class="comment"># mkdir /drbd  </span></span><br><span class="line">[root@node2 ~]<span class="comment"># mount /dev/drbd0 /drbd/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DRBD 双主模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@node ~]<span class="comment"># drbdadm primary --force resource</span></span><br><span class="line">配置资源双主模型的示例：</span><br><span class="line">resource mydrbd &#123;</span><br><span class="line">        net &#123;</span><br><span class="line">                protocol C;  </span><br><span class="line">                allow-two-primaries yes;  </span><br><span class="line">        &#125;</span><br><span class="line">        startup &#123;</span><br><span class="line">                become-primary-on both;  </span><br><span class="line">        &#125;</span><br><span class="line">        disk &#123;</span><br><span class="line">                fencing resource-and-stonith;  </span><br><span class="line">        &#125;</span><br><span class="line">        handlers &#123;</span><br><span class="line">                <span class="comment"># Make sure the other node is confirmed  </span></span><br><span class="line">                <span class="comment"># dead after this!  </span></span><br><span class="line">                outdate-peer <span class="string">"/sbin/kill-other-node.sh"</span>;  </span><br><span class="line">        &#125;</span><br><span class="line">        on node1.magedu.com &#123;</span><br><span class="line">                device  /dev/drbd0;  </span><br><span class="line">                disk    /dev/vg0/mydrbd;  </span><br><span class="line">                address 172.16.200.11:7789;  </span><br><span class="line">                meta-disk       internal;  </span><br><span class="line">        &#125;</span><br><span class="line">        on node2.magedu.com &#123;</span><br><span class="line">                device  /dev/drbd0;  </span><br><span class="line">                disk    /dev/vg0/mydrbd;  </span><br><span class="line">                address 172.16.200.12:7789;  </span><br><span class="line">                meta-disk       internal;  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/18/drbd-install/" data-id="cjazexzc0001tqcoq25zf2lnp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-make提高源码编译速度" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/18/make提高源码编译速度/" class="article-date">
  <time datetime="2017-04-18T03:19:52.000Z" itemprop="datePublished">2017-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/system-service/">system service</a>►<a class="article-category-link" href="/categories/system-service/CentOS/">CentOS</a>►<a class="article-category-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/18/make提高源码编译速度/">make提高源码编译速度</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="make-提交源码编译速度"><a href="#make-提交源码编译速度" class="headerlink" title="make 提交源码编译速度"></a>make 提交源码编译速度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">make 默认是以单核进行编译,速度很慢,需要增加一个参数&quot;-j(表示指定内核参数)&quot;,提交编译速度.</span><br><span class="line"></span><br><span class="line">例如:</span><br><span class="line">[root@10 app]# tar xzf otp_src_19.2.tar.gz</span><br><span class="line">[root@10 app]# cd otp_src_19.2/</span><br><span class="line">[root@10 otp_src_19.2]# ./configure --prefix=/mnt/app/erlang</span><br><span class="line">[root@10 otp_src_19.2]# make -j 8</span><br><span class="line">[root@10 otp_src_19.2]# make -j 8 install</span><br><span class="line"></span><br><span class="line">上面的&quot;make -j 8&quot; 表示使用8核CPU进行编译</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/18/make提高源码编译速度/" data-id="cjazexzgr005zqcoqw5fhfxhj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-keepalived-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/18/keepalived-install/" class="article-date">
  <time datetime="2017-04-18T02:19:12.000Z" itemprop="datePublished">2017-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/HA/">HA</a>►<a class="article-category-link" href="/categories/HA/keepalived/">keepalived</a>►<a class="article-category-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/18/keepalived-install/">keepalived install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="keepalived-install"><a href="#keepalived-install" class="headerlink" title="keepalived install"></a>keepalived install</h3><p><a href="http://www.keepalived.org/" target="_blank" rel="noopener">Download</a></p>
<ol>
<li><p>keepalived 介绍</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Keepalived是一个基于VRRP协议来实现的LVS服务高可用方案,可以利用其来避免单点故障.</span><br><span class="line">一个LVS服务会有2台服务器运行Keepalived,一台为主服务器（MASTER）,一台为备份服务器（BACKUP）,但是对外表现为一个虚拟IP,主服务器会发送特定的消息给备份服务器,当备份服务器收不到这个消息的时候,即主服务器宕机的时候,备份服务器就会接管虚拟IP,继续提供服务,从而保证了高可用性</span><br></pre></td></tr></table></figure>
</li>
<li><p>VRRP协议简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在现实的网络环境中,两台需要通信的主机大多数情况下并没有直接的物理连接.对于这样的情况,它们之间路由怎样选择？主机如何选定到达目的主机的下一跳路由,这个问题通常的解决方法有二种:</span><br><span class="line">* 在主机上使用动态路由协议(RIP、OSPF等)</span><br><span class="line">* 在主机上配置静态路由</span><br><span class="line"></span><br><span class="line">很明显,在主机上配置动态路由是非常不切实际的,因为管理,维护成本以及是否支持等诸多问题.配置静态路由就变得十分流行,但路由器(或者说默认网关default gateway)却经常成为单点故障.VRRP的目的就是为了解决&quot;静态路由单点故障&quot;问题,VRRP通过一竞选(election)协议来动态的将路由任务交给LAN中虚拟路由器中的某台VRRP路由器</span><br></pre></td></tr></table></figure>
</li>
<li><p>VRRP工作机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在一个VRRP虚拟路由器中,有多台物理的VRRP路由器,但是这多台的物理的机器并不能同时工作,而是由一台称为MASTER的负责路由工作,其它的都是BACKUP,MASTER并非一成不变,VRRP让每个VRRP路由器参与竞选,最终获胜的就是MASTER.MASTER拥有一些特权,比如:拥有虚拟路由器的IP地址,我们的主机就是用这个IP地址作为静态路由的.拥有特权的MASTER要负责转发发送给网关地址的包和响应ARP请求</span><br><span class="line"></span><br><span class="line">VRRP通过竞选协议来实现虚拟路由器的功能,所有的协议报文都是通过IP多播(multicast)包(多播地址224.0.0.18)形式发送的.虚拟路由器由VRID(范围0-255)和一组IP地址组成,对外表现为一个周知的MAC地址.所以,在一个虚拟路由器中,不管谁是MASTER,对外都是相同的MAC和IP(称之为VIP).客户端主机并不需要因为MASTER的改变而修改自己的路由配置,对客户端来说,这种主从的切换是透明的.</span><br><span class="line"></span><br><span class="line">在一个虚拟路由器中,只有作为MASTER的VRRP路由器会一直发送VRRP通告信息(VRRPAdvertisement message),BACKUP不会抢占MASTER,除非它的优先级(priority)更高.当MASTER不可用时(BACKUP收不到通告信息),多台BACKUP中优先级最高的这台会被抢占为MASTER.这种抢占是非常快速的(&lt;1s),以保证服务的连续性.由于安全性考虑,VRRP包使用了加密协议进行加密.</span><br></pre></td></tr></table></figure>
</li>
<li><p>VRRP工作流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.初始化：    </span><br><span class="line">  路由器启动时,如果路由器的优先级是255(最高优先级,路由器拥有路由器地址),要发送VRRP通告信息,并发送广播ARP信息通告路由器IP地址对应的MAC地址为路由虚拟MAC,设置通告信息定时器准备定时发送VRRP通告信息,转为MASTER状态;否则进入BACKUP状态,设置定时器检查定时检查是否收到MASTER的通告信息</span><br><span class="line">2.Master</span><br><span class="line">  * 设置定时通告定时器</span><br><span class="line">  * 用VRRP虚拟MAC地址响应路由器IP地址的ARP请求</span><br><span class="line">  * 转发目的MAC是VRRP虚拟MAC的数据包</span><br><span class="line">  * 如果是虚拟路由器IP的拥有者,将接受目的地址是虚拟路由器IP的数据包,否则丢弃</span><br><span class="line">  * 当收到shutdown的事件时删除定时通告定时器,发送优先权级为0的通告包,转初始化状态</span><br><span class="line">  * 如果定时通告定时器超时时,发送VRRP通告信息</span><br><span class="line">  * 收到VRRP通告信息时,如果优先权为0,发送VRRP通告信息,否则判断数据的优先级是否高于本机,或相等而且实际IP地址大于本地实际IP,设置定时通告定时器,复位主机超时定时器,转BACKUP状态;否则的话,丢弃该通告包</span><br><span class="line">3.Backup</span><br><span class="line">  * 设置主机超时定时器</span><br><span class="line">  * 不能响应针对虚拟路由器IP的ARP请求信息</span><br><span class="line">  * 丢弃所有目的MAC地址是虚拟路由器MAC地址的数据包</span><br><span class="line">  * 不接受目的是虚拟路由器IP的所有数据包</span><br><span class="line">  * 当收到shutdown的事件时删除主机超时定时器,转初始化状态</span><br><span class="line">  * 主机超时定时器超时的时候,发送VRRP通告信息,广播ARP地址信息,转MASTER状态</span><br><span class="line">  * 收到VRRP通告信息时,如果优先权为0,表示进入MASTER选举;否则判断数据的优先级是否高于本机,如果高的话承认MASTER有效,复位主机超时定时器;否则的话,丢弃该通告包</span><br></pre></td></tr></table></figure>
</li>
<li><p>ARP查询处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当内部主机通过ARP查询虚拟路由器IP地址对应的MAC地址时,MASTER路由器回复的MAC地址为虚拟的VRRP的MAC地址,而不是实际网卡的MAC地址,这样在路由器切换时让内网机器觉察不到;而在路由器重新启动时,不能主动发送本机网卡的实际MAC地址.如果虚拟路由器开启的ARP代理(proxy_arp)功能,代理的ARP回应也回应VRRP虚拟MAC地址</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="keepalived-安装"><a href="#keepalived-安装" class="headerlink" title="keepalived 安装"></a>keepalived 安装</h3><ol>
<li><p>keepalived master/slave install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install keepalived ipvsadm</span><br></pre></td></tr></table></figure>
</li>
<li><p>keepalived master conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># cat /etc/keepalived/keepalived.conf  </span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;  </span><br><span class="line">   notification_email &#123;   </span><br><span class="line">      smallasa@sina.com          <span class="comment">#配置管理员邮箱   </span></span><br><span class="line">   &#125;   </span><br><span class="line">   notification_email_from root  <span class="comment">#配置发件人   </span></span><br><span class="line">   smtp_server 127.0.0.1         <span class="comment">#配置邮件服务器   </span></span><br><span class="line">   smtp_connect_timeout 30   </span><br><span class="line">   router_id LVS_DEVEL   </span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;  </span><br><span class="line">    state MASTER           <span class="comment">#配置模式   </span></span><br><span class="line">    interface eth0   </span><br><span class="line">    virtual_router_id 51   </span><br><span class="line">    priority 101           <span class="comment">#配置优先级   </span></span><br><span class="line">    advert_int 1   </span><br><span class="line">    authentication &#123;   </span><br><span class="line">        auth_type PASS   </span><br><span class="line">        auth_pass 1111   </span><br><span class="line">    &#125;   </span><br><span class="line">    virtual_ipaddress &#123;   </span><br><span class="line">        192.168.18.200     <span class="comment">#配置虚拟IP地址   </span></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.18.200 80 &#123;  </span><br><span class="line">    delay_loop 6   </span><br><span class="line">    lb_algo rr   </span><br><span class="line">    lb_kind DR   </span><br><span class="line">    nat_mask 255.255.255.0   </span><br><span class="line">    <span class="comment">#persistence_timeout 50   </span></span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 192.168.18.201 80 &#123;   <span class="comment">#配置realaserver  </span></span><br><span class="line">        weight 1   </span><br><span class="line">        HTTP_GET &#123;   <span class="comment">#监控配置   </span></span><br><span class="line">            url &#123;   </span><br><span class="line">              path /   </span><br><span class="line">              status_code 200   </span><br><span class="line">            &#125;   </span><br><span class="line">            connect_timeout 2   </span><br><span class="line">            nb_get_retry 3   </span><br><span class="line">            delay_before_retry 1   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">    real_server 192.168.18.202 80 &#123;   </span><br><span class="line">        weight 1   </span><br><span class="line">        HTTP_GET &#123;   </span><br><span class="line">            url &#123;   </span><br><span class="line">              path /   </span><br><span class="line">              status_code 200   </span><br><span class="line">            &#125;   </span><br><span class="line">            connect_timeout 2   </span><br><span class="line">            nb_get_retry 3   </span><br><span class="line">            delay_before_retry 1   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">sorry_server 127.0.0.1 80   <span class="comment">#增加一行sorry_server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>keepalived slave conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@slave keepalived]<span class="comment"># cat keepalived.conf  </span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;  </span><br><span class="line">   notification_email &#123;   </span><br><span class="line">     smallasa@sina.com   </span><br><span class="line">   &#125;   </span><br><span class="line">   notification_email_from root   </span><br><span class="line">   smtp_server 127.0.0.1   </span><br><span class="line">   smtp_connect_timeout 30   </span><br><span class="line">   router_id LVS_DEVEL   </span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;  </span><br><span class="line">    state BACKUP           <span class="comment">#修改为BACKUP   </span></span><br><span class="line">    interface eth0   </span><br><span class="line">    virtual_router_id 51   </span><br><span class="line">    priority 100           <span class="comment">#修改优先级   </span></span><br><span class="line">    advert_int 1   </span><br><span class="line">    authentication &#123;   </span><br><span class="line">        auth_type PASS   </span><br><span class="line">        auth_pass 1111   </span><br><span class="line">    &#125;   </span><br><span class="line">    virtual_ipaddress &#123;   </span><br><span class="line">        192.168.18.200   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.18.200 80 &#123;  </span><br><span class="line">    delay_loop 6   </span><br><span class="line">    lb_algo rr   </span><br><span class="line">    lb_kind DR   </span><br><span class="line">    nat_mask 255.255.255.0   </span><br><span class="line">    <span class="comment">#persistence_timeout 50   </span></span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 192.168.18.201 80 &#123;  </span><br><span class="line">        weight 1   </span><br><span class="line">        HTTP_GET &#123;   </span><br><span class="line">            url &#123;   </span><br><span class="line">              path /   </span><br><span class="line">              status_code 200   </span><br><span class="line">            &#125;   </span><br><span class="line">            connect_timeout 2   </span><br><span class="line">            nb_get_retry 3   </span><br><span class="line">            delay_before_retry 1   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">    real_server 192.168.18.202 80 &#123;   </span><br><span class="line">        weight 1   </span><br><span class="line">        HTTP_GET &#123;   </span><br><span class="line">            url &#123;   </span><br><span class="line">              path /   </span><br><span class="line">              status_code 200   </span><br><span class="line">            &#125;   </span><br><span class="line">            connect_timeout 2   </span><br><span class="line">            nb_get_retry 3   </span><br><span class="line">            delay_before_retry 1   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">sorry_server 127.0.0.1 80   <span class="comment">#增加一行sorry_server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>keepalived master/slave start</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># systemctl start keepalived</span></span><br><span class="line">[root@master ~]<span class="comment"># systemctl enable keepalived</span></span><br><span class="line"></span><br><span class="line">[root@slave ~]<span class="comment"># systemctl start keepalived</span></span><br><span class="line">[root@slave ~]<span class="comment"># systemctl enable keepalived</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看LVS状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ipvsadm -L -n  </span></span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)   </span><br><span class="line">Prot LocalAddress:Port Scheduler Flags   </span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn   </span><br><span class="line">TCP  192.168.18.200:80 rr   </span><br><span class="line">  -&gt; 192.168.18.202:80            Route   1      0          0</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过stop keepalived 服务进行验证</p>
</li>
</ol>
<hr>
<h3 id="keepalived-在不关闭keepalived情况下实现维护"><a href="#keepalived-在不关闭keepalived情况下实现维护" class="headerlink" title="keepalived 在不关闭keepalived情况下实现维护"></a>keepalived 在不关闭keepalived情况下实现维护</h3><ol>
<li><p>keepalived master conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># cat /etc/keepalived/keepalived.conf  </span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;  </span><br><span class="line">     smallasa@sina.com</span><br><span class="line">   &#125;  </span><br><span class="line">   notification_email_from root  </span><br><span class="line">   smtp_server 127.0.0.1  </span><br><span class="line">   smtp_connect_timeout 30  </span><br><span class="line">   router_id LVS_DEVEL  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_schedown &#123;   <span class="comment">#定义vrrp执行脚本  </span></span><br><span class="line">   script <span class="string">"[ -e /etc/keepalived/down ] &amp;&amp; exit 1 || exit 0"</span>  <span class="comment">#查看是否有down文件,有就进入维护模式  </span></span><br><span class="line">   interval 1  <span class="comment">#监控间隔时间  </span></span><br><span class="line">   weight -5   <span class="comment">#降低优先级  </span></span><br><span class="line">   fall 2      <span class="comment">#失败次数  </span></span><br><span class="line">   rise 1      <span class="comment">#成功数次  </span></span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER  </span><br><span class="line">    interface eth0  </span><br><span class="line">    virtual_router_id 51  </span><br><span class="line">    priority 101  </span><br><span class="line">    advert_int 1  </span><br><span class="line">    authentication &#123;  </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass 1111  </span><br><span class="line">    &#125;  </span><br><span class="line">    virtual_ipaddress &#123;  </span><br><span class="line">        192.168.18.200  </span><br><span class="line">    &#125;  </span><br><span class="line">    track_script &#123;   <span class="comment">#执行脚本  </span></span><br><span class="line">        chk_schedown  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.18.200 80 &#123;</span><br><span class="line">    delay_loop 6  </span><br><span class="line">    lb_algo rr  </span><br><span class="line">    lb_kind DR  </span><br><span class="line">    nat_mask 255.255.255.0  </span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 192.168.18.201 80 &#123;</span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    real_server 192.168.18.202 80 &#123;  </span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">   sorry_server 127.0.0.1 80  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>keepalived slave conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]<span class="comment"># cat /etc/keepalived/keepalived.conf  </span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;  </span><br><span class="line">     smallasa@sina.com</span><br><span class="line">   &#125;  </span><br><span class="line">   notification_email_from root  </span><br><span class="line">   smtp_server 127.0.0.1  </span><br><span class="line">   smtp_connect_timeout 30  </span><br><span class="line">   router_id LVS_DEVEL  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_schedown &#123;</span><br><span class="line">   script <span class="string">"[ -e /etc/keepalived/down ] &amp;&amp; exit 1 || exit 0"</span>  </span><br><span class="line">   interval 1  </span><br><span class="line">   weight -5  </span><br><span class="line">   fall 2  </span><br><span class="line">   rise 1  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP  </span><br><span class="line">    interface eth0  </span><br><span class="line">    virtual_router_id 51  </span><br><span class="line">    priority 100  </span><br><span class="line">    advert_int 1  </span><br><span class="line">    authentication &#123;  </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass 1111  </span><br><span class="line">    &#125;  </span><br><span class="line">    virtual_ipaddress &#123;  </span><br><span class="line">        192.168.18.200  </span><br><span class="line">    &#125;  </span><br><span class="line">    track_script &#123;  </span><br><span class="line">        chk_schedown  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.18.200 80 &#123;</span><br><span class="line">    delay_loop 6  </span><br><span class="line">    lb_algo rr  </span><br><span class="line">    lb_kind DR  </span><br><span class="line">    nat_mask 255.255.255.0  </span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 192.168.18.201 80 &#123;</span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    real_server 192.168.18.202 80 &#123;  </span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    sorry_server 127.0.0.1 80</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>3.测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># cd /etc/keepalived</span></span><br><span class="line">[root@master keepalived ~]<span class="comment"># touch down</span></span><br><span class="line"></span><br><span class="line">[root@master keepalived ~]<span class="comment"># tail -f /var/log/messages</span></span><br><span class="line">[root@master keepalived ~]<span class="comment"># ip add show</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="keepalived-邮件报警通知"><a href="#keepalived-邮件报警通知" class="headerlink" title="keepalived 邮件报警通知"></a>keepalived 邮件报警通知</h3><ol>
<li><p>keepalived master/slave 编辑报警邮件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">[root@x ~]<span class="comment">#vim /etc/keepalived/notify.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash  </span></span><br><span class="line"><span class="comment"># Author: freeloda   </span></span><br><span class="line"><span class="comment"># description: An example of notify script  </span></span><br><span class="line"><span class="comment"># Usage: notify.sh -m|--mode &#123;mm|mb&#125; -s|--service SERVICE1,... -a|--address VIP  -n|--notify &#123;master|backup|falut&#125; -h|--help</span></span><br><span class="line">contact=<span class="string">'smallasa@sina.com'</span></span><br><span class="line">helpflag=0  </span><br><span class="line">serviceflag=0  </span><br><span class="line">modeflag=0  </span><br><span class="line">addressflag=0  </span><br><span class="line">notifyflag=0</span><br><span class="line"><span class="function"><span class="title">Usage</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: notify.sh [-m|--mode &#123;mm|mb&#125;] [-s|--service SERVICE1,...] &lt;-a|--address VIP&gt;  &lt;-n|--notify &#123;master|backup|falut&#125;&gt;"</span>   </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: notify.sh -h|--help"</span>  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">ParseOptions</span></span>() &#123;</span><br><span class="line">  <span class="built_in">local</span> I=1;  </span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$#</span> -gt 0 ]; <span class="keyword">then</span>  </span><br><span class="line">    <span class="keyword">while</span> [ <span class="variable">$I</span> -le <span class="variable">$#</span> ]; <span class="keyword">do</span>  </span><br><span class="line">      <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span>  </span><br><span class="line">      -s|--service)  </span><br><span class="line">        [ <span class="variable">$#</span> -lt 2 ] &amp;&amp; <span class="built_in">return</span> 3  </span><br><span class="line">         serviceflag=1  </span><br><span class="line">         services=(`<span class="built_in">echo</span> <span class="variable">$2</span>|awk -F<span class="string">","</span> <span class="string">'&#123;for(i=1;i&lt;=NF;i++) print $i&#125;'</span>`)  </span><br><span class="line">        <span class="built_in">shift</span> 2 ;;  </span><br><span class="line">      -h|--<span class="built_in">help</span>)  </span><br><span class="line">         helpflag=1  </span><br><span class="line">        <span class="built_in">return</span> 0  </span><br><span class="line">        <span class="built_in">shift</span>  </span><br><span class="line">        ;;  </span><br><span class="line">      -a|--address)  </span><br><span class="line">        [ <span class="variable">$#</span> -lt 2 ] &amp;&amp; <span class="built_in">return</span> 3  </span><br><span class="line">        addressflag=1  </span><br><span class="line">        vip=<span class="variable">$2</span>  </span><br><span class="line">        <span class="built_in">shift</span> 2  </span><br><span class="line">        ;;  </span><br><span class="line">      -m|--mode)  </span><br><span class="line">        [ <span class="variable">$#</span> -lt 2 ] &amp;&amp; <span class="built_in">return</span> 3  </span><br><span class="line">        mode=<span class="variable">$2</span>  </span><br><span class="line">        <span class="built_in">shift</span> 2  </span><br><span class="line">        ;;  </span><br><span class="line">      -n|--notify)  </span><br><span class="line">        [ <span class="variable">$#</span> -lt 2 ] &amp;&amp; <span class="built_in">return</span> 3  </span><br><span class="line">        notifyflag=1  </span><br><span class="line">        notify=<span class="variable">$2</span>  </span><br><span class="line">        <span class="built_in">shift</span> 2  </span><br><span class="line">        ;;  </span><br><span class="line">      *)  </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Wrong options..."</span>  </span><br><span class="line">        Usage  </span><br><span class="line">        <span class="built_in">return</span> 7  </span><br><span class="line">        ;;  </span><br><span class="line">       <span class="keyword">esac</span>  </span><br><span class="line">    <span class="keyword">done</span>  </span><br><span class="line">    <span class="built_in">return</span> 0  </span><br><span class="line">  <span class="keyword">fi</span>  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#workspace=$(dirname $0)</span></span><br><span class="line"><span class="function"><span class="title">RestartService</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;#@&#125;</span> -gt 0 ]; <span class="keyword">then</span>  </span><br><span class="line">    <span class="keyword">for</span> I <span class="keyword">in</span> <span class="variable">$@</span>; <span class="keyword">do</span>  </span><br><span class="line">      <span class="keyword">if</span> [ -x /etc/rc.d/init.d/<span class="variable">$I</span> ]; <span class="keyword">then</span>  </span><br><span class="line">        /etc/rc.d/init.d/<span class="variable">$I</span> restart  </span><br><span class="line">      <span class="keyword">else</span>  </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$I</span> is not a valid service..."</span>  </span><br><span class="line">      <span class="keyword">fi</span>  </span><br><span class="line">    <span class="keyword">done</span>  </span><br><span class="line">  <span class="keyword">fi</span>  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">StopService</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;#@&#125;</span> -gt 0 ]; <span class="keyword">then</span>  </span><br><span class="line">    <span class="keyword">for</span> I <span class="keyword">in</span> <span class="variable">$@</span>; <span class="keyword">do</span>  </span><br><span class="line">      <span class="keyword">if</span> [ -x /etc/rc.d/init.d/<span class="variable">$I</span> ]; <span class="keyword">then</span>  </span><br><span class="line">        /etc/rc.d/init.d/<span class="variable">$I</span> stop  </span><br><span class="line">      <span class="keyword">else</span>  </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$I</span> is not a valid service..."</span>  </span><br><span class="line">      <span class="keyword">fi</span>  </span><br><span class="line">    <span class="keyword">done</span>  </span><br><span class="line">  <span class="keyword">fi</span>  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">Notify</span></span>() &#123;  </span><br><span class="line">    mailsubject=<span class="string">"`hostname` to be <span class="variable">$1</span>: <span class="variable">$vip</span> floating"</span>  </span><br><span class="line">    mailbody=<span class="string">"`date '+%F %H:%M:%S'`, vrrp transition, `hostname` changed to be <span class="variable">$1</span>."</span>  </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$mailbody</span> | mail -s <span class="string">"<span class="variable">$mailsubject</span>"</span> <span class="variable">$contact</span>  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Main Function  </span></span><br><span class="line">ParseOptions <span class="variable">$@</span>  </span><br><span class="line">[ $? -ne 0 ] &amp;&amp; Usage &amp;&amp; <span class="built_in">exit</span> 5</span><br><span class="line">[ <span class="variable">$helpflag</span> -eq 1 ] &amp;&amp; Usage &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$addressflag</span> -ne 1 -o <span class="variable">$notifyflag</span> -ne 1 ]; <span class="keyword">then</span></span><br><span class="line">  Usage  </span><br><span class="line">  <span class="built_in">exit</span> 2  </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">mode=<span class="variable">$&#123;mode:-mb&#125;</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$notify</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">'master'</span>)  </span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$serviceflag</span> -eq 1 ]; <span class="keyword">then</span>  </span><br><span class="line">      RestartService <span class="variable">$&#123;services[*]&#125;</span>  </span><br><span class="line">  <span class="keyword">fi</span>  </span><br><span class="line">  Notify master  </span><br><span class="line">  ;;  </span><br><span class="line"><span class="string">'backup'</span>)  </span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$serviceflag</span> -eq 1 ]; <span class="keyword">then</span>  </span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$mode</span>"</span> == <span class="string">'mb'</span> ]; <span class="keyword">then</span>  </span><br><span class="line">      StopService <span class="variable">$&#123;services[*]&#125;</span>  </span><br><span class="line">    <span class="keyword">else</span>  </span><br><span class="line">      RestartService <span class="variable">$&#123;services[*]&#125;</span>  </span><br><span class="line">    <span class="keyword">fi</span>  </span><br><span class="line">  <span class="keyword">fi</span>  </span><br><span class="line">  Notify backup  </span><br><span class="line">  ;;  </span><br><span class="line"><span class="string">'fault'</span>)  </span><br><span class="line">  Notify fault  </span><br><span class="line">  ;;  </span><br><span class="line">*)  </span><br><span class="line">  Usage  </span><br><span class="line">  <span class="built_in">exit</span> 4  </span><br><span class="line">  ;;  </span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">[root@x ~]<span class="comment">#chmod +x  /etc/keepalived/notify.sh</span></span><br><span class="line">[root@x ~]<span class="comment">#/etc/keepalived/notify.sh -m mb -a 1.1.1.1 -n master</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">help</span>:</span><br><span class="line">-s, --service SERVICE,...：指定服务脚本名称,当状态切换时可自动启动,重启或关闭此服务</span><br><span class="line">-a, --address VIP: 指定相关虚拟路由器的VIP地址</span><br><span class="line">-m, --mode &#123;mm|mb&#125;：指定虚拟路由的模型,mm表示主主,mb表示主备;它们表示相对于同一种服务而方,其VIP的工作类型</span><br><span class="line">-n, --notify &#123;master|backup|fault&#125;：指定通知的类型,即vrrp角色切换的目标角色</span><br><span class="line">-h, --<span class="built_in">help</span>：获取脚本的使用帮助；</span><br></pre></td></tr></table></figure>
</li>
<li><p>keepalived master conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[root@master keepalived]<span class="comment"># cat keepalived.conf  </span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;  </span><br><span class="line">     smallasa@sina.com</span><br><span class="line">   &#125;  </span><br><span class="line">   notification_email_from root  </span><br><span class="line">   smtp_server 127.0.0.1  </span><br><span class="line">   smtp_connect_timeout 30  </span><br><span class="line">   router_id LVS_DEVEL  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_schedown &#123;</span><br><span class="line">   script <span class="string">"[ -e /etc/keepalived/down ] &amp;&amp; exit 1 || exit 0"</span>  </span><br><span class="line">   interval 1  </span><br><span class="line">   weight -5  </span><br><span class="line">   fall 2  </span><br><span class="line">   rise 1  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER  </span><br><span class="line">    interface eth0  </span><br><span class="line">    virtual_router_id 51  </span><br><span class="line">    priority 101  </span><br><span class="line">    advert_int 1  </span><br><span class="line">    authentication &#123;  </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass 1111  </span><br><span class="line">    &#125;  </span><br><span class="line">    virtual_ipaddress &#123;  </span><br><span class="line">        192.168.18.200  </span><br><span class="line">    &#125;  </span><br><span class="line">    track_script &#123;  </span><br><span class="line">        chk_schedown  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#增加以下三行</span></span><br><span class="line">    notify_master <span class="string">"/etc/keepalived/notify.sh -n master -a 192.168.18.200"</span>  </span><br><span class="line">    notify_backup <span class="string">"/etc/keepalived/notify.sh -n backup -a 192.168.18.200"</span></span><br><span class="line">    notify_fault  <span class="string">"/etc/keepalived/notify.sh -n fault -a 192.168.18.200"</span></span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.18.200 80 &#123;</span><br><span class="line">    delay_loop 6  </span><br><span class="line">    lb_algo rr  </span><br><span class="line">    lb_kind DR  </span><br><span class="line">    nat_mask 255.255.255.0  </span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 192.168.18.201 80 &#123;</span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    real_server 192.168.18.202 80 &#123;  </span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">   sorry_server 127.0.0.1 80  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>keepalived slave conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[root@slave keepalived]<span class="comment"># cat keepalived.conf  </span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;  </span><br><span class="line">     smallasa@sina.com</span><br><span class="line">   &#125;  </span><br><span class="line">   notification_email_from root  </span><br><span class="line">   smtp_server 127.0.0.1  </span><br><span class="line">   smtp_connect_timeout 30  </span><br><span class="line">   router_id LVS_DEVEL  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_schedown &#123;</span><br><span class="line">   script <span class="string">"[ -e /etc/keepalived/down ] &amp;&amp; exit 1 || exit 0"</span>  </span><br><span class="line">   interval 1  </span><br><span class="line">   weight -5  </span><br><span class="line">   fall 2  </span><br><span class="line">   rise 1  </span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP  </span><br><span class="line">    interface eth0  </span><br><span class="line">    virtual_router_id 51  </span><br><span class="line">    priority 100  </span><br><span class="line">    advert_int 1  </span><br><span class="line">    authentication &#123;  </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass 1111  </span><br><span class="line">    &#125;  </span><br><span class="line">    virtual_ipaddress &#123;  </span><br><span class="line">        192.168.18.200  </span><br><span class="line">    &#125;  </span><br><span class="line">    track_script &#123;  </span><br><span class="line">    chk_schedown  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#增加以下三行</span></span><br><span class="line">    notify_master <span class="string">"/etc/keepalived/notify.sh -n master -a 192.168.18.200"</span></span><br><span class="line">    notify_backup <span class="string">"/etc/keepalived/notify.sh -n backup -a 192.168.18.200"</span>  </span><br><span class="line">    notify_fault  <span class="string">"/etc/keepalived/notify.sh -n fault -a 192.168.18.200"</span>  </span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.18.200 80 &#123;</span><br><span class="line">    delay_loop 6  </span><br><span class="line">    lb_algo rr  </span><br><span class="line">    lb_kind DR  </span><br><span class="line">    nat_mask 255.255.255.0  </span><br><span class="line">    protocol TCP</span><br><span class="line">    real_server 192.168.18.201 80 &#123;</span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    real_server 192.168.18.202 80 &#123;  </span><br><span class="line">        weight 1  </span><br><span class="line">        HTTP_GET &#123;  </span><br><span class="line">            url &#123;  </span><br><span class="line">              path /  </span><br><span class="line">              status_code 200  </span><br><span class="line">            &#125;  </span><br><span class="line">            connect_timeout 2  </span><br><span class="line">            nb_get_retry 3  </span><br><span class="line">            delay_before_retry 1  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    sorry_server 127.0.0.1 80  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/18/keepalived-install/" data-id="cjazexzfh0054qcoqantbyz2n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-innodb-buffer-pool-flush" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/14/mysql-innodb-buffer-pool-flush/" class="article-date">
  <time datetime="2017-04-14T04:31:46.000Z" itemprop="datePublished">2017-04-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>►<a class="article-category-link" href="/categories/database/Mysql/">Mysql</a>►<a class="article-category-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/14/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="InnoDB-buffer-pool简介"><a href="#InnoDB-buffer-pool简介" class="headerlink" title="InnoDB buffer pool简介"></a>InnoDB buffer pool简介</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">InnoDB使用buffer pool来缓存从磁盘读取到内存的数据页.buffer pool通常由数个内存块加上一组控制结构体对象组成.内存块的个数取决于buffer pool instance的个数,不过在5.7版本中开始默认以128M(可配置)的chunk单位分配内存块,这样做的目的是为了支持buffer pool的在线动态调整大小.</span><br><span class="line"></span><br><span class="line">Buffer pool的每个内存块通过mmap的方式分配内存,因此你会发现,在实例启动时虚存很高,而物理内存很低.这些大片的内存块又按照16KB划分为多个frame,用于存储数据页.</span><br><span class="line"></span><br><span class="line">虽然大多数情况下buffer pool是以16KB来存储数据页,但有一种例外: 使用压缩表时,需要在内存中同时存储压缩页和解压页,对于压缩页,使用Binary buddy allocator算法来分配内存空间.例如我们读入一个8KB的压缩页,就从buffer pool中取一个16KB的block,取其中8KB,剩下的8KB放到空闲链表上,如果紧跟着另外一个4KB的压缩页读入内存,就可以从这8KB中分裂4KB,同时将剩下的4KB放到空闲链表上.</span><br><span class="line"></span><br><span class="line">为了管理buffer pool,每个buffer pool instance使用如下几个链表来管理:</span><br><span class="line">* LRU链表包含所有读入内存的数据页</span><br><span class="line">* Flush_list包含被修改过的脏页</span><br><span class="line">* unzip_LRU包含所有解压页</span><br><span class="line">* Free list上存放当前空闲的block</span><br><span class="line"></span><br><span class="line">另外为了避免查询数据页时扫描LRU,还为每个buffer pool instance维护了一个page hash,通过space id和page no可以直接找到对应的page</span><br><span class="line"></span><br><span class="line">一般情况下,当我们需要读入一个Page时,首先根据space id 和page no找到对应的buffer pool instance.然后查询page hash,如果page hash中没有,则表示需要从磁盘读取.在读盘前首先我们需要为即将读入内存的数据页分配一个空闲的block.当free list上存在空闲的block时,可以直接从free list上摘取,如果没有,就需要从unzip_lru 或者 lru上驱逐page.</span><br><span class="line"></span><br><span class="line">这里需要遵循一定的原则（参考函数buf_LRU_scan_and_free_block , 5.7.5）：</span><br><span class="line">首先尝试从unzip_lru上驱逐解压页,如果没有,再尝试从Lru链表上驱逐Page;如果还是无法从Lru上获取到空闲block,用户线程就会参与刷脏,尝试做一次SINGLE PAGE FLUSH,单独从Lru上刷掉一个脏页,然后再重试.Buffer pool中的page被修改后,不是立刻写入磁盘,而是由后台线程定时写入,和大多数数据库系统一样,脏页的写盘遵循日志先行WAL原则,因此在每个block上都记录了一个最近被修改时的Lsn,写数据页时需要确保当前写入日志文件的redo不低于这个Lsn.</span><br><span class="line"></span><br><span class="line">然而基于WAL原则的刷脏策略可能带来一个问题: 当数据库的写入负载过高时,产生redo log的速度极快,redo log可能很快到达同步checkpoint点.这时候需要进行刷脏来推进Lsn.由于这种行为是由用户线程在检查到redo log空间不够时触发,大量用户线程将可能陷入到这段低效的逻辑中,产生一个明显的性能拐点.</span><br></pre></td></tr></table></figure>
<h3 id="Page-Cleaner线程"><a href="#Page-Cleaner线程" class="headerlink" title="Page Cleaner线程"></a>Page Cleaner线程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在MySQL5.6中,开启了一个独立的page cleaner线程来进行刷lru list 和flush list.默认每隔一秒运行一次,5.6版本里提供了一大堆的参数来控制page cleaner的flush行为,包括：</span><br><span class="line">* innodb_adaptive_flushing_lwm</span><br><span class="line">* innodb_max_dirty_pages_pct_lwm</span><br><span class="line">* innodb_flushing_avg_loops</span><br><span class="line">* innodb_io_capacity_max</span><br><span class="line">* innodb_lru_scan_depth</span><br><span class="line"></span><br><span class="line">如果你发现redo log推进的非常快,为了避免用户线程陷入刷脏,可以通过调大innodb_io_capacity_max来解决,该参数限制了每秒刷新的脏页上限,调大该值可以增加Page cleaner线程每秒的工作量.</span><br><span class="line">如果你发现你的系统中free list不足,总是需要驱逐脏页来获取空闲的block时,可以适当调大innodb_lru_scan_depth.该参数表示从每个buffer pool instance的lru上扫描的深度,调大该值有助于多释放些空闲页,避免用户线程去做single page flush</span><br><span class="line"></span><br><span class="line">为了提升扩展性和刷脏效率,在5.7.4版本里引入了多个page cleaner线程,从而达到并行刷脏的效果.目前Page cleaner并未和buffer pool绑定,其模型为一个协调线程 + 多个工作线程,协调线程本身也是工作线程.因此如果innodb_page_cleaners设置为4,那么就是一个协调线程,加3个工作线程,工作方式为生产者-消费者.工作队列长度为buffer pool instance的个数,使用一个全局slot数组表示.</span><br><span class="line"></span><br><span class="line">协调线程在决定了需要flush的page数和lsn_limit后,会设置slot数组,将其中每个slot的状态设置为PAGE_CLEANER_STATE_REQUESTED,并设置目标page数及lsn_limit,然后唤醒工作线程(pc_request).工作线程被唤醒后,从slot数组中取一个未被占用的slot,修改其状态,表示已被调度,然后对该slot所对应的buffer pool instance进行操作.直到所有的slot都被消费完后,才进入下一轮.通过这种方式,多个page cleaner线程实现了并发flush buffer pool,从而提升flush dirty page/lru的效率.</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MySQL5.7的InnoDB flush策略优化</span><br><span class="line">在之前版本中,因为可能同时有多个线程操作buffer pool刷page(在刷脏时会释放buffer pool mutex),每次刷完一个page后需要回溯到链表尾部,使得扫描bp链表的时间复杂度最差为O（N*N）</span><br><span class="line"></span><br><span class="line">在5.6版本中针对Flush list的扫描做了一定的修复,使用一个指针来记录当前正在flush的page,待flush操作完成后,再看一下这个指针有没有被别的线程修改掉,如果被修改了,就回溯到链表尾部,否则无需回溯.但这个修复并不完整,在最差的情况下,时间复杂度依旧不理想</span><br><span class="line"></span><br><span class="line">在5.7版本中对这个问题进行了彻底的修复,使用多个名为hazard pointer的指针,在需要扫描LIST时,存储下一个即将扫描的目标page,根据不同的目的分为几类:</span><br><span class="line">* flush_hp: 用作批量刷FLUSH LIST</span><br><span class="line">* lru_hp: 用作批量刷LRU LIST</span><br><span class="line">* lru_scan_itr: 用于从LRU链表上驱逐一个可替换的page，总是从上一次扫描结束的位置开始，而不是LRU尾部</span><br><span class="line">* single_scan_itr: 当buffer pool中没有空闲block时,用户线程会从FLUSH LIST上单独驱逐一个可替换的page 或者 flush一个脏页,总是从上一次扫描结束的位置开始,而不是LRU尾部</span><br><span class="line"></span><br><span class="line">后两类的hp都是由用户线程在尝试获取空闲block时调用,只有在推进到某个buf_page_t::old被设置成true的page(大约从Lru链表尾部起至总长度的八分之三位置的page)时,再将指针重置到Lru尾部</span><br><span class="line"></span><br><span class="line">这些指针在初始化buffer pool时分配,每个buffer pool instance都拥有自己的hp指针.当某个线程对buffer pool中的page进行操作时,例如需要从LRU中移除Page时,如果当前的page被设置为hp,就要将hp更新为当前Page的前一个page.当完成当前page的flush操作后,直接使用hp中存储的page指针进行下一轮flush.</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">社区优化：</span><br><span class="line">一如既往的,Percona Server在5.6版本中针对buffer pool flush做了不少的优化,主要的修改包括如下几点：</span><br><span class="line">* 优化刷LRU流程buf_flush_LRU_tail</span><br><span class="line">* 该函数由page cleaner线程调用</span><br><span class="line">  原生的逻辑:依次flush每个buffer pool instance,每次扫描的深度通过参数innodb_lru_scan_depth来配置.而在每个instance内,又分成多个chunk来调用</span><br><span class="line">  修改后的逻辑为:每次flush一个buffer pool的LRU时,只刷一个chunk,然后再下一个instance,刷完所有instnace后,再回到前面再刷一个chunk.简而言之,把集中的flush操作进行了分散,其目的是分散压力,避免对某个instance的集中操作,给予其他线程更多访问buffer pool的机会.</span><br><span class="line">* 允许设定刷LRU/FLUSH LIST的超时时间,防止flush操作时间过长导致别的线程(例如尝试做single page flush的用户线程)stall住;当到达超时时间时,page cleaner线程退出flush.</span><br><span class="line">* 避免用户线程参与刷buffer pool</span><br><span class="line">  当用户线程参与刷buffer pool时,由于线程数的不可控,将产生严重的竞争开销,例如free list不足时做single page flush,以及在redo空间不足时,做dirty page flush,都会严重影响性能.Percona Server允许选择让page cleaner线程来做这些工作,用户线程只需要等待即可.出于效率考虑,用户还可以设置page cleaner线程的cpu调度优先级.另外在Page cleaner线程经过优化后,可以知道系统当前处于同步刷新状态,可以去做更激烈的刷脏(furious flush),用户线程参与到其中,可能只会起到反作用.</span><br><span class="line">* 允许设置page cleaner线程，purge线程，io线程，master线程的CPU调度优先级，并优先获得InnoDB的mutex</span><br><span class="line">  使用新的独立后台线程来刷buffer pool的LRU链表,将这部分工作负担从page cleaner线程剥离</span><br><span class="line">  实际上就是直接转移刷LRU的代码到独立线程了.从之前Percona的版本来看,都是在不断的强化后台线程,让用户线程少参与到刷脏/checkpoint这类耗时操作中</span><br></pre></td></tr></table></figure>
<h3 id="为什么InnoDB关闭会慢？"><a href="#为什么InnoDB关闭会慢？" class="headerlink" title="为什么InnoDB关闭会慢？"></a>为什么InnoDB关闭会慢？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">InnoDB较之MyISAM,一个重要特性是InnoDB会在内存中开辟一个Buffer Pool来存储最近访问的数据块/索引块,使得下次再次访问这个块时速度能够很快.当InnoDB对需要修改数据块的时候,会先记录修改日志,然后直接对Buffer_Pool中的数据块的操作.记录日志是顺序写,对数据块的操作是内存操作,这让InnoDB在很多场景下有这很好的速度优势.</span><br><span class="line"></span><br><span class="line">上面对内存块修改完成后,InnoDB就向客户端返回了.可这时实际磁盘上的数据块,还并没有被更新,我们把这样的page称为Dirty Page.在InnoDB的后台有一个专门的线程来做将内存数据块Flush到磁盘的工作.这个Flush操作就是主要影响InnoDB关闭时间的因素.在关闭MySQL/InnoDB时,所有的Dirty_Page都需要Flush,所以Dirty_Page越多,要Flush的数据块也就越多,意味着InnoDB关闭时间越长</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们可以通过下面的命令来观察Dirty Page的数量:</span><br><span class="line">mysqladmin -uroot ext -i 1 |grep &quot;Innodb_buffer_pool_pages_dirty&quot;</span><br><span class="line"></span><br><span class="line">参数innodb_max_dirty_pages_pct:</span><br><span class="line">Buffer_Pool中Dirty_Page所占的数量,直接影响InnoDB的关闭时间.参数innodb_max_dirty_pages_pct可以直接控制了Dirty_Page在Buffer_Pool中所占的比率,而且幸运的是innodb_max_dirty_pages_pct是可以动态改变的.所以,在关闭InnoDB之前先将innodb_max_dirty_pages_pct调小,强制数据块Flush一段时间,则能够大大缩短MySQL关闭的时间</span><br><span class="line"></span><br><span class="line">set global innodb_max_dirty_pages_pct=0;</span><br><span class="line">一般执行了上面的命令之后,Dirty_Page的Flush仍需要一段时间,所以要稍等一会儿,再关闭MySQL才有效果</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/04/14/mysql-innodb-buffer-pool-flush/" data-id="cjazexzh7006kqcoqchl8uyus" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/13/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/15/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/">AliCloud</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/">SDK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/Python-SDK/">Python SDK</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/">Android install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/Android-studio-install/">Android studio install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/">Doc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP-严格传输安全HSTS/">HTTP 严格传输安全HSTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP协议/">HTTP协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP-协议详解/">TCP 协议详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP与socket区别/">TCP与socket区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件描述符与打开文件之间的关系/">linux 文件描述符与打开文件之间的关系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件系统inode/">linux 文件系统inode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/一次完整的HTTP请求/">一次完整的HTTP请求</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/">Disk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-io-performance/">disk io performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-iostat/">disk iostat</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/">Distributed storage</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/">GlusterFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-architecture/">GlusterFS architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-info/">GlusterFS info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-install/">GlusterFS install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-workflow/">GlusterFS workflow</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/">Domain</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/nslookup-dns-search/">nslookup dns search</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/">DRBD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/">keepalived</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/">Intellij</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/Intellij-setting/">Intellij setting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/">vim</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-shortcut-key/">vim shortcut key</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-vimrc/">vim vimrc</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/">Kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/">kernel memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/kernel-共享内存/">kernel 共享内存</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/">ganglia</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/ganglia-install/">ganglia install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/">hmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/">htmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/">smokeping</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/">zabbix</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/">monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-cpu/">zabbix monitor cpu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-mem/">zabbix monitor mem</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-auto-discover/">zabbix auto discover</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-grafana-install/">zabbix grafana install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install/">zabbix install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-item-and-tigger/">zabbix item and tigger</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-java-gateway/">zabbix java gateway</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-modify-login-user-passwd/">zabbix modify login user passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-proxy-install/">zabbix proxy install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-server-support-chinese/">zabbix server support chinese</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-windows-agent/">zabbix windows agent</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/树莓派-GSM-语音短信报警/">树莓派 GSM 语音短信报警</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/">监控</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/监控知识体系/">监控知识体系</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/">Python Framework</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django/">Python Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django-setting/">Python Django setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/">Python Learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-内存管理/">python 内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-函数编程/">python 函数编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-变量/">python 变量</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象使用/">python 对象使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象的属性/">python 对象的属性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象编程/">python 对象编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-数据类型/">python 数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-流程控制/">python 流程控制</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-爬虫/">python 爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊方法/">python 特殊方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊说明/">python 特殊说明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-装饰器/">python 装饰器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-过程编程/">python 过程编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-进阶/">python 进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-闭包/">python 闭包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/">Python install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-error-info/">python error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-source-image/">python pip source image</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-use/">python pip use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pyenv-install/">python pyenv install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-setup-py/">python setup.py</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-source-install/">python source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-virtualenv/">python virtualenv</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/">Python library</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/MySQLdb/">MySQLdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/memory-profiler/">memory_profiler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/">Python modules</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-path/">python modules path</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-pylint-and-ipython/">python modules pylint and ipython</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/">Python other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/python-import-and-reload/">python import and reload</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/">Ruby install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP.IP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-状态/">TCP 状态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-IP模型/">TCP/IP模型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/Wireshark-use/">Wireshark use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/">WeChat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/">WeChat enterprise</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/WeChat-enterprise-API/">WeChat enterprise API</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/">automation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/">git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-command/">git command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-error/">git error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitlab/">git gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitolite/">git gitolite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs/">git gogs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs-source-install/">git gogs source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-init/">git init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-workflow/">git workflow</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/">jenkins</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-info/">jenkins info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-install/">jenkins install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/">kvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/kvm-install/">kvm install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/">maven</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/maven-install/">maven install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/">nexus</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-install/">nexus install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-proxy-maven/">nexus proxy maven</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/">rpm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/">salt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-info/">salt info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install/">salt install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-HA/">salt install HA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-standard/">salt install standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-jinja2-grain-pillar-module/">salt jinja2 grain pillar module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-event-reactor/">salt manage event reactor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-grains/">salt manage grains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-job/">salt manage job</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-module/">salt manage module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-pillar/">salt manage pillar</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-return/">salt manage return</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-states/">salt manage states</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-target/">salt manage target</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-syndic-install/">salt master syndic install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-conf/">salt master.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-minion-conf/">salt minion.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-raet/">salt raet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-state-module/">salt state module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-syndic-conf/">salt syndic.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-write-module-code/">salt write module code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/">svn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-auto-update/">svn auto update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-checkout-bat/">svn checkout bat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-server-for-windows/">svn server for windows</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/">yum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/yum-server-install/">yum server install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/">Mongo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-auth/">mongo auth</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-error/">mongo error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-auth-install/">mongo replication auth install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-standard-install/">mongo replication standard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-standard-install/">mongo standard install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/">Mysql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-command/">mysql command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-error-info/">mysql error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-explain/">mysql explain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-grant/">mysql grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-index-options/">mysql index options</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave/">mysql master slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave-switch/">mysql master slave switch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-partition/">mysql partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-select-join/">mysql select join</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-slow-log/">mysql slow log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-standard/">mysql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-table-size/">mysql table size</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/">Postgresql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-book-use/">postgresql book use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave-info/">postgresql master slave info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave/">postgresql master/slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-plugin-install/">postgresql plugin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-standard/">postgresql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-tablespace-database-schema-table-user-role-relation/">postgresql tablespace database schema table user role relation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-yum-install/">postgresql yum install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-常用命令/">postgresql 常用命令</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库对象/">postgresql 数据库对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库管理/">postgresql 数据库管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/">Redis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-error/">redis error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-install/">redis install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-redis-trib-rb/">redis redis-trib.rb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-status/">redis status</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-use/">redis use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/">influxDB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang/go-env/">go env</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-high-availability/">RabbitMQ high availability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-install/">RabbitMQ install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-working-principle/">RabbitMQ working principle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/">beats</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/beats-install/">beats install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/">datax</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-info/">datax info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-install/">datax install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-job/">datax job</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-command/">elasticsearch command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-core-component/">elasticsearch core component</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-cluster/">elasticsearch exploring your cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-data/">elasticsearch exploring your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-four-search-type/">elasticsearch four search type</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-full-cluster-restart-upgrade/">elasticsearch full cluster restart upgrade</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-install/">elasticsearch install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-modifying-your-data/">elasticsearch modifying your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-rolling-upgrades/">elasticsearch rolling upgrades</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-safe-restart/">elasticsearch safe restart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-shard/">elasticsearch shard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-indexing-speed/">how to tune for indexing speed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-search-speed/">how to tune for search speed</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/">flume</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-info/">flume info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-install/">flume install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/">grafana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/grafana-install/">grafana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/hadoop-简介/">hadoop 简介</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/">kafka</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-install/">kafka install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-manage-web/">kafka manage web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-offset-monitor/">kafka offset monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-optimize/">kafka optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-web-console/">kafka web console</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/">kibana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/kibana-install/">kibana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/">logstash</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-config-file/">logstash config file</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-filter-grok/">logstash filter grok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-info/">logstash info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-install/">logstash install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/">mycat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-web-install/">mycat web install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/">nsq</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-command/">nsq command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-info/">nsq info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-install/">nsq install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/">zookeeper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-install/">zookeeper install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-monitor/">zookeeper monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-optimize/">zookeeper optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-use/">zookeeper use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-zab-protocol/">zookeeper zab protocol</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-env/">java env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-optimize/">java jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-opts/">java jvm opts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/">java learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/java-学习笔记/">java 学习笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-log4j/">java log4j</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/">java performance analysis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/jps/">jps</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-dashboard-install/">k8s dashboard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-install/">k8s install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-registry-install/">k8s registry install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/node-install/">node install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/other/ACID/">ACID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/分布式二阶段和三阶段提交协议/">分布式二阶段和三阶段提交协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/开源许可协议/">开源许可协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/网络带宽/">网络带宽</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/">system service</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/">Atlassian</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-https/">confluence https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-install/">confluence install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-reset-passwd/">confluence reset passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-update/">confluence update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-https/">jira https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-install/">jira install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-update/">jira update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/mariadb-install/">mariadb install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/Base-env/">Base env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-common-use-scripts/">linux common use scripts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-history-info-setting/">linux history info setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-login-info/">linux login info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-nginx-install/">linux nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-skill/">linux skill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-system-init/">linux system init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-内存插槽-内存信息/">linux 内存插槽 内存信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-扩容swap分区/">linux 扩容swap分区</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-物理CPU-CPU核数-逻辑CPU/">linux 物理CPU CPU核数 逻辑CPU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-磁盘系统block区别/">linux 磁盘系统block区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-设置-包含头文件路径-和-动态库链接路径/">linux 设置 包含头文件路径 和 动态库链接路径</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/">NFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/">Samba</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-conf/">samba conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-install/">samba install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/">command</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/grep/">grep</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/pigz/">pigz</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/sed/">sed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/split/">split</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/tr/">tr</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/">haproxy</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/haproxy-install/">haproxy install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-install/">nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-location/">nginx location</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-rewrite/">nginx rewrite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-status/">nginx status</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/">ntpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/ntpd-install/">ntpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/">openssl</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/openssl-certificate/">openssl certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/">openvpn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/openvpn-install/">openvpn install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/">rsync</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/rsync-install/">rsync install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/">supersord</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/supersord-install/">supersord install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/">vsftpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-error/">vsftpd error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-info/">vsftpd info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-install/">vsftpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/">windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/cygwin-install/">cygwin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/ipsec-set/">ipsec set</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/windows-modify-hosts/">windows modify hosts</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/">SSL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/">angular</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/angular-install/">angular install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/hexo-install/">hexo install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/">sass</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/sass-install/">sass install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/">xml</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/xml-format/">xml format</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/hello-everyone/">Hello Everyone</a>
          </li>
        
          <li>
            <a href="/2017/12/08/svn-checkout-bat/">svn checkout bat</a>
          </li>
        
          <li>
            <a href="/2017/12/08/svn-server-for-windows/">svn server for windows</a>
          </li>
        
          <li>
            <a href="/2017/12/08/nslookup-dns-search/">nslookup dns search</a>
          </li>
        
          <li>
            <a href="/2017/11/28/kafka-web-console/">kafka web console</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 penn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>