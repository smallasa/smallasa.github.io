<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>smallasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="smallasa">
<meta property="og:url" content="http://www.smallasa.com/page/22/index.html">
<meta property="og:site_name" content="smallasa">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="smallasa">
  
    <link rel="alternate" href="/atom.xml" title="smallasa" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">smallasa</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I known what i do !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.smallasa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-nfs-exports-command" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/10/nfs-exports-command/" class="article-date">
  <time datetime="2017-03-10T08:44:32.000Z" itemprop="datePublished">2017-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/system-service/">system service</a>►<a class="article-category-link" href="/categories/system-service/NFS/">NFS</a>►<a class="article-category-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/nfs-exports-command/">nfs exports command</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="NFS-exports-命令使用"><a href="#NFS-exports-命令使用" class="headerlink" title="NFS exports 命令使用"></a>NFS exports 命令使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如果修改了/etc/exports文件后不需要重新激活nfs,只要重新扫描一次/etc/exports文件,并且重新将设定加载即可:</span><br><span class="line"># exportfs [-aruv]</span><br><span class="line">参数说明如下。</span><br><span class="line">* -a：全部挂载（或卸载）/etc/exports文件内的设定。</span><br><span class="line">* -r：重新挂载/etc/exports中的设置，此外同步更新/etc/exports及/var/lib/nfs/xtab中的内容。</span><br><span class="line">* -u：卸载某一目录。</span><br><span class="line">* -v：在export时将共享的目录显示在屏幕上。</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/10/nfs-exports-command/" data-id="cjavy9k1m00700coqa5qxg4pe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-samba-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/10/samba-install/" class="article-date">
  <time datetime="2017-03-10T06:29:59.000Z" itemprop="datePublished">2017-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/system-service/">system service</a>►<a class="article-category-link" href="/categories/system-service/Samba/">Samba</a>►<a class="article-category-link" href="/categories/system-service/Samba/samba-install/">samba install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/samba-install/">samba install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="samba-安装"><a href="#samba-安装" class="headerlink" title="samba 安装"></a>samba 安装</h3><ol>
<li><p>关闭selinux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@10 ~]<span class="comment"># sed -i s/'SELINUX=enforcing'/'SELINUX=disabled'/g /etc/selinux/config</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭防火墙</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># systemctl stop firewalld.service</span></span><br><span class="line">[root@10 ~]<span class="comment"># systemctl disable firewalld.service</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>samba 安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum -y install samba samba-client</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建共享目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># mkdir -p /mnt/data/samba/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># chmod 777 /mnt/data/samba/elasticsearch</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>samba 配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># cp /etc/samba/&#123;smb.conf,smb.conf.bak&#125;</span></span><br><span class="line">[root@10 ~]<span class="comment"># vim /etc/samba/smb.conf  ==&gt;追加</span></span><br><span class="line">[elasticsearch]</span><br><span class="line">        comment = elasticsearch share</span><br><span class="line">        path = /mnt/data/samba/elasticsearch</span><br><span class="line">        hosts allow = 10.0.1. 10.0.2. 10.0.3. 10.0.4.</span><br><span class="line">        browseable = no</span><br><span class="line">        guest ok = no</span><br><span class="line">        writable = yes</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建访问账号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># useradd -s /sbin/nologin smbuser</span></span><br><span class="line">[root@10 ~]<span class="comment"># smbpasswd -a smbuser</span></span><br><span class="line">New SMB password:          //123qwe`</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Added user smbuser.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//添加账号并设置密码</span><br><span class="line">smbpasswd -a smbuser</span><br><span class="line"></span><br><span class="line">//删除smb账号</span><br><span class="line">smbpasswd -x smbuser</span><br><span class="line"></span><br><span class="line">//禁用smb账号</span><br><span class="line">smbpasswd -d smbuser</span><br><span class="line"></span><br><span class="line">//启用smb账号</span><br><span class="line">smbpasswd -e smbuser</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动smb服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># systemctl start smb</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># netstat -lntp|grep smbd</span></span><br><span class="line">tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      5949/smbd           </span><br><span class="line">tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      5949/smbd           </span><br><span class="line">tcp6       0      0 :::445                  :::*                    LISTEN      5949/smbd           </span><br><span class="line">tcp6       0      0 :::139                  :::*                    LISTEN      5949/smbd</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端安装samba-client</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># yum -y install samba-client</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端查看共享资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># smbclient -L //10.0.2.115</span></span><br><span class="line">Enter root<span class="string">'s password:        //查看共享信息,不需要密码,直接按回车键</span></span><br><span class="line"><span class="string">Anonymous login successful</span></span><br><span class="line"><span class="string">Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Sharename       Type      Comment</span></span><br><span class="line"><span class="string">        ---------       ----      -------</span></span><br><span class="line"><span class="string">        print$          Disk      Printer Drivers</span></span><br><span class="line"><span class="string">        IPC$            IPC       IPC Service (Samba 4.4.4)</span></span><br><span class="line"><span class="string">Anonymous login successful</span></span><br><span class="line"><span class="string">Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Server               Comment</span></span><br><span class="line"><span class="string">        ---------            -------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Workgroup            Master</span></span><br><span class="line"><span class="string">        ---------            -------</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端查看认证用户共享目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># smbclient -U smbuser //10.0.2.115/elasticsearch</span></span><br><span class="line">Enter smbuser<span class="string">'s password:</span></span><br><span class="line"><span class="string">Domain=[SAMBA] OS=[Windows 6.1] Server=[Samba 4.4.4]</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Sat Mar 11 15:27:59 2017</span></span><br><span class="line"><span class="string">  ..                                  D        0  Sat Mar 11 15:27:59 2017</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                1048064000 blocks of size 1024. 1048031024 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt; help</span></span><br><span class="line"><span class="string">?              allinfo        altname        archive        backup         </span></span><br><span class="line"><span class="string">blocksize      cancel         case_sensitive cd             chmod          </span></span><br><span class="line"><span class="string">chown          close          del            dir            du             </span></span><br><span class="line"><span class="string">echo           exit           get            getfacl        geteas         </span></span><br><span class="line"><span class="string">hardlink       help           history        iosize         lcd            </span></span><br><span class="line"><span class="string">link           lock           lowercase      ls             l              </span></span><br><span class="line"><span class="string">mask           md             mget           mkdir          more           </span></span><br><span class="line"><span class="string">mput           newer          notify         open           posix          </span></span><br><span class="line"><span class="string">posix_encrypt  posix_open     posix_mkdir    posix_rmdir    posix_unlink   </span></span><br><span class="line"><span class="string">print          prompt         put            pwd            q              </span></span><br><span class="line"><span class="string">queue          quit           readlink       rd             recurse        </span></span><br><span class="line"><span class="string">reget          rename         reput          rm             rmdir          </span></span><br><span class="line"><span class="string">showacls       setea          setmode        scopy          stat           </span></span><br><span class="line"><span class="string">symlink        tar            tarmode        timeout        translate      </span></span><br><span class="line"><span class="string">unlock         volume         vuid           wdel           logon          </span></span><br><span class="line"><span class="string">listconnect    showconnect    tcon           tdis           tid            </span></span><br><span class="line"><span class="string">logoff         ..             !              </span></span><br><span class="line"><span class="string">smb: \&gt; quit</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端挂载和卸载共享目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># mkdir -p /mnt/ops/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># chmod 777 /mnt/ops/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># mount -t cifs //10.0.2.115/elasticsearch /mnt/ops/elasticsearch -o username=smbuser,password=123qwe\`</span></span><br><span class="line"></span><br><span class="line">或者:</span><br><span class="line"></span><br><span class="line">[root@10 ~]<span class="comment"># mkdir -p /mnt/ops/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># chmod 777 /mnt/ops/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">//10.0.2.115/elasticsearch /mnt/ops/elasticsearch cifs defaults,username=smbuser,password=123qwe` 0 0</span><br><span class="line">[root@10 ~]<span class="comment"># mount -a</span></span><br><span class="line"></span><br><span class="line">[root@10 ~]<span class="comment"># df -h |grep elasticsearch</span></span><br><span class="line">//10.0.2.115/elasticsearch 1000G   33M 1000G   1% /mnt/ops/elasticsearch</span><br><span class="line"></span><br><span class="line">[root@10 ~]<span class="comment"># umount /mnt/ops/elasticsearch</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>拓展:不同用户访问不同目录(授权)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//创建两个组</span><br><span class="line">groupadd G1</span><br><span class="line">groupadd G2</span><br><span class="line"></span><br><span class="line">//创建三个用户</span><br><span class="line">useradd -s /sbin/nologin -g G1 U1</span><br><span class="line">useradd -s /sbin/nologin -g G1 U2</span><br><span class="line">useradd -s /sbin/nologin -g G2 U3</span><br><span class="line"></span><br><span class="line">//设置smb 密码</span><br><span class="line">smbpasswd -a U1</span><br><span class="line">smbpasswd -a U2</span><br><span class="line">smbpasswd -a U3</span><br><span class="line"></span><br><span class="line">//配置文件设置</span><br><span class="line">[test1]</span><br><span class="line">comment = Only U1 and U2 access</span><br><span class="line">path = /tmp/test1</span><br><span class="line">hosts allow = 10.0.1. 10.0.2. 10.0.3. 10.0.4.</span><br><span class="line">browseable = yes</span><br><span class="line">guest ok = no</span><br><span class="line">writable = yes</span><br><span class="line">write list = @G1</span><br><span class="line"></span><br><span class="line">[test2]</span><br><span class="line">comment = Only u3 access</span><br><span class="line">path = /tmp/test1</span><br><span class="line">hosts allow = 10.0.1. 10.0.2. 10.0.3. 10.0.4.</span><br><span class="line">browseable = no</span><br><span class="line">guest ok = no</span><br><span class="line">writable = yes</span><br><span class="line">write list = @G2</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/10/samba-install/" data-id="cjavy9k7400as0coqpq6of3kf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nfs-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/10/nfs-install/" class="article-date">
  <time datetime="2017-03-10T06:29:36.000Z" itemprop="datePublished">2017-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/system-service/">system service</a>►<a class="article-category-link" href="/categories/system-service/NFS/">NFS</a>►<a class="article-category-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/10/nfs-install/">nfs install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="NFS-简介"><a href="#NFS-简介" class="headerlink" title="NFS 简介"></a>NFS 简介</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NFS是Network File System的缩写,即网络文件系统</span><br><span class="line"></span><br><span class="line">NFS是一种使用于分散式文件系统的协定,功能是通过网络让不同的机器,不同的操作系统能够彼此分享个别的数据,让应用程序在客户端通过网络访问位于服务器磁盘中的数据,是在类Unix系统间实现磁盘文件共享的一种方法.</span><br><span class="line"></span><br><span class="line">NFS的基本原则是&quot;允许不同的客户端及服务端通过一组RPC分享相同的文件系统&quot;,它是独立于操作系统,允许不同硬件及操作系统的系统共同进行文件的分享.</span><br><span class="line"></span><br><span class="line">NFS在文件传送或信息传送过程中依赖于RPC协议.RPC,远程过程调用(Remote Procedure Call)是能使客户端执行其他系统中程序的一种机制.NFS本身是没有提供信息传输的协议和功能的,但NFS却能让我们通过网络进行资料的分享,这是因为NFS使用了一些其它的传输协议.而这些传输协议用到这个RPC功能的.可以说NFS本身就是使用RPC的一个程序.或者说NFS也是一个RPC SERVER.所以只要用到NFS的地方都要启动RPC服务,不论是NFS SERVER或者NFS CLIENT.这样SERVER和CLIENT才能通过RPC来实现PROGRAM PORT的对应.可以这么理解RPC和NFS的关系:NFS是一个文件系统,而RPC是负责负责信息的传输</span><br></pre></td></tr></table></figure>
<h3 id="NFS-安装"><a href="#NFS-安装" class="headerlink" title="NFS 安装"></a>NFS 安装</h3><ol>
<li><p>NFS 安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// NFS 服务端 和 客户端</span><br><span class="line">[root@10 ~]<span class="comment"># yum -y install nfs-utils rpcbind</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* nfs-utils  Nfs-utils软件包提供了rpc.nfsd和rpc.mountd两个RPC守护进程</span><br><span class="line">* rpcbind  远程过程调用服务</span><br><span class="line">* nfs-ganesha* NFS-Ganesha是一个基于NFSv3\v4\v4.1的文件服务器,运行在大多数Linux发行版的用户模态下,同时也支持9p.2000L协议.它支持的运行平台包括Linux，BSD variants和POSIX-compliant Unixes</span><br></pre></td></tr></table></figure>
</li>
<li><p>NFS 常用文件或目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* /etc/exports           NFS服务的主要配置文件</span><br><span class="line">* /usr/sbin/exportfs     NFS服务的管理命令</span><br><span class="line">* /usr/sbin/showmount    客户端的查看命令</span><br><span class="line">* /var/lib/nfs/etab      记录NFS分享出来的目录的完整权限设定值</span><br><span class="line">* /var/lib/nfs/xtab      记录曾经登录过的客户端信息</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="NFS-配置"><a href="#NFS-配置" class="headerlink" title="NFS 配置"></a>NFS 配置</h3><ol>
<li><p>服务端:创建存放数据目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># mkdir -p /mnt/data/nfs/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># chmod 777 /mnt/data/nfs/elasticsearch</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>服务端:修改配置文件/etc/exports</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># vim /etc/exports</span></span><br><span class="line">/mnt/data/nfs/elasticsearch 10.0.3.0/24(rw,sync,no_root_squash,no_all_squash)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/etc/exports文件内容格式:</span><br><span class="line">&lt;输出目录&gt; [客户端1 选项（访问权限,用户映射,其他）] [客户端2 选项（访问权限,用户映射,其他）]</span><br><span class="line"></span><br><span class="line">* 输出目录   共享目录位置</span><br><span class="line">* 客户端IP:</span><br><span class="line">  1.指定ip地址:1.1.1.1</span><br><span class="line">  2.指定网段:1.1.1.0/24,1.1.1.0/255.255.255.0</span><br><span class="line">  3.指定主机域名:a.b.com</span><br><span class="line">  4.指定部分主机域名:*.b.com</span><br><span class="line">  5.所有主机:*</span><br><span class="line">* 客户端选项:选项用来设置输出目录的访问权限,用户映射</span><br><span class="line">  1.访问权限:</span><br><span class="line">    * ro 只读访问</span><br><span class="line">    * rw 读写访问</span><br><span class="line">  2.用户映射选项:</span><br><span class="line">    * all_squash 将远程访问的所有普通用户及所属组都映射为匿名用户或用户组(nfsnobody)</span><br><span class="line">    * no_all_squash 与all_squash取反(默认设置)</span><br><span class="line">    * root_squash 将root用户及所属组都映射为匿名用户或用户组(默认设置)</span><br><span class="line">    * no_root_squash 与rootsquash取反</span><br><span class="line">    * anonuid=xxx 将远程访问的所有用户都映射为匿名用户,并指定该用户为本地用户(UID=xxx)</span><br><span class="line">    * anongid=xxx 将远程访问的所有用户组都映射为匿名用户组账户,并指定该匿名用户组账户为本地用户组账户(GID=xxx)</span><br><span class="line">  3.其它选项</span><br><span class="line">    * secure 限制客户端只能从小于1024的tcp/ip端口连接nfs服务器(默认设置)</span><br><span class="line">    * insecure 允许客户端从大于1024的tcp/ip端口连接服务器</span><br><span class="line">    * sync 将数据同步写入内存缓冲区与磁盘中,效率低,但可以保证数据的一致性</span><br><span class="line">    * async 将数据先保存在内存缓冲区中,必要时才写入磁盘</span><br><span class="line">    * wdelay 检查是否有相关的写操作,如果有则将这些写操作一起执行,这样可以提高效率(默认设置)</span><br><span class="line">    * no_wdelay 若有写操作则立即执行,应与sync配合使用</span><br><span class="line">    * subtree 若输出目录是一个子目录,则nfs服务器将检查其父目录的权限(默认设置)</span><br><span class="line">    * no_subtree 即使输出目录是一个子目录,nfs服务器也不检查其父目录的权限,这样可以提高效率</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务端:启动服务和开机自启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//重启(修改完配置文件后)</span><br><span class="line">[root@10 ~]<span class="comment"># systemctl restart rpcbind</span></span><br><span class="line">[root@10 ~]<span class="comment"># systemctl restart nfs</span></span><br><span class="line">或者:</span><br><span class="line">//重新加载配置文件</span><br><span class="line">[root@10 ~]<span class="comment"># exportfs -r</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//启动</span><br><span class="line">[root@10 ~]<span class="comment"># systemctl start rpcbind</span></span><br><span class="line">[root@10 ~]<span class="comment"># systemctl start nfs</span></span><br><span class="line"></span><br><span class="line">//开机启动项</span><br><span class="line">[root@10 ~]<span class="comment"># systemctl enable rpcbind</span></span><br><span class="line">[root@10 ~]<span class="comment"># systemctl enable nfs</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>服务端:检查NFS是否启动成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># rpcinfo -p</span></span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line">    100024    1   udp  53483  status</span><br><span class="line">    100024    1   tcp  50192  status</span><br><span class="line">    100005    1   udp  20048  mountd</span><br><span class="line">    100005    1   tcp  20048  mountd</span><br><span class="line">    100005    2   udp  20048  mountd</span><br><span class="line">    100005    2   tcp  20048  mountd</span><br><span class="line">    100005    3   udp  20048  mountd</span><br><span class="line">    100005    3   tcp  20048  mountd</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line">    100003    3   udp   2049  nfs</span><br><span class="line">    100003    4   udp   2049  nfs</span><br><span class="line">    100227    3   udp   2049  nfs_acl</span><br><span class="line">    100021    1   udp  38395  nlockmgr</span><br><span class="line">    100021    3   udp  38395  nlockmgr</span><br><span class="line">    100021    4   udp  38395  nlockmgr</span><br><span class="line">    100021    1   tcp  53778  nlockmgr</span><br><span class="line">    100021    3   tcp  53778  nlockmgr</span><br><span class="line">    100021    4   tcp  53778  nlockmgr</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">注意:</span><br><span class="line">我们只输入了一条启动NFS服务的命令,它额外的启动了3个服务:quotas,daemon,mountd(启动portmap服务)又是怎么回事?</span><br><span class="line"></span><br><span class="line">首先,NFS文件系统要提供服务单靠本身的NFS服务是不够的,还需要调用其它服务,这个其它服务就是RPC(remote procedure call,远程过程调用)服务和portmap服务.由于NFS服务本身不提供文件传输功能,我们要远程使用NFS文件系统就需要RPC服务的支持,而portmap服务用来为RPC服务进行动态端口分配和映射,所以portmap服务也是NFS服务所必须的.正是因为NFS的运行必须要使用RPC服务,所以一般把NFS服务看作RPC服务的一种,开启NFS服务其实就是在开启RPC服务.REDHAT安全指南在讲portmap服务时就说:&quot;portmap服务是用于RPC服务(如NIS和NFS)的动态端口分配守护进程&quot;，明显把NFS和NIS(network information service)看成了RPC服务的其中两个应用.</span><br><span class="line"></span><br><span class="line">NFS使用了RPC的哪些服务呢? rpc.nfsd服务 和 rpc.mountd服务</span><br><span class="line">明白了这点,我们就明白为什么在开启nfs服务时,系统除了开启NFS services还开启了rpc.nfsd和rpc.mountd,而至于NFS quotas是用来管理目录配额的,它并不是必需的.这也就明白了安装NFS服务时所需要的两个软件包nfs-utils和portmap: Nfs-utils软件包提供了rpc.nfsd和rpc.mountd两个RPC的daemon(守护进程)程序,而portmap软件包提供了portmap程序</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端:检查共享目录列表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># showmount -e 10.0.2.115</span></span><br><span class="line">Export list <span class="keyword">for</span> 10.0.2.115:</span><br><span class="line">/mnt/data/nfs/elasticsearch 10.0.3.0/24</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端:创建挂载点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># mkdir -p /mnt/ops/elasticsearch</span></span><br><span class="line">[root@10 ~]<span class="comment"># chmod 777 /mnt/ops/elasticsearch</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端:挂在共享目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//显示指定NFS服务器的客户端以及服务器端在客户端的挂载点</span><br><span class="line">showmount –a IP  </span><br><span class="line">//显示指定NFS服务器在客户端的挂载点</span><br><span class="line">showmount –d IP      </span><br><span class="line"></span><br><span class="line">rpcinfo -p 10.10.209.148</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端挂载目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@10 ~]<span class="comment"># mount.nfs -t nfs 10.0.2.115:/mnt/data/nfs/elasticsearch /mnt/ops/elasticsearch -o proto=tcp -o nolock</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/10/nfs-install/" data-id="cjavy9k1p00720coqoq3o4hs0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-elasticsearch-backup-and-restore" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/09/elasticsearch-backup-and-restore/" class="article-date">
  <time datetime="2017-03-09T02:13:37.000Z" itemprop="datePublished">2017-03-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a>►<a class="article-category-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/09/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="elasticsearch-备份说明"><a href="#elasticsearch-备份说明" class="headerlink" title="elasticsearch 备份说明"></a>elasticsearch 备份说明</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Elasticsearch的备份分两步:</span><br><span class="line">1.创建一个仓库</span><br><span class="line">  备份数据之前,要创建一个仓库来保存数据,仓库的类型支持共享文件系统,Amazon S3,HDFS和Azure Cloud</span><br><span class="line">2.备份指定索引</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearch-备份"><a href="#elasticsearch-备份" class="headerlink" title="elasticsearch 备份"></a>elasticsearch 备份</h3><ol>
<li><p>elasticsearch 创建一个仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//查看当前所有仓库</span><br><span class="line">[root@10 ~]<span class="comment"># curl -XGET http://10.0.3.41:9200/_snapshot/_all?pretty</span></span><br><span class="line">&#123; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//创建一个仓库</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT <span class="string">'10.0.3.41:9200/_snapshot/esbackup'</span> -d <span class="string">'</span></span><br><span class="line"><span class="string">&gt; &#123;</span></span><br><span class="line"><span class="string">&gt;  "type": "fs",</span></span><br><span class="line"><span class="string">&gt;  "settings": &#123;</span></span><br><span class="line"><span class="string">&gt;    "location": "/mnt/ops/elasticsearch",</span></span><br><span class="line"><span class="string">&gt;    "compress" : "true",</span></span><br><span class="line"><span class="string">&gt;    "max_snapshot_bytes_per_sec" : "80mb",</span></span><br><span class="line"><span class="string">&gt;    "max_restore_bytes_per_sec" : "80mb"</span></span><br><span class="line"><span class="string">&gt;  &#125;</span></span><br><span class="line"><span class="string">&gt; &#125;'</span></span><br><span class="line">&#123;<span class="string">"acknowledged"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 使用POST来修改配置</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT <span class="string">'10.0.3.41:9200/_snapshot/esbackup'</span> -d <span class="string">'</span></span><br><span class="line"><span class="string">&gt; &#123;</span></span><br><span class="line"><span class="string">&gt;  "type": "fs",</span></span><br><span class="line"><span class="string">&gt;  "settings": &#123;</span></span><br><span class="line"><span class="string">&gt;    "max_snapshot_bytes_per_sec" : "100mb",</span></span><br><span class="line"><span class="string">&gt;    "max_restore_bytes_per_sec" : "100mb"</span></span><br><span class="line"><span class="string">&gt;  &#125;</span></span><br><span class="line"><span class="string">&gt; &#125;'</span></span><br><span class="line">&#123;<span class="string">"acknowledged"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//查看当前仓库信息</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_snapshot/esbackup?pretty     </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"esbackup"</span> : &#123;</span><br><span class="line">    <span class="string">"type"</span> : <span class="string">"fs"</span>,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"location"</span> : <span class="string">"/mnt/ops/elasticsearch"</span>,</span><br><span class="line">      <span class="string">"max_restore_bytes_per_sec"</span> : <span class="string">"80mb"</span>,</span><br><span class="line">      <span class="string">"compress"</span> : <span class="string">"true"</span>,</span><br><span class="line">      <span class="string">"max_snapshot_bytes_per_sec"</span> : <span class="string">"80mb"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//查看当前所有仓库信息</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_snapshot/_all?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"esbackup"</span> : &#123;</span><br><span class="line">    <span class="string">"type"</span> : <span class="string">"fs"</span>,</span><br><span class="line">    <span class="string">"settings"</span> : &#123;</span><br><span class="line">      <span class="string">"location"</span> : <span class="string">"/mnt/ops/elasticsearch"</span>,</span><br><span class="line">      <span class="string">"max_restore_bytes_per_sec"</span> : <span class="string">"80mb"</span>,</span><br><span class="line">      <span class="string">"compress"</span> : <span class="string">"true"</span>,</span><br><span class="line">      <span class="string">"max_snapshot_bytes_per_sec"</span> : <span class="string">"80mb"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//查看仓库是否创建成功</span><br><span class="line">[wisdom@10 ~]$ curl -XPOST http://10.0.3.41:9200/_snapshot/esbackup/_verify?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"nodes"</span> : &#123;</span><br><span class="line">    <span class="string">"j0bxQZGZSbW1lNoD9d2WHQ"</span> : &#123;</span><br><span class="line">      <span class="string">"name"</span> : <span class="string">"10.0.3.41"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"lhlUZILyRAm2Mtmp8czEOw"</span> : &#123;</span><br><span class="line">      <span class="string">"name"</span> : <span class="string">"10.0.3.42"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"DKfbgvGYTNO48BdMI3eeQA"</span> : &#123;</span><br><span class="line">      <span class="string">"name"</span> : <span class="string">"10.0.3.40"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//删除仓库</span><br><span class="line">[root@10 ~]<span class="comment"># curl -XDELETE http://10.0.3.40:9200/_snapshot/esbackup?pretty  </span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"acknowledged"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">补充: 一个权限错误</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT &apos;10.0.3.41:9200/_snapshot/es&apos; -d &apos;      </span><br><span class="line">&#123;</span><br><span class="line"> &quot;type&quot;: &quot;fs&quot;,</span><br><span class="line"> &quot;settings&quot;: &#123;</span><br><span class="line">   &quot;location&quot;: &quot;/mnt/ops/elasticsearch&quot;,</span><br><span class="line">   &quot;max_snapshot_bytes_per_sec&quot; : &quot;80mb&quot;,</span><br><span class="line">   &quot;max_restore_bytes_per_sec&quot; : &quot;80mb&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;&apos;</span><br><span class="line">&#123;&quot;error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;access_denied_exception&quot;,&quot;reason&quot;:&quot;access_denied_exception: /mnt/ops/elasticsearch/tests-ggM3LzbjTn2d0pWjwj7WpQ/master.dat-temp&quot;&#125;],&quot;type&quot;:&quot;repository_verification_exception&quot;,&quot;reason&quot;:&quot;[es] path  is not accessible on master node&quot;,&quot;caused_by&quot;:&#123;&quot;type&quot;:&quot;access_denied_exception&quot;,&quot;reason&quot;:&quot;access_denied_exception: /mnt/ops/elasticsearch/tests-ggM3LzbjTn2d0pWjwj7WpQ/master.dat-temp&quot;&#125;&#125;,&quot;status&quot;:500&#125;</span><br><span class="line"></span><br><span class="line">问题解决:</span><br><span class="line">1. 查看test目录</span><br><span class="line">[root@10 ~]# ls -l /mnt/ops/elasticsearch/                                 </span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 1001 1001 0 Mar 12 03:10 tests-ggM3LzbjTn2d0pWjwj7WpQ</span><br><span class="line"></span><br><span class="line">2. 我使用的是普通用户wisdom启动的elasticsearch,三台es的uid和gid都是1000</span><br><span class="line">[wisdom@10 ~]$ tail /etc/passwd|grep wisdom</span><br><span class="line">wisdom:x:1000:1000::/home/wisdom:/bin/bash</span><br><span class="line"></span><br><span class="line">此时,我们已经发现问题,创建的test目录的权限是1001,和我们使用的用户对不上号</span><br><span class="line"></span><br><span class="line">3. 1001是什么用户？经排查是samba的权限账号</span><br><span class="line">//Samba server:</span><br><span class="line">[root@10 ~]# tail /etc/passwd|grep 1001</span><br><span class="line">smbuser:x:1001:1001::/home/smbuser:/sbin/nologin</span><br><span class="line"></span><br><span class="line">//查看ES集群挂载点</span><br><span class="line">[root@10 ~]# cat /etc/fstab |grep elasticsearch</span><br><span class="line">//10.0.2.115/elasticsearch /mnt/ops/elasticsearch cifs defaults,username=smbuser,password=xxxxxx 0 0</span><br><span class="line"></span><br><span class="line">至此，问题已经找到. 解决就很快了.</span><br><span class="line"></span><br><span class="line">4. 在Samba服务器上创建UID和GID与三台ES主机中ES启动用户相同的用户</span><br><span class="line">//Samba server:</span><br><span class="line">[root@10 ~]# useradd -u 1000 -g 1000 wisdom</span><br><span class="line">[root@10 ~]# smbpasswd -a wisdom</span><br><span class="line"></span><br><span class="line">//ES集群</span><br><span class="line">[root@10 ~]# umount /mnt/ops/elasticsearch</span><br><span class="line">[root@10 ~]# vim /etc/fstab |grep elasticsearch</span><br><span class="line">//10.0.2.115/elasticsearch /mnt/ops/elasticsearch cifs defaults,username=wisdom,password=xxxxxx 0 0</span><br><span class="line">[root@10 ~]# mount -a</span><br><span class="line">[root@10 ~]# smbclient -U wisdom //10.0.2.115/elasticsearch</span><br><span class="line"></span><br><span class="line">5. 重新创建仓库,成功</span><br></pre></td></tr></table></figure>
</li>
<li><p>elasticsearch 备份索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一个仓库可以包含多个快照(snapshots),快照可以存所有的索引,部分索引或者一个单独的索引</span><br><span class="line"></span><br><span class="line">注意: 快照只会备份正在运行open状态的索引！！！</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//备份所有索引到一个快照中</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT http://10.0.3.40:9200/_snapshot/esbackup/snapshot_all</span><br><span class="line">直接返回&#123;<span class="string">"accepted"</span>:<span class="literal">true</span>&#125;,然后备份在后台执行</span><br><span class="line"></span><br><span class="line">or:</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT http://10.0.3.40:9200/_snapshot/esbackup/snapshot_all?wait_for_completion=<span class="literal">true</span></span><br><span class="line">只有备份完成后,才会显示&#123;<span class="string">"accepted"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//备份部分索引</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT http://10.0.3.40:9200/_snapshot/esbackup/snapshot_index -d <span class="string">'&#123; "indices": "index_1,index_2" &#125;'</span></span><br><span class="line">会将索引index_1和index_2备份到快照snapshot_index中</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//备份单个索引</span><br><span class="line">[wisdom@10 ~]$ curl -XPUT http://10.0.3.40:9200/_snapshot/esbackup/snapshot_index_1 -d <span class="string">'&#123; "indices": "index_1" &#125;'</span></span><br><span class="line">会将索引index_1备份到快照snapshot_index_1中</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//查看快照信息</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_snapshot/esbackup/snapshot_index_1?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"snapshots"</span> : [ &#123;</span><br><span class="line">    <span class="string">"snapshot"</span> : <span class="string">"snapshot_index_1"</span>,</span><br><span class="line">    <span class="string">"version_id"</span> : 2030399,</span><br><span class="line">    <span class="string">"version"</span> : <span class="string">"2.3.3"</span>,</span><br><span class="line">    <span class="string">"indices"</span> : [ <span class="string">"snapshot_index_1"</span> ],</span><br><span class="line">    <span class="string">"state"</span> : <span class="string">"SUCCESS"</span>,</span><br><span class="line">    <span class="string">"start_time"</span> : <span class="string">"2017-03-11T20:53:11.478Z"</span>,</span><br><span class="line">    <span class="string">"start_time_in_millis"</span> : 1489265591478,</span><br><span class="line">    <span class="string">"end_time"</span> : <span class="string">"2017-03-11T20:53:46.128Z"</span>,</span><br><span class="line">    <span class="string">"end_time_in_millis"</span> : 1489265626128,</span><br><span class="line">    <span class="string">"duration_in_millis"</span> : 34650,</span><br><span class="line">    <span class="string">"failures"</span> : [ ],</span><br><span class="line">    <span class="string">"shards"</span> : &#123;</span><br><span class="line">      <span class="string">"total"</span> : 5,</span><br><span class="line">      <span class="string">"failed"</span> : 0,</span><br><span class="line">      <span class="string">"successful"</span> : 5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查看所有快照信息</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_snapshot/esbackup/_all?pretty</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">//查看快照状态信息</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_snapshot/esbackup/snapshot_index_1/_status?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"snapshots"</span> : [ &#123;</span><br><span class="line">    <span class="string">"snapshot"</span> : <span class="string">"snapshot_index_1"</span>,</span><br><span class="line">    <span class="string">"repository"</span> : <span class="string">"esbackup"</span>,</span><br><span class="line">    <span class="string">"state"</span> : <span class="string">"SUCCESS"</span>,</span><br><span class="line">    <span class="string">"shards_stats"</span> : &#123;</span><br><span class="line">      <span class="string">"initializing"</span> : 0,</span><br><span class="line">      <span class="string">"started"</span> : 0,</span><br><span class="line">      <span class="string">"finalizing"</span> : 0,</span><br><span class="line">      <span class="string">"done"</span> : 5,</span><br><span class="line">      <span class="string">"failed"</span> : 0,</span><br><span class="line">      <span class="string">"total"</span> : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"stats"</span> : &#123;</span><br><span class="line">      <span class="string">"number_of_files"</span> : 497,</span><br><span class="line">      <span class="string">"processed_files"</span> : 497,</span><br><span class="line">      <span class="string">"total_size_in_bytes"</span> : 2141849055,</span><br><span class="line">      <span class="string">"processed_size_in_bytes"</span> : 2141849055,</span><br><span class="line">      <span class="string">"start_time_in_millis"</span> : 1489265591607,</span><br><span class="line">      <span class="string">"time_in_millis"</span> : 34498</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"indices"</span> : &#123;</span><br><span class="line">      <span class="string">"snapshot_index_1"</span> : &#123;</span><br><span class="line">        <span class="string">"shards_stats"</span> : &#123;</span><br><span class="line">          <span class="string">"initializing"</span> : 0,</span><br><span class="line">          <span class="string">"started"</span> : 0,</span><br><span class="line">          <span class="string">"finalizing"</span> : 0,</span><br><span class="line">          <span class="string">"done"</span> : 5,</span><br><span class="line">          <span class="string">"failed"</span> : 0,</span><br><span class="line">          <span class="string">"total"</span> : 5</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"stats"</span> : &#123;</span><br><span class="line">          <span class="string">"number_of_files"</span> : 497,</span><br><span class="line">          <span class="string">"processed_files"</span> : 497,</span><br><span class="line">          <span class="string">"total_size_in_bytes"</span> : 2141849055,</span><br><span class="line">          <span class="string">"processed_size_in_bytes"</span> : 2141849055,</span><br><span class="line">          <span class="string">"start_time_in_millis"</span> : 1489265591607,</span><br><span class="line">          <span class="string">"time_in_millis"</span> : 34498</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"shards"</span> : &#123;</span><br><span class="line">          <span class="string">"0"</span> : &#123;</span><br><span class="line">            <span class="string">"stage"</span> : <span class="string">"DONE"</span>,</span><br><span class="line">            <span class="string">"stats"</span> : &#123;</span><br><span class="line">              <span class="string">"number_of_files"</span> : 94,</span><br><span class="line">              <span class="string">"processed_files"</span> : 94,</span><br><span class="line">              <span class="string">"total_size_in_bytes"</span> : 429108117,</span><br><span class="line">              <span class="string">"processed_size_in_bytes"</span> : 429108117,</span><br><span class="line">              <span class="string">"start_time_in_millis"</span> : 1489265591663,</span><br><span class="line">              <span class="string">"time_in_millis"</span> : 12916</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"1"</span> : &#123;</span><br><span class="line">            <span class="string">"stage"</span> : <span class="string">"DONE"</span>,</span><br><span class="line">            <span class="string">"stats"</span> : &#123;</span><br><span class="line">              <span class="string">"number_of_files"</span> : 82,</span><br><span class="line">              <span class="string">"processed_files"</span> : 82,</span><br><span class="line">              <span class="string">"total_size_in_bytes"</span> : 429223456,</span><br><span class="line">              <span class="string">"processed_size_in_bytes"</span> : 429223456,</span><br><span class="line">              <span class="string">"start_time_in_millis"</span> : 1489265591607,</span><br><span class="line">              <span class="string">"time_in_millis"</span> : 32220</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"2"</span> : &#123;</span><br><span class="line">            <span class="string">"stage"</span> : <span class="string">"DONE"</span>,</span><br><span class="line">            <span class="string">"stats"</span> : &#123;</span><br><span class="line">              <span class="string">"number_of_files"</span> : 115,</span><br><span class="line">              <span class="string">"processed_files"</span> : 115,</span><br><span class="line">              <span class="string">"total_size_in_bytes"</span> : 428510263,</span><br><span class="line">              <span class="string">"processed_size_in_bytes"</span> : 428510263,</span><br><span class="line">              <span class="string">"start_time_in_millis"</span> : 1489265591615,</span><br><span class="line">              <span class="string">"time_in_millis"</span> : 34152</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"3"</span> : &#123;</span><br><span class="line">            <span class="string">"stage"</span> : <span class="string">"DONE"</span>,</span><br><span class="line">            <span class="string">"stats"</span> : &#123;</span><br><span class="line">              <span class="string">"number_of_files"</span> : 97,</span><br><span class="line">              <span class="string">"processed_files"</span> : 97,</span><br><span class="line">              <span class="string">"total_size_in_bytes"</span> : 427697132,</span><br><span class="line">              <span class="string">"processed_size_in_bytes"</span> : 427697132,</span><br><span class="line">              <span class="string">"start_time_in_millis"</span> : 1489265591619,</span><br><span class="line">              <span class="string">"time_in_millis"</span> : 34261</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"4"</span> : &#123;</span><br><span class="line">            <span class="string">"stage"</span> : <span class="string">"DONE"</span>,</span><br><span class="line">            <span class="string">"stats"</span> : &#123;</span><br><span class="line">              <span class="string">"number_of_files"</span> : 109,</span><br><span class="line">              <span class="string">"processed_files"</span> : 109,</span><br><span class="line">              <span class="string">"total_size_in_bytes"</span> : 427310087,</span><br><span class="line">              <span class="string">"processed_size_in_bytes"</span> : 427310087,</span><br><span class="line">              <span class="string">"start_time_in_millis"</span> : 1489265591611,</span><br><span class="line">              <span class="string">"time_in_millis"</span> : 34494</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//删除快照</span><br><span class="line">[wisdom@10 ~]$ curl -XDELETE http://10.0.3.41:9200/_snapshot/esbackup/snapshot_index_1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="elasticsearch-恢复"><a href="#elasticsearch-恢复" class="headerlink" title="elasticsearch 恢复"></a>elasticsearch 恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//恢复快照</span><br><span class="line">[wisdom@10 ~]$ curl -XPOST http://10.0.3.41:9200/_snapshot/esbackup/snapshot_index_1/_restore</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//恢复快照中指定索引</span><br><span class="line">[wisdom@10 ~]$ curl -XPOST http://10.0.3.41:9200/_snapshot/esbackup/snapshot_index_1/_restore -d <span class="string">'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "indices": "index_1",</span></span><br><span class="line"><span class="string">  "rename_pattern": "index_(.+)",</span></span><br><span class="line"><span class="string">  "rename_replacement": "restored_index_$1"</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">说明:</span><br><span class="line">* indices表示只恢复索引index_1</span><br><span class="line">* 参数rename_pattern和rename_replacement 用来正则匹配要恢复的索引,并且重命名</span><br><span class="line">* 和备份一样,api会立刻返回值,然后在后台执行恢复,使用wait_for_completion 标记强制同步执行</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//查看恢复状态</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_recovery/snapshot_index_1</span><br><span class="line">[wisdom@10 ~]$ curl -XGET http://10.0.3.41:9200/_recovery/</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//取消恢复过程(不管是已经恢复完,还是正在恢复)直接删除索引即可</span><br><span class="line">[wisdom@10 ~]$ curl -XDELETE http://10.0.3.41:9200/_recovery/snapshot_index_1</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/09/elasticsearch-backup-and-restore/" data-id="cjavy9jv6001y0coqtbbv6ltz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-broker-config" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/kafka-broker-config/" class="article-date">
  <time datetime="2017-03-08T10:52:45.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/kafka-broker-config/">kafka broker config</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################# System #############################</span></span><br><span class="line"><span class="comment">#唯一标识在集群中的ID，要求是正数。</span></span><br><span class="line">broker.id=0</span><br><span class="line"><span class="comment">#服务端口，默认9092</span></span><br><span class="line">port=9092</span><br><span class="line"><span class="comment">#监听地址，不设为所有地址</span></span><br><span class="line">host.name=debugo01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理网络请求的最大线程数</span></span><br><span class="line">num.network.threads=2</span><br><span class="line"><span class="comment"># 处理磁盘I/O的线程数</span></span><br><span class="line">num.io.threads=8</span><br><span class="line"><span class="comment"># 一些后台线程数</span></span><br><span class="line">background.threads = 4</span><br><span class="line"><span class="comment"># 等待IO线程处理的请求队列最大数</span></span><br><span class="line">queued.max.requests = 500</span><br><span class="line"></span><br><span class="line"><span class="comment">#  socket的发送缓冲区（SO_SNDBUF）</span></span><br><span class="line">socket.send.buffer.bytes=1048576</span><br><span class="line"><span class="comment"># socket的接收缓冲区 (SO_RCVBUF)</span></span><br><span class="line">socket.receive.buffer.bytes=1048576</span><br><span class="line"><span class="comment"># socket请求的最大字节数。为了防止内存溢出，message.max.bytes必然要小于</span></span><br><span class="line">socket.request.max.bytes = 104857600</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Topic #############################</span></span><br><span class="line"><span class="comment"># 每个topic的分区个数，更多的partition会产生更多的segment file</span></span><br><span class="line">num.partitions=2</span><br><span class="line"><span class="comment"># 是否允许自动创建topic ，若是false，就需要通过命令创建topic</span></span><br><span class="line">auto.create.topics.enable =<span class="literal">true</span></span><br><span class="line"><span class="comment"># 一个topic ，默认分区的replication个数 ，不能大于集群中broker的个数。</span></span><br><span class="line">default.replication.factor =1</span><br><span class="line"><span class="comment"># 消息体的最大大小，单位是字节</span></span><br><span class="line">message.max.bytes = 1000000</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# ZooKeeper #############################</span></span><br><span class="line"><span class="comment"># Zookeeper quorum设置。如果有多个使用逗号分割</span></span><br><span class="line">zookeeper.connect=debugo01:2181,debugo02,debugo03</span><br><span class="line"><span class="comment"># 连接zk的超时时间</span></span><br><span class="line">zookeeper.connection.timeout.ms=1000000</span><br><span class="line"><span class="comment"># ZooKeeper集群中leader和follower之间的同步实际</span></span><br><span class="line">zookeeper.sync.time.ms = 2000</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# Log #############################</span></span><br><span class="line"><span class="comment">#日志存放目录，多个目录使用逗号分割</span></span><br><span class="line">log.dirs=/var/<span class="built_in">log</span>/kafka</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当达到下面的消息数量时，会将数据flush到日志文件中。默认10000</span></span><br><span class="line"><span class="comment">#log.flush.interval.messages=10000</span></span><br><span class="line"><span class="comment"># 当达到下面的时间(ms)时，执行一次强制的flush操作。interval.ms和interval.messages无论哪个达到，都会flush。默认3000ms</span></span><br><span class="line"><span class="comment">#log.flush.interval.ms=1000</span></span><br><span class="line"><span class="comment"># 检查是否需要将日志flush的时间间隔</span></span><br><span class="line">log.flush.scheduler.interval.ms = 3000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志清理策略（delete|compact）</span></span><br><span class="line">log.cleanup.policy = delete</span><br><span class="line"><span class="comment"># 日志保存时间 (hours|minutes)，默认为7天（168小时）。超过这个时间会根据policy处理数据。bytes和minutes无论哪个先达到都会触发。</span></span><br><span class="line">log.retention.hours=168</span><br><span class="line"><span class="comment"># 日志数据存储的最大字节数。超过这个时间会根据policy处理数据。</span></span><br><span class="line"><span class="comment">#log.retention.bytes=1073741824</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制日志segment文件的大小，超出该大小则追加到一个新的日志segment文件中（-1表示没有限制）</span></span><br><span class="line">log.segment.bytes=536870912</span><br><span class="line"><span class="comment"># 当达到下面时间，会强制新建一个segment</span></span><br><span class="line">log.roll.hours = 24*7</span><br><span class="line"><span class="comment"># 日志片段文件的检查周期，查看它们是否达到了删除策略的设置（log.retention.hours或log.retention.bytes）</span></span><br><span class="line">log.retention.check.interval.ms=60000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否开启压缩</span></span><br><span class="line">log.cleaner.enable=<span class="literal">false</span></span><br><span class="line"><span class="comment"># 对于压缩的日志保留的最长时间</span></span><br><span class="line">log.cleaner.delete.retention.ms = 1 day</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于segment日志的索引文件大小限制</span></span><br><span class="line">log.index.size.max.bytes = 10 * 1024 * 1024</span><br><span class="line"><span class="comment">#y索引计算的一个缓冲区，一般不需要设置。</span></span><br><span class="line">log.index.interval.bytes = 4096</span><br><span class="line"></span><br><span class="line"><span class="comment">############################# replica #############################</span></span><br><span class="line"><span class="comment"># partition management controller 与replicas之间通讯的超时时间</span></span><br><span class="line">controller.socket.timeout.ms = 30000</span><br><span class="line"><span class="comment"># controller-to-broker-channels消息队列的尺寸大小</span></span><br><span class="line">controller.message.queue.size=10</span><br><span class="line"><span class="comment"># replicas响应leader的最长等待时间，若是超过这个时间，就将replicas排除在管理之外</span></span><br><span class="line">replica.lag.time.max.ms = 10000</span><br><span class="line"><span class="comment"># 是否允许控制器关闭broker ,若是设置为true,会关闭所有在这个broker上的leader，并转移到其他broker</span></span><br><span class="line">controlled.shutdown.enable = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 控制器关闭的尝试次数</span></span><br><span class="line">controlled.shutdown.max.retries = 3</span><br><span class="line"><span class="comment"># 每次关闭尝试的时间间隔</span></span><br><span class="line">controlled.shutdown.retry.backoff.ms = 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果relicas落后太多,将会认为此partition relicas已经失效。而一般情况下,因为网络延迟等原因,总会导致replicas中消息同步滞后。如果消息严重滞后,leader将认为此relicas网络延迟较大或者消息吞吐能力有限。在broker数量较少,或者网络不足的环境中,建议提高此值.</span></span><br><span class="line">replica.lag.max.messages = 4000</span><br><span class="line"><span class="comment">#leader与relicas的socket超时时间</span></span><br><span class="line">replica.socket.timeout.ms= 30 * 1000</span><br><span class="line"><span class="comment"># leader复制的socket缓存大小</span></span><br><span class="line">replica.socket.receive.buffer.bytes=64 * 1024</span><br><span class="line"><span class="comment"># replicas每次获取数据的最大字节数</span></span><br><span class="line">replica.fetch.max.bytes = 1024 * 1024</span><br><span class="line"><span class="comment"># replicas同leader之间通信的最大等待时间，失败了会重试</span></span><br><span class="line">replica.fetch.wait.max.ms = 500</span><br><span class="line"><span class="comment"># 每一个fetch操作的最小数据尺寸,如果leader中尚未同步的数据不足此值,将会等待直到数据达到这个大小</span></span><br><span class="line">replica.fetch.min.bytes =1</span><br><span class="line"><span class="comment"># leader中进行复制的线程数，增大这个数值会增加relipca的IO</span></span><br><span class="line">num.replica.fetchers = 1</span><br><span class="line"><span class="comment"># 每个replica将最高水位进行flush的时间间隔</span></span><br><span class="line">replica.high.watermark.checkpoint.interval.ms = 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否自动平衡broker之间的分配策略</span></span><br><span class="line">auto.leader.rebalance.enable = <span class="literal">false</span></span><br><span class="line"><span class="comment"># leader的不平衡比例，若是超过这个数值，会对分区进行重新的平衡</span></span><br><span class="line">leader.imbalance.per.broker.percentage = 10</span><br><span class="line"><span class="comment"># 检查leader是否不平衡的时间间隔</span></span><br><span class="line">leader.imbalance.check.interval.seconds = 300</span><br><span class="line"><span class="comment"># 客户端保留offset信息的最大空间大小</span></span><br><span class="line">offset.metadata.max.bytes = 1024</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################Consumer #############################</span></span><br><span class="line"><span class="comment"># Consumer端核心的配置是group.id、zookeeper.connect</span></span><br><span class="line"><span class="comment"># 决定该Consumer归属的唯一组ID，By setting the same group id multiple processes indicate that they are all part of the same consumer group.</span></span><br><span class="line">group.id</span><br><span class="line"><span class="comment"># 消费者的ID，若是没有设置的话，会自增</span></span><br><span class="line">consumer.id</span><br><span class="line"><span class="comment"># 一个用于跟踪调查的ID ，最好同group.id相同</span></span><br><span class="line">client.id = &lt;group_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于zookeeper集群的指定，必须和broker使用同样的zk配置</span></span><br><span class="line">zookeeper.connect=debugo01:2182,debugo02:2182,debugo03:2182</span><br><span class="line"><span class="comment"># zookeeper的心跳超时时间，查过这个时间就认为是无效的消费者</span></span><br><span class="line">zookeeper.session.timeout.ms = 6000</span><br><span class="line"><span class="comment"># zookeeper的等待连接时间</span></span><br><span class="line">zookeeper.connection.timeout.ms = 6000</span><br><span class="line"><span class="comment"># zookeeper的follower同leader的同步时间</span></span><br><span class="line">zookeeper.sync.time.ms = 2000</span><br><span class="line"><span class="comment"># 当zookeeper中没有初始的offset时，或者超出offset上限时的处理方式 。</span></span><br><span class="line"><span class="comment"># smallest ：重置为最小值</span></span><br><span class="line"><span class="comment"># largest:重置为最大值</span></span><br><span class="line"><span class="comment"># anything else：抛出异常给consumer</span></span><br><span class="line">auto.offset.reset = largest</span><br><span class="line"></span><br><span class="line"><span class="comment"># socket的超时时间，实际的超时时间为max.fetch.wait + socket.timeout.ms.</span></span><br><span class="line">socket.timeout.ms= 30 * 1000</span><br><span class="line"><span class="comment"># socket的接收缓存空间大小</span></span><br><span class="line">socket.receive.buffer.bytes=64 * 1024</span><br><span class="line"><span class="comment">#从每个分区fetch的消息大小限制</span></span><br><span class="line">fetch.message.max.bytes = 1024 * 1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># true时，Consumer会在消费消息后将offset同步到zookeeper，这样当Consumer失败后，新的consumer就能从zookeeper获取最新的offset</span></span><br><span class="line">auto.commit.enable = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 自动提交的时间间隔</span></span><br><span class="line">auto.commit.interval.ms = 60 * 1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于消费的最大数量的消息块缓冲大小，每个块可以等同于fetch.message.max.bytes中数值</span></span><br><span class="line">queued.max.message.chunks = 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当有新的consumer加入到group时,将尝试reblance,将partitions的消费端迁移到新的consumer中, 该设置是尝试的次数</span></span><br><span class="line">rebalance.max.retries = 4</span><br><span class="line"><span class="comment"># 每次reblance的时间间隔</span></span><br><span class="line">rebalance.backoff.ms = 2000</span><br><span class="line"><span class="comment"># 每次重新选举leader的时间</span></span><br><span class="line">refresh.leader.backoff.ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># server发送到消费端的最小数据，若是不满足这个数值则会等待直到满足指定大小。默认为1表示立即接收。</span></span><br><span class="line">fetch.min.bytes = 1</span><br><span class="line"><span class="comment"># 若是不满足fetch.min.bytes时，等待消费端请求的最长等待时间</span></span><br><span class="line">fetch.wait.max.ms = 100</span><br><span class="line"><span class="comment"># 如果指定时间内没有新消息可用于消费，就抛出异常，默认-1表示不受限</span></span><br><span class="line">consumer.timeout.ms = -1</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################Producer#############################</span></span><br><span class="line"><span class="comment"># 核心的配置包括：</span></span><br><span class="line"><span class="comment"># metadata.broker.list</span></span><br><span class="line"><span class="comment"># request.required.acks</span></span><br><span class="line"><span class="comment"># producer.type</span></span><br><span class="line"><span class="comment"># serializer.class</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 消费者获取消息元信息(topics, partitions and replicas)的地址,配置格式是：host1:port1,host2:port2，也可以在外面设置一个vip</span></span><br><span class="line">metadata.broker.list</span><br><span class="line"></span><br><span class="line"><span class="comment">#消息的确认模式</span></span><br><span class="line"><span class="comment"># 0：不保证消息的到达确认，只管发送，低延迟但是会出现消息的丢失，在某个server失败的情况下，有点像TCP</span></span><br><span class="line"><span class="comment"># 1：发送消息，并会等待leader 收到确认后，一定的可靠性</span></span><br><span class="line"><span class="comment"># -1：发送消息，等待leader收到确认，并进行复制操作后，才返回，最高的可靠性</span></span><br><span class="line">request.required.acks = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消息发送的最长等待时间</span></span><br><span class="line">request.timeout.ms = 10000</span><br><span class="line"><span class="comment"># socket的缓存大小</span></span><br><span class="line">send.buffer.bytes=100*1024</span><br><span class="line"><span class="comment"># key的序列化方式，若是没有设置，同serializer.class</span></span><br><span class="line">key.serializer.class</span><br><span class="line"><span class="comment"># 分区的策略，默认是取模</span></span><br><span class="line">partitioner.class=kafka.producer.DefaultPartitioner</span><br><span class="line"><span class="comment"># 消息的压缩模式，默认是none，可以有gzip和snappy</span></span><br><span class="line">compression.codec = none</span><br><span class="line"><span class="comment"># 可以针对默写特定的topic进行压缩</span></span><br><span class="line">compressed.topics=null</span><br><span class="line"><span class="comment"># 消息发送失败后的重试次数</span></span><br><span class="line">message.send.max.retries = 3</span><br><span class="line"><span class="comment"># 每次失败后的间隔时间</span></span><br><span class="line">retry.backoff.ms = 100</span><br><span class="line"><span class="comment"># 生产者定时更新topic元信息的时间间隔 ，若是设置为0，那么会在每个消息发送后都去更新数据</span></span><br><span class="line">topic.metadata.refresh.interval.ms = 600 * 1000</span><br><span class="line"><span class="comment"># 用户随意指定，但是不能重复，主要用于跟踪记录消息</span></span><br><span class="line">client.id=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 异步模式下缓冲数据的最大时间。例如设置为100则会集合100ms内的消息后发送，这样会提高吞吐量，但是会增加消息发送的延时</span></span><br><span class="line">queue.buffering.max.ms = 5000</span><br><span class="line"><span class="comment"># 异步模式下缓冲的最大消息数，同上</span></span><br><span class="line">queue.buffering.max.messages = 10000</span><br><span class="line"><span class="comment"># 异步模式下，消息进入队列的等待时间。若是设置为0，则消息不等待，如果进入不了队列，则直接被抛弃</span></span><br><span class="line">queue.enqueue.timeout.ms = -1</span><br><span class="line"><span class="comment"># 异步模式下，每次发送的消息数，当queue.buffering.max.messages或queue.buffering.max.ms满足条件之一时producer会触发发送。</span></span><br><span class="line">batch.num.messages=200</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/08/kafka-broker-config/" data-id="cjavy9jy5004m0coqr5xug7i7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-add-topic-replicats" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/kafka-add-topic-replicats/" class="article-date">
  <time datetime="2017-03-07T17:16:32.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/kafka-add-topic-replicats/">kafka add topic replicats</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kafka修改topic的replicats数量-添加"><a href="#kafka修改topic的replicats数量-添加" class="headerlink" title="kafka修改topic的replicats数量(添加)"></a>kafka修改topic的replicats数量(添加)</h3><ol>
<li><p>修改前检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-1</span><br><span class="line">Topic:<span class="built_in">test</span>-1    PartitionCount:2        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 0    Leader: 4       Replicas: 4,3   Isr: 3,4</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 1    Leader: 3       Replicas: 3,4   Isr: 3,4</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写json文件,将partition的副本由2个扩大到4个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ cat increate_replica_partition.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"partitions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"topic"</span>: <span class="string">"test-1"</span>,</span><br><span class="line">      <span class="string">"partition"</span>: 0,</span><br><span class="line">      <span class="string">"replicas"</span>: [</span><br><span class="line">        1,</span><br><span class="line">        2,</span><br><span class="line">        3,</span><br><span class="line">        4</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"topic"</span>: <span class="string">"test-1"</span>,</span><br><span class="line">      <span class="string">"partition"</span>: 1,</span><br><span class="line">      <span class="string">"replicas"</span>: [</span><br><span class="line">        1,</span><br><span class="line">        2,</span><br><span class="line">        3,</span><br><span class="line">        4</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"version"</span>: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行副本集扩容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --reassignment-json-file ./increate_replica_partition.json --execute</span><br><span class="line">Current partition replica assignment</span><br><span class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[4,3]&#125;]&#125;</span><br><span class="line">Save this to use as the --reassignment-json-file option during rollback</span><br><span class="line">Successfully started reassignment of partitions.</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改后检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --reassignment-json-file ./increate_replica_partition.json --verify</span><br><span class="line">Status of partition reassignment:</span><br><span class="line">Reassignment of partition [<span class="built_in">test</span>-1,0] completed successfully</span><br><span class="line">Reassignment of partition [<span class="built_in">test</span>-1,1] completed successfully</span><br><span class="line"></span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-1</span><br><span class="line">Topic:<span class="built_in">test</span>-1    PartitionCount:2        ReplicationFactor:4     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 0    Leader: 4       Replicas: 1,2,3,4       Isr: 3,4,2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 1    Leader: 3       Replicas: 1,2,3,4       Isr: 3,4,2,1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="kafka修改topic的replicats数量-缩减"><a href="#kafka修改topic的replicats数量-缩减" class="headerlink" title="kafka修改topic的replicats数量(缩减)"></a>kafka修改topic的replicats数量(缩减)</h3><ol>
<li><p>缩容前检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-1</span><br><span class="line">Topic:<span class="built_in">test</span>-1    PartitionCount:2        ReplicationFactor:4     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 0    Leader: 1       Replicas: 1,2,3,4       Isr: 3,4,2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 1    Leader: 1       Replicas: 1,2,3,4       Isr: 3,4,2,1</span><br></pre></td></tr></table></figure>
</li>
<li><p>缩容json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ cat increate_replica_partition.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"partitions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"topic"</span>: <span class="string">"test-1"</span>,</span><br><span class="line">      <span class="string">"partition"</span>: 0,</span><br><span class="line">      <span class="string">"replicas"</span>: [</span><br><span class="line">        1,</span><br><span class="line">        2</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"topic"</span>: <span class="string">"test-1"</span>,</span><br><span class="line">      <span class="string">"partition"</span>: 1,</span><br><span class="line">      <span class="string">"replicas"</span>: [</span><br><span class="line">        1,</span><br><span class="line">        2</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"version"</span>: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --reassignment-json-file ./increate_replica_partition.json --execute</span><br><span class="line">Current partition replica assignment</span><br><span class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[1,2,3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[1,2,3,4]&#125;]&#125;</span><br><span class="line">Save this to use as the --reassignment-json-file option during rollback</span><br><span class="line">Successfully started reassignment of partitions.</span><br><span class="line"></span><br><span class="line">4. 缩减后检查</span><br><span class="line">```bash</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-1                                                      Topic:<span class="built_in">test</span>-1    PartitionCount:2        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 0    Leader: 1       Replicas: 1,2   Isr: 2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 1    Leader: 1       Replicas: 1,2   Isr: 2,1</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/08/kafka-add-topic-replicats/" data-id="cjavy9jy0004j0coqbkkp5vws" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-migrate-and-scale" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/kafka-migrate-and-scale/" class="article-date">
  <time datetime="2017-03-07T17:06:03.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/kafka-migrate-and-scale/">kafka migrate and scale</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="迁移和扩容"><a href="#迁移和扩容" class="headerlink" title="迁移和扩容"></a>迁移和扩容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">迁移和扩容需要满足两点:</span><br><span class="line">1.将指定topic迁移到集群内新增的node上</span><br><span class="line">2.将topic指定的partition迁移到新增的node上</span><br></pre></td></tr></table></figure>
<ol>
<li><p>测试数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --create --replication-factor 2 --partitions 2 --topic <span class="built_in">test</span>-1</span><br><span class="line">Created topic <span class="string">"test-1"</span>.</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --create --replication-factor 2 --partitions 2 --topic <span class="built_in">test</span>-2</span><br><span class="line">Created topic <span class="string">"test-2"</span>.</span><br><span class="line"></span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --list</span><br><span class="line"><span class="built_in">test</span>-1</span><br><span class="line"><span class="built_in">test</span>-2</span><br><span class="line"></span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-1</span><br><span class="line">Topic:<span class="built_in">test</span>-1    PartitionCount:2        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 0    Leader: 2       Replicas: 2,1   Isr: 2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 1    Leader: 1       Replicas: 1,2   Isr: 1,2</span><br><span class="line"></span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-2</span><br><span class="line">Topic:<span class="built_in">test</span>-2    PartitionCount:2        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 0    Leader: 2       Replicas: 2,1   Isr: 2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 1    Leader: 1       Replicas: 1,2   Isr: 1,2</span><br><span class="line"></span><br><span class="line">通过上面我们看到,我们创建了2个topic,它们存放在1和2两个broker上,此时我们添加第三个broker,并将<span class="built_in">test</span>-1 topic迁移到3和4broker上</span><br></pre></td></tr></table></figure>
</li>
<li><p>准备迁移json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//创建migration-test-topic.json文件,并写入要迁移都topic</span><br><span class="line">penn@ubuntu:~$ cat migration-test-topic.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"topics"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"topic"</span>: <span class="string">"test-1"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"version"</span>: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据json文件生成迁移JSON语句</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//根据上面的migration-test-topic.json文件生成迁移JSON语句</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --topics-to-move-json-file ./migration-test-topic.json --broker-list <span class="string">"3,4"</span> --generate</span><br><span class="line">Current partition replica assignment</span><br><span class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[2,1]&#125;]&#125;</span><br><span class="line">Proposed partition reassignment configuration</span><br><span class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[4,3]&#125;]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//将JSON保存到文件</span><br><span class="line">penn@ubuntu:~$ cat move-to-new-broker.json //将下面都json写入到新文件中</span><br><span class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[4,3]&#125;]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//补充:一个错误</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --topics-to-move-json-file ./migration-test-topic.json --broker-list <span class="string">"3"</span> --generate</span><br><span class="line">Partitions reassignment failed due to replication factor: 2 larger than available brokers: 1</span><br><span class="line">org.apache.kafka.common.errors.InvalidReplicationFactorException: replication factor: 2 larger than available brokers: 1</span><br><span class="line">报错原因: 是因为要迁移都topic有两个replica,所以在添加新的broker的个数最好是replica指定数的倍数</span><br></pre></td></tr></table></figure>
</li>
<li><p>对topic进行迁移</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//迁移前检查</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --reassignment-json-file ./move-to-new-broker.json --verify</span><br><span class="line">Status of partition reassignment:</span><br><span class="line">ERROR: Assigned replicas (1,2) don<span class="string">'t match the list of replicas for reassignment (3,4) for partition [test-1,1]</span></span><br><span class="line"><span class="string">ERROR: Assigned replicas (2,1) don'</span>t match the list of replicas <span class="keyword">for</span> reassignment (4,3) <span class="keyword">for</span> partition [<span class="built_in">test</span>-1,0]</span><br><span class="line">Reassignment of partition [<span class="built_in">test</span>-1,1] failed</span><br><span class="line">Reassignment of partition [<span class="built_in">test</span>-1,0] failed</span><br><span class="line"></span><br><span class="line">//迁移</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --reassignment-json-file ./move-to-new-broker.json --execute</span><br><span class="line">Current partition replica assignment</span><br><span class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"test-1"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[2,1]&#125;]&#125;</span><br><span class="line">Save this to use as the --reassignment-json-file option during rollback</span><br><span class="line">Successfully started reassignment of partitions.</span><br><span class="line"></span><br><span class="line">//迁移后检查</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-reassign-partitions.sh --zookeeper 10.0.2.15:2181/kafka --reassignment-json-file ./move-to-new-broker.json --verify</span><br><span class="line">Status of partition reassignment:</span><br><span class="line">Reassignment of partition [<span class="built_in">test</span>-1,1] completed successfully</span><br><span class="line">Reassignment of partition [<span class="built_in">test</span>-1,0] completed successfully</span><br><span class="line"></span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-1</span><br><span class="line">Topic:<span class="built_in">test</span>-1    PartitionCount:2        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 0    Leader: 4       Replicas: 4,3   Isr: 3,4</span><br><span class="line">        Topic: <span class="built_in">test</span>-1   Partition: 1    Leader: 3       Replicas: 3,4   Isr: 3,4</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/08/kafka-migrate-and-scale/" data-id="cjavy9jyd004s0coqzoaedxs8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-add-topic-partitions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/kafka-add-topic-partitions/" class="article-date">
  <time datetime="2017-03-07T17:02:24.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/kafka-add-topic-partitions/">kafka add topic partitions</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kafka-修改topic的partition数量"><a href="#kafka-修改topic的partition数量" class="headerlink" title="kafka 修改topic的partition数量"></a>kafka 修改topic的partition数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//修改前检查</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-2</span><br><span class="line">Topic:<span class="built_in">test</span>-2    PartitionCount:2        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 0    Leader: 2       Replicas: 2,1   Isr: 2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 1    Leader: 1       Replicas: 1,2   Isr: 1,2</span><br><span class="line"></span><br><span class="line">//增加topic的partition</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --alter --topic <span class="built_in">test</span>-2 --partitions 3</span><br><span class="line">WARNING: If partitions are increased <span class="keyword">for</span> a topic that has a key, the partition logic or ordering of the messages will be affected</span><br><span class="line">Adding partitions succeeded!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//修改后检查</span><br><span class="line">penn@ubuntu:~$ /mnt/app/kafka.1/bin/kafka-topics.sh --zookeeper 10.0.2.15:2181/kafka --describe --topic <span class="built_in">test</span>-2</span><br><span class="line">Topic:<span class="built_in">test</span>-2    PartitionCount:3        ReplicationFactor:2     Configs:</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 0    Leader: 2       Replicas: 2,1   Isr: 2,1</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 1    Leader: 1       Replicas: 1,2   Isr: 1,2</span><br><span class="line">        Topic: <span class="built_in">test</span>-2   Partition: 2    Leader: 4       Replicas: 4,2   Isr: 4,2</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/08/kafka-add-topic-partitions/" data-id="cjavy9jxz004i0coq4hc0s65i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-use" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/kafka-use/" class="article-date">
  <time datetime="2017-03-07T16:54:29.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/kafka-use/">kafka use</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kafka-常用命令"><a href="#kafka-常用命令" class="headerlink" title="kafka 常用命令"></a>kafka 常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//查看topic</span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --list</span><br><span class="line"></span><br><span class="line">//创建3个副本的topic</span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --create --replication-factor 3 --partitions 1 --topic my-replicated-topic</span><br><span class="line"></span><br><span class="line">//查看topic状态</span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --describe --topic my-replicated-topic</span><br><span class="line"></span><br><span class="line">//删除topic</span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic my-replicated-topic</span><br><span class="line"></span><br><span class="line">//发送数据</span><br><span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic my-replicated-topic</span><br><span class="line"></span><br><span class="line">//消费数据</span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic my-replicated-topic --from-beginning</span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//查看当前消费者是否已经读到最新的数据</span><br><span class="line">[wisdom@10 ~]$ /mnt/app/kafka/bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --group Booking --zookeeper 10.0.3.65:2181 --topic Booking</span><br><span class="line">[2017-03-17 14:35:48,094] WARN WARNING: ConsumerOffsetChecker is deprecated and will be dropped <span class="keyword">in</span> releases following 0.9.0. Use ConsumerGroupCommand instead. (kafka.tools.ConsumerOffsetChecker$)</span><br><span class="line">  Group           Topic                          Pid Offset          logSize         Lag             Owner</span><br><span class="line">  Booking         Booking                        0   101             166             65              Booking_470_636253289830976972-0</span><br><span class="line">  Booking         Booking                        1   97              167             70             </span><br><span class="line">  Booking_470_636253289830976972-0</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/08/kafka-use/" data-id="cjavy9jym004x0coqwql842no" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-kafka-info" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/08/kafka-info/" class="article-date">
  <time datetime="2017-03-07T16:35:45.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/08/kafka-info/">kafka info</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kafka-关键词"><a href="#kafka-关键词" class="headerlink" title="kafka 关键词"></a>kafka 关键词</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Kafka部分名词解释如下:</span><br><span class="line">1.Broker</span><br><span class="line">  消息中间件处理结点,一个Kafka节点就是一个broker,多个broker可以组成一个Kafka集群</span><br><span class="line">2.Topic</span><br><span class="line">  一类消息,例如page view日志,click日志等都可以以topic的形式存在,Kafka集群能够同时负责多个topic的分发</span><br><span class="line">3.Partition</span><br><span class="line">  topic物理上的分组,一个topic可以分为多个partition,每个partition是一个有序的队列</span><br><span class="line">4.Segment</span><br><span class="line">  partition物理上由多个segment组成</span><br><span class="line">5.offset</span><br><span class="line">  每个partition都由一系列有序的,不可变的消息组成,这些消息被连续的追加到partition中.partition中的每个消息都有一个连续的序列号叫做offset,用于partition唯一标识一条消息.</span><br><span class="line"></span><br><span class="line">分析过程分为以下4个步骤:</span><br><span class="line">1.topic中partition存储分布</span><br><span class="line">2.partiton中文件存储方式</span><br><span class="line">3.partiton中segment文件存储结构</span><br><span class="line">4.在partition中如何通过offset查找message</span><br></pre></td></tr></table></figure>
<h3 id="kafka副本分配算法"><a href="#kafka副本分配算法" class="headerlink" title="kafka副本分配算法"></a>kafka副本分配算法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">副本分配算法如下:（mod表示余数,例如: 3 mod 2 = 1）</span><br><span class="line">1.将所有N Broker和待分配的i个Partition排序.</span><br><span class="line">2.将第i个Partition分配到第(i mod n)个Broker上.</span><br><span class="line">3.将第i个Partition的第j个副本分配到第((i + j) mod n)个Broker上.</span><br></pre></td></tr></table></figure>
<h3 id="kafka存储过程"><a href="#kafka存储过程" class="headerlink" title="kafka存储过程"></a>kafka存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Kafka运行时很少有大量读磁盘的操作,主要是定期批量写磁盘操作,因此操作磁盘很高效.这跟Kafka文件存储中读写message的设计是息息相关的.Kafka中读写message有如下特点:</span><br><span class="line">写message:</span><br><span class="line">1.消息从java堆转入page cache(即物理内存)</span><br><span class="line">2.由异步线程刷盘,消息从page cache刷入磁盘</span><br><span class="line"></span><br><span class="line">读message:</span><br><span class="line">1.消息直接从page cache转入socket发送出去</span><br><span class="line">2.当从page cache没有找到相应数据时,此时会产生磁盘IO,从磁盘Load消息到page cache,然后直接从socket发出去</span><br></pre></td></tr></table></figure>
<h3 id="kafka-Partition-Recovery机制"><a href="#kafka-Partition-Recovery机制" class="headerlink" title="kafka Partition Recovery机制"></a>kafka Partition Recovery机制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">每个Partition会在磁盘记录一个RecoveryPoint, 记录已经flush到磁盘的最大offset。当broker fail 重启时,会进行loadLogs。 首先会读取该Partition的RecoveryPoint,找到包含RecoveryPoint的segment及以后的segment, 这些segment就是可能没有 完全flush到磁盘segments。然后调用segment的recover,重新读取各个segment的msg,并重建索引</span><br><span class="line"></span><br><span class="line">优点</span><br><span class="line">1.以segment为单位管理Partition数据,方便数据生命周期的管理,删除过期数据简单</span><br><span class="line">2.在程序崩溃重启时,加快recovery速度,只需恢复未完全flush到磁盘的segment</span><br><span class="line">3.通过index中offset与物理偏移映射,用二分查找能快速定位msg,并且通过分多个Segment,每个index文件很小,查找速度更快。</span><br></pre></td></tr></table></figure>
<h3 id="kafka-Partition-Replica同步机制"><a href="#kafka-Partition-Replica同步机制" class="headerlink" title="kafka Partition Replica同步机制"></a>kafka Partition Replica同步机制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.Partition的多个replica中一个为Leader,其余为follower</span><br><span class="line">2.Producer只与Leader交互,把数据写入到Leader中</span><br><span class="line">3.Followers从Leader中拉取数据进行数据同步</span><br><span class="line">4.Consumer只从Leader拉取数据</span><br><span class="line"></span><br><span class="line">ISR:所有不落后的replica集合,不落后有两层含义:距离上次FetchRequest的时间不大于某一个值或落后的消息数不大于某一个值, Leader失败后会从ISR中选取一个Follower做Leader</span><br></pre></td></tr></table></figure>
<h3 id="数据可靠性保证"><a href="#数据可靠性保证" class="headerlink" title="数据可靠性保证"></a>数据可靠性保证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">当Producer向Leader发送数据时,可以通过acks参数设置数据可靠性的级别</span><br><span class="line">1.0: 不论写入是否成功,server不需要给Producer发送Response,如果发生异常,server会终止连接,触发Producer更新meta数据;</span><br><span class="line">2.1: Leader写入成功后即发送Response,此种情况如果Leader fail,会丢失数据</span><br><span class="line">3.-1: 等待所有ISR接收到消息后再给Producer发送Response,这是最强保证</span><br><span class="line">      仅设置acks=-1也不能保证数据不丢失,当Isr列表中只有Leader时,同样有可能造成数据丢失.要保证数据不丢除了设置acks=-1, 还要保证ISR的大小大于等于2,具体参数设置:</span><br><span class="line">      1.request.required.acks:设置为-1等待所有ISR列表中的Replica接收到消息后采算写成功;</span><br><span class="line">      2.min.insync.replicas: 设置为大于等于2,保证ISR中至少有两个Replica</span><br><span class="line">      Producer要在吞吐率和数据可靠性之间做一个权衡</span><br></pre></td></tr></table></figure>
<h3 id="数据一致性保证"><a href="#数据一致性保证" class="headerlink" title="数据一致性保证"></a>数据一致性保证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">一致性定义:若某条消息对Consumer可见,那么即使Leader宕机了,在新Leader上数据依然可以被读到</span><br><span class="line">1.HighWaterMark简称HW:</span><br><span class="line">  Partition的高水位,取一个partition对应的ISR中最小的LEO作为HW,消费者最多只能消费到HW所在的位置,另外每个replica都有highWatermark,leader和follower各自负责更新自己的highWatermark状态,highWatermark &lt;= leader.LogEndOffset</span><br><span class="line">2.对于Leader新写入的msg,Consumer不能立刻消费,Leader会等待该消息被所有ISR中的replica同步后,更新HW,此时该消息才能被Consumer消费,即Consumer最多只能消费到HW位置</span><br><span class="line"></span><br><span class="line">这样就保证了如果Leader Broker失效,该消息仍然可以从新选举的Leader中获取.对于来自内部Broker的读取请求,没有HW的限制.同时,Follower也会维护一份自己的HW,Folloer.HW = min(Leader.HW,Follower.offset)</span><br></pre></td></tr></table></figure>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/08/kafka-info/" data-id="cjavy9jy7004o0coqpqjq4buk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/21/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/23/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/">AliCloud</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/">SDK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/Python-SDK/">Python SDK</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/">Android install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/Android-studio-install/">Android studio install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/">Doc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP-严格传输安全HSTS/">HTTP 严格传输安全HSTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP协议/">HTTP协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP-协议详解/">TCP 协议详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP与socket区别/">TCP与socket区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件描述符与打开文件之间的关系/">linux 文件描述符与打开文件之间的关系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件系统inode/">linux 文件系统inode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/一次完整的HTTP请求/">一次完整的HTTP请求</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/">Disk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-io-performance/">disk io performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-iostat/">disk iostat</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/">Distributed storage</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/">GlusterFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-architecture/">GlusterFS architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-info/">GlusterFS info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-install/">GlusterFS install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-workflow/">GlusterFS workflow</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/">DRBD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/">keepalived</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/">Intellij</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/Intellij-setting/">Intellij setting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/">vim</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-shortcut-key/">vim shortcut key</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-vimrc/">vim vimrc</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/">Kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/">kernel memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/kernel-共享内存/">kernel 共享内存</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/">ganglia</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/ganglia-install/">ganglia install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/">hmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/">htmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/">smokeping</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/">zabbix</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/">monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-cpu/">zabbix monitor cpu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-mem/">zabbix monitor mem</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-auto-discover/">zabbix auto discover</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-grafana-install/">zabbix grafana install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install/">zabbix install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-item-and-tigger/">zabbix item and tigger</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-java-gateway/">zabbix java gateway</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-modify-login-user-passwd/">zabbix modify login user passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-proxy-install/">zabbix proxy install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-server-support-chinese/">zabbix server support chinese</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-windows-agent/">zabbix windows agent</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/树莓派-GSM-语音短信报警/">树莓派 GSM 语音短信报警</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/">监控</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/监控知识体系/">监控知识体系</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/">Python Framework</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django/">Python Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django-setting/">Python Django setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/">Python Learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-内存管理/">python 内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-函数编程/">python 函数编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-变量/">python 变量</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象使用/">python 对象使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象的属性/">python 对象的属性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象编程/">python 对象编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-数据类型/">python 数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-流程控制/">python 流程控制</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-爬虫/">python 爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊方法/">python 特殊方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊说明/">python 特殊说明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-装饰器/">python 装饰器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-过程编程/">python 过程编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-进阶/">python 进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-闭包/">python 闭包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/">Python install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-error-info/">python error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-source-image/">python pip source image</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-use/">python pip use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pyenv-install/">python pyenv install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-setup-py/">python setup.py</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-source-install/">python source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-virtualenv/">python virtualenv</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/">Python library</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/MySQLdb/">MySQLdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/memory-profiler/">memory_profiler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/">Python modules</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-path/">python modules path</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-pylint-and-ipython/">python modules pylint and ipython</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/">Python other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/python-import-and-reload/">python import and reload</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/">Ruby install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP.IP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-状态/">TCP 状态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-IP模型/">TCP/IP模型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/Wireshark-use/">Wireshark use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/">WeChat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/">WeChat enterprise</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/WeChat-enterprise-API/">WeChat enterprise API</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/">automation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/">git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-command/">git command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-error/">git error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitlab/">git gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitolite/">git gitolite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs/">git gogs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs-source-install/">git gogs source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-init/">git init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-workflow/">git workflow</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/">jenkins</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-info/">jenkins info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-install/">jenkins install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/">kvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/kvm-install/">kvm install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/">maven</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/maven-install/">maven install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/">nexus</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-install/">nexus install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-proxy-maven/">nexus proxy maven</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/">rpm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/">salt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-info/">salt info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install/">salt install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-HA/">salt install HA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-standard/">salt install standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-jinja2-grain-pillar-module/">salt jinja2 grain pillar module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-event-reactor/">salt manage event reactor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-grains/">salt manage grains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-job/">salt manage job</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-module/">salt manage module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-pillar/">salt manage pillar</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-return/">salt manage return</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-states/">salt manage states</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-target/">salt manage target</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-syndic-install/">salt master syndic install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-conf/">salt master.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-minion-conf/">salt minion.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-raet/">salt raet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-state-module/">salt state module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-syndic-conf/">salt syndic.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-write-module-code/">salt write module code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/">svn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-auto-update/">svn auto update</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/">yum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/yum-server-install/">yum server install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/">Mongo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-auth/">mongo auth</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-error/">mongo error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-auth-install/">mongo replication auth install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-standard-install/">mongo replication standard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-standard-install/">mongo standard install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/">Mysql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-command/">mysql command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-error-info/">mysql error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-explain/">mysql explain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-grant/">mysql grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-index-options/">mysql index options</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave/">mysql master slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave-switch/">mysql master slave switch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-partition/">mysql partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-select-join/">mysql select join</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-slow-log/">mysql slow log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-standard/">mysql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-table-size/">mysql table size</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/">Postgresql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-book-use/">postgresql book use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave-info/">postgresql master slave info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave/">postgresql master/slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-plugin-install/">postgresql plugin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-standard/">postgresql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-tablespace-database-schema-table-user-role-relation/">postgresql tablespace database schema table user role relation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-yum-install/">postgresql yum install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-常用命令/">postgresql 常用命令</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库对象/">postgresql 数据库对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库管理/">postgresql 数据库管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/">Redis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-error/">redis error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-install/">redis install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-redis-trib-rb/">redis redis-trib.rb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-status/">redis status</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-use/">redis use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/">influxDB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang/go-env/">go env</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-high-availability/">RabbitMQ high availability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-install/">RabbitMQ install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-working-principle/">RabbitMQ working principle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/">beats</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/beats-install/">beats install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/">datax</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-info/">datax info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-install/">datax install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-job/">datax job</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-command/">elasticsearch command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-core-component/">elasticsearch core component</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-cluster/">elasticsearch exploring your cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-data/">elasticsearch exploring your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-four-search-type/">elasticsearch four search type</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-full-cluster-restart-upgrade/">elasticsearch full cluster restart upgrade</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-install/">elasticsearch install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-modifying-your-data/">elasticsearch modifying your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-rolling-upgrades/">elasticsearch rolling upgrades</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-safe-restart/">elasticsearch safe restart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-shard/">elasticsearch shard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-indexing-speed/">how to tune for indexing speed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-search-speed/">how to tune for search speed</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/">flume</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-info/">flume info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-install/">flume install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/">grafana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/grafana-install/">grafana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/hadoop-简介/">hadoop 简介</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/">kafka</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-install/">kafka install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-manage-web/">kafka manage web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-offset-monitor/">kafka offset monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-optimize/">kafka optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-web-console/">kafka web console</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/">kibana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/kibana-install/">kibana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/">logstash</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-config-file/">logstash config file</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-filter-grok/">logstash filter grok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-info/">logstash info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-install/">logstash install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/">mycat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-web-install/">mycat web install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/">nsq</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-command/">nsq command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-info/">nsq info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-install/">nsq install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/">zookeeper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-install/">zookeeper install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-monitor/">zookeeper monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-optimize/">zookeeper optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-use/">zookeeper use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-zab-protocol/">zookeeper zab protocol</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-env/">java env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-optimize/">java jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-opts/">java jvm opts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/">java learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/java-学习笔记/">java 学习笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-log4j/">java log4j</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/">java performance analysis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/jps/">jps</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-dashboard-install/">k8s dashboard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-install/">k8s install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-registry-install/">k8s registry install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/node-install/">node install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/other/ACID/">ACID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/分布式二阶段和三阶段提交协议/">分布式二阶段和三阶段提交协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/开源许可协议/">开源许可协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/网络带宽/">网络带宽</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/">system service</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/">Atlassian</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-https/">confluence https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-install/">confluence install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-reset-passwd/">confluence reset passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-update/">confluence update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-https/">jira https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-install/">jira install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-update/">jira update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/mariadb-install/">mariadb install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/Base-env/">Base env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-common-use-scripts/">linux common use scripts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-history-info-setting/">linux history info setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-login-info/">linux login info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-nginx-install/">linux nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-skill/">linux skill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-system-init/">linux system init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-内存插槽-内存信息/">linux 内存插槽 内存信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-扩容swap分区/">linux 扩容swap分区</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-物理CPU-CPU核数-逻辑CPU/">linux 物理CPU CPU核数 逻辑CPU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-磁盘系统block区别/">linux 磁盘系统block区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-设置-包含头文件路径-和-动态库链接路径/">linux 设置 包含头文件路径 和 动态库链接路径</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/">NFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/">Samba</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-conf/">samba conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-install/">samba install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/">command</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/grep/">grep</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/pigz/">pigz</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/sed/">sed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/split/">split</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/tr/">tr</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/">haproxy</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/haproxy-install/">haproxy install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-install/">nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-location/">nginx location</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-rewrite/">nginx rewrite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-status/">nginx status</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/">ntpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/ntpd-install/">ntpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/">openssl</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/openssl-certificate/">openssl certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/">openvpn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/openvpn-install/">openvpn install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/">rsync</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/rsync-install/">rsync install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/">supersord</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/supersord-install/">supersord install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/">vsftpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-error/">vsftpd error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-info/">vsftpd info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-install/">vsftpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/">windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/cygwin-install/">cygwin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/ipsec-set/">ipsec set</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/windows-modify-hosts/">windows modify hosts</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/">SSL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/">angular</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/angular-install/">angular install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/hexo-install/">hexo install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/">sass</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/sass-install/">sass install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/">xml</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/xml-format/">xml format</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/hello-everyone/">Hello Everyone</a>
          </li>
        
          <li>
            <a href="/2017/11/28/kafka-web-console/">kafka web console</a>
          </li>
        
          <li>
            <a href="/2017/11/27/svn-auto-update/">svn auto update</a>
          </li>
        
          <li>
            <a href="/2017/11/15/salt-manage-event-reactor/">salt manage event reactor</a>
          </li>
        
          <li>
            <a href="/2017/11/15/salt-manage-job/">salt manage job</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 penn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>