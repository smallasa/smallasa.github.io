<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>smallasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="smallasa">
<meta property="og:url" content="http://www.smallasa.com/page/7/index.html">
<meta property="og:site_name" content="smallasa">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="smallasa">
  
    <link rel="alternate" href="/atom.xml" title="smallasa" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">smallasa</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I known what i do !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.smallasa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-python-上下文管理器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/15/python-上下文管理器/" class="article-date">
  <time datetime="2017-08-15T01:42:47.000Z" itemprop="datePublished">2017-08-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>►<a class="article-category-link" href="/categories/Python/Python-Learn/">Python Learn</a>►<a class="article-category-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/15/python-上下文管理器/">python 上下文管理器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="python上下文管理器"><a href="#python上下文管理器" class="headerlink" title="python上下文管理器"></a>python上下文管理器</h3><ol>
<li><p>简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 规定对象的使用范围,超越范围则&quot;采取处理&quot;</span><br><span class="line">  格式:  with...as.. 代码块</span><br><span class="line">* 任何定义了&quot;__enter__()&quot;和&quot;__exit__()&quot;方法的对象都可以用于上下文管理器</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">//普通文件打开方式</span><br><span class="line">[root@dev <span class="built_in">test</span>]<span class="comment"># cat 1.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">f = open(<span class="string">'new.text'</span>,<span class="string">'w'</span>)</span><br><span class="line"><span class="built_in">print</span>(f.closed)</span><br><span class="line">f.write(<span class="string">'Hello,world!'</span>)</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>(f.closed)</span><br><span class="line"></span><br><span class="line">[root@dev <span class="built_in">test</span>]<span class="comment"># python 1.py</span></span><br><span class="line">False</span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">//使用上下文管理器打开文件</span><br><span class="line">[root@dev <span class="built_in">test</span>]<span class="comment"># cat 2.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">with open(<span class="string">'new.txt'</span>,<span class="string">'w'</span>) as f:</span><br><span class="line">    <span class="built_in">print</span>(f.closed)</span><br><span class="line">    f.write(<span class="string">'haha'</span>)</span><br><span class="line"><span class="built_in">print</span>(f.closed)</span><br><span class="line"></span><br><span class="line">[root@dev <span class="built_in">test</span>]<span class="comment"># python 2.py</span></span><br><span class="line">False</span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">//自定义上下文管理器</span><br><span class="line">[root@dev <span class="built_in">test</span>]<span class="comment"># cat 3.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">class Vow(object):</span><br><span class="line">    def __init__(self,text):</span><br><span class="line">        self.text = text</span><br><span class="line"></span><br><span class="line">    def __enter__(self):</span><br><span class="line">        self.text = <span class="string">"enter : "</span> + self.text</span><br><span class="line">        <span class="built_in">return</span> self   <span class="comment"># 注意,这里返回的是 对象!!!</span></span><br><span class="line"></span><br><span class="line">    def __exit__(self,exc_type,exc_value,traceback):</span><br><span class="line">        self.text = self.text + <span class="string">' now __exit__ !'</span></span><br><span class="line"></span><br><span class="line">with Vow(<span class="string">'hello'</span>) as myvow:</span><br><span class="line">    <span class="built_in">print</span>(myvow.text)  <span class="comment"># 此时进入的是__enter__()</span></span><br><span class="line"><span class="built_in">print</span>(myvow.text)  <span class="comment"># 此时进入的是__exit__()</span></span><br><span class="line"></span><br><span class="line">[root@dev <span class="built_in">test</span>]<span class="comment"># python 3.py</span></span><br><span class="line">enter : hello</span><br><span class="line">enter : hello now __exit__ !</span><br></pre></td></tr></table></figure>
</li>
<li><p>上下文管理器理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">with EXPR as VAR:</span><br><span class="line">相当于:</span><br><span class="line">VAR = EXPR</span><br><span class="line">VAR = VAR.__enter__()</span><br><span class="line">try:</span><br><span class="line">    BLOCK</span><br><span class="line">finally:</span><br><span class="line">    VAR.__exit__()</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/15/python-上下文管理器/" data-id="cjazexzjt008mqcoqncwqk5u4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-library-time-datetime-calendar" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/14/python-library-time-datetime-calendar/" class="article-date">
  <time datetime="2017-08-14T08:37:38.000Z" itemprop="datePublished">2017-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>►<a class="article-category-link" href="/categories/Python/Python-library/">Python library</a>►<a class="article-category-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/14/python-library-time-datetime-calendar/">python library time datetime calendar</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="python-library-time-datetime-calendar"><a href="#python-library-time-datetime-calendar" class="headerlink" title="python library time datetime calendar"></a>python library time datetime calendar</h3><ol>
<li><p>时间模块简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Python处理时间和日期方面的模块,主要有: time,datetime和calendar 三个模块</span><br></pre></td></tr></table></figure>
</li>
<li><p>time模块<br><img src="python-library-time-datetime-calendar/time.module.jpg" alt="time module"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import time       <span class="comment">#导入模块</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t = time.time()   <span class="comment">#获取当前时间戳</span></span><br><span class="line">&gt;&gt;&gt; t</span><br><span class="line">1502700231.32274</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t_tuple = time.localtime(t)  <span class="comment">#由时间戳转换为时间元组</span></span><br><span class="line">&gt;&gt;&gt; t_tuple</span><br><span class="line">time.struct_time(tm_year=2017, tm_mon=8, tm_mday=14, tm_hour=16, tm_min=43, tm_sec=51, tm_wday=0, tm_yday=226, tm_isdst=0)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t_people = time.ctime(t)    <span class="comment">#由时间戳转换为"友好显示"</span></span><br><span class="line">&gt;&gt;&gt; t_people</span><br><span class="line"><span class="string">'Mon Aug 14 16:43:51 2017'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t = time.mktime(t_tuple)   <span class="comment">#由时间元组转换为时间戳</span></span><br><span class="line">&gt;&gt;&gt; t</span><br><span class="line">1502700231.0</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t_people = time.asctime(t_tuple)  <span class="comment">#由时间元组转换为"友好显示"</span></span><br><span class="line">&gt;&gt;&gt; t_people</span><br><span class="line"><span class="string">'Mon Aug 14 16:43:51 2017'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t_1 = time.strftime(<span class="string">'%Y-%m-%d %X'</span>,t_tuple)  <span class="comment">#由时间元组转换为自定义显示格式</span></span><br><span class="line">&gt;&gt;&gt; t_1</span><br><span class="line"><span class="string">'2017-08-14 16:43:51'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t_2 = time.strptime(t_1,<span class="string">'%Y-%m-%d %X'</span>)   <span class="comment">#由自定义时间转换为时间元组显示</span></span><br><span class="line">&gt;&gt;&gt; t_2</span><br><span class="line">time.struct_time(tm_year=2017, tm_mon=8, tm_mday=14, tm_hour=16, tm_min=43, tm_sec=51, tm_wday=0, tm_yday=226, tm_isdst=-1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>datetime模块<br><img src="python-library-time-datetime-calendar/datetime.module.jpg" alt="datetime module"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import datetime     <span class="comment">#导入datetime模块</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt = datetime.datetime.now()   <span class="comment">#获取当前时间</span></span><br><span class="line">&gt;&gt;&gt; dt</span><br><span class="line">datetime.datetime(2017, 8, 14, 16, 59, 56, 358531)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.year     <span class="comment">#获取当前年份</span></span><br><span class="line">2017</span><br><span class="line">&gt;&gt;&gt; dt.month    <span class="comment">#获取当前月份</span></span><br><span class="line">8</span><br><span class="line">&gt;&gt;&gt; dt.day      <span class="comment">#获取当前月第几天</span></span><br><span class="line">14</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.date()   <span class="comment">#获取年月日</span></span><br><span class="line">datetime.date(2017, 8, 14)</span><br><span class="line">&gt;&gt;&gt; dt.time()   <span class="comment">#获取时间</span></span><br><span class="line">datetime.time(16, 59, 56, 358531)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.weekday()     <span class="comment">#获取今天是周几,默认周一为0</span></span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt; dt.isoweekday()  <span class="comment">#获取今天是周几,默认周一为1</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.isocalendar()  <span class="comment">#获取日历,年,一年中第几周,周几</span></span><br><span class="line">(2017, 33, 1)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.toordinal()      <span class="comment">#计算到公元元年过了多少天</span></span><br><span class="line">736555</span><br><span class="line">&gt;&gt;&gt; dt.fromordinal(54)  <span class="comment">#以元年为起点,获取指定某天的时间</span></span><br><span class="line">datetime.datetime(1, 2, 23, 0, 0)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.today()    <span class="comment">#获取当前时间</span></span><br><span class="line">datetime.datetime(2017, 8, 14, 17, 6, 29, 46188)</span><br><span class="line">&gt;&gt;&gt; dt.utcnow()   <span class="comment">#获取utc当前时间</span></span><br><span class="line">datetime.datetime(2017, 8, 14, 9, 6, 49, 240196)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.isoformat()  <span class="comment">#获取时间字符串</span></span><br><span class="line"><span class="string">'2017-08-14T16:59:56.358531'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.ctime()      <span class="comment">#将时间转换为友好显示</span></span><br><span class="line"><span class="string">'Mon Aug 14 17:16:49 2017'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.strftime(<span class="string">'%Y-%m-%d %X'</span>)  <span class="comment">#转换为指定格式</span></span><br><span class="line"><span class="string">'2017-08-14 17:16:49'</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; dt.strptime(<span class="string">'2017-08-14 17:16:49'</span>,<span class="string">'%Y-%m-%d %X'</span>)  <span class="comment">#指定格式转换为datetime格式</span></span><br><span class="line">datetime.datetime(2017, 8, 14, 17, 16, 49)</span><br></pre></td></tr></table></figure>
</li>
<li><p>calendar模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import calendar   <span class="comment">#导入模块</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; calendar.isleap(2017)  <span class="comment">#判断是否是闰年</span></span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; calendar.isleap(2020)</span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; calendar.leapdays(1990,2020)  <span class="comment">#返回闰年在1990-2020之间出现的次数</span></span><br><span class="line">7</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/14/python-library-time-datetime-calendar/" data-id="cjazexzjd0087qcoqf4swjw6r" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-zabbix-install-distributed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/10/zabbix-install-distributed/" class="article-date">
  <time datetime="2017-08-10T08:20:02.000Z" itemprop="datePublished">2017-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Monitor/">Monitor</a>►<a class="article-category-link" href="/categories/Monitor/zabbix/">zabbix</a>►<a class="article-category-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/10/zabbix-install-distributed/">zabbix install distributed</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="zabbix-install-distributed"><a href="#zabbix-install-distributed" class="headerlink" title="zabbix install distributed"></a>zabbix install distributed</h3><ol>
<li><p>基础环境安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">//系统信息</span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/redhat-release</span></span><br><span class="line">CentOS Linux release 7.0.1406 (Core)</span><br><span class="line"></span><br><span class="line">//修改主机名</span><br><span class="line">zabbix-server-company:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname zabbix-server-company &amp;&amp; echo zabbix-server-company | tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@zabbix-server-company ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">zabbix-server-mysql:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname zabbix-server-mysql &amp;&amp; echo zabbix-server-mysql | tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@zabbix-server-mysql ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">//格式化磁盘(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkfs.xfs /dev/vdb</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo '/dev/vdb /mnt xfs defaults 0 0' | tee -a /etc/fstab</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># mount -a</span></span><br><span class="line"></span><br><span class="line">//修改最大文件数(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo '* - nproc  65535' | tee -a /etc/security/limits.conf</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo '* - nofile 65535' | tee -a /etc/security/limits.conf</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># ls /etc/security/limits.d/|xargs rm -f</span></span><br><span class="line"></span><br><span class="line">//YUM源设置(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir /etc/yum.repos.d/backup &amp;&amp; mv /etc/yum.repos.d/&#123;*,backup&#125;</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -O https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># rpm --import RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># rm -f RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum clean all</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">//安装基础软件包(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y groupinstall "Development Tools"</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y install \</span></span><br><span class="line">make cmake \</span><br><span class="line">bison-devel \</span><br><span class="line">bzip2-devel \</span><br><span class="line">zlib zlib-devel \</span><br><span class="line">openssl openssl-devel openssl-libs \</span><br><span class="line">pcre pcre-devel pcre-static \</span><br><span class="line">ncurses ncurses-devel ncurses-libs \</span><br><span class="line">bzip2-devel\</span><br><span class="line">openldap openldap-devel \</span><br><span class="line">readline readline-devel readline-static \</span><br><span class="line">libssh2 libssh2-devel \</span><br><span class="line">unixODBC unixODBC-devel \</span><br><span class="line">sqlite sqlite-devel \</span><br><span class="line">tcl tcl-devel \</span><br><span class="line">perl-Digest-SHA1 \</span><br><span class="line">python-libs python-devel python2-pip python-crypto \</span><br><span class="line">perl-libs \</span><br><span class="line">GeoIP GeoIP-devel \</span><br><span class="line">gperftools gperftools-devel gperftools-libs \</span><br><span class="line">libatomic_ops-devel \</span><br><span class="line">gtest gtest-devel \</span><br><span class="line">gdk-pixbuf2 gdk-pixbuf2-deve \</span><br><span class="line">libffi libffi-devel \</span><br><span class="line">libcurl libcurl-devel \</span><br><span class="line">http-parser http-parser-devel</span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y install fop lftp ntp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span></span><br><span class="line"></span><br><span class="line">//关闭selinux(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># sed -i s/'SELINUX=enforcing'/'SELINUX=disabled'/g /etc/selinux/config</span></span><br><span class="line"></span><br><span class="line">//关闭防火墙(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span></span><br><span class="line"></span><br><span class="line">//设置时区和时间(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/localtime ] &amp;&amp; cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/sysconfig/clock ] &amp;&amp; echo 'ZONE="Asia/Shanghai"' | tee /etc/sysconfig/clock</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/timezone ] &amp;&amp; echo 'Asia/Shanghai' | tee /etc/timezone</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/sysconfig/ntpd ] &amp;&amp; echo 'SYNC_HWCLOCK=yes' | tee -a /etc/sysconfig/ntpd</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># ntpdate cn.pool.ntp.org</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cp -f /etc/&#123;ntp.conf,ntp.conf.bak&#125;</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt; /etc/ntp.conf &lt;&lt;EOF</span></span><br><span class="line">&gt; driftfile /var/lib/ntp/drift</span><br><span class="line">&gt; restrict default nomodify notrap nopeer noquery</span><br><span class="line">&gt; restrict 127.0.0.1</span><br><span class="line">&gt; restrict ::1</span><br><span class="line">&gt; server cn.pool.ntp.org prefer</span><br><span class="line">&gt; server 0.centos.pool.ntp.org iburst</span><br><span class="line">&gt; server 1.centos.pool.ntp.org iburst</span><br><span class="line">&gt; server 2.centos.pool.ntp.org iburst</span><br><span class="line">&gt; server 3.centos.pool.ntp.org iburst</span><br><span class="line">&gt; includefile /etc/ntp/crypto/pw</span><br><span class="line">&gt; keys /etc/ntp/keys</span><br><span class="line">&gt; <span class="built_in">disable</span> monitor</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@[ALL] ~]<span class="comment"># cp -f /etc/ntp/&#123;step-tickers,step-tickers.bak&#125;</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt; /etc/ntp/step-tickers &lt;&lt;EOF</span></span><br><span class="line">&gt; cn.pool.ntp.org</span><br><span class="line">&gt; 0.centos.pool.ntp.org</span><br><span class="line">&gt; 1.centos.pool.ntp.org</span><br><span class="line">&gt; 2.centos.pool.ntp.org</span><br><span class="line">&gt; 3.centos.pool.ntp.org</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@[ALL] ~]<span class="comment"># systemctl start ntpd &amp;&amp; systemctl enable ntpd</span></span><br><span class="line"></span><br><span class="line">//设置PIP源(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir ~/.pip</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt; ~/.pip/pip.conf &lt;&lt;EOF</span></span><br><span class="line">&gt; [global]</span><br><span class="line">&gt; trusted-host=mirrors.aliyun.com</span><br><span class="line">&gt; index-url=http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">&gt; [list]</span><br><span class="line">&gt; format=columns</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">//python安装(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># git clone https://github.com/yyuu/pyenv.git /usr/local/pyenv</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo 'export PYENV_ROOT=/usr/local/pyenv' | tee /etc/profile.d/pyenv.sh</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo 'export PATH="$PYENV_ROOT/bin:$PATH"' | tee -a /etc/profile.d/pyenv.sh</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo 'eval "$(pyenv init -)"' | tee -a /etc/profile.d/pyenv.sh</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># source /etc/profile</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># exec $SHELL</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir -p $&#123;PYENV_ROOT&#125;/cache</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># v=2.7.13;wget -P /usr/local/pyenv/cache/ http://mirrors.sohu.com/python/$v/Python-$v.tar.xz</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># pyenv install 2.7.13</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># pyenv rehash</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># pyenv local 2.7.13</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># python -V</span></span><br><span class="line">Python 2.7.13</span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># pip -V</span></span><br><span class="line">pip 9.0.1 from /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages (python 2.7)</span><br><span class="line"></span><br><span class="line">//设置开机启动文件权限</span><br><span class="line">[root@[ALL] ~]<span class="comment"># chmod +x /etc/rc.d/rc.local</span></span><br><span class="line"></span><br><span class="line">//创建基础目录(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir -p /mnt/&#123;app,data,log,web,ops/&#123;app,data,cron&#125;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改内核</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOF</span></span><br><span class="line">kernel.shmmax=30000000000</span><br><span class="line">kernel.shmall=7000000</span><br><span class="line">kernel.msgmax=65535</span><br><span class="line">kernel.msgmnb=65535</span><br><span class="line">EOF</span><br><span class="line">[root@[ALL] ~]<span class="comment"># sysctl -p</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>zabbix-server-mysql 数据库安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-mysql app]<span class="comment"># useradd -s /sbin/nologin mysql</span></span><br><span class="line">[root@zabbix-server-mysql app]<span class="comment"># tar xzf mysql-5.6.35.tar.gz</span></span><br><span class="line">[root@zabbix-server-mysql app]<span class="comment"># cd mysql-5.6.35</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># cmake \</span></span><br><span class="line">&gt; -DCMAKE_INSTALL_PREFIX=/mnt/app/mysql \</span><br><span class="line">&gt; -DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">&gt; -DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">&gt; -DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">&gt; -DWITH_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">&gt; -DEXTRA_CHARSETS=all \</span><br><span class="line">&gt; -DDEFAULT_CHARSET=utf8 \</span><br><span class="line">&gt; -DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">&gt; -DENABLE_DOWNLOADS=1</span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># make</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># make install</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># echo 'export MYSQL_BASE=/mnt/app/mysql' |tee /etc/profile.d/mysql.sh</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># echo 'export MYSQL_BIN=$MYSQL_BASE/bin' |tee -a /etc/profile.d/mysql.sh</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># echo 'export PATH=$MYSQL_BIN:$PATH'     |tee -a /etc/profile.d/mysql.sh</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># mkdir -p /mnt/&#123;data,log&#125;/mysql/3306</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># touch /mnt/log/mysql/3306/mysqld.log</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># chown -R mysql.mysql /mnt/&#123;data,log&#125;/mysql</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># chmod +x scripts/*</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># ./scripts/mysql_install_db --basedir=/mnt/app/mysql/ --datadir=/mnt/data/mysql/3306/ --user=mysql</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># mkdir -p /mnt/app/mysql/conf</span></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># cat &gt; /mnt/app/mysql/conf/3306.M.cnf &lt;&lt;EOF</span></span><br><span class="line">[mysqld]</span><br><span class="line">user    = mysql</span><br><span class="line">port    = 3306</span><br><span class="line">basedir = /mnt/app/mysql</span><br><span class="line">datadir = /mnt/data/mysql/3306</span><br><span class="line">socket  = /mnt/data/mysql/3306/mysql.sock</span><br><span class="line">default-storage-engine = InnoDB</span><br><span class="line">character_set_server   = utf8</span><br><span class="line">max_connections        = 100000</span><br><span class="line">skip-name-resolve</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line">server-id               = 82</span><br><span class="line">max_allowed_packet      = 32m</span><br><span class="line">max_heap_table_size     = 256m</span><br><span class="line">read_rnd_buffer_size    = 16m</span><br><span class="line">sort_buffer_size        = 8m</span><br><span class="line">join_buffer_size        = 8m</span><br><span class="line">query_cache_type        = 1</span><br><span class="line">query_cache_size        = 1024m</span><br><span class="line">query_cache_limit       = 8m</span><br><span class="line">innodb_open_files       = 30000</span><br><span class="line">innodb_buffer_pool_size = 24G</span><br><span class="line">innodb_file_per_table   = 1</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line"><span class="built_in">log</span>-error=/mnt/<span class="built_in">log</span>/mysql/3306/mysqld.log</span><br><span class="line">pid-file =/mnt/app/mysql/mysqld.3306.pid</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket=/mnt/data/mysql/3306/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket=/mnt/data/mysql/3306/mysql.sock</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql mysql-5.6.35]<span class="comment"># cat &gt; /etc/init.d/mysql.3306M &lt;&lt;EOF</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> != 1 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Please input:</span></span><br><span class="line"><span class="string">/etc/init.d/<span class="variable">$0</span> start</span></span><br><span class="line"><span class="string">/etc/init.d/<span class="variable">$0</span> stop</span></span><br><span class="line"><span class="string">/etc/init.d/<span class="variable">$0</span> status</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">STATUS=<span class="variable">$1</span></span><br><span class="line">ROLE=<span class="string">'mysql'</span></span><br><span class="line">PORT=3306</span><br><span class="line">SQLAPP=<span class="string">"/mnt/app/<span class="variable">$&#123;ROLE&#125;</span>/bin/mysqld_safe"</span></span><br><span class="line">SQLSHT=<span class="string">"/mnt/app/<span class="variable">$&#123;ROLE&#125;</span>/bin/mysqladmin"</span></span><br><span class="line">SOCKET=<span class="string">"/mnt/data/<span class="variable">$&#123;ROLE&#125;</span>/<span class="variable">$&#123;PORT&#125;</span>/mysql.sock"</span></span><br><span class="line">COFIG=<span class="string">"/mnt/app/<span class="variable">$&#123;ROLE&#125;</span>/conf/<span class="variable">$&#123;PORT&#125;</span>.M.cnf"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$STATUS</span> == <span class="string">"start"</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="variable">$&#123;SQLAPP&#125;</span> --defaults-file=<span class="variable">$&#123;COFIG&#125;</span> &amp;</span><br><span class="line">  <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> start success."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> start fail."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$STATUS</span> == <span class="string">"stop"</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="variable">$&#123;SQLSHT&#125;</span> -S <span class="variable">$&#123;SOCKET&#125;</span> shutdown</span><br><span class="line">  <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> stoped success."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> stoped fail."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$STATUS</span> == <span class="string">"kill"</span> ];<span class="keyword">then</span></span><br><span class="line">  PID=$(ps -ef|grep -w <span class="variable">$&#123;ROLE&#125;</span>|grep <span class="variable">$&#123;PORT&#125;</span>|grep -v grep|grep -v bash|awk <span class="string">'&#123;print $2&#125;'</span>|tr <span class="string">'\n'</span> <span class="string">' '</span>)</span><br><span class="line">  <span class="built_in">kill</span> -9 <span class="variable">$PID</span></span><br><span class="line">  <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> killed success."</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> killed fail."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$STATUS</span> == <span class="string">"status"</span> ];<span class="keyword">then</span></span><br><span class="line">  NUM=$(ps -ef|grep -w <span class="variable">$&#123;ROLE&#125;</span>|grep <span class="variable">$&#123;PORT&#125;</span>|grep root|grep -v grep|grep -v bash|awk <span class="string">'&#123;print $2&#125;'</span>|wc -l)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$NUM</span> == 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> is stopped."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$NUM</span> != 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Please check <span class="variable">$ROLE</span>, There are <span class="variable">$NUM</span> processes."</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  PID=$(ps -ef|grep -w <span class="variable">$&#123;ROLE&#125;</span>|grep <span class="variable">$&#123;PORT&#125;</span>|grep -v grep|grep -v bash|awk <span class="string">'&#123;print $2&#125;'</span>|tr <span class="string">'\n'</span> <span class="string">' '</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$ROLE</span> <span class="variable">$PORT</span> is running. PID: <span class="variable">$PID</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">EOF</span><br><span class="line">[root@zabbix-server-mysql ~]<span class="comment"># chmod +x /etc/init.d/mysql.3306M</span></span><br><span class="line">[root@zabbix-server-mysql ~]<span class="comment"># chown -R mysql.mysql /mnt/app/mysql</span></span><br><span class="line">[root@zabbix-server-mysql ~]<span class="comment"># /etc/init.d/mysql.3306M start</span></span><br><span class="line">[root@zabbix-server-mysql ~]<span class="comment"># echo '/etc/init.d/mysql.3306M start' | tee -a /etc/rc.local</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>zabbix-server-company zabbix安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-company ~]<span class="comment"># rpm -ivh http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># yum -y install zabbix-server-mysql zabbix-web-mysql httpd</span></span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># yum -y install zabbix-java-gateway zabbix-sender zabbix-get</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建zabbix-server数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//安装完zabbix-server-mysql后,将数据库表结构拷贝到zabbix-server-mysql上</span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># scp /usr/share/doc/zabbix-server-mysql-3.2.7/create.sql.gz root@zabbix-server-mysql:/mnt/ops/app/</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server-mysql app]<span class="comment"># mysql -S /mnt/data/mysql/3306/mysql.sock</span></span><br><span class="line">mysql&gt; create database zabbix_server character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix_server.* to zabbix@192.168.10.81 identified by <span class="string">'zabbix'</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">[root@zabbix-server-mysql app]<span class="comment"># zcat create.sql.gz | mysql -S /mnt/data/mysql/3306/mysql.sock -B zabbix_server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改zabbix-server配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-company ~]<span class="comment"># vim /etc/zabbix/zabbix_server.conf</span></span><br><span class="line">ListenPort=10051</span><br><span class="line">LogType=file</span><br><span class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_server.log</span><br><span class="line">LogFileSize=512</span><br><span class="line">DebugLevel=3</span><br><span class="line">PidFile=/var/run/zabbix/zabbix_server.pid</span><br><span class="line">DBHost=192.168.10.82</span><br><span class="line">DBName=zabbix_server</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=UPCLfTHSj72a</span><br><span class="line">DBPort=3306</span><br><span class="line">StartPollers=500</span><br><span class="line">StartIPMIPollers=0</span><br><span class="line">StartPollersUnreachable=50</span><br><span class="line">StartTrappers=50</span><br><span class="line">StartPingers=30</span><br><span class="line">StartDiscoverers=80</span><br><span class="line">StartHTTPPollers=30</span><br><span class="line">StartTimers=100</span><br><span class="line">StartEscalators=30</span><br><span class="line">SNMPTrapperFile=/var/<span class="built_in">log</span>/snmptrap/snmptrap.log</span><br><span class="line">StartSNMPTrapper=0</span><br><span class="line">HousekeepingFrequency=1</span><br><span class="line">MaxHousekeeperDelete=500000</span><br><span class="line">SenderFrequency=60</span><br><span class="line">CacheSize=2G</span><br><span class="line">CacheUpdateFrequency=300</span><br><span class="line">StartDBSyncers=50</span><br><span class="line">HistoryCacheSize=2G</span><br><span class="line">HistoryIndexCacheSize=2G</span><br><span class="line">TrendCacheSize=2G</span><br><span class="line">ValueCacheSize=5G</span><br><span class="line">Timeout=20</span><br><span class="line">TrapperTimeout=300</span><br><span class="line">UnreachablePeriod=300</span><br><span class="line">UnavailableDelay=300</span><br><span class="line">UnreachableDelay=30</span><br><span class="line">AlertScriptsPath=/etc/zabbix/zabbix_alert</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/zabbix_exec</span><br><span class="line">FpingLocation=/usr/sbin/fping</span><br><span class="line">LogSlowQueries=1000</span><br><span class="line">StartProxyPollers=50</span><br><span class="line">ProxyConfigFrequency=300</span><br><span class="line">ProxyDataFrequency=30</span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># systemctl start zabbix-server</span></span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># systemctl enable zabbix-server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置 httpd zabbix</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server-company ~]<span class="comment"># cat &gt; /etc/httpd/conf.d/zabbix.conf &lt;&lt;EOF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Zabbix monitoring system php web frontend</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">Alias /zabbix /usr/share/zabbix</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/usr/share/zabbix"</span>&gt;</span><br><span class="line">    Options FollowSymLinks</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Require all granted</span><br><span class="line"></span><br><span class="line">    &lt;IfModule mod_php5.c&gt;</span><br><span class="line">        php_value max_execution_time 300</span><br><span class="line">        php_value memory_limit 2048M</span><br><span class="line">        php_value post_max_size 512M</span><br><span class="line">        php_value upload_max_filesize 200M</span><br><span class="line">        php_value max_input_time 300</span><br><span class="line">        php_value always_populate_raw_post_data -1</span><br><span class="line">        php_value date.timezone Asia/Shanghai</span><br><span class="line">    &lt;/IfModule&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/usr/share/zabbix/conf"</span>&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/usr/share/zabbix/app"</span>&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/usr/share/zabbix/include"</span>&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/usr/share/zabbix/local"</span>&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">EOF</span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># systemctl start httpd</span></span><br><span class="line">[root@zabbix-server-company ~]<span class="comment"># systemctl enable httpd</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>打开浏览器进行设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL: http://192.168.10.81/zabbix/   默认账号/密码:Admin/zabbix</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/10/zabbix-install-distributed/" data-id="cjazey08i018cqcoq6ce9ddtk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-salt-install-distributed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/09/salt-install-distributed/" class="article-date">
  <time datetime="2017-08-09T08:49:01.000Z" itemprop="datePublished">2017-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/salt/">salt</a>►<a class="article-category-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/09/salt-install-distributed/">salt install distributed</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="salt-multiple-master-syndic-minion"><a href="#salt-multiple-master-syndic-minion" class="headerlink" title="salt multiple master/syndic/minion"></a>salt multiple master/syndic/minion</h3><ol>
<li><p>基础环境安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">//机器信息</span><br><span class="line">192.168.13.217 saltmaster1  <span class="comment"># CentOS 7.0</span></span><br><span class="line">192.168.13.218 saltmaster2  <span class="comment"># CentOS 7.0</span></span><br><span class="line">192.168.13.212 saltsyndic1  <span class="comment"># CentOS 7.0</span></span><br><span class="line">192.168.13.187 saltminion1  <span class="comment"># CentOS 6.5</span></span><br><span class="line">192.168.13.188 saltminion2  <span class="comment"># CentOS 7.0</span></span><br><span class="line"></span><br><span class="line">说明: 192.168.13.217 和 192.168.13.218 互为主备</span><br><span class="line"></span><br><span class="line">//修改主机名</span><br><span class="line">saltmaster1:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname saltmaster1 &amp;&amp; echo saltmaster1 |tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@saltmaster1 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">saltmaster2:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname saltmaster2 &amp;&amp; echo saltmaster2 |tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@saltmaster2 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">saltsyndic1:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname saltsyndic1 &amp;&amp; echo saltsyndic1 |tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@saltsyndic1 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">saltminion1:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname saltminion1 &amp;&amp; echo saltminion1 |tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># sed -i s/'localhost.localdomain'/saltminion1/g /etc/sysconfig/network</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@saltminion1 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">saltminion2:</span><br><span class="line">[root@localhost ~]<span class="comment"># hostname saltminion2 &amp;&amp; echo saltminion2 |tee /etc/hostname</span></span><br><span class="line">[root@localhost ~]<span class="comment"># $SHELL</span></span><br><span class="line">[root@saltminion2 ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">//格式化磁盘(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkfs.xfs /dev/vdb</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo '/dev/vdb /mnt xfs defaults 0 0' | tee -a /etc/fstab</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># mount -a</span></span><br><span class="line"></span><br><span class="line">//修改最大文件数(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo '* - nproc  65535' | tee -a /etc/security/limits.conf</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># echo '* - nofile 65535' | tee -a /etc/security/limits.conf</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># ls /etc/security/limits.d/|xargs rm -f</span></span><br><span class="line"></span><br><span class="line">//YUM源设置(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir /etc/yum.repos.d/backup &amp;&amp; mv /etc/yum.repos.d/&#123;*,backup&#125;</span></span><br><span class="line"></span><br><span class="line">CentOS6:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -o /etc/yum.repos.d/epel-6.repo http://mirrors.aliyun.com/repo/epel-6.repo</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -O https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-6</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># rpm --import RPM-GPG-KEY-CentOS-6</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># rm -f RPM-GPG-KEY-CentOS-6</span></span><br><span class="line">CentOS7:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -o /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># curl -O https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># rpm --import RPM-GPG-KEY-CentOS-7</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># rm -f RPM-GPG-KEY-CentOS-7</span></span><br><span class="line"></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum clean all</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum makecache</span></span><br><span class="line"></span><br><span class="line">//安装基础软件包(ALL)</span><br><span class="line">CentOS6:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y groupinstall "Development Tools"</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y install \</span></span><br><span class="line">cmake \</span><br><span class="line">bison-devel\</span><br><span class="line">bzip2 bzip2-devel bzip2-libs \</span><br><span class="line">zlib zlib-devel \</span><br><span class="line">openssl openssl-devel openssl-static \</span><br><span class="line">pcre pcre-devel pcre-static \</span><br><span class="line">ncurses ncurses-devel ncurses-libs ncurses-static \</span><br><span class="line">bzip2 bzip2-devel bzip2-libs \</span><br><span class="line">openldap openldap-devel \</span><br><span class="line">readline readline-devel readline-static \</span><br><span class="line">libssh2 libssh2-devel \</span><br><span class="line">unixODBC unixODBC-devel \</span><br><span class="line">sqlite sqlite-devel \</span><br><span class="line">tcl tcl-devel \</span><br><span class="line">perl-Digest-SHA1 \</span><br><span class="line">python-libs python-devel python-pip python-crypto \</span><br><span class="line">perl-libs \</span><br><span class="line">GeoIP GeoIP-devel \</span><br><span class="line">gperftools gperftools-devel gperftools-libs \</span><br><span class="line">libatomic_ops-devel \</span><br><span class="line">gtest gtest-devel \</span><br><span class="line">gdk-pixbuf2 gdk-pixbuf2-devel \</span><br><span class="line">libffi libffi-devel \</span><br><span class="line">libcurl libcurl-devel \</span><br><span class="line">http-parser http-parser-devel</span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y install fop lftp ntp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span></span><br><span class="line"></span><br><span class="line">CentOS7:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y groupinstall "Development Tools"</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y install \</span></span><br><span class="line">make cmake \</span><br><span class="line">bison-devel \</span><br><span class="line">bzip2-devel \</span><br><span class="line">zlib zlib-devel \</span><br><span class="line">openssl openssl-devel openssl-libs \</span><br><span class="line">pcre pcre-devel pcre-static \</span><br><span class="line">ncurses ncurses-devel ncurses-libs \</span><br><span class="line">bzip2-devel\</span><br><span class="line">openldap openldap-devel \</span><br><span class="line">readline readline-devel readline-static \</span><br><span class="line">libssh2 libssh2-devel \</span><br><span class="line">unixODBC unixODBC-devel \</span><br><span class="line">sqlite sqlite-devel \</span><br><span class="line">tcl tcl-devel \</span><br><span class="line">perl-Digest-SHA1 \</span><br><span class="line">python-libs python-devel python2-pip python-crypto \</span><br><span class="line">perl-libs \</span><br><span class="line">GeoIP GeoIP-devel \</span><br><span class="line">gperftools gperftools-devel gperftools-libs \</span><br><span class="line">libatomic_ops-devel \</span><br><span class="line">gtest gtest-devel \</span><br><span class="line">gdk-pixbuf2 gdk-pixbuf2-deve \</span><br><span class="line">libffi libffi-devel \</span><br><span class="line">libcurl libcurl-devel \</span><br><span class="line">http-parser http-parser-devel</span><br><span class="line">[root@[ALL] ~]<span class="comment"># yum -y install fop lftp ntp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span></span><br><span class="line"></span><br><span class="line">//关闭selinux(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># sed -i s/'SELINUX=enforcing'/'SELINUX=disabled'/g /etc/selinux/config</span></span><br><span class="line"></span><br><span class="line">//关闭防火墙(ALL)</span><br><span class="line">CentOS6:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># /etc/init.d/iptables stop &amp;&amp; chkconfig iptables off</span></span><br><span class="line">CentOS7:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span></span><br><span class="line"></span><br><span class="line">//设置时区和时间(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/localtime ] &amp;&amp; cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/sysconfig/clock ] &amp;&amp; echo 'ZONE="Asia/Shanghai"' | tee /etc/sysconfig/clock</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/timezone ] &amp;&amp; echo 'Asia/Shanghai' | tee /etc/timezone</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># [ -f /etc/sysconfig/ntpd ] &amp;&amp; echo 'SYNC_HWCLOCK=yes' | tee -a /etc/sysconfig/ntpd</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># ntpdate cn.pool.ntp.org</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cp -f /etc/&#123;ntp.conf,ntp.conf.bak&#125;</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt; /etc/ntp.conf &lt;&lt;EOF</span></span><br><span class="line">&gt; driftfile /var/lib/ntp/drift</span><br><span class="line">&gt; restrict default nomodify notrap nopeer noquery</span><br><span class="line">&gt; restrict 127.0.0.1</span><br><span class="line">&gt; restrict ::1</span><br><span class="line">&gt; server cn.pool.ntp.org prefer</span><br><span class="line">&gt; server 0.centos.pool.ntp.org iburst</span><br><span class="line">&gt; server 1.centos.pool.ntp.org iburst</span><br><span class="line">&gt; server 2.centos.pool.ntp.org iburst</span><br><span class="line">&gt; server 3.centos.pool.ntp.org iburst</span><br><span class="line">&gt; includefile /etc/ntp/crypto/pw</span><br><span class="line">&gt; keys /etc/ntp/keys</span><br><span class="line">&gt; <span class="built_in">disable</span> monitor</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@[ALL] ~]<span class="comment"># cp -f /etc/ntp/&#123;step-tickers,step-tickers.bak&#125;</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt; /etc/ntp/step-tickers &lt;&lt;EOF</span></span><br><span class="line">&gt; cn.pool.ntp.org</span><br><span class="line">&gt; 0.centos.pool.ntp.org</span><br><span class="line">&gt; 1.centos.pool.ntp.org</span><br><span class="line">&gt; 2.centos.pool.ntp.org</span><br><span class="line">&gt; 3.centos.pool.ntp.org</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">CentOS6:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># /etc/init.d/ntpd start &amp;&amp; chkconfig ntpd on</span></span><br><span class="line">CentOS7:</span><br><span class="line">[root@[ALL] ~]<span class="comment"># systemctl start ntpd &amp;&amp; systemctl enable ntpd</span></span><br><span class="line"></span><br><span class="line">//设置PIP源(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir ~/.pip</span></span><br><span class="line">[root@[ALL] ~]<span class="comment"># cat &gt; ~/.pip/pip.conf &lt;&lt;EOF</span></span><br><span class="line">&gt; [global]</span><br><span class="line">&gt; trusted-host=mirrors.aliyun.com</span><br><span class="line">&gt; index-url=http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">&gt; [list]</span><br><span class="line">&gt; format=columns</span><br><span class="line">&gt; EOF</span><br><span class="line"></span><br><span class="line">//设置开机启动文件权限</span><br><span class="line">[root@[ALL] ~]<span class="comment"># chmod +x /etc/rc.d/rc.local</span></span><br><span class="line"></span><br><span class="line">//创建基础目录(ALL)</span><br><span class="line">[root@[ALL] ~]<span class="comment"># mkdir -p /mnt/&#123;app,data,log,web,ops/&#123;app,data,cron&#125;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>python版本安装(ALL)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@ALL app]<span class="comment"># wget https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tar.xz</span></span><br><span class="line">[root@ALL app]<span class="comment"># xz -d Python-2.7.13.tar.xz</span></span><br><span class="line">[root@ALL app]<span class="comment"># tar xf Python-2.7.13.tar</span></span><br><span class="line">[root@ALL app]<span class="comment"># cd Python-2.7.13</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># ./configure --prefix=/usr/local/python27</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># make -j 4</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># make -j 4 install</span></span><br><span class="line"></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># wget https://bootstrap.pypa.io/get-pip.py</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># /usr/local/python27/bin/python get-pip.py</span></span><br><span class="line"></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># echo 'export PYTHON_PATH=/usr/local/python27' |tee /etc/profile.d/python27.sh</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># echo 'export PYTHON_BIN=$PYTHON_PATH/bin' |tee -a /etc/profile.d/python27.sh</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># echo 'export PATH=$PYTHON_BIN:$PATH' |tee -a /etc/profile.d/python27.sh</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line">CentOS6:</span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># rm -f /usr/bin/&#123;python,pip&#125;</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># sed -i s/python/python2.6/g /usr/bin/yum</span></span><br><span class="line"></span><br><span class="line">CentOS7:</span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># rm -f /usr/bin/&#123;python,pip&#125;</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># sed -i s/python/python2.7/g /usr/bin/yum</span></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># sed -i s/python/python2.7/g /usr/libexec/urlgrabber-ext-down</span></span><br><span class="line"></span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># python -V</span></span><br><span class="line">Python 2.7.13</span><br><span class="line">[root@ALL Python-2.7.13]<span class="comment"># pip -V</span></span><br><span class="line">pip 9.0.1 from /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages (python 2.7)</span><br></pre></td></tr></table></figure>
</li>
<li><p>saltmaster1 和 saltmaster2 挂载一块共享磁盘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster[X] ~]<span class="comment"># yum -y install nfs-utils</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /salt</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># echo '192.168.13.201:/mnt/data/nfs /salt  nfs  nfsvers=3 0 0' | tee -a /etc/fstab</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mount -a</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt 安装(ALL)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@[ALL] ~]<span class="comment"># pip install salt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltmaster[X] 和 saltsyndic[X] pygit2 install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster[X] app]<span class="comment"># wget https://codeload.github.com/libgit2/libgit2/tar.gz/v0.26.0</span></span><br><span class="line">[root@saltmaster[X] app]<span class="comment"># tar xzf v0.26.0  &amp;&amp; rm -f v0.26.0</span></span><br><span class="line">[root@saltmaster[X] app]<span class="comment"># cd libgit2-0.26.0/</span></span><br><span class="line">[root@saltmaster[X] libgit2-0.26.0]<span class="comment"># cmake .</span></span><br><span class="line">[root@saltmaster[X] libgit2-0.26.0]<span class="comment"># make</span></span><br><span class="line">[root@saltmaster[X] libgit2-0.26.0]<span class="comment"># make install</span></span><br><span class="line">[root@saltmaster[X] libgit2-0.26.0]<span class="comment"># echo '/usr/local/lib' | tee /etc/ld.so.conf.d/libgit2.conf</span></span><br><span class="line">[root@saltmaster[X] libgit2-0.26.0]<span class="comment"># ldconfig</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] app]<span class="comment"># wget https://codeload.github.com/libgit2/pygit2/tar.gz/v0.26.0</span></span><br><span class="line">[root@saltmaster[X] app]<span class="comment"># tar xzf v0.26.0  &amp;&amp; rm -f v0.26.0</span></span><br><span class="line">[root@saltmaster[X] app]<span class="comment"># cd pygit2-0.26.0</span></span><br><span class="line">[root@saltmaster[X] pygit2-0.26.0]<span class="comment"># python setup.py build</span></span><br><span class="line">[root@saltmaster[X] pygit2-0.26.0]<span class="comment"># python setup.py install</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] pygit2-0.26.0]<span class="comment"># pip list |grep pygit2</span></span><br><span class="line">pygit2         0.26.0</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol>
<li><p>saltmaster[X] 创建salt目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /etc/salt</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /salt/master.d</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># ln -s /salt/master.d /etc/salt/master.d</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /salt/&#123;file,pillar&#125;/&#123;base,dev,prod&#125;</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /salt/pki</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># ln -s /salt/pki /etc/salt/pki</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /mnt/data/salt/cache</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># ln -s /mnt/data/salt/cache /var/cache/salt</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /mnt/data/salt/run</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># ln -s /mnt/data/salt/run /var/run/salt</span></span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># mkdir -p /mnt/log/salt</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># ln -s /mnt/log/salt /var/log/salt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltmaster[X] 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注意: 由于配置文件创建master.conf在<span class="string">"/salt"</span>(共享磁盘),所以saltmaster1和saltmaster2共享配置</span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># echo 'default_include: master.d/*.conf' | tee /etc/salt/master</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># cat &gt; /etc/salt/master.d/master.conf &lt;&lt;EOF</span></span><br><span class="line">...</span><br><span class="line">order_masters: True   <span class="comment">#主要是将它打开</span></span><br><span class="line">...</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>saltmaster[X] 启动/关闭程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt-master -c /etc/salt -d  #启动程序</span></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># pkill salt-master            #关闭程序</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol>
<li><p>saltsyndic[X] 创建salt目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /mnt/data/salt</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># ln -s /mnt/data/salt /salt</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /etc/salt</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /salt/master.d</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># ln -s /salt/master.d /etc/salt/master.d</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /salt/&#123;file,pillar&#125;/&#123;base,dev,prod&#125;</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /salt/pki</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># ln -s /salt/pki /etc/salt/pki</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /mnt/data/salt/cache</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># ln -s /mnt/data/salt/cache /var/cache/salt</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /mnt/data/salt/run</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># ln -s /mnt/data/salt/run /var/run/salt</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># mkdir -p /mnt/log/salt</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># ln -s /mnt/log/salt /var/log/salt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltsyndic[X] 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@saltsyndic[x] ~]<span class="comment"># echo 'default_include: master.d/*.conf' | tee /etc/salt/master</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># cat &gt; /etc/salt/master.d/master.conf &lt;&lt;EOF</span></span><br><span class="line">...</span><br><span class="line"><span class="comment"># order_masters: True</span></span><br><span class="line">syndic_master:              <span class="comment">#指定salt-master IP</span></span><br><span class="line">  - 192.168.13.217</span><br><span class="line">  - 192.168.13.218</span><br><span class="line">syndic_master_port: 4506</span><br><span class="line">syndic_pidfile: /var/<span class="built_in">log</span>/salt/salt-syndic.pid</span><br><span class="line">syndic_log_file: /var/<span class="built_in">log</span>/salt/syndic</span><br><span class="line">syndic_failover: random</span><br><span class="line">syndic_wait: 20</span><br><span class="line">...</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>saltsyndic[X] 启动/关闭程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@saltsyndic[x] ~]<span class="comment"># salt-master -c /etc/salt -d   #先启动salt-master</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># salt-syndic -c /etc/salt -d   #在启动salt-syndic</span></span><br><span class="line"></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># pkill salt-syndic  #先关闭salt-syndic</span></span><br><span class="line">[root@saltsyndic[x] ~]<span class="comment"># pkill salt-master  #在关闭salt-master</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltsyndic[X] 与 saltmaster[X] 建立认证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">方式一: 自动认证(配置文件中已经开启<span class="string">"auto_accept: True"</span>)</span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt-key -L</span></span><br><span class="line">minions:</span><br><span class="line">    - saltsyndic1</span><br><span class="line">minions_denied:</span><br><span class="line">minions_pre:</span><br><span class="line">minions_rejected:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二: 手动认证(配置文件中已经关闭<span class="string">"auto_accept: False"</span>)</span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt-key -L    # 查看当前Key信息</span></span><br><span class="line">minions:</span><br><span class="line">minions_denied:</span><br><span class="line">minions_pre:</span><br><span class="line">    - saltsyndic1</span><br><span class="line">minions_rejected:</span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt-key -A      # 认证全部</span></span><br><span class="line">The following keys are going to be accepted:</span><br><span class="line">minions_pre:</span><br><span class="line">    - saltsyndic1</span><br><span class="line">Proceed? [n/Y] y</span><br><span class="line">Key <span class="keyword">for</span> minion saltsyndic1 accepted.</span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt-key -L     # 认证结果查看</span></span><br><span class="line">minions:</span><br><span class="line">    - saltsyndic1</span><br><span class="line">minions_denied:</span><br><span class="line">minions_pre:</span><br><span class="line">minions_rejected:</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol>
<li><p>saltminion[X] 创建salt目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@saltminion[x] ~]<span class="comment"># mkdir -p /etc/salt/minion.d</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltminion[X] 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@saltminion[x] ~]<span class="comment"># echo 'default_include: minion.d/*.conf'|tee /etc/salt/minion</span></span><br><span class="line">[root@saltminion[x] ~]<span class="comment"># cat &gt; /etc/salt/minion.d/minion.conf &lt;&lt;EOF</span></span><br><span class="line">...</span><br><span class="line">master: saltsyndic1     <span class="comment">#注意这里的master指向 satlsyndic</span></span><br><span class="line">id: saltminion1</span><br><span class="line">...</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>saltminion[X] 启动/关闭程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@saltminion[x] ~]<span class="comment"># salt-minion -c /etc/salt -d  #启动程序</span></span><br><span class="line">[root@saltminion[x] ~]<span class="comment"># pkill salt-minion            #关闭程序</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltminion[X] 与 saltsyndic[X] 建立认证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">方式一: 自动认证(配置文件中已经开启<span class="string">"auto_accept: True"</span>)</span><br><span class="line">[root@saltsyndic[X] ~]<span class="comment"># salt-key -L                  </span></span><br><span class="line">minions:</span><br><span class="line">    - saltminion1</span><br><span class="line">    - saltminion2</span><br><span class="line">minions_denied:</span><br><span class="line">minions_pre:</span><br><span class="line">minions_rejected:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二: 手动认证(配置文件中已经关闭<span class="string">"auto_accept: False"</span>)</span><br><span class="line">[root@saltsyndic[X] ~]<span class="comment"># salt-key -L    # 查看当前Key信息</span></span><br><span class="line">minions:</span><br><span class="line">minions_denied:</span><br><span class="line">minions_pre:</span><br><span class="line">    - saltminion1</span><br><span class="line">    - saltminion2</span><br><span class="line">minions_rejected:</span><br><span class="line"></span><br><span class="line">[root@saltsyndic[X] ~]<span class="comment"># salt-key -A      # 认证全部</span></span><br><span class="line">The following keys are going to be accepted:</span><br><span class="line">minions_pre:</span><br><span class="line">    - saltminion1</span><br><span class="line">    - saltminion2</span><br><span class="line">Proceed? [n/Y] y</span><br><span class="line">Key <span class="keyword">for</span> minion saltminion1 saltminion2 accepted.</span><br><span class="line"></span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt-key -L     # 认证结果查看</span></span><br><span class="line">minions:</span><br><span class="line">    - saltsyndic1</span><br><span class="line">minions_denied:</span><br><span class="line">minions_pre:</span><br><span class="line">minions_rejected:</span><br></pre></td></tr></table></figure>
</li>
<li><p>补充说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意:</span><br><span class="line">salt-syndic上面只运行了salt-master和salt-syndic,不要运行salt-minion.如果在salt-syndic上有运行salt-minion, id最好不要与salt-syndic一样,或者 禁止启动 salt-minion</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol>
<li>saltmaster[X] 通过 saltsyndic[X] 管理 saltminion[X]<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//在saltsyndic[X]测试:</span><br><span class="line">[root@saltsyndic[X] ~]<span class="comment"># salt '*' test.ping</span></span><br><span class="line">saltminion1:</span><br><span class="line">    True</span><br><span class="line">saltminion2:</span><br><span class="line">    True</span><br><span class="line"></span><br><span class="line">//在saltmaster[X]测试:</span><br><span class="line">[root@saltmaster[X] ~]<span class="comment"># salt '*' test.ping</span></span><br><span class="line">saltminion2:</span><br><span class="line">    True</span><br><span class="line">saltminion1:</span><br><span class="line">    True</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/09/salt-install-distributed/" data-id="cjazexzlj009xqcoqpe6qf36o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hmonitor-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/09/hmonitor-install/" class="article-date">
  <time datetime="2017-08-09T00:35:51.000Z" itemprop="datePublished">2017-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Monitor/">Monitor</a>►<a class="article-category-link" href="/categories/Monitor/hmonitor/">hmonitor</a>►<a class="article-category-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/09/hmonitor-install/">hmonitor install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="hmonitor-install"><a href="#hmonitor-install" class="headerlink" title="hmonitor install"></a>hmonitor install</h3><ol>
<li><p>基础环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter ~]<span class="comment"># python -V</span></span><br><span class="line">Python 2.7.13</span><br><span class="line"></span><br><span class="line">[root@alarmcenter ~]<span class="comment"># pip -V</span></span><br><span class="line">pip 9.0.1 from /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages (python 2.7)</span><br><span class="line"></span><br><span class="line">[root@alarmcenter ~]<span class="comment"># mysql -V</span></span><br><span class="line">mysql  Ver 14.14 Distrib 5.6.36, <span class="keyword">for</span> Linux (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">注意:数据库要添加动态库:</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/mnt/app/mysql/lib'</span> | tee /etc/ld.so.conf.d/mysql.conf</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>
</li>
<li><p>hmonitor install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//下载</span><br><span class="line">[root@alarmcenter ~]<span class="comment"># cd /mnt/web/</span></span><br><span class="line">[root@alarmcenter web]<span class="comment"># git clone https://github.com/smallasa/hmonitor.git</span></span><br><span class="line"></span><br><span class="line">//安装依赖包</span><br><span class="line">[root@alarmcenter web]<span class="comment"># cd hmonitor/</span></span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># cat requirements.txt</span></span><br><span class="line"><span class="comment"># python version : 2.7.13</span></span><br><span class="line"><span class="comment"># pip version    : 9.0.1</span></span><br><span class="line">tornado&gt;=4.2</span><br><span class="line">torndb==0.3</span><br><span class="line">requests&gt;=2.7.0</span><br><span class="line">six&gt;=1.9.0</span><br><span class="line">stevedore&gt;=1.5.0</span><br><span class="line">MySQL-python&gt;=1.2.5</span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># pip install -r requirements.txt</span></span><br><span class="line"></span><br><span class="line">//初始化数据库</span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql -S /mnt/data/mysql/mysql.sock &lt; db.sql</span></span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql -S /mnt/data/mysql/mysql.sock -e "show tables in hmonitor;"</span></span><br><span class="line">+-----------------------+</span><br><span class="line">| Tables_in_hmonitor    |</span><br><span class="line">+-----------------------+</span><br><span class="line">| ALERT_FILTER          |</span><br><span class="line">| ALERT_MSG             |</span><br><span class="line">| AUTOFIX_BINDING       |</span><br><span class="line">| AUTOFIX_LOG           |</span><br><span class="line">| HM_TRIGGER            |</span><br><span class="line">| TRIGGER_EVENTS        |</span><br><span class="line">| USERS                 |</span><br><span class="line">| USERS_TRIGGER_BINDING |</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line">//数据库授权</span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql -S /mnt/data/mysql/mysql.sock</span></span><br><span class="line">mysql&gt; grant all privileges on hmonitor.* to <span class="string">'hmonitor'</span>@<span class="string">'127.0.0.1'</span> identified by <span class="string">'hmonitor'</span> with grant option;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql -uhmonitor -phmonitor -h127.0.0.1</span></span><br><span class="line">mysql&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// hmonitor 安装</span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># python setup.py build</span></span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># python setup.py install</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>hmonitor 配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//hmonitor.py</span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># vim hmonitor.py</span></span><br><span class="line"><span class="comment">#MySQL</span></span><br><span class="line">define(<span class="string">"port"</span>, default=8888, <span class="built_in">help</span>=<span class="string">"run on the given port"</span>, <span class="built_in">type</span>=int)</span><br><span class="line">define(<span class="string">"mysql_host"</span>, default=<span class="string">"&#123;127.0.0.1:3306&#125;"</span>, <span class="built_in">help</span>=<span class="string">"hmonitor database host"</span>)</span><br><span class="line">define(<span class="string">"mysql_database"</span>, default=<span class="string">"&#123;hmonitor&#125;"</span>, <span class="built_in">help</span>=<span class="string">"hmonitor database name"</span>)</span><br><span class="line">define(<span class="string">"mysql_user"</span>, default=<span class="string">"&#123;hmonitor&#125;"</span>, <span class="built_in">help</span>=<span class="string">"hmonitor database user"</span>)</span><br><span class="line">define(<span class="string">"mysql_password"</span>, default=<span class="string">"&#123;htmonitor&#125;"</span>, <span class="built_in">help</span>=<span class="string">"hmonitor database password"</span>)</span><br><span class="line"><span class="comment">#Zabbix</span></span><br><span class="line">define(<span class="string">"zabbix_user"</span>, default=<span class="string">"&#123;Admin&#125;"</span>, <span class="built_in">help</span>=<span class="string">"Zabbix user name"</span>)</span><br><span class="line">define(<span class="string">"zabbix_password"</span>, default=<span class="string">"&#123;zabbix&#125;"</span>, <span class="built_in">help</span>=<span class="string">"Zabbix password"</span>)</span><br><span class="line">define(<span class="string">"zabbix_url"</span>, default=<span class="string">"&#123;http://zabbix.domain.cn&#125;"</span>, <span class="built_in">help</span>=<span class="string">"Zabbix URL"</span>)</span><br><span class="line"><span class="comment">#Executor</span></span><br><span class="line">define(<span class="string">"executor_driver"</span>, default=<span class="string">"ssh"</span>, <span class="built_in">help</span>=<span class="string">"remote executor driver"</span>)</span><br><span class="line">define(<span class="string">"executor_user"</span>, default=<span class="string">"stack"</span>, <span class="built_in">help</span>=<span class="string">"remote executor user"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/09/hmonitor-install/" data-id="cjazexze6003rqcoqn0tkuwfp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-htmonitor-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/09/htmonitor-install/" class="article-date">
  <time datetime="2017-08-09T00:35:51.000Z" itemprop="datePublished">2017-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Monitor/">Monitor</a>►<a class="article-category-link" href="/categories/Monitor/htmonitor/">htmonitor</a>►<a class="article-category-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/09/htmonitor-install/">htmonitor install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="htmonitor-install"><a href="#htmonitor-install" class="headerlink" title="htmonitor install"></a>htmonitor install</h3><ol>
<li><p>tornado install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter ~]<span class="comment"># python -V</span></span><br><span class="line">Python 2.7.13</span><br><span class="line">[root@alarmcenter ~]<span class="comment"># pip -V</span></span><br><span class="line">pip 9.0.1 from /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages (python 2.7)</span><br><span class="line"></span><br><span class="line">[root@alarmcenter ~]<span class="comment"># cat &gt; requirements.txt &lt;&lt;EOF</span></span><br><span class="line">&gt; tornado&gt;=4.2</span><br><span class="line">&gt; torndb==0.3 <span class="comment"># 0.3 is ok, not sure if other versions can work.</span></span><br><span class="line">&gt; requests&gt;=2.7.0</span><br><span class="line">&gt; six&gt;=1.9.0</span><br><span class="line">&gt; stevedore&gt;=1.5.0</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@alarmcenter ~]<span class="comment"># pip install -r requirements.txt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>mysql install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter ~]<span class="comment"># yum -y install mariadb-server</span></span><br><span class="line">[root@alarmcenter ~]<span class="comment"># systemctl start mariadb</span></span><br><span class="line">[root@alarmcenter ~]<span class="comment"># systemctl enable mariadb</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>下载htmonitor</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter ~]<span class="comment"># cd /mnt/web/</span></span><br><span class="line">[root@alarmcenter web]<span class="comment"># git clone https://github.com/smallasa/hmonitor.git</span></span><br><span class="line"></span><br><span class="line">[root@alarmcenter web]<span class="comment"># cd hmonitor/</span></span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql &lt; db.sql</span></span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql -e "show tables in hmonitor;"</span></span><br><span class="line">+-----------------------+</span><br><span class="line">| Tables_in_hmonitor    |</span><br><span class="line">+-----------------------+</span><br><span class="line">| ALERT_FILTER          |</span><br><span class="line">| ALERT_MSG             |</span><br><span class="line">| AUTOFIX_BINDING       |</span><br><span class="line">| AUTOFIX_LOG           |</span><br><span class="line">| HM_TRIGGER            |</span><br><span class="line">| TRIGGER_EVENTS        |</span><br><span class="line">| USERS                 |</span><br><span class="line">| USERS_TRIGGER_BINDING |</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line">[root@alarmcenter hmonitor]<span class="comment"># mysql</span></span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on hmonitor.* to <span class="string">'hmonitor'</span>@<span class="string">'localhost'</span> identified by <span class="string">'htmonitor'</span> with grant option;</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/09/htmonitor-install/" data-id="cjazexze6003uqcoqmhntwf02" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-tornado-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/09/python-tornado-install/" class="article-date">
  <time datetime="2017-08-09T00:35:35.000Z" itemprop="datePublished">2017-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>►<a class="article-category-link" href="/categories/Python/Python-Framework/">Python Framework</a>►<a class="article-category-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/09/python-tornado-install/">python tornado install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="python-tornado-install"><a href="#python-tornado-install" class="headerlink" title="python tornado install"></a>python tornado install</h3><ol>
<li><p>python install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter app]<span class="comment"># wget https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tar.xz</span></span><br><span class="line">[root@alarmcenter app]<span class="comment"># xz -d Python-2.7.13.tar.xz</span></span><br><span class="line">[root@alarmcenter app]<span class="comment"># tar xf Python-2.7.13.tar</span></span><br><span class="line">[root@alarmcenter app]<span class="comment"># cd Python-2.7.13</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># ./configure --prefix=/usr/local/python27</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># make</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># make install</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># wget https://bootstrap.pypa.io/get-pip.py</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># /usr/local/python27/bin/python get-pip.py</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># echo 'export PYTHON_PATH=/usr/local/python27' |tee /etc/profile.d/python27.sh</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># echo 'export PYTHON_BIN=$PYTHON_PATH/bin' |tee -a /etc/profile.d/python27.sh</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># echo 'export PATH=$PYTHON_BIN:$PATH' |tee -a /etc/profile.d/python27.sh</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># source /etc/profile</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># rm -f /usr/bin/&#123;python,pip&#125;</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># sed -i s/python/python2.7/g /usr/bin/yum</span></span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># python -V</span></span><br><span class="line">Python 2.7.13</span><br><span class="line">[root@alarmcenter Python-2.7.13]<span class="comment"># pip -V</span></span><br><span class="line">pip 9.0.1 from /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages (python 2.7)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pip源设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter ~]<span class="comment"># mkdir ~/.pip</span></span><br><span class="line">[root@alarmcenter ~]<span class="comment"># cat &gt; ~/.pip/pip.conf &lt;&lt;EOF</span></span><br><span class="line">&gt; [global]</span><br><span class="line">&gt; trusted-host=mirrors.aliyun.com</span><br><span class="line">&gt; index-url=http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">&gt; [list]</span><br><span class="line">&gt; format=columns</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>tornado install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@alarmcenter ~]<span class="comment"># pip install tornado</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/09/python-tornado-install/" data-id="cjazexzjt008jqcoql0mmtfx1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-salt-raet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/08/salt-raet/" class="article-date">
  <time datetime="2017-08-08T03:29:12.000Z" itemprop="datePublished">2017-08-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/salt/">salt</a>►<a class="article-category-link" href="/categories/automation/salt/salt-raet/">salt raet</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/08/salt-raet/">salt raet</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="salt-raet"><a href="#salt-raet" class="headerlink" title="salt raet"></a><a href="https://github.com/saltstack/raet" target="_blank" rel="noopener">salt raet</a></h3><ol>
<li><p>简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">salt raet 是继 Salt-Zeromq,Salt-Ssh 之后的第三套通信体系,全名为&quot;Reliable Asynchronous Event Transport&quot;(即基于事件的可靠异步传输协议)</span><br></pre></td></tr></table></figure>
</li>
<li><p>为什么研发salt raet?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">现代大规模的分布式应用架构,其组件均是分布在互联网上的多个主机和多个CPU内核,往往是基于一个消息或事件总线,允许不同的分布式组件之间相互异步通信.</span><br><span class="line">通常情况下,消息总线是某种形式的消息队列服务,如: AMQP 或 ZeroMQ.</span><br><span class="line">消息总线支持通常被称为&quot;发布/订阅&quot;模式的信息交互方式</span><br><span class="line"></span><br><span class="line">一个具备完整功能的消息队列服务拥有很多的优点,然而,其存在的缺陷之一便是&quot;大规模应用环境下的性能问题&quot;</span><br><span class="line"></span><br><span class="line">一个消息队列服务完成两个独立而互补的功能:</span><br><span class="line">第一个是,在互联网上消息的异步传输</span><br><span class="line">第二个是,消息队列管理,这便是通过队列实现的诸如:消息识别,跟踪,存储,以及发布者和订阅者相互之间的消息分发</span><br><span class="line"></span><br><span class="line">对于众多应用程序而言,一个消息队列服务的优势之一便是通过API能很好的隐藏服务背后的细节,也就是其来自各个客户端的消息队列管理的复杂性.但是,消息队列服务存在的主要缺陷便是&quot;大规模应用环境下的扩展性&quot;,其消息的容量,消息的定时以及内存,网络和CPU处理能力相关的需求往往成为关键,而客户端对于服务性能的调整往往显得无能为力.MQ服务在分布式的应用环境下通常会成为瓶颈所在,而更复杂的MQ服务,如 AMQP,则会在高负载下变得不可靠</span><br><span class="line"></span><br><span class="line">异步事件的网络传输 和 消息队列管理之间功能的分离,使得每个功能模块可以独立的调整各自大规模环境下的性能</span><br><span class="line"></span><br><span class="line">绝大部分的MQ服务是基于TCP/IP网络传输协议.TCP/IP对于网络通信有显著的&quot;延迟效应&quot;,因而不太适合用于分布式事件驱动式应用程序交互的异步特性.这其中主要的原因便是在于&quot;TCP/IP为了支持流传输针对&apos;连接的建立&apos;和&apos;连接的关闭&apos;以及&apos;失败连接&apos;的处理&quot;.从根本上来说,&quot;TCP/IP是基于大规模的连续数据流作出了诸多优化,而不太适用于大量小规模异步事件或消息的传输&quot;.其在小规模应用系统下不成问题,而一旦达到一定规模,相关的通信特征的差异问题将会凸显.</span><br><span class="line"></span><br><span class="line">UDP/IP低延迟和无连接的特性注定它更适用于许多小规模异步消息的传输.UDP/IP本身的缺点在于它是不可靠的传输协议.这里所需要的便是一个适配的针对UDP/IP协议增添可靠性,而同时无损其低延迟及扩展性的传输协议.一个事务型协议,比流协议更适用于为异步事件提供可靠传输.进一步来说,由于大部分的MQ服务是基于TCP/IP协议,他们也更倾向于使用HTTP或者保证安全通信的TLS/SSL.虽然使用HTTP能够轻松的提供基于Web的集成系统,但是长远来说它也会成为高性能系统的瓶颈所在,TLS对于一个安全系统而言,其性能和漏洞两方面也同样存在问题.</span><br><span class="line"></span><br><span class="line">椭圆曲线加密,另一方面来说,在相对于其他实现方法更低的性能需求的前提下增强了系统的安全性.LibSodium提供了一个开源的椭圆曲线加密库,用于验证和加密支持.CurveCP协议基于LibSodium提供了一个引导安全网络信息交互的握手协议.最后,在分布式并发事件驱动的应用环境下管理和协调处理器资源(CPU,内存,网络)的一个最佳途径便是使用一种称为微线程的东西.一个微线程应该说是一个程序语言级的特性,它在不比函数调用消耗更多资源的情况下实现了代码逻辑上的并发.</span><br><span class="line"></span><br><span class="line">微线程使用协同工作的多任务处理来取代线程和/或进程,其避免了许多诸如资源竞争,上下文切换,和进程间通信的复杂性,同时提供了更高的性能.由于所有协同工作的微线程均运行于一个进程,也就造成一个简单的微线程应用的资源调用被限制在一个CPU核心.为了使得所有的CPU核心均得到充分的利用,应用程序需要能够为每个CPU核心运行至少一个进程.这就需要同一台主机的进程间通信.但是不同于传统的多进程处理方式,即一个进程完成一个逻辑并发的功能,一个基于微线程的多进程程序不再使用一个微线程处理一个逻辑并发功能的模式,而微线程的总数是取决于总的进程的最小数目的限制,并且其不超过CPU的核心数量.这将优化CPU的处理能力,同时最大限度地减少进程上下文切换的开销.</span><br><span class="line"></span><br><span class="line">一个使用这样的&quot;微线程-多进程&quot;架构平台的典型例子便是Erlang.事实上,Erlang模式的成功为RAET方案的可行性提供了强有力的支持.进一步来说,一个潜在的问题可能是:我们为什么不使用Erlang呢? 很不幸的是,Erlang生态系统跟Python相比较而言有些时候显得有些局限性,而它本身则使用了一种不太友好的语法结构. RAET的设计实现目标之一便是充分集成现有的Python生态系统丰富的类库和知识集,同时又能够方便的开发一个基于&quot;微线程-多进程&quot;架构模型的分布式应用程序.我们的终极目标便是想两全其美.</span><br><span class="line"></span><br><span class="line">RAET设计用于借助&quot;微线程-多进程&quot;应用框架提供在互联网上安全可靠的,可扩展的异步消息/事件传输,其使用UDP协议来完成主机间的通信,LibSodium来完成认证,加密,CurveCP握手协议来达成安全引导.相应的队列管理和微线程应用程序的支持由Ioflo提供.RAET可以算作是Ioflo的一个互补项目,它使得多个Ioflo程序可以通过网络结合在一起,作为一个分布式程序的一部分协同工作.</span><br><span class="line"></span><br><span class="line">导致开发RAET的一个主要驱动因素便是&quot;使得Saltstack具备更好的扩展性的需求&quot;.Saltstack是一个使用Python编写的远程执行和配置管理平台.Saltstack使用Zeromq作为它的消息总线或者说消息队列服务.Zeromq是基于TCP/IP传输协议实现的,因而也存在上述相应的TCP/IP基础架构下的延迟及非同步性问题.此外,因为Zeromq是通过一个特殊的&quot;套接字&quot;将队列管理和传输集成在一起,其大规模应用环境下的队列的独立传输性能也成为问题所在,甚至于跟踪Bug也存在一定的困难.</span><br></pre></td></tr></table></figure>
</li>
<li><p>raet安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install raet</span><br></pre></td></tr></table></figure>
</li>
<li><p>Raet支持两种通信方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Raet支持两种通信方式:</span><br><span class="line">* 主机间通过UDP/IP协议套接字通信</span><br><span class="line">* 通过Unix域(UXD)套接字实现的同一主机进程间通信</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="salt-raet/RaetMetaphor.png" alt="RaetMetaphor"><br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">如上图:</span><br><span class="line">Road,Estates,Main Estate:</span><br><span class="line">* UPD通道便是一个&quot;Road&quot;</span><br><span class="line">* 一个Road的成员便是&quot;Estates&quot;(就像现实中房屋前方的道路)</span><br><span class="line">* 每个Estate拥有一个唯一的UDP主机端口地址&quot;ha&quot;,一个唯一的字符串&quot;name&quot;和一个唯一的数字ID&quot;eid&quot;</span><br><span class="line">* 一个Road上的Estate便称为&quot;Main Estate&quot;</span><br><span class="line">* Main Estate允许其他Estates通过Join方法(key交换)加入到Road上并且允许(CurveCP)相互之间的信息交易</span><br><span class="line">* Main Estate同样负责担任其他Estates的消息路由</span><br><span class="line"></span><br><span class="line">Lane，Yards，Main Yard:</span><br><span class="line">* 每个Estate都可以是一个&quot;Lane&quot;,这便是一个UXD通道</span><br><span class="line">* 一个Lane的成员便是&quot;Yard&quot;(简单来说便是一个Estate的细分点)</span><br><span class="line">* 一个Lane的每个Yard成员都有一个唯一的UXD文件名称,主机地址&quot;ha&quot;和一个唯一的字符串&quot;name&quot;.这个类通常也有一个Yard的数字ID&quot;yid&quot;用于生成Yard name但是它不是Yard实例的属性之一</span><br><span class="line">* Lane name和Yard name结合起来便可以形成一个唯一的文件名,它是UXD的主机地址&quot;ha&quot;</span><br><span class="line">* 一个Lane上的Yard便是一个Main Yard</span><br><span class="line">* Main Yard负责形成Lane并且允许其他Yards加入到该lane;在此之前这还没有一个正式的处理过程.当前这会设置一个由Main yard维护的标志,其将会把任何事先未在Yards列表里的Yard发送过来的数据包Drop掉.另外,文件权限的设置可以用来阻止伪Yards与Main Yard交互</span><br><span class="line">* Main Yard还负责其他Lane上的Yards之间的消息路由</span><br><span class="line"></span><br><span class="line">运行IoFlo:</span><br><span class="line">* 每个Estate UDP接口运行于一个在单个IoFlo House上下文中工作的RoadStack(UDP套接字),因此可以把运行UDP Stack的House看作是Estate组成的庄园别墅</span><br><span class="line">* 每个Yard UXD接口运行于一个在单个IoFlo House上下文中工作的 LaneStack(Unix域套接字),因此可以把运行UXD Stack的House看作是Estate的附属Houses、Tents或Shacks</span><br><span class="line">* &quot;庄园&quot;House的特殊之处在于其可以运行在针对Estate的UDP Stack和针对Main Yard的UXD Stack两套环境下运行</span><br><span class="line">* Main Estate UDP Stack的House可以被认为是Mayor&apos;s House;</span><br><span class="line">* 在上下文中,一个House便是一个数据存储.共享的数据存储可以被以一个点号分隔路径的唯一共享名称定位</span><br><span class="line"></span><br><span class="line">路由</span><br><span class="line">鉴于上面所描述的Ioflo运行架构,其依照如下方式完成路由:</span><br><span class="line">* 为了定位一个特定的Estate，Estate name需要相应的指定</span><br><span class="line">* 为了定位一个Estate下的特定Yard，Yard name需要相应的指定</span><br><span class="line">* 为了定位一个House下的特定Queue，Share name需要相应的指定</span><br><span class="line"></span><br><span class="line">UDP stack 将Estate name映射到UDP主机地址和Estate ID,而UXD stack 将Yard name映射到UXD主机地址,任意IoFlo行为的存储将Share name映射到共享引用.因此,路由是从: 在一个源Share、源Yard或是一个源Estate中的队列定义好的一个源节点到,一个源Share、源Yard或是一个源Estate中的队列定义好的目的节点</span><br><span class="line"></span><br><span class="line">这里需要两个三选一的节点,一个是源节点,另一个则是目标节点:</span><br><span class="line">* 源节点(Estate name，Yard name，Share name)</span><br><span class="line">* 目标节点(Estate name，Yard name，Share name)</span><br><span class="line">如果三合一中的任一元素均是None或者空,那么便会使用默认参数值</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/08/salt-raet/" data-id="cjazexzme00alqcoqo3p9oa8l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-salt-advanced-topic" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/07/salt-advanced-topic/" class="article-date">
  <time datetime="2017-08-07T08:12:24.000Z" itemprop="datePublished">2017-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/salt/">salt</a>►<a class="article-category-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/07/salt-advanced-topic/">salt advanced topic</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="salt高级话题"><a href="#salt高级话题" class="headerlink" title="salt高级话题"></a>salt高级话题</h3><ol>
<li><p>salt job管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">// job概念</span><br><span class="line">slat每次运行任务时都会将作业任务发布到pub-sub总线,minion会对任务做出响应.为区分不同任务,salt-master每次发布一个任务都会为该任务创建一个jobid,不同的jobid对应一个独立的操作任务,master端默认会缓存24小时内的所有job详细操作</span><br><span class="line"></span><br><span class="line">master 缓存目录: /var/cache/salt/master/jobs</span><br><span class="line">minion 缓存目录: /var/cache/salt/minion/proc,创建以jobid为名的文件,文件内容是对本次任务的缓存,任务执行完后文件会被删除.使用&quot;strings /var/cache/salt/minion/proc/2017080912124243524&quot;进行查看缓存文件内容</span><br><span class="line"></span><br><span class="line">例如:</span><br><span class="line">在master上长时间执行一个命令:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; cmd.run &apos;sleep 1000;echo hello&apos;</span><br><span class="line">在minion上查看:</span><br><span class="line">[root@saltminion ~]# ls /var/cache/salt/minion/proc/20170807162006823661</span><br><span class="line">/var/cache/salt/minion/proc/20170807162006823661</span><br><span class="line">[root@saltminion ~]# strings /var/cache/salt/minion/proc/20170807162006823661</span><br><span class="line">tgt_type</span><br><span class="line">glob</span><br><span class="line">20170807162006823661</span><br><span class="line">user</span><br><span class="line">root</span><br><span class="line">sleep 1000;echo hello</span><br><span class="line">cmd.run</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 管理job</span><br><span class="line">通过 salt-run 命令来管理job,这种方式其实是通过runner系统对job进行管理;另一种管理job的方式是通过 saltutil模块</span><br><span class="line"></span><br><span class="line">例如: 执行过程中 中断</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; cmd.run &apos;sleep 1000;echo hello&apos;</span><br><span class="line">^C</span><br><span class="line">Exiting gracefully on Ctrl-c</span><br><span class="line">This job&apos;s jid is: 20170807162218636420</span><br><span class="line">The minions may not have all finished running and any remaining minions will return upon completion. To look up the return data for this job later, run the following command:</span><br><span class="line">salt-run jobs.lookup_jid 20170807162218636420</span><br><span class="line"></span><br><span class="line">综上,我们看到jobid是20170807162218636420</span><br><span class="line">在minion上查看:</span><br><span class="line">[root@saltminion ~]# ls /var/cache/salt/minion/proc/20170807162218636420</span><br><span class="line">/var/cache/salt/minion/proc/20170807162218636420</span><br><span class="line"></span><br><span class="line">通过saltutil进行查看:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; saltutil.find_job 20170807162218636420</span><br><span class="line">192.168.13.187:</span><br><span class="line">    ----------</span><br><span class="line">    arg:</span><br><span class="line">        - sleep 1000;echo hello</span><br><span class="line">    fun:</span><br><span class="line">        cmd.run</span><br><span class="line">    jid:</span><br><span class="line">        20170807162218636420</span><br><span class="line">    pid:</span><br><span class="line">        30823</span><br><span class="line">    ret:</span><br><span class="line">    tgt:</span><br><span class="line">        *</span><br><span class="line">    tgt_type:</span><br><span class="line">        glob</span><br><span class="line">    user:</span><br><span class="line">        root</span><br><span class="line"></span><br><span class="line">通过kill指令杀死job:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; saltutil.kill_job 20170807162218636420    </span><br><span class="line">192.168.13.187:</span><br><span class="line">    Signal 9 sent to job 20170807162218636420 at pid 30823</span><br><span class="line"></span><br><span class="line">查看master上cache的所有job:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; saltutil.runner jobs.list_jobs</span><br></pre></td></tr></table></figure>
</li>
<li><p>runner系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">前面通过salt master通过执行模块管理salt minion,除此之外,salt还为我们提供了runners系统,runner和salt的模块类似,不同点是salt的模块在minion上执行,runner在sat master上执行,而salt master可以在任意minion执行任务.</span><br><span class="line">所以,通过runner可以控制不同minion的执行顺序,这一点是state模块无法做到的.通过salt-run可以调用salt的runner功能</span><br><span class="line"></span><br><span class="line">//minion管理</span><br><span class="line">探测主机是否存活:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; test.ping</span><br><span class="line">192.168.13.187:</span><br><span class="line">    True</span><br><span class="line">通过runner也可以达到同样效果,不同的是runner不需要匹配目标minion:</span><br><span class="line">[root@saltserver ~]# salt-run manage.up</span><br><span class="line">- 192.168.13.187</span><br><span class="line">这条命令实质上是runner调用master并对所有minion进行test.ping,不同的是runner只在master上执行,没有和任何minion进行通信</span><br><span class="line"></span><br><span class="line">[root@saltserver ~]# salt-run manage.down</span><br><span class="line">这条命令也是通过master对所有minion调用test.ping函数,然后和已经注册的minion做比较,找出现在已经不能连接的minion,然后进行输出</span><br><span class="line"></span><br><span class="line">//job管理</span><br><span class="line">查看所有和job管理相关的命令:</span><br><span class="line">[root@saltserver ~]# salt-run -d |grep job</span><br><span class="line"></span><br><span class="line">列出24小时内所有job:</span><br><span class="line">[root@saltserver ~]# salt-run jobs.list_jobs</span><br><span class="line"></span><br><span class="line">查看某一个特定的job:</span><br><span class="line">[root@saltserver ~]# salt-run jobs.list_job 20170807162218636420</span><br><span class="line"></span><br><span class="line">//orchestrate</span><br><span class="line">runner可以控制不同minion的执行顺序,runner有一项功能用于管理多台minion的状态:orchestrate runner.</span><br><span class="line">例如:</span><br><span class="line">[root@saltserver ~]# vim /srv/salt/orch.sls</span><br><span class="line">mysql_mod:</span><br><span class="line">  salt.state:</span><br><span class="line">    - tgt: &apos;minion-one&apos;</span><br><span class="line">    - tgt_type: list</span><br><span class="line">    - sls: mysql</span><br><span class="line">web_mod:</span><br><span class="line">  salt.state:</span><br><span class="line">    - tgt: &apos;minion-two&apos;</span><br><span class="line">    - tgt_type: list</span><br><span class="line">    - sls: httpd</span><br><span class="line">    - require:</span><br><span class="line">      - salt: mysql_mod</span><br><span class="line"></span><br><span class="line">执行:</span><br><span class="line">[root@saltserver ~]# salt-run state.orchestrate orch</span><br><span class="line"></span><br><span class="line">综上,通过这样的模块顺序控制使得minion-one必须先安装mysql后,才能让minion-two再安装httpd</span><br></pre></td></tr></table></figure>
</li>
<li><p>event系统和reactor系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br></pre></td><td class="code"><pre><span class="line">//event系统</span><br><span class="line">event是salt通信的核心,每一个event可以认为是salt的一个执行单元,比job要宽泛,job可以看成一种特殊的event</span><br><span class="line"></span><br><span class="line">例如: 写一个脚本用于监听master的event</span><br><span class="line">* 编写脚本:</span><br><span class="line">[root@saltserver ~]# vim eventlisten.py</span><br><span class="line">#-*- coding:utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">This script is a generic tool to test event output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># import python libs</span><br><span class="line">from __future__ import absolute_import,print_function</span><br><span class="line">import optparse</span><br><span class="line">import pprint</span><br><span class="line">import time</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># import salt libs</span><br><span class="line">import salt.utils.event</span><br><span class="line"></span><br><span class="line"># import 3rd-party libs</span><br><span class="line">import salt.ext.six as six</span><br><span class="line"></span><br><span class="line">def parse():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Parse the script command line inputs</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    parser = optparse.OptionParser()</span><br><span class="line">    parser.add_option(</span><br><span class="line">        &apos;-s&apos;,</span><br><span class="line">        &apos;--sock-dir&apos;,</span><br><span class="line">        dest=&apos;sock_dir&apos;,</span><br><span class="line">        default=&apos;/var/run/salt&apos;,</span><br><span class="line">        help=(&apos;statically define the directory holding the salt unix sockets for communication&apos;)</span><br><span class="line">    )</span><br><span class="line">    parser.add_option(</span><br><span class="line">        &apos;-n&apos;,</span><br><span class="line">        &apos;--node&apos;,</span><br><span class="line">        dest=&apos;node&apos;,</span><br><span class="line">        default=&apos;master&apos;,</span><br><span class="line">        help=(&apos;state if this listener will attach to a master or a minion daemon,pass &quot;master&quot; or &quot;minion&quot;&apos;)</span><br><span class="line">    )</span><br><span class="line">    parser.add_option(</span><br><span class="line">        &apos;-f&apos;,</span><br><span class="line">        &apos;--func_count&apos;,</span><br><span class="line">        default=&apos;&apos;,</span><br><span class="line">        help=(&apos;Return a count of the number of minions which hava replied to a job with a ggiven func.&apos;)</span><br><span class="line">    )</span><br><span class="line">    parser.add_option(</span><br><span class="line">        &apos;-i&apos;,</span><br><span class="line">        &apos;--id&apos;,</span><br><span class="line">        default=&apos;&apos;,</span><br><span class="line">        help=(&apos;if connection to a live master or minion,pass in the id&apos;)</span><br><span class="line">    )</span><br><span class="line">    parser.add_option(</span><br><span class="line">        &apos;-t&apos;,</span><br><span class="line">        &apos;--transport&apos;,</span><br><span class="line">        default=&apos;zeromq&apos;,</span><br><span class="line">        help=(&apos;Transport to use. Default:\&apos;zeromq\&apos;&apos;)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    options, args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    opts = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    for k,v in six.iteritems(options.__dict__):</span><br><span class="line">        if v is not None:</span><br><span class="line">            opts[k] = v</span><br><span class="line"></span><br><span class="line">    opts[&apos;sock_dir&apos;] = os.path.join(opts[&apos;sock_dir&apos;],opts[&apos;node&apos;])</span><br><span class="line"></span><br><span class="line">    if &apos;minion&apos; in options.node:</span><br><span class="line">        if args:</span><br><span class="line">            opts[&apos;id&apos;] = args[0]</span><br><span class="line">            return opts</span><br><span class="line">        if options.id:</span><br><span class="line">            opts[&apos;id&apos;] = options.id</span><br><span class="line">        else:</span><br><span class="line">            opts[&apos;id&apos;] = options.node</span><br><span class="line">    return opts</span><br><span class="line"></span><br><span class="line">def check_access_and_print_warning(sock_dir):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    check if this user is able to access the socket directory and print a warning if not</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if (os.access(sock_dir,os.R_OK) and</span><br><span class="line">        os.access(sock_dir,os.W_OK) and</span><br><span class="line">        os.access(sock_dir,os.X_OK)):</span><br><span class="line">        return</span><br><span class="line">    else:</span><br><span class="line">        print(&apos;Warning: Events will not be reported &quot;(not able to access &#123;0&#125;)&quot;.format(sock_dir)&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def listen(opts):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    attach to the pub socket and grab messges</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    event = salt.utils.event.get_event(</span><br><span class="line">        opts[&apos;node&apos;],</span><br><span class="line">        sock_dir = opts[&apos;sock_dir&apos;],</span><br><span class="line">        transport = opts[&apos;transport&apos;],</span><br><span class="line">        opts = opts,</span><br><span class="line">        listen = True</span><br><span class="line">    )</span><br><span class="line">    check_access_and_print_warning(opts[&apos;sock_dir&apos;])</span><br><span class="line">    print(event.puburi)</span><br><span class="line">    jid_counter = 0</span><br><span class="line">    found_minions = []</span><br><span class="line">    while True:</span><br><span class="line">        ret = event.get_event(full=True)</span><br><span class="line">        if ret is None:</span><br><span class="line">            continue</span><br><span class="line">        if opts[&apos;func_count&apos;]:</span><br><span class="line">            data = ret.get(&apos;data&apos;,False)</span><br><span class="line">            if data:</span><br><span class="line">                if &apos;id&apos; in six.iterkeys(data) and data.get(&apos;id&apos;,False) not in found_minions:</span><br><span class="line">                    if data[&apos;fun&apos;] == opts[&apos;func_count&apos;]:</span><br><span class="line">                        jid_counter += 1</span><br><span class="line">                        found_minions.append(data[&apos;id&apos;])</span><br><span class="line">                        print(&apos;Reply received from [&#123;0&#125;]. Total replies now:[&#123;1&#125;].&apos;.format(ret[&apos;data&apos;][&apos;id&apos;],jid_counter))</span><br><span class="line">                    continue</span><br><span class="line">        else:</span><br><span class="line">            print(&apos;Event fired at &#123;0&#125;&apos;.format(time.asctime()))</span><br><span class="line">            print(&apos;*&apos; * 25)</span><br><span class="line">            print(&apos;Tag: &#123;0&#125;&apos;.format(ret[&apos;tag&apos;]))</span><br><span class="line">            print(&apos;Data:&apos;)</span><br><span class="line">            pprint.pprint(ret[&apos;data&apos;])</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    opts = parse()</span><br><span class="line">    listen(opts)</span><br><span class="line"></span><br><span class="line">* 在salt-master上执行脚本:</span><br><span class="line">[root@saltserver ~]# python eventlisten.py</span><br><span class="line">/var/run/salt/master/master_event_pub.ipc</span><br><span class="line"></span><br><span class="line">* 在打开一个salt-master终端进行执行:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; test.ping</span><br><span class="line">192.168.13.187:</span><br><span class="line">    True</span><br><span class="line"></span><br><span class="line">* 在salt-master上查看输出信息:</span><br><span class="line">[root@saltserver ~]# python eventlisten.py</span><br><span class="line">/var/run/salt/master/master_event_pub.ipc</span><br><span class="line">Event fired at Tue Aug  8 10:06:47 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: 20170808100647714897</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:06:47.715514&apos;, &apos;minions&apos;: [&apos;192.168.13.187&apos;]&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:06:47 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/job/20170808100647714897/new</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:06:47.716171&apos;,</span><br><span class="line"> &apos;arg&apos;: [],</span><br><span class="line"> &apos;fun&apos;: &apos;test.ping&apos;,</span><br><span class="line"> &apos;jid&apos;: &apos;20170808100647714897&apos;,</span><br><span class="line"> &apos;minions&apos;: [&apos;192.168.13.187&apos;],</span><br><span class="line"> &apos;tgt&apos;: &apos;*&apos;,</span><br><span class="line"> &apos;tgt_type&apos;: &apos;glob&apos;,</span><br><span class="line"> &apos;user&apos;: &apos;root&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:06:47 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/job/20170808100647714897/ret/192.168.13.187</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:06:47.797479&apos;,</span><br><span class="line"> &apos;cmd&apos;: &apos;_return&apos;,</span><br><span class="line"> &apos;fun&apos;: &apos;test.ping&apos;,</span><br><span class="line"> &apos;fun_args&apos;: [],</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;jid&apos;: &apos;20170808100647714897&apos;,</span><br><span class="line"> &apos;retcode&apos;: 0,</span><br><span class="line"> &apos;return&apos;: True,</span><br><span class="line"> &apos;success&apos;: True&#125;</span><br><span class="line"></span><br><span class="line"> 综上,event输出包含两部分:</span><br><span class="line"> 部分一: tag,类似于一个url</span><br><span class="line">        salt/job/20170808100647714897/new</span><br><span class="line">        这条tag从左到右说明了:类型,任务ID,任务标识</span><br><span class="line"> 部分二: 数据字典,包含:时间戳,调用函数,jid,minion信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//salt为我们提供了event.send模块可自定义event,例如:</span><br><span class="line">* 在master端执行</span><br><span class="line">[root@saltserver ~]# python eventlisten.py</span><br><span class="line">/var/run/salt/master/master_event_pub.ipc</span><br><span class="line">* 在minion端执行</span><br><span class="line">[root@saltminion ~]# salt-call  event.send myco/mytag foo=Foo bar=Bar</span><br><span class="line">local:</span><br><span class="line">    True</span><br><span class="line">* 在master端查看</span><br><span class="line">[root@saltserver ~]# python eventlisten.py         </span><br><span class="line">/var/run/salt/master/master_event_pub.ipc</span><br><span class="line">Event fired at Tue Aug  8 10:21:41 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/auth</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:21:41.187922&apos;,</span><br><span class="line"> &apos;act&apos;: &apos;accept&apos;,</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;pub&apos;: &apos;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnZHnTfGzMpKiNqPmwM1Q\nrgnRGSrA8eNghWRBECq+raT3qG99xvY7sjP1at8Ul/fnEMCC/K1W4CJz/6TN2lG/\n1jVh77zk9W/PbABGv5i00ZpmxZBtgNywRj4wL9IPPDmalSqm13HnjnVQ7+1I4MK7\naQDmkihGWynSh5U/CGLpApWNowcGw2Xui0d3jdrhGjngvmFuwooCLHlXDOXE3kLY\n1/5oE1+NpM4+6Hbg09XQ6wXtAnM7zNW1GFBfuNTh9ZymkicUso8uqZXCH2dUrf+e\n8VViFb01jBOBgThXm4hmqyF+NfbrjlFmcfSMJ73pJBC1VvmfQ4+F9oSksJGVufkl\n7QIDAQAB\n-----END PUBLIC KEY-----&apos;,</span><br><span class="line"> &apos;result&apos;: True&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:21:41 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: minion/refresh/192.168.13.187</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;Minion data cache refresh&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;_stamp&apos;: &apos;2017-08-08T02:21:41.311715&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:21:41 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: myco/mytag</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:21:41.396306&apos;,</span><br><span class="line"> &apos;cmd&apos;: &apos;_minion_event&apos;,</span><br><span class="line"> &apos;data&apos;: &#123;&apos;__pub_fun&apos;: &apos;event.send&apos;,</span><br><span class="line">          &apos;__pub_jid&apos;: &apos;20170808102141379062&apos;,</span><br><span class="line">          &apos;__pub_pid&apos;: 31706,</span><br><span class="line">          &apos;__pub_tgt&apos;: &apos;salt-call&apos;,</span><br><span class="line">          &apos;bar&apos;: &apos;Bar&apos;,</span><br><span class="line">          &apos;foo&apos;: &apos;Foo&apos;&#125;,</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;tag&apos;: &apos;myco/mytag&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:21:41 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/job/20170808102141404168/ret/192.168.13.187</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:21:41.405667&apos;,</span><br><span class="line"> &apos;arg&apos;: [&apos;myco/mytag&apos;, &apos;foo=Foo&apos;, &apos;bar=Bar&apos;],</span><br><span class="line"> &apos;cmd&apos;: &apos;_return&apos;,</span><br><span class="line"> &apos;fun&apos;: &apos;event.send&apos;,</span><br><span class="line"> &apos;fun_args&apos;: [&apos;myco/mytag&apos;, &apos;foo=Foo&apos;, &apos;bar=Bar&apos;],</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;jid&apos;: &apos;20170808102141404168&apos;,</span><br><span class="line"> &apos;retcode&apos;: 0,</span><br><span class="line"> &apos;return&apos;: True,</span><br><span class="line"> &apos;tgt&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;tgt_type&apos;: &apos;glob&apos;&#125;</span><br><span class="line"></span><br><span class="line">综上,我们看到新产生的event的tag正是我们自己触发的Event.我们既然可以获取这么多的Event,如果能对这些event做定制化的相应会使salt更加灵活强大. salt为我们设计了Reactor系统,可以对event做出相应</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//reactor系统</span><br><span class="line">reactor分两部分来配置:</span><br><span class="line">部分一: 在master配置文件中,定义哪些event触发哪些reactor文件</span><br><span class="line">部分二: reactor的SLS配置文件,定义对事件作出相应时采取哪些操作</span><br><span class="line"></span><br><span class="line">例如:(修改master配置)</span><br><span class="line">* 修改master配置文件</span><br><span class="line">[root@saltserver ~]# vim /etc/salt/master</span><br><span class="line">reactor:</span><br><span class="line">  - &apos;myco/*&apos;:</span><br><span class="line">    - salt://reactor.sls</span><br><span class="line"></span><br><span class="line">* 重启salt-master</span><br><span class="line">[root@saltserver ~]# pkill salt-master</span><br><span class="line">[root@saltserver ~]# salt-master -c /etc/salt -d</span><br><span class="line"></span><br><span class="line">* 定义reactor.sls文件</span><br><span class="line">[root@saltserver ~]# vim /srv/salt/reactor.sls</span><br><span class="line">my_first_reactor:</span><br><span class="line">  local.cmd.run:</span><br><span class="line">    - tgt: &apos;192.168.13.187&apos;</span><br><span class="line">    - arg:</span><br><span class="line">      - &apos;touch /tmp/my_first_reactor&apos;</span><br><span class="line"></span><br><span class="line">* 在master上执行</span><br><span class="line">[root@saltserver ~]# python eventlisten.py</span><br><span class="line">/var/run/salt/master/master_event_pub.ipc</span><br><span class="line"></span><br><span class="line">* 在minion上执行</span><br><span class="line">[root@saltminion ~]# salt-call  event.send myco/mytag foo=Foo bar=Bar</span><br><span class="line">local:</span><br><span class="line">    True</span><br><span class="line"></span><br><span class="line">* 在master上观察输出结果</span><br><span class="line">[root@saltserver ~]# python eventlisten.py</span><br><span class="line">/var/run/salt/master/master_event_pub.ipc</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/auth</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.543849&apos;,</span><br><span class="line"> &apos;act&apos;: &apos;accept&apos;,</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;pub&apos;: &apos;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnZHnTfGzMpKiNqPmwM1Q\nrgnRGSrA8eNghWRBECq+raT3qG99xvY7sjP1at8Ul/fnEMCC/K1W4CJz/6TN2lG/\n1jVh77zk9W/PbABGv5i00ZpmxZBtgNywRj4wL9IPPDmalSqm13HnjnVQ7+1I4MK7\naQDmkihGWynSh5U/CGLpApWNowcGw2Xui0d3jdrhGjngvmFuwooCLHlXDOXE3kLY\n1/5oE1+NpM4+6Hbg09XQ6wXtAnM7zNW1GFBfuNTh9ZymkicUso8uqZXCH2dUrf+e\n8VViFb01jBOBgThXm4hmqyF+NfbrjlFmcfSMJ73pJBC1VvmfQ4+F9oSksJGVufkl\n7QIDAQAB\n-----END PUBLIC KEY-----&apos;,</span><br><span class="line"> &apos;result&apos;: True&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: minion/refresh/192.168.13.187</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;Minion data cache refresh&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;_stamp&apos;: &apos;2017-08-08T02:32:51.669152&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: myco/mytag</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.755789&apos;,</span><br><span class="line"> &apos;cmd&apos;: &apos;_minion_event&apos;,</span><br><span class="line"> &apos;data&apos;: &#123;&apos;__pub_fun&apos;: &apos;event.send&apos;,</span><br><span class="line">          &apos;__pub_jid&apos;: &apos;20170808103251736557&apos;,</span><br><span class="line">          &apos;__pub_pid&apos;: 31742,</span><br><span class="line">          &apos;__pub_tgt&apos;: &apos;salt-call&apos;,</span><br><span class="line">          &apos;bar&apos;: &apos;Bar&apos;,</span><br><span class="line">          &apos;foo&apos;: &apos;Foo&apos;&#125;,</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;tag&apos;: &apos;myco/mytag&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/job/20170808103251765140/ret/192.168.13.187</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.768086&apos;,</span><br><span class="line"> &apos;arg&apos;: [&apos;myco/mytag&apos;, &apos;foo=Foo&apos;, &apos;bar=Bar&apos;],</span><br><span class="line"> &apos;cmd&apos;: &apos;_return&apos;,</span><br><span class="line"> &apos;fun&apos;: &apos;event.send&apos;,</span><br><span class="line"> &apos;fun_args&apos;: [&apos;myco/mytag&apos;, &apos;foo=Foo&apos;, &apos;bar=Bar&apos;],</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;jid&apos;: &apos;20170808103251765140&apos;,</span><br><span class="line"> &apos;retcode&apos;: 0,</span><br><span class="line"> &apos;return&apos;: True,</span><br><span class="line"> &apos;tgt&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;tgt_type&apos;: &apos;glob&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: 20170808103251827538</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.829254&apos;, &apos;minions&apos;: [&apos;192.168.13.187&apos;]&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/job/20170808103251827538/new</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.829749&apos;,</span><br><span class="line"> &apos;arg&apos;: [&apos;touch /tmp/my_first_reactor&apos;],</span><br><span class="line"> &apos;fun&apos;: &apos;cmd.run&apos;,</span><br><span class="line"> &apos;jid&apos;: &apos;20170808103251827538&apos;,</span><br><span class="line"> &apos;minions&apos;: [&apos;192.168.13.187&apos;],</span><br><span class="line"> &apos;tgt&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;tgt_type&apos;: &apos;glob&apos;,</span><br><span class="line"> &apos;user&apos;: &apos;root&apos;&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/auth</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.890407&apos;,</span><br><span class="line"> &apos;act&apos;: &apos;accept&apos;,</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;pub&apos;: &apos;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnZHnTfGzMpKiNqPmwM1Q\nrgnRGSrA8eNghWRBECq+raT3qG99xvY7sjP1at8Ul/fnEMCC/K1W4CJz/6TN2lG/\n1jVh77zk9W/PbABGv5i00ZpmxZBtgNywRj4wL9IPPDmalSqm13HnjnVQ7+1I4MK7\naQDmkihGWynSh5U/CGLpApWNowcGw2Xui0d3jdrhGjngvmFuwooCLHlXDOXE3kLY\n1/5oE1+NpM4+6Hbg09XQ6wXtAnM7zNW1GFBfuNTh9ZymkicUso8uqZXCH2dUrf+e\n8VViFb01jBOBgThXm4hmqyF+NfbrjlFmcfSMJ73pJBC1VvmfQ4+F9oSksJGVufkl\n7QIDAQAB\n-----END PUBLIC KEY-----&apos;,</span><br><span class="line"> &apos;result&apos;: True&#125;</span><br><span class="line">Event fired at Tue Aug  8 10:32:51 2017</span><br><span class="line">*************************</span><br><span class="line">Tag: salt/job/20170808103251827538/ret/192.168.13.187</span><br><span class="line">Data:</span><br><span class="line">&#123;&apos;_stamp&apos;: &apos;2017-08-08T02:32:51.984504&apos;,</span><br><span class="line"> &apos;cmd&apos;: &apos;_return&apos;,</span><br><span class="line"> &apos;fun&apos;: &apos;cmd.run&apos;,</span><br><span class="line"> &apos;fun_args&apos;: [&apos;touch /tmp/my_first_reactor&apos;],</span><br><span class="line"> &apos;id&apos;: &apos;192.168.13.187&apos;,</span><br><span class="line"> &apos;jid&apos;: &apos;20170808103251827538&apos;,</span><br><span class="line"> &apos;retcode&apos;: 0,</span><br><span class="line"> &apos;return&apos;: &apos;&apos;,</span><br><span class="line"> &apos;success&apos;: True&#125;</span><br><span class="line"></span><br><span class="line"> * 在minion上查看</span><br><span class="line"> [root@saltminion ~]# ls -1 /tmp/my_first_reactor</span><br><span class="line">/tmp/my_first_reactor</span><br></pre></td></tr></table></figure>
</li>
<li><p>salt api</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">salt 提供了大量的 python API 来供第三方程序调用,这些python API可以让我们将Salt强大的功能通过几行代码嵌入到自己的脚本和程序中来完成复杂的任务</span><br><span class="line"></span><br><span class="line">// salt配置文件信息获取</span><br><span class="line">&gt;&gt;&gt; import salt.config</span><br><span class="line">&gt;&gt;&gt; master_opts = salt.config.client_config(&apos;/etc/salt/master&apos;)</span><br><span class="line">&gt;&gt;&gt; master_opts</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; minion_opts = salt.config.client_config(&apos;/etc/salt/minion&apos;)</span><br><span class="line">&gt;&gt;&gt; minion_opts</span><br><span class="line"></span><br><span class="line">// salt loader API</span><br><span class="line">通过Loader API我们加载salt的执行模块,还可以获取salt的grains等数据信息</span><br><span class="line">&gt;&gt;&gt; import salt.config</span><br><span class="line">&gt;&gt;&gt; import salt.loader</span><br><span class="line">&gt;&gt;&gt; __opts__ = salt.config.minion_config(&apos;/etc/salt/minion&apos;)</span><br><span class="line">&gt;&gt;&gt; __grains__ = salt.loader.grains(__opts__)</span><br><span class="line">&gt;&gt;&gt; __grains__</span><br><span class="line"></span><br><span class="line">加载执行模块:</span><br><span class="line">&gt;&gt;&gt; import salt.config</span><br><span class="line">&gt;&gt;&gt; import salt.loader</span><br><span class="line">&gt;&gt;&gt; __opts__ = salt.config.minion_config(&apos;/etc/salt/minion&apos;)</span><br><span class="line">&gt;&gt;&gt; __salt__ = salt.loader.minion_mods(__opts__)</span><br><span class="line">&gt;&gt;&gt; __salt__[&apos;cmd.run&apos;](&quot;ls /&quot;)</span><br><span class="line"></span><br><span class="line">//LocalClient</span><br><span class="line">LocalClient是最常用的Salt API之一,通过LocalClient的cmd等方法我们可以实现salt执行远程模块的功能</span><br><span class="line">* 用local.cmd批量执行远程模块</span><br><span class="line">&gt;&gt;&gt; import salt.client</span><br><span class="line">&gt;&gt;&gt; local = salt.client.LocalClient()</span><br><span class="line">&gt;&gt;&gt; local.cmd(&apos;*&apos;,&apos;test.fib&apos;,&apos;10&apos;)</span><br><span class="line">* 用local.cmd_async批量异步执行远程模块</span><br><span class="line">&gt;&gt;&gt; import salt.client</span><br><span class="line">&gt;&gt;&gt; local = salt.client.LocalClient()</span><br><span class="line">&gt;&gt;&gt; local.cmd_async(&apos;*&apos;,&apos;test.sleep&apos;,[30])</span><br><span class="line">&apos;20170808104645529446&apos;</span><br><span class="line">[root@saltserver ~]# salt-run  jobs.list_job 20170808104645529446</span><br><span class="line">Arguments:</span><br><span class="line">    - 30</span><br><span class="line">Function:</span><br><span class="line">    test.sleep</span><br><span class="line">Minions:</span><br><span class="line">    - 192.168.13.187</span><br><span class="line">Result:</span><br><span class="line">    ----------</span><br><span class="line">    192.168.13.187:</span><br><span class="line">        ----------</span><br><span class="line">        return:</span><br><span class="line">            True</span><br><span class="line">StartTime:</span><br><span class="line">    2017, Aug 08 10:46:45.529446</span><br><span class="line">Target:</span><br><span class="line">    *</span><br><span class="line">Target-type:</span><br><span class="line">    glob</span><br><span class="line">User:</span><br><span class="line">    root</span><br><span class="line">jid:</span><br><span class="line">    20170808104645529446</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/07/salt-advanced-topic/" data-id="cjazexzl3009rqcoqlje36zdw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-salt-highstate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/07/salt-highstate/" class="article-date">
  <time datetime="2017-08-07T07:13:59.000Z" itemprop="datePublished">2017-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/salt/">salt</a>►<a class="article-category-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/07/salt-highstate/">salt highstate </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="salt-用highstate复合主机状态"><a href="#salt-用highstate复合主机状态" class="headerlink" title="salt 用highstate复合主机状态"></a>salt 用highstate复合主机状态</h3><ol>
<li><p>简介</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过Jinjia2和grain,pillar数据来扩展状态配置,使状态管理更加灵活.但都是单一状态的管理.</span><br><span class="line">通过highstate你将学会如何组织主机状态,把多个主机状态配置根据不同的规则进行复合,进而对整个服务器集群进行整体管控</span><br><span class="line"></span><br><span class="line">之前都是使用state.sls来运行一个状态文件,接下来使用highstate模块进行组织和管理单一的状态文件</span><br></pre></td></tr></table></figure>
</li>
<li><p>top.sls文件管理状态文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">top.sls文件将pillar文件定位到不同的minion;也可以用来在状态系统中将不同状态文件定位到不同的minion中</span><br><span class="line">highstate函数正式通过top.sls文件作为入口对模块和主机进行管理的</span><br><span class="line"></span><br><span class="line">例如:</span><br><span class="line">创建状态文件目录:</span><br><span class="line">[root@saltserver ~]# mkdir -p /srv/salt/lamp</span><br><span class="line">[root@saltserver ~]# mkdir -p /srv/salt/nginx</span><br><span class="line">编写相应的state模块文件:</span><br><span class="line">[root@saltserver ~]# tree /srv/salt/&#123;lamp,nginx&#125;</span><br><span class="line">/srv/salt/lamp</span><br><span class="line">├── httpd.conf</span><br><span class="line">├── lamp.sls</span><br><span class="line">├── my.cnf</span><br><span class="line">└── php.ini</span><br><span class="line">/srv/salt/nginx</span><br><span class="line">├── nginx.j2</span><br><span class="line">├── nginx.sls</span><br><span class="line">└── test_vhost.conf</span><br><span class="line">通过top.sls将lamp和nginx进行整合:</span><br><span class="line">[root@saltserver ~]# vim /srv/salt/top.sls</span><br><span class="line">[root@saltserver ~]# cat /srv/salt/top.sls</span><br><span class="line">base:</span><br><span class="line">  &apos;minion-one&apos;:</span><br><span class="line">    - nginx.nginx</span><br><span class="line">  &apos;minion-two&apos;:</span><br><span class="line">    - match: list</span><br><span class="line">    - lamp.lamp</span><br><span class="line">执行指令:</span><br><span class="line">[root@saltserver ~]# salt &apos;*&apos; state.highstate</span><br></pre></td></tr></table></figure>
</li>
<li><p>状态文件的拆分和复用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">* 将模块目录结构化</span><br><span class="line">[root@saltserver ~]# mkdir -p /srv/salt/nginx/&#123;templates,file&#125;</span><br><span class="line">[root@saltserver ~]# tree /srv/salt/nginx/</span><br><span class="line">/srv/salt/nginx/</span><br><span class="line">├── file</span><br><span class="line">│   └── test_vhost.conf</span><br><span class="line">├── nginx.sls</span><br><span class="line">└── templates</span><br><span class="line">    └── nginx.j2</span><br><span class="line"></span><br><span class="line">* 对nginx.sls进行拆分</span><br><span class="line">删除nginx.sls配置文件:</span><br><span class="line">[root@saltserver ~]# rm -f /srv/salt/nginx/nginx.sls</span><br><span class="line"></span><br><span class="line">创建独立的SLS文件:</span><br><span class="line">[root@saltserver ~]# touch /srv/salt/nginx/&#123;init,nginx_install,nginx_conf,nginx_running,vhost_conf&#125;.sls</span><br><span class="line">[root@saltserver ~]# tree /srv/salt/nginx/</span><br><span class="line">/srv/salt/nginx/</span><br><span class="line">├── file</span><br><span class="line">│   └── test_vhost.conf</span><br><span class="line">├── init.sls</span><br><span class="line">├── nginx_conf.sls</span><br><span class="line">├── nginx_install.sls</span><br><span class="line">├── nginx_running.sls</span><br><span class="line">├── templates</span><br><span class="line">│   └── nginx.j2</span><br><span class="line">└── vhost_conf.sls</span><br><span class="line"></span><br><span class="line">用init文件作入口文件(包含其它文件):</span><br><span class="line">[root@saltserver ~]# vim /srv/salt/nginx/init.sls     </span><br><span class="line">include:</span><br><span class="line">  - .nginx_install</span><br><span class="line">  - .nginx_running</span><br><span class="line">  - .nginx_conf</span><br><span class="line">  - .vhost_conf</span><br><span class="line"></span><br><span class="line">nginx软件安装:</span><br><span class="line">[root@saltserver ~]# vim /srv/salt/nginx/nginx_install.sls    </span><br><span class="line">nginx_install:</span><br><span class="line">  pkg.installed:</span><br><span class="line">    - name: nginx</span><br><span class="line"></span><br><span class="line">nginx服务管理:</span><br><span class="line">[root@saltserver ~]# cat /srv/salt/nginx/nginx_running.sls     </span><br><span class="line">nginx_running:</span><br><span class="line">  service.running:</span><br><span class="line">    - name: nginx</span><br><span class="line">    - enable: True</span><br><span class="line">    - require:</span><br><span class="line">      - pkg: nginx_install</span><br><span class="line">    - watch:</span><br><span class="line">      - file: nginx_conf</span><br><span class="line">      - file: vhost_conf</span><br><span class="line"></span><br><span class="line">nginx配置模板文件管理:</span><br><span class="line">[root@saltserver ~]# cat /srv/salt/nginx/nginx_conf.sls    </span><br><span class="line">nginx_conf:</span><br><span class="line">  file.managed:</span><br><span class="line">    - name: /etc/nginx/conf/nginx.conf</span><br><span class="line">    - source: salt://nginx/templates/nginx.j2</span><br><span class="line">    - user: root</span><br><span class="line">    - group: root</span><br><span class="line">    - template: jinja</span><br><span class="line">    - mode: 644</span><br><span class="line"></span><br><span class="line">nginx虚拟主机文件管理:</span><br><span class="line">[root@saltserver ~]# cat /srv/salt/nginx/vhost_conf.sls     </span><br><span class="line">vhost_conf:</span><br><span class="line">  file.managed:</span><br><span class="line">    - name: /etc/nginx/conf/conf.d/nginx.conf</span><br><span class="line">    - source: salt://nginx/file/test_vhost.conf</span><br><span class="line">    - user: root</span><br><span class="line">    - group: root</span><br><span class="line">    - mode: 644</span><br><span class="line"></span><br><span class="line">修改top.sls文件:</span><br><span class="line">[root@saltserver ~]# cat /srv/salt/top.sls    </span><br><span class="line">base:</span><br><span class="line">  &apos;minion-one&apos;:</span><br><span class="line">    - nginx</span><br><span class="line">注意: nginx模块文件夹里面有init.sls文件,salt会默认加载init.sls,不需要写成nginx.init这种形式</span><br></pre></td></tr></table></figure>
</li>
<li><p>多环境的配置和管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">通过top.sls配置文件和模块拆分已经可以对多种状态和多组minion进行同时管理.</span><br><span class="line">只需要执行&quot;salt &apos;*&apos; state.highstate&quot;就能完成base环境内的minion管理</span><br><span class="line"></span><br><span class="line">[root@saltserver ~]# vim /etc/salt/master</span><br><span class="line"># file_roots:</span><br><span class="line">#   base:</span><br><span class="line">#     - /srv/salt/</span><br><span class="line">#   dev:</span><br><span class="line">#     - /srv/salt/dev/services</span><br><span class="line">#     - /srv/salt/dev/states</span><br><span class="line">#   prod:</span><br><span class="line">#     - /srv/salt/prod/services</span><br><span class="line">#     - /srv/salt/prod/states</span><br><span class="line"></span><br><span class="line">file_roots这个配置项指明了我们的环境目录在哪里,salt执行对应的SLS状态文件都会默认的目录去寻找.</span><br><span class="line">一般企业都会有开发环境,测试环境,生产环境.对不同的环境配置不同的目录,我们修改:</span><br><span class="line">[root@saltserver ~]# vim /etc/salt/master</span><br><span class="line">file_roots:</span><br><span class="line">  base:</span><br><span class="line">    - /srv/salt/</span><br><span class="line">  dev:</span><br><span class="line">    - /srv/salt/dev/</span><br><span class="line">  prod:</span><br><span class="line">    - /srv/salt/prod/</span><br><span class="line"></span><br><span class="line">重启salt-server:</span><br><span class="line">[root@saltserver ~]# pkill salt-master</span><br><span class="line">[root@saltserver ~]# salt-master -c /etc/salt -d</span><br><span class="line"></span><br><span class="line">管理top.sls文件:</span><br><span class="line">[root@saltserver ~]# vim /srv/salt/top.sls  </span><br><span class="line">base:</span><br><span class="line">  &apos;minion-one&apos;:</span><br><span class="line">    - nginx</span><br><span class="line">dev:</span><br><span class="line">  &quot;test-*&quot;:</span><br><span class="line">    - httpd</span><br><span class="line">prod:</span><br><span class="line">  &quot;prod-*&quot;:</span><br><span class="line">    - match: list</span><br><span class="line">    - httpd</span><br><span class="line">    - php</span><br><span class="line">    - mysql</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/08/07/salt-highstate/" data-id="cjazexzl3009sqcoqul55l3s4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/8/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/">AliCloud</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/">SDK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/Python-SDK/">Python SDK</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/">Android install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/Android-studio-install/">Android studio install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/">Doc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP-严格传输安全HSTS/">HTTP 严格传输安全HSTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP协议/">HTTP协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP-协议详解/">TCP 协议详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP与socket区别/">TCP与socket区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件描述符与打开文件之间的关系/">linux 文件描述符与打开文件之间的关系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件系统inode/">linux 文件系统inode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/一次完整的HTTP请求/">一次完整的HTTP请求</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/">Disk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-io-performance/">disk io performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-iostat/">disk iostat</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/">Distributed storage</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/">GlusterFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-architecture/">GlusterFS architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-info/">GlusterFS info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-install/">GlusterFS install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-workflow/">GlusterFS workflow</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/">Domain</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/nslookup-dns-search/">nslookup dns search</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/">DRBD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/">keepalived</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/">Intellij</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/Intellij-setting/">Intellij setting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/">vim</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-shortcut-key/">vim shortcut key</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-vimrc/">vim vimrc</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/">Kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/">kernel memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/kernel-共享内存/">kernel 共享内存</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/">ganglia</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/ganglia-install/">ganglia install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/">hmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/">htmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/">smokeping</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/">zabbix</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/">monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-cpu/">zabbix monitor cpu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-mem/">zabbix monitor mem</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-auto-discover/">zabbix auto discover</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-grafana-install/">zabbix grafana install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install/">zabbix install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-item-and-tigger/">zabbix item and tigger</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-java-gateway/">zabbix java gateway</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-modify-login-user-passwd/">zabbix modify login user passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-proxy-install/">zabbix proxy install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-server-support-chinese/">zabbix server support chinese</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-windows-agent/">zabbix windows agent</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/树莓派-GSM-语音短信报警/">树莓派 GSM 语音短信报警</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/">监控</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/监控知识体系/">监控知识体系</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/">Python Framework</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django/">Python Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django-setting/">Python Django setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/">Python Learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-内存管理/">python 内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-函数编程/">python 函数编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-变量/">python 变量</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象使用/">python 对象使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象的属性/">python 对象的属性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象编程/">python 对象编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-数据类型/">python 数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-流程控制/">python 流程控制</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-爬虫/">python 爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊方法/">python 特殊方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊说明/">python 特殊说明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-装饰器/">python 装饰器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-过程编程/">python 过程编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-进阶/">python 进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-闭包/">python 闭包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/">Python install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-error-info/">python error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-source-image/">python pip source image</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-use/">python pip use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pyenv-install/">python pyenv install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-setup-py/">python setup.py</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-source-install/">python source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-virtualenv/">python virtualenv</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/">Python library</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/MySQLdb/">MySQLdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/memory-profiler/">memory_profiler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/">Python modules</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-path/">python modules path</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-pylint-and-ipython/">python modules pylint and ipython</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/">Python other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/python-import-and-reload/">python import and reload</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/">Ruby install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP.IP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-状态/">TCP 状态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-IP模型/">TCP/IP模型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/Wireshark-use/">Wireshark use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/">WeChat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/">WeChat enterprise</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/WeChat-enterprise-API/">WeChat enterprise API</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/">automation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/">git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-command/">git command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-error/">git error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitlab/">git gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitolite/">git gitolite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs/">git gogs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs-source-install/">git gogs source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-init/">git init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-workflow/">git workflow</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/">jenkins</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-info/">jenkins info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-install/">jenkins install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/">kvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/kvm-install/">kvm install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/">maven</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/maven-install/">maven install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/">nexus</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-install/">nexus install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-proxy-maven/">nexus proxy maven</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/">rpm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/">salt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-info/">salt info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install/">salt install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-HA/">salt install HA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-standard/">salt install standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-jinja2-grain-pillar-module/">salt jinja2 grain pillar module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-event-reactor/">salt manage event reactor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-grains/">salt manage grains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-job/">salt manage job</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-module/">salt manage module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-pillar/">salt manage pillar</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-return/">salt manage return</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-states/">salt manage states</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-target/">salt manage target</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-syndic-install/">salt master syndic install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-conf/">salt master.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-minion-conf/">salt minion.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-raet/">salt raet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-state-module/">salt state module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-syndic-conf/">salt syndic.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-write-module-code/">salt write module code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/">svn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-auto-update/">svn auto update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-checkout-bat/">svn checkout bat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-server-for-windows/">svn server for windows</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/">yum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/yum-server-install/">yum server install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/">Mongo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-auth/">mongo auth</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-error/">mongo error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-auth-install/">mongo replication auth install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-standard-install/">mongo replication standard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-standard-install/">mongo standard install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/">Mysql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-command/">mysql command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-error-info/">mysql error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-explain/">mysql explain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-grant/">mysql grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-index-options/">mysql index options</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave/">mysql master slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave-switch/">mysql master slave switch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-partition/">mysql partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-select-join/">mysql select join</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-slow-log/">mysql slow log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-standard/">mysql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-table-size/">mysql table size</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/">Postgresql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-book-use/">postgresql book use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave-info/">postgresql master slave info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave/">postgresql master/slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-plugin-install/">postgresql plugin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-standard/">postgresql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-tablespace-database-schema-table-user-role-relation/">postgresql tablespace database schema table user role relation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-yum-install/">postgresql yum install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-常用命令/">postgresql 常用命令</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库对象/">postgresql 数据库对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库管理/">postgresql 数据库管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/">Redis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-error/">redis error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-install/">redis install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-redis-trib-rb/">redis redis-trib.rb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-status/">redis status</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-use/">redis use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/">influxDB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang/go-env/">go env</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-high-availability/">RabbitMQ high availability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-install/">RabbitMQ install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-working-principle/">RabbitMQ working principle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/">beats</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/beats-install/">beats install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/">datax</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-info/">datax info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-install/">datax install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-job/">datax job</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-command/">elasticsearch command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-core-component/">elasticsearch core component</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-cluster/">elasticsearch exploring your cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-data/">elasticsearch exploring your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-four-search-type/">elasticsearch four search type</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-full-cluster-restart-upgrade/">elasticsearch full cluster restart upgrade</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-install/">elasticsearch install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-modifying-your-data/">elasticsearch modifying your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-rolling-upgrades/">elasticsearch rolling upgrades</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-safe-restart/">elasticsearch safe restart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-shard/">elasticsearch shard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-indexing-speed/">how to tune for indexing speed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-search-speed/">how to tune for search speed</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/">flume</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-info/">flume info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-install/">flume install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/">grafana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/grafana-install/">grafana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/hadoop-简介/">hadoop 简介</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/">kafka</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-install/">kafka install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-manage-web/">kafka manage web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-offset-monitor/">kafka offset monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-optimize/">kafka optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-web-console/">kafka web console</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/">kibana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/kibana-install/">kibana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/">logstash</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-config-file/">logstash config file</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-filter-grok/">logstash filter grok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-info/">logstash info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-install/">logstash install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/">mycat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-web-install/">mycat web install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/">nsq</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-command/">nsq command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-info/">nsq info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-install/">nsq install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/">zookeeper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-install/">zookeeper install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-monitor/">zookeeper monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-optimize/">zookeeper optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-use/">zookeeper use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-zab-protocol/">zookeeper zab protocol</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-env/">java env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-optimize/">java jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-opts/">java jvm opts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/">java learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/java-学习笔记/">java 学习笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-log4j/">java log4j</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/">java performance analysis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/jps/">jps</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-dashboard-install/">k8s dashboard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-install/">k8s install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-registry-install/">k8s registry install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/node-install/">node install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/other/ACID/">ACID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/分布式二阶段和三阶段提交协议/">分布式二阶段和三阶段提交协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/开源许可协议/">开源许可协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/网络带宽/">网络带宽</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/">system service</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/">Atlassian</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-https/">confluence https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-install/">confluence install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-reset-passwd/">confluence reset passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-update/">confluence update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-https/">jira https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-install/">jira install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-update/">jira update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/mariadb-install/">mariadb install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/Base-env/">Base env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-common-use-scripts/">linux common use scripts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-history-info-setting/">linux history info setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-login-info/">linux login info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-nginx-install/">linux nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-skill/">linux skill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-system-init/">linux system init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-内存插槽-内存信息/">linux 内存插槽 内存信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-扩容swap分区/">linux 扩容swap分区</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-物理CPU-CPU核数-逻辑CPU/">linux 物理CPU CPU核数 逻辑CPU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-磁盘系统block区别/">linux 磁盘系统block区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-设置-包含头文件路径-和-动态库链接路径/">linux 设置 包含头文件路径 和 动态库链接路径</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/">NFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/">Samba</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-conf/">samba conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-install/">samba install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/">command</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/grep/">grep</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/pigz/">pigz</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/sed/">sed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/split/">split</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/tr/">tr</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/">haproxy</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/haproxy-install/">haproxy install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-install/">nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-location/">nginx location</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-rewrite/">nginx rewrite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-status/">nginx status</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/">ntpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/ntpd-install/">ntpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/">openssl</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/openssl-certificate/">openssl certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/">openvpn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/openvpn-install/">openvpn install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/">rsync</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/rsync-install/">rsync install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/">supersord</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/supersord-install/">supersord install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/">vsftpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-error/">vsftpd error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-info/">vsftpd info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-install/">vsftpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/">windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/cygwin-install/">cygwin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/ipsec-set/">ipsec set</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/windows-modify-hosts/">windows modify hosts</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/">SSL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/">angular</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/angular-install/">angular install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/hexo-install/">hexo install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/">sass</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/sass-install/">sass install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/">xml</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/xml-format/">xml format</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/hello-everyone/">Hello Everyone</a>
          </li>
        
          <li>
            <a href="/2017/12/08/svn-checkout-bat/">svn checkout bat</a>
          </li>
        
          <li>
            <a href="/2017/12/08/svn-server-for-windows/">svn server for windows</a>
          </li>
        
          <li>
            <a href="/2017/12/08/nslookup-dns-search/">nslookup dns search</a>
          </li>
        
          <li>
            <a href="/2017/11/28/kafka-web-console/">kafka web console</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 penn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>