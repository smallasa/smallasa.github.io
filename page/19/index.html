<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>smallasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="smallasa">
<meta property="og:url" content="http://www.smallasa.com/page/19/index.html">
<meta property="og:site_name" content="smallasa">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="smallasa">
  
    <link rel="alternate" href="/atom.xml" title="smallasa" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">smallasa</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I known what i do !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.smallasa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-kafka-with-zookeeper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/kafka-with-zookeeper/" class="article-date">
  <time datetime="2017-03-20T07:54:32.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/kafka/">kafka</a>►<a class="article-category-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/kafka-with-zookeeper/">kafka with zookeeper</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kafka-与-zookeeper-的关系"><a href="#kafka-与-zookeeper-的关系" class="headerlink" title="kafka 与 zookeeper 的关系"></a>kafka 与 zookeeper 的关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kafka对消息保存时根据Topic进行归类,发送消息者成为Producer,消息接受者成为Consumer,此外kafka集群有多个kafka实例组成,每个实例(server)成为broker.无论是kafka集群,还是producer和consumer都依赖于zookeeper来保证系统可用性集群保存一些meta信息.</span><br><span class="line"></span><br><span class="line">一个Kafka集群通常包括多个代理.为了均衡负载,将话题分成多个分区,每个代理存储一或多个分区.多个生产者和消费者能够同时生产和获取消息.</span><br><span class="line"></span><br><span class="line">一个Topic可以认为是一类消息,每个topic将被分成多个partition(区),每个partition在存储层面是append log文件.任何发布到此partition的消息都会被直接追加到log文件的尾部,每条消息在文件中的位置称为offset(偏移量),offset为一个long型数字,它是唯一标记一条消息.kafka并没有提供其他额外的索引机制来存储offset,因为在kafka中几乎不允许对消息进行&quot;随机读写&quot;</span><br><span class="line"></span><br><span class="line">kafka和JMS(Java Message Service)实现(activeMQ)不同的是: 即使消息被消费,消息仍然不会被立即删除.日志文件将会根据broker中的配置要求,保留一定的时间之后删除;比如log文件保留2天,那么两天后,文件会被清除,无论其中的消息是否被消费.kafka通过这种简单的手段,来释放磁盘空间,以及减少消息消费之后对文件内容改动的磁盘IO开支.</span><br><span class="line"></span><br><span class="line">对于consumer而言,它需要保存消费消息的offset,对于offset的保存和使用,有consumer来控制;当consumer正常消费消息时,offset将会&quot;线性&quot;的向前驱动,即消息将依次顺序被消费.事实上consumer可以使用任意顺序消费消息,它只需要将offset重置为任意值.(offset将会保存在zookeeper中)</span><br><span class="line"></span><br><span class="line">kafka集群几乎不需要维护任何consumer和producer状态信息,这些信息有zookeeper保存;因此producer和consumer的客户端实现非常轻量级,它们可以随意离开,而不会对集群造成额外的影响.</span><br><span class="line"></span><br><span class="line">partitions的设计目的有多个.最根本原因是kafka基于文件存储.通过分区,可以将日志内容分散到多个server上,来避免文件尺寸达到单机磁盘的上限,每个partiton都会被当前server(kafka实例)保存;可以将一个topic切分多任意多个partitions,来消息保存/消费的效率.此外越多的partitions意味着可以容纳更多的consumer,有效提升并发消费的能力.</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">一个Topic的多个partitions,被分布在kafka集群中的多个server上;每个server(kafka实例)负责partitions中消息的读写操作;此外kafka还可以配置partitions需要备份的个数(replicas),每个partition将会被备份到多台机器上,以提高可用性.</span><br><span class="line"></span><br><span class="line">基于replicated方案,那么就意味着需要对多个备份进行调度;每个partition都有一个server为&quot;leader&quot;;leader负责所有的读写操作,如果leader失效,那么将会有其他follower来接管(成为新的leader);follower只是单调的和leader跟进,同步消息即可..由此可见作为leader的server承载了全部的请求压力,因此从集群的整体考虑,有多少个partitions就意味着有多少个&quot;leader&quot;,kafka会将&quot;leader&quot;均衡的分散在每个实例上,来确保整体的性能稳定.</span><br><span class="line"></span><br><span class="line">Producer将消息发布到指定的Topic中,同时Producer也能决定将此消息归属于哪个partition;比如基于&quot;round-robin&quot;方式或者通过其他的一些算法等.本质上kafka只支持Topic.每个consumer属于一个consumer group;反过来说,每个group中可以有多个consumer.发送到Topic的消息,只会被订阅此Topic的每个group中的一个consumer消费.</span><br><span class="line"></span><br><span class="line">如果所有的consumer都具有相同的group,这种情况和queue模式很像;消息将会在consumers之间负载均衡.</span><br><span class="line">如果所有的consumer都具有不同的group,那这就是&quot;发布-订阅&quot;;消息将会广播给所有的消费者.</span><br><span class="line"></span><br><span class="line">在kafka中,一个partition中的消息只会被group中的一个consumer消费;每个group中consumer消息消费互相独立;我们可以认为一个group是一个&quot;订阅&quot;者,一个Topic中的每个partions,只会被一个&quot;订阅者&quot;中的一个consumer消费,不过一个consumer可以消费多个partitions中的消息.kafka只能保证一个partition中的消息被某个consumer消费时,消息是顺序的.事实上,从Topic角度来说,消息仍不是有序的.</span><br><span class="line"></span><br><span class="line">kafka的设计原理决定,对于一个topic,同一个group中不能有多于partitions个数的consumer同时消费,否则将意味着某些consumer将无法得到消息.</span><br><span class="line"></span><br><span class="line">Guarantees</span><br><span class="line">1) 发送到partitions中的消息将会按照它接收的顺序追加到日志中</span><br><span class="line">2) 对于消费者而言,它们消费消息的顺序和日志中消息顺序一致.</span><br><span class="line">3) 如果Topic的&quot;replicationfactor&quot;为N,那么允许N-1个kafka实例失效.</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/kafka-with-zookeeper/" data-id="cjazexzfh0053qcoqzxleencc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-流量带宽" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/流量带宽/" class="article-date">
  <time datetime="2017-03-20T04:37:48.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>►<a class="article-category-link" href="/categories/other/网络带宽/">网络带宽</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/流量带宽/">流量带宽</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1Mbps=1024Kbps=1024/8KBps=128KB/s</span><br><span class="line">我们拉宽带1M,下载速度才100多KBps(KB/s)等宽带速率大小字样</span><br><span class="line"></span><br><span class="line">兆比特(Mbps)</span><br><span class="line">时间内传输数据的平均比特数,其单位是比特每秒(bps),或千比特每秒(Kbps),或兆比特每秒(Mbps),其换算关系为：1Kbps=1024bps,1Mbps=1024*1024bps(有时为了计算简单记作1Kbps=1000bps,1Mbps=1000000bps)</span><br><span class="line"></span><br><span class="line">数据传输 速率反映了终端设备之间的信息处理能力,它是一段时间的平均值</span><br><span class="line">所以1Mbps(1兆比特每秒)=0.125M Byte/s(0.125兆字节每秒)=0.125M Byte/s*1024=128KB/s(128千字节每秒)即1Mbps(兆位每秒)=1/8 MB/s(八分之一兆字节每秒)</span><br><span class="line">说明：</span><br><span class="line">1B = 8b</span><br><span class="line">两边同时扩大1024*1024倍，等式恒成立,即：</span><br><span class="line">1 MB = 8 Mb</span><br><span class="line">继而得出上面的公式，每秒传送1Mb，即：每秒传送了1/8MB = 0.125MB，即：</span><br><span class="line">1Mbps = 0.125 M Byte/s = 1/8M Byte/s * 1024 = 128 KB/s</span><br><span class="line"></span><br><span class="line">总结：</span><br><span class="line">在计算机网络或者是网络运营商中,一般宽带速率的单位用bps(或b/s)表示；bps表示比特每秒即表示每秒钟传输多少位信息,是bit per second的缩写.在实际所说的1M带宽的意思是1Mbps(是兆比特每秒(Mbps),不是兆字节每秒(MBps))</span><br><span class="line"></span><br><span class="line">20Mbps = 20 * 1024 = 20480 Kbps</span><br><span class="line">1Mbps = 1024Kbps</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/流量带宽/" data-id="cjazey0ao019gqcoqof1fu8h5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RabbitMQ-cluster" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/RabbitMQ-cluster/" class="article-date">
  <time datetime="2017-03-20T04:33:52.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/RabbitMQ-cluster/">RabbitMQ cluster</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="RabbitMQ-集群"><a href="#RabbitMQ-集群" class="headerlink" title="RabbitMQ 集群"></a>RabbitMQ 集群</h3><ol>
<li><p>RabbitMQ始终会记录以下四种内部元数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 队列元数据(队列名称和它们的属性)</span><br><span class="line">* 交换器元数据(交换器名称,类型和属性)</span><br><span class="line">* 绑定元数据(一张简单的表格展示了如何将消息路由到队列)</span><br><span class="line">* vhost元数据(为vhost内部队列,交换器和绑定提供命名空间和安全属性)</span><br><span class="line">*注意:</span><br><span class="line">单一节点,RabbitMQ会将所有信息存储在内存,同时将那些标记为可持久化的队列和交换器存储到硬盘上</span><br><span class="line">引入集群,RabbitMQ需要追踪新的元数据类型:集群节点位置,以及节点与已记录的其他类型元数据的关系;集群也提供了选择,将元数据存储到磁盘或者内存中*</span><br></pre></td></tr></table></figure>
</li>
<li><p>集群中的队列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">将两个节点组成集群,如果创建队列,集群只会在单个节点而不是所有节点上创建完整的队列信息(元数据,状态,内容),只有队列的所有者知道有关队列的所有信息</span><br><span class="line">所有其他非所有者节点只知道队列的元数据和指向该队列存在的那个节点的指针.因此,当集群节点崩溃时,该节点的队列和关联绑定都消失了.</span><br><span class="line">*注意: 只有队列在最开始没有被设置可持久化时,集群节点崩溃才可以让消费者重连并重新创建队列;如果队列开始已经设置为可持久化,客户端重新声明会得到404错误,这样确保了当失败节点恢复后加入集群,该节点上的队列不会丢失.想要指定队列重回集群的唯一方法是恢复故障节点.*</span><br><span class="line"></span><br><span class="line">为什么默认情况下RabbitMQ不将队列内容和状态复制到所有节点:</span><br><span class="line">* 存储空间  如果每个集群节点都拥有所有队列的完全拷贝,那么新计入了节点不会给你带来更多存储空间</span><br><span class="line">* 性能  消息的发布需要将消息复制到每一个集群节点,对持久化消息来说,每一条消息都会触发磁盘IO.每次新节点添加,网络和磁盘负载都会增加</span><br><span class="line"></span><br><span class="line">通过设置集群中唯一节点来负责任何特定队列,只有该负责节点才会因队列消息而消耗磁盘IO.所有其他节点需要将接收到该队列的请求转发给该队列的所有者节点.因此,增加Rabbit集群节点意味着你将拥有更多的节点传播队列,这些新节点为你带来了性能提升</span><br></pre></td></tr></table></figure>
</li>
<li><p>分布交换器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">交换器不同队列那样拥有自己的进程,交换器说到底只是一个名称和一个队列绑定列表</span><br><span class="line">当你将消息发布到交换器时,实际上是由你所连接到的信道将消息上的路由键同交换器的绑定列表进行比较,然后路由信息.正是信道按照绑定的匹配结果,将消息路由到队列</span><br><span class="line">理解信道是真正的路由器这一点很重要,这解释了为什么交换器不会像集群中的队列那样受到相同的限制</span><br><span class="line">由于交换器只不过是一张查询表,而非实际上的消息路由器,因此将交换器在整个集群中进行复制会更加简单.</span><br></pre></td></tr></table></figure>
</li>
<li><p>是内存节点，还是磁盘节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">每个RabbitMQ节点,不管是单一节点还是集群中的一部分,要么是内存节点,要么是磁盘节点</span><br><span class="line">* 内存节点将所有的队列,交换器,绑定,用户,权限和vhost的元数据定义都仅存储在内存中</span><br><span class="line">* 磁盘节点则将元数据存储在磁盘</span><br><span class="line">*注意:单节点只允许磁盘类型节点,否则你每次重启RabbitMQ,所有关于系统的配置信息都会丢失*</span><br><span class="line">在集群中,你可以选择配置部分节点为内存节点,因为它使得向队列和交换器声明之类的操作更加快速</span><br><span class="line">*注意: 当在集群中声明队列,交换器或绑定时,这些操作直到所有集群节点都成功提交元数据变更后才返回。对内存节点来说,将变更写入内存;对磁盘节点来说,将变更写入磁盘,直到完成之后*</span><br><span class="line"></span><br><span class="line">RabbitMQ只要求在集群中至少有一个磁盘节点,所有其他节点都可以是内存节点.当节点加入和离开集群时,它们必须将该变更通知到至少一个磁盘节点</span><br><span class="line">如果集群只有一个磁盘节点,正好它又崩溃了,那么集群还可以路由消息,但不能操作:创建队列,创建交换器,创建绑定,添加用户,更改权限,添加或删除集群节点</span><br><span class="line">解决方法: 建议在集群中设置两台磁盘节点</span><br><span class="line">*注意: 只有一个需要所有的磁盘节点必须在线的操作是添加或者删除集群节点*</span><br><span class="line"></span><br><span class="line">当重启内存节点后,它们会连接到预先配置的磁盘节点,下载当前集群元数据拷贝.如果你只讲两个磁盘节点中的一个高速了内存节点,不凑巧这个磁盘节点崩溃了,内存节点重启后就无法找到集群了.所以添加内存节点时,确保告知其所有的磁盘节点.只要内存节点可以找到至少一个磁盘节点,那么它就能在重启后重新加入集群</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">集群一: 单台集群启动三个Rabbit服务</span><br><span class="line">1. 启动三个Rabbit服务</span><br><span class="line">   RABBITMQ_NODE_PORT=5671 RABBITMQ_NODENAME=rabbit_1 rabbitmq-server -detached</span><br><span class="line">   RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit_2 rabbitmq-server -detached</span><br><span class="line">   RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit_3 rabbitmq-server -detached</span><br><span class="line">2. 停止第二个节点上的RabbitMQ程序</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost stop_app</span><br><span class="line">3. 重新设置第二个节点的元数据和状态为清空状态</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost reset</span><br><span class="line">4. 将第二个节点加入到第一个集群节点</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost cluster rabbit_1@localhost rabbit_2@localhost</span><br><span class="line">   * -n rabbit_2@localhost 表示你想在指定的节点上执行命令</span><br><span class="line">   * cluster rabbit_1@localhost rabbit_2@localhost  表示rabbit_1和将要加入的rabbit_2都是磁盘节点</span><br><span class="line">5. 重新启动第二个节点</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost start_app</span><br><span class="line">6. 将第三个节点加入到集群</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost stop_app</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost reset</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost cluster rabbit_1@localhost rabbit_2@localhost</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost start_app</span><br><span class="line">   *注意: 将第三个节点加入到集群时,cluster后面并没有包含rabbit_3,表示为rabbit_3指定了两个磁盘节点rabbit_2和rabbit_1,rabbit_3将会成为内存节点*</span><br><span class="line">7. 查看集群状态</span><br><span class="line">   rabbitmqctl cluster_status</span><br><span class="line">   查看nodes部分:</span><br><span class="line">   * disc 表示磁盘节点信息</span><br><span class="line">   * ram  表示内存节点信息</span><br><span class="line">   * running_nodes 告诉你集群中的哪些节点正在运行</span><br><span class="line">8. 连接到RabbitMQ</span><br><span class="line">   你可以连接到Running_nodes中任何一个节点,开始创建队列,发布消息,或者执行其他AMQP命令</span><br><span class="line"></span><br><span class="line">集群二: 将节点分布到更多机器上(三台机器为例)</span><br><span class="line">1. 在三台机器上启动RabbitMQ</span><br><span class="line">   RABBITMQ_NODE_PORT=5671 RABBITMQ_NODENAME=rabbit_1 rabbitmq-server -detached</span><br><span class="line">   RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit_2 rabbitmq-server -detached</span><br><span class="line">   RABBITMQ_NODE_PORT=5673 RABBITMQ_NODENAME=rabbit_3 rabbitmq-server -detached</span><br><span class="line">2. 将其中一台的RabbitMQ的Erlang cookie复制到其他几个节点</span><br><span class="line">   /var/lib/rabbitmq/.erlang.cookie</span><br><span class="line">   复制cookie内的字符串,并粘贴到其他两个节点的/var/lib/rabbitmq/.erlang.cookie中</span><br><span class="line">   重启其他另外两个节点</span><br><span class="line">   rabbitmqctl stop</span><br><span class="line">   rabbitmqctl start      </span><br><span class="line">3. 停止第二个节点上的RabbitMQ程序</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost stop_app</span><br><span class="line">4. 重新设置第二个节点的元数据和状态为清空状态</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost reset</span><br><span class="line">5. 将第二个节点加入到第一个集群节点</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost cluster rabbit_1@localhost rabbit_2@localhost</span><br><span class="line">   * -n rabbit_2@localhost 表示你想在指定的节点上执行命令</span><br><span class="line">   * cluster rabbit_1@localhost rabbit_2@localhost  表示rabbit_1和将要加入的rabbit_2都是磁盘节点</span><br><span class="line">6. 重新启动第二个节点</span><br><span class="line">   rabbitmqctl -n rabbit_2@localhost start_app</span><br><span class="line">7. 将第三个节点加入到集群</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost stop_app</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost reset</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost cluster rabbit_1@localhost rabbit_2@localhost</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost start_app</span><br><span class="line">   *注意: 将第三个节点加入到集群时,cluster后面并没有包含rabbit_3,表示为rabbit_3指定了两个磁盘节点rabbit_2和rabbit_1,rabbit_3将会成为内存节点*</span><br><span class="line">8. 查看集群状态</span><br><span class="line">   rabbitmqctl cluster_status</span><br><span class="line">   查看nodes部分:</span><br><span class="line">   * disc 表示磁盘节点信息</span><br><span class="line">   * ram  表示内存节点信息</span><br><span class="line">   * running_nodes 告诉你集群中的哪些节点正在运行</span><br><span class="line">9. 连接到RabbitMQ</span><br><span class="line">   你可以连接到Running_nodes中任何一个节点,开始创建队列,发布消息,或者执行其他AMQP命令</span><br><span class="line"></span><br><span class="line">集群三:将节点从集群中移除</span><br><span class="line">1. 找到你需要停止的集群节点</span><br><span class="line">2. 移除</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost stop_app</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost reset    </span><br><span class="line">3. 验证</span><br><span class="line">   方法一: 启动移除的节点  </span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost start_app</span><br><span class="line">   rabbitmqctl -n rabbit_3@localhost cluster_status</span><br><span class="line">   方法二: 查看已有集群的状态</span><br><span class="line">   rabbitmqctl -n rabbit_1@localhost cluster_status</span><br></pre></td></tr></table></figure>
</li>
<li><p>升级版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在独立的系统中升级新版本RabbitMQ比较容易: 解压新版本,然后停服,替换新版本,启动服务.</span><br><span class="line"></span><br><span class="line">集群升级版本是半自动化的,不能简单的将新版本在集群节点上解压并重启服务:</span><br><span class="line">1. 通过RabbitMQ Management 插件备份当前配置</span><br><span class="line">2. 关闭所有生产者并等待消费者消费完队列中的所有消息</span><br><span class="line">3. 关闭节点,并解压新版本RabbitMQ到安装目录</span><br><span class="line">4. 选择其中一个磁盘节点作为升级节点,当启动时,该节点会将持久化的集群数据升级到新版本</span><br><span class="line">5. 然后启动其他集群的磁盘节点,它们会获取升级后的集群数据</span><br><span class="line">6. 最后启动集群的内存节点</span><br></pre></td></tr></table></figure>
</li>
<li><p>镜像队列和保留消息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">RabbitMQ集群默认情况下队列只存活于集群中的一个节点上.在RabbitMQ 2.6.0版本之后,Rabbit增加了内建的双活冗余选项: 镜像队列</span><br><span class="line">镜像队列: 像普通队列一样,镜像队列的主拷贝仅存在于一个节点上,但与普通队列不同的是,镜像节点在集群中的其他节点上拥有从队列拷贝.一旦队列的主节点不可用,最老的从队列将被选举为新的主队列</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">queue_args = &#123;&quot;x-ha-policy&quot;:&quot;all&quot;&#125;</span><br><span class="line">channel.queue_declare(queue=&quot;hello-queue&quot;,arguments=queue_args)</span><br><span class="line"></span><br><span class="line">由于队列的镜像性质是由应用程序在允许时指定的,RabbitMQ团队决定你可以同样的方式在允许时指定队列需要镜像到哪些节点.</span><br><span class="line">指定将镜像放在哪个节点:</span><br><span class="line">queue_args = &#123;&quot;x-ha-policy&quot;:&quot;nodes&quot;,&quot;x-ha-policy-params&quot;:[&quot;rabbit@localhost&quot;]&#125;</span><br><span class="line">channel.queue_declare(queue=&quot;hello-queue&quot;,arguments=queue_args)</span><br><span class="line"></span><br><span class="line">*注意: 新增的从拷贝只会包含那些其添加进来之后从镜像队列发来的消息.RabbitMQ不会将镜像队列现已经存在的内容与新添加的从拷贝进行同步. 新增的从拷贝最终会和现存的队列拷贝拥有相同的状态.*</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="RabbitMQ从故障中恢复"><a href="#RabbitMQ从故障中恢复" class="headerlink" title="RabbitMQ从故障中恢复"></a>RabbitMQ从故障中恢复</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.架构的规划</span><br><span class="line">  haproxy</span><br><span class="line">  RabbitMQ集群</span><br><span class="line">2.业务代码的调整</span><br><span class="line">  错误检测和重新链接</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/RabbitMQ-cluster/" data-id="cjazexza9000jqcoqhbyg4ksw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RabbitMQ-user-and-grant" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/RabbitMQ-user-and-grant/" class="article-date">
  <time datetime="2017-03-20T04:31:29.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="RabbitMQ-用户管理"><a href="#RabbitMQ-用户管理" class="headerlink" title="RabbitMQ 用户管理"></a>RabbitMQ 用户管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 创建用户</span><br><span class="line">  rabbitmqctl add username  password</span><br><span class="line">* 删除用户</span><br><span class="line">  rabbitmqctl delete username</span><br><span class="line">  *注意:会删除用户和访问策略!!!*</span><br><span class="line">* 修改用户密码</span><br><span class="line">  rabbitmqctl change_password username new-password</span><br><span class="line">* 查看用户列表</span><br><span class="line">  rabbitmqctl list_users</span><br></pre></td></tr></table></figure>
<h3 id="RabbitMQ-权限管理"><a href="#RabbitMQ-权限管理" class="headerlink" title="RabbitMQ 权限管理"></a>RabbitMQ 权限管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">1. 权限种类</span><br><span class="line">   * 读  有关消费消息的任何操作,包括&quot;清除&quot;整个队列(绑定操作的成功)</span><br><span class="line">     1. queue.bind:</span><br><span class="line">        配置:exchange</span><br><span class="line">     2. basic.get</span><br><span class="line">        配置: queue</span><br><span class="line">     3. basic.consume</span><br><span class="line">        配置: queue</span><br><span class="line">     4. queue.purge</span><br><span class="line">        配置: queue</span><br><span class="line">   * 写  发布消息(绑定操作的成功)</span><br><span class="line">     1. queue.bind</span><br><span class="line">        配置: queue</span><br><span class="line">     2. basic.publish</span><br><span class="line">        配置: exchange</span><br><span class="line">   * 配置  队列和交换器的创建和删除</span><br><span class="line">     1. exchange.declare</span><br><span class="line">        配置: exchange</span><br><span class="line">     2. exchange.delete</span><br><span class="line">        配置: exchange</span><br><span class="line">     3. queue.declare</span><br><span class="line">        配置: queue</span><br><span class="line">     4. queue.delete</span><br><span class="line">        配置: queue</span><br><span class="line">2. 每条访问规则组成</span><br><span class="line">   * 被授权访问的用户</span><br><span class="line">   * 权限控制应用的vhost</span><br><span class="line">   * 需要授予读/写/配置权限组合</span><br><span class="line">   * 权限范围(仅应用于客户端命名队列/交换器;仅用于服务端命名队列/交换器;两者兼备)</span><br><span class="line">   *注意: 访问控制条目是无法跨越vhost的*</span><br><span class="line">3. 授权案例</span><br><span class="line">   * 完全访问控制</span><br><span class="line">     rabbitmqctl set_permissions -p vhost-name username &quot;.\*&quot; &quot;.\*&quot; &quot;.\*&quot;</span><br><span class="line">     * 第一个&quot;.\*&quot;表示配置的权限</span><br><span class="line">     * 第二个&quot;.\*&quot;表示写的权限</span><br><span class="line">     * 第三个&quot;.\*&quot;表示读的权限</span><br><span class="line">   * 组合使用</span><br><span class="line">     rabbitmqctl set_permissions -p vhost-name -s all username &quot;&quot; &quot;check-.\*&quot; &quot;.\*&quot;</span><br><span class="line">     * 授权在vhost-name上</span><br><span class="line">     * -s all 表示任何队列或者交换器</span><br><span class="line">     * &quot;&quot; 表示不匹配队列和交换器</span><br><span class="line">     * &quot;check-.\*&quot; 表示只匹配以&quot;check-&quot;开头的队列和交换器</span><br><span class="line">   * 查看访问策略</span><br><span class="line">     rabbitmqctl list_permissions -p vhost-name</span><br><span class="line">   * 移除一个用户在vhost上的权限</span><br><span class="line">     rabbitmqctl clear_permissions -p vhost-name username</span><br><span class="line">   * 查看用户在所有vhost上的权限</span><br><span class="line">     rabbitmqctl list_user_permissions username</span><br></pre></td></tr></table></figure>
<h3 id="RabbitMQ-查看统计"><a href="#RabbitMQ-查看统计" class="headerlink" title="RabbitMQ 查看统计"></a>RabbitMQ 查看统计</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. 列出队列和消息数目</span><br><span class="line">   * rabbitmqctl list_queues</span><br><span class="line">   * rabbitmqctl list_queues -p vhost-name</span><br><span class="line">   * rabbitmqctl list_queues -p vhost-name  name messages consumers memory</span><br><span class="line">   * rabbitmqctl list_queues -p vhost-name  name durable auto_delete</span><br><span class="line">2. 查看交换器和绑定</span><br><span class="line">   * rabbitmqctl list_exchanges</span><br><span class="line">   * rabbitmqctl list_exchanges name type durable auto_delete</span><br><span class="line"></span><br><span class="line">   * rabbitmqctl list_bindings</span><br></pre></td></tr></table></figure>
<h3 id="RabbitMQ-日志"><a href="#RabbitMQ-日志" class="headerlink" title="RabbitMQ 日志"></a>RabbitMQ 日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 两个日志文件</span><br><span class="line">   * RABBITMQ_NODENAME-sasl.log</span><br><span class="line">     sasl是库的集合,作为Erlang-OPT发行版一部分,帮助开发者在开发应用程序时,将日志写入rabbit-sasl.log文件</span><br><span class="line">     可以找到Erlang的崩溃报告</span><br><span class="line">   * RABBITMQ_NODENAME.log</span><br><span class="line">     配置系统日志</span><br><span class="line">2. 轮询日志</span><br><span class="line">   rabbitmqctl rotate_logs .1</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/RabbitMQ-user-and-grant/" data-id="cjazexzap000qqcoqvfv53qh6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RabbitMQ-info" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/RabbitMQ-info/" class="article-date">
  <time datetime="2017-03-20T04:28:25.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a>►<a class="article-category-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/RabbitMQ-info/">RabbitMQ info</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="RabbitMQ-简介"><a href="#RabbitMQ-简介" class="headerlink" title="RabbitMQ 简介"></a>RabbitMQ 简介</h3><ol>
<li><p>AMQP是什么?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AMQP,即Advanced Message Queuing Protocol,一个提供统一消息服务的应用层标准高级消息队列协议,是应用层协议的一个开放标准,为面向消息的中间件设计.</span><br><span class="line">基于此协议的客户端与消息中间件可传递消息,并不受客户端/中间件不同产品,不同的开发语言等条件的限制.</span><br></pre></td></tr></table></figure>
</li>
<li><p>AMQP的范围:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">为了完全实现消息中间件的互操作性,需要充分定义*网络协议*和*消息代理服务*的功能语义</span><br><span class="line">因此,AMQP定义网络协议和代理服务如下：</span><br><span class="line">* 一套确定的消息交换功能,也就是&quot;高级消息交换协议模型&quot;.AMQP模型包括一套用于路由和存储消息的功能模块,以及一套在这些模块之间交换消息的规则.</span><br><span class="line">* 一个网络线级协议(数据传输格式),客户端应用可以通过这个协议与消息代理和它实现的AMQP模型进行交互通信.</span><br></pre></td></tr></table></figure>
</li>
<li><p>AMQP模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在服务器中,三个主要功能模块连接成一个处理链完成预期的功能：</span><br><span class="line">* &quot;exchange&quot;接收发布应用程序发送的消息,并根据一定的规则将这些消息路由到&quot;消息队列&quot;</span><br><span class="line">* &quot;message queue&quot;存储消息,直到这些消息被消费者安全处理完为止</span><br><span class="line">* &quot;binding&quot;定义了exchange 和 message queue 之间的关联,提供路由规则</span><br><span class="line"></span><br><span class="line">一个AMQP服务器类似于邮件服务器,exchange类似于消息传输代理(email里的概念),message queue类似于邮箱.Binding定义了每一个传输代理中的消息路由表,发布者将消息发给特定的传输代理,然后传输代理将这些消息路由到邮箱中,消费者从这些邮箱中取出消息.</span><br></pre></td></tr></table></figure>
</li>
<li><p>AMQP 消息交换体系结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 存储转发（多个消息发送者，单个消息接收者）</span><br><span class="line">* 分布式事务（多个消息发送者，多个消息接收者）</span><br><span class="line">* 发布订阅（多个消息发送者，多个消息接收者）</span><br><span class="line">* 基于内容的路由（多个消息发送者，多个消息接收者）</span><br><span class="line">* 文件传输队列（多个消息发送者，多个消息接收者）</span><br><span class="line">* 点对点连接（单个消息发送者，单个消息接收者）</span><br></pre></td></tr></table></figure>
</li>
<li><p>理解消息通信</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">1. 生产者和消费者</span><br><span class="line">   RabbitMQ在应用程序和服务器之间扮演者路由器的角色.所以当应用程序连接RabbitMQ时,它会决定是发送还是接收</span><br><span class="line">   1. 生产者生产消息,然后发布到代理服务器(RabbitMQ).</span><br><span class="line">      消息分为两部分:</span><br><span class="line">      * 有效载荷：你要传输的数据</span><br><span class="line">      * 标签:它描述了有效载荷,并且RabbitMQ用它来决定谁将获得消息的拷贝</span><br><span class="line">   2. 消费者消费消息,先连接到代理服务器(RabbitMQ),并订阅到队列上</span><br><span class="line">      当消费者接收到消息时,它只得到消息的一部分:有效载荷.在消息的路由过程中,消息的标签并没有随有效载荷一起传递</span><br><span class="line">   生产者创建消息,消费者接收消息.在发布消息或接收消息之前必须先连接RabbitMQ,建立一条信道(channel)</span><br><span class="line">2. 队列</span><br><span class="line">   AMPQ消息路由必须包含三部分:</span><br><span class="line">   * 路由器: 生产者把消息发送到路由器上</span><br><span class="line">   * 队列: 消息最终到达队列,并被消费者接收</span><br><span class="line">   * 绑定: 决定了消息如何从路由器路由到特定的队列上</span><br><span class="line"></span><br><span class="line">   消费者通过两种方式从特定的队列中接收消息:</span><br><span class="line">   * 通过AMQP的base.consume命令订阅(持续订阅)</span><br><span class="line">   * 通过AMQP的base.get命令(单条订阅)</span><br><span class="line">   当至少一个消费者订阅了队列, 消息会立即发送给这些订阅的消费者;如果消息到达了无人订阅的队列,消息会在队列中等待,一旦有消费者订阅该队列,那么队列上的消息会立即发送给消费者.当有多个消费者订阅到同一个队列时,队列收到的消息将以循环的方式发送给消费者,**每条消息只会发送给一个订阅消费者**.</span><br><span class="line">   例如:消费者A和B都订阅了队列send</span><br><span class="line">   1. Message_A发送到队列send</span><br><span class="line">   2. RabbitMQ将消息Message_A发送给消费者A</span><br><span class="line">   3. 消费者A确认收到了消息Message_A</span><br><span class="line">   4. RabbitMQ将消息Message_A从队列send中删除</span><br><span class="line">   5. Message_B发送到队列send</span><br><span class="line">   6. RabbitMQ将消息Message_B发送给消费者B</span><br><span class="line">   7. 消费者B确认收到了消息Message_B</span><br><span class="line">   8. RabbitMQ将消息Message_B从队列send中删除</span><br><span class="line">   注意:</span><br><span class="line">   * 消费者接收到的每一条消息都必须进行确认(通过AMQP的base.ack命令或在订阅队列的时候将auto_ack设置为true).</span><br><span class="line">   * 消费者对消息的确认和告诉生产者消息已经被接收了这两件事情毫无相关.因此,消费者通过确认命令告诉RabbitMQ它已经正确的接收到了消息,同时RabbitMQ才能安全的把消息从队列中移除</span><br><span class="line">   * 如果消费者接收一条消息,然后确认之前从Rabbit处断开连接,RabbitMQ会认为这条消息没有分发,它会从新分发给下一个订阅的消费者</span><br><span class="line">   * 如果你的程序崩溃了,这样做一方面保证消息会被发送给下一个消费者处理;另一方面,如果应用程序有Bug而忘记确认消息,RabbitMQ不会给该消费者发送更多消息,这是因为在上一条消息被确认之前,RabbitMQ会认为这个消费者还没有准备好接收下一条消息</span><br><span class="line"></span><br><span class="line">   在收到消息后,如果你想明确拒绝而不是确认收到该消息,你有两个选择:</span><br><span class="line">   * 把消费者从RabbitMQ服务器断开连接,这会导致RabbitMQ会重新将消息发送给另一个消费者</span><br><span class="line">     优点:所有RabbitMQ都支持</span><br><span class="line">     缺点:这样连接/断开的连接方式会增加RabbitMQ的负担</span><br><span class="line">   * RabbitMQ &gt;= 2.0.0版本,使用AMPQ的base.reject命令</span><br><span class="line">     如果把reject的requeue参数设置为true,RabbitMQ会把消息发送给下一个消费者</span><br><span class="line">     如果把reject的requeue参数设置为false,RabbitMQ会立即把消息从队列中移除,而不会把它发送给新的消费者</span><br><span class="line"></span><br><span class="line">   创建队列:</span><br><span class="line">   生产者和消费者都能使用AMPQ的queue.declare命令创建队列</span><br><span class="line">   如果消费者在同一条信道上订阅了另一个队列,就无法声明队列了.必须首先取消订阅,将信道设置为&quot;传输&quot;模式</span><br><span class="line">   创建队列时需要指定队列名称,消费者订阅时需要队列名称,在创建绑定时也需要队列名称.如果在创建队列时没有指定队列名称,RabbitMQ会分配一个随机名称并在queue.declare命令的响应中返回</span><br><span class="line">   创建队列有用参数:</span><br><span class="line">   * exclusive</span><br><span class="line">     设置true,队列将变为私有的,此时只有你的应用程序才能够消费队列消息.当你限制一个队列只有一个消费者时有用</span><br><span class="line">   * auto-delete</span><br><span class="line">     当最后一个消费者取消订阅时,队列会自动移除</span><br><span class="line">   * 如果你只想检测队列是否存在,可设置queue.declare的passive选项为true.在该设置下,如果队列存在返回成功;如果队列不存在返回错误</span><br><span class="line"></span><br><span class="line">   队列是AMPQ的基础模块:</span><br><span class="line">   * 为消息提供了处所,消息在此等待消费</span><br><span class="line">   * 对负载均衡来说,队列是绝佳方案.只需附加一堆消费者,并让RabbitMQ循环的方式均匀分发消息</span><br><span class="line">   * 队列是RabbitMQ消息的最终点(除非消息进入了黑洞)</span><br><span class="line"></span><br><span class="line">3. 交换器和绑定</span><br><span class="line">   将你想将消息投递给队列时,你通过把消息发送给交换器来完成.然后,根据确定的规则,RabbitMQ会决定消息该投递到哪个队列.这些规则成为路由键</span><br><span class="line">   **队列通过路由键来绑定到交换器.**</span><br><span class="line">   当你把消息发送到代理服务器时,消息将有一个路由键(即便是空的),RabbitMQ也会将其和绑定的路由键进行匹配.如果匹配成功,那么消息将投递到该队列;如果匹配不成功,消息将进入黑洞</span><br><span class="line"></span><br><span class="line">   服务器会根据路由键将消息从交换器路由到队列,如何处理投递多个队列呢？</span><br><span class="line">   协议中定义的不通类型交换器发挥了作用:</span><br><span class="line">   * direct</span><br><span class="line">   * fanout</span><br><span class="line">   * topic</span><br><span class="line">   * headers</span><br><span class="line">   每一类实现了不通的路由算法.</span><br><span class="line"></span><br><span class="line">   1. headers交换器允许你匹配AMQP消息的header而非路由键,除此之外,headers交换器和direct交换器完全一致,但性能会差很多</span><br><span class="line">   2. direct</span><br><span class="line">      **如果路由键匹配,消息就会被投递到对应的队列**</span><br><span class="line">      服务器必须实现direct类型交换器,包含一个空白字符串名称的默认交换器</span><br><span class="line">      当声明一个队列时,它会自动绑定到默认交换器,并以队列名称作为路由键.</span><br><span class="line">      例如: $channel-&gt;baseic_publish($msg,&apos;&apos;,&apos;queue-name&apos;)</span><br><span class="line">      第一个参数表示你想发送的内容</span><br><span class="line">      第二个参数为空,表示指定了默认的交换器</span><br><span class="line">      第三个参数就是路由键,即队列名字</span><br><span class="line">      当默认的direct交换器无法满足应用程序的需求时,你可以声明自己的交换器.只需发送exchange.declare命令并设置合适的参数</span><br><span class="line">   3. fanout</span><br><span class="line">      **会将收到的消息广播到绑定的队列上**</span><br><span class="line">      当你发送一条消息到fanout交换器时,它会把消息投递给所有附加在此交换机的队列</span><br><span class="line">   4. topic</span><br><span class="line">      **允许来自不同源头的消息能够到达同一个队列**</span><br><span class="line"></span><br><span class="line">      声明队列msg-inbox-errors,并将其绑定到交换器上</span><br><span class="line">      $channel-&gt;queue_bind(&apos;msg-inbox-errors&apos;,&apos;logs-exchange&apos;,&apos;error.msg-inbox&apos;)</span><br><span class="line">      error.msg-inbox表示绑定规则</span><br><span class="line">4. 虚拟主机和隔离</span><br><span class="line">   每一个RabbitMQ服务器都能创建虚拟消息服务器,我们称为虚拟主机vhost.</span><br><span class="line">   每一个vhost本质上都一个mini版的RabbitMQ服务器,拥有自己的队列,交换器和绑定,更重要的是拥有自己的权限机制</span><br><span class="line">   vhost之于RabbitMQ就像虚拟机之于物理服务器一样:它们通过在各个实例间提供逻辑上的分离,允许你为不同应用程序安全保密的运行数据</span><br><span class="line">   vhost是AMQP概念的基础,你必须在连接时进行制定.默认的vhost:&quot;/&quot;</span><br><span class="line"></span><br><span class="line">   AMQP它并没有指定权限控制是在vhost级别还是在服务器端级别实现</span><br><span class="line">   当你在RabbitMQ里面创建一个用户时,用户通常会被指派至少一个vhost,并且只能访问被指派vhost内的队列,交换器和绑定</span><br><span class="line">   注意:vhost之间是绝对隔离的</span><br><span class="line">   vhost和权限控制非常独特,它们是AMQP中唯一无法通过AMQP协议创建的基元.需要通过rabbitmqctl工具创建</span><br><span class="line">   例如:</span><br><span class="line">   * rabbitmqctl add_vhost vhost-name</span><br><span class="line">   * rabbitmqctl delete_vhost vhost-name</span><br><span class="line">   * rabbitmqctl list_vhost</span><br><span class="line">5. 持久化和你的策略</span><br><span class="line">   默认情况下,重启RabbitMQ服务器后,那些队列和交换器就消失了.原因在于每个队列和交换器的durable属性,该属性为false,它决定了RabbitMQ是否在崩溃或者重启之后重建队列.该属性为true,你就不需要在服务器断电重启后重新创建队列和交换器了</span><br><span class="line"></span><br><span class="line">   在发布消息之前,通过把它的&quot;投递模式&quot;(delivery mode)选项设置为2来把消息标记成持久化.到目前为止,消息还只是被表示为持久化的,但是它还必须被发布到持久化交换器中并到达持久化队列中才行.</span><br><span class="line">   如果消息想从RabbitMQ崩溃中恢复,那么消息必须:</span><br><span class="line">   * 把它的投递模式设置为2(持久)</span><br><span class="line">   * 发送到持久化交换器</span><br><span class="line">   * 到达持久化队列</span><br><span class="line"></span><br><span class="line">   RabbitMQ确保持久性消息能从服务器重启中恢复的方式是,将它们写入磁盘上的一个持久化日志文件.当发布一条持久性消息到交换器时,RabbitMQ会在消息提交到日志文件后才发送响应.记住,之后这条消息如果路由到了非持久队列,它会自动从持久性日志中移除,并且无法从服务器重启中恢复.如果你使用持久性消息,则确保之前提到的持久性消息的那三点必须做到位.一旦你从持久化队列中消费了一条持久性消息,RabbitMQ会在持久化日志中把这条消息标记为等待垃圾收集.在你消费持久化消息之前,如果RabbitMQ重启的话,服务器会自动重建交换器和队列,绑定,重播持久性日志文件中消息到合适的队列或者交换器上</span><br><span class="line"></span><br><span class="line">   持久化消息能保证RabbitMQ重启后数据的恢复,同时你也要为此付出性能代价.</span><br><span class="line"></span><br><span class="line">   和持久化相关的一个概念是AMQP事务.</span><br><span class="line">   在AMQP中,在把信道设置成事务模式后,你通过信道发送那些想要确认的消息,之后还有多个其他AMQP命令.这些命令是执行还是忽略,取决于第一条消息发送是否成功.一旦你发送完所有命令,就可以提交事务了.</span><br><span class="line">   事务填补了生产者发布消息以及RabbitMQ将它们提交到磁盘上这两者之间&quot;最有1英里&quot;的差距</span><br><span class="line"></span><br><span class="line">   RabbitMQ事务消耗RabbitMQ性能,RabbitMQ团队拿出最好的方案来保证消息投递:发送方确认模式</span><br><span class="line">   你需要告诉RabbitMQ将信道设置成confirm模式,而且你只能通过重新创建信道来关闭该设置.一旦信道进入confirm模式,所有在信道上发布的消息都会被指派一个唯一的ID号.一旦消息被投递给所有匹配的队列后,信道会发送一个发送方确认模式给生产者应用程序.这使得生产者知晓消息已经安全到达队列了.如果消息和队列是可持久化的,那么确认消息只会在队列将消息写入磁盘后才会发出.发送方确认模式的最大好处是它们是异步的.一旦发布了一条消息,生产者应用程序就可以在等待确认的同时继续发送下一条.当确认消息最终收到的时候,生产者应用的回调方法就会被触发来处理该确认消息.如果RabbitMQ内部错误从而导致了消息的丢失,RabbitMQ会发送一条nack消息.就像发送方确认消息那样,只不过这次说明的消息已经丢失了.同时,由于没有消息回滚的概念,因此发送方确认模式更加轻量级,同时对RabbitMQ代理服务器的性能影响几乎可以忽略不计</span><br><span class="line">6. 一条消息的一生</span><br><span class="line">   发布者:</span><br><span class="line">   * 连接到RabbitMQ</span><br><span class="line">   * 获取信道</span><br><span class="line">   * 声明交换器</span><br><span class="line">   * 创建消息</span><br><span class="line">   * 发布消息</span><br><span class="line">   * 关闭信道</span><br><span class="line">   * 关闭连接</span><br><span class="line"></span><br><span class="line">   脚本:</span><br><span class="line">   esay_install pika</span><br><span class="line">   # -*- coding:utf-8 -*-</span><br><span class="line">   import pika,sys</span><br><span class="line">   # 建立连接</span><br><span class="line">   credentials = pika.PlainCredentials(&quot;guest&quot;,&quot;guest&quot;)</span><br><span class="line">   conn_params = pika.ConnectionParameters(&quot;localhost&quot;,credentials = credentials)</span><br><span class="line">   conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line">   # 获取信道</span><br><span class="line">   channel = conn_broker.channel()</span><br><span class="line">   # 声明交换器</span><br><span class="line">   channel.exchange_declare(exchange=&quot;hello-exchange&quot;,type=&quot;direct&quot;,passive=False,durable=True,auto_delete=False)</span><br><span class="line">   # 创建消息</span><br><span class="line">   msg = sys.argv[1]</span><br><span class="line">   msg_props = pika.baseicProperties()</span><br><span class="line">   msg_props.content_type = &quot;text/plain&quot;</span><br><span class="line">   # 发布消息</span><br><span class="line">   channel.basic_publish(body=msg,exchange=&quot;hello-exchange&quot;,properties=msg_props,routing_key=&quot;hola&quot;)</span><br><span class="line"></span><br><span class="line">   消费者:</span><br><span class="line">   * 连接到RabbitMQ</span><br><span class="line">   * 获取信道</span><br><span class="line">   * 声明交换器</span><br><span class="line">   * 声明队列</span><br><span class="line">   * 把队列和交换器绑定起来</span><br><span class="line">   * 消费消息</span><br><span class="line">   * 关闭信道</span><br><span class="line">   * 关闭连接</span><br><span class="line"></span><br><span class="line">   脚本:</span><br><span class="line">   esay_install pika</span><br><span class="line">   # -*- coding:utf-8 -*-</span><br><span class="line">   import pika,sys</span><br><span class="line">   # 建立连接</span><br><span class="line">   credentials = pika.PlainCredentials(&quot;guest&quot;,&quot;guest&quot;)</span><br><span class="line">   conn_params = pika.ConnectionParameters(&quot;localhost&quot;,credentials = credentials)</span><br><span class="line">   conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line">   # 获取信道</span><br><span class="line">   channel = conn_broker.channel()</span><br><span class="line">   # 声明交换器</span><br><span class="line">   channel.exchange_declare(exchange=&quot;hello-exchange&quot;,type=&quot;direct&quot;,passive=False,durable=True,auto_delete=False)</span><br><span class="line">   # 声明队列</span><br><span class="line">   channel.queue_declare(queue=&quot;hello-queue&quot;)</span><br><span class="line">   # 通过routing键将队列和交换器绑定起来</span><br><span class="line">   channel.queue_bind(queue=&quot;hello-queue&quot;,exchange=&quot;hello-exchange&quot;,routing_key=&quot;hola&quot;)</span><br><span class="line">   # 定义消息处理函数</span><br><span class="line">   def msg_consumer(channel,method,header,body):</span><br><span class="line">       # 消息确认</span><br><span class="line">       channel.basic_ack(delivery_tag=method.delivery_tag)</span><br><span class="line">       # 停止消费并退出</span><br><span class="line">       if body == &quot;quit&quot;:</span><br><span class="line">           channel.basic_cancel(consumer_tag=&quot;hello-consumer&quot;)</span><br><span class="line">           channel.stop_consuming()</span><br><span class="line">       else:</span><br><span class="line">           print body</span><br><span class="line">       return</span><br><span class="line">  # 订阅消费者</span><br><span class="line">  channel.basic_consume(msg_consumer,queue=&quot;hello-queue&quot;,consumer_tag=&quot;hello-consumer&quot;)</span><br><span class="line">  channel.start_consuming()</span><br><span class="line"></span><br><span class="line">7. 使用发送方确认模式来确认投递</span><br><span class="line">  带有确认功能的生产者</span><br><span class="line"></span><br><span class="line">  # -*- coding:utf-8 -*-</span><br><span class="line">  import pika,sys</span><br><span class="line">  from pika import spec</span><br><span class="line"></span><br><span class="line">  credentials = pika.PlainCredentials(&quot;guest&quot;,&quot;guest&quot;)</span><br><span class="line">  conn_params = pika.ConnectionParameters(&quot;localhost&quot;,credentials = credentials)</span><br><span class="line">  conn_broker = pika.BlockingConnection(conn_params)</span><br><span class="line"></span><br><span class="line">  channel = conn_broker.channel()</span><br><span class="line">  #发送方确认模式处理器</span><br><span class="line">  def confirm_handler(frame):</span><br><span class="line">      if type(frame.method) == spec.Confirm.SelectOK:</span><br><span class="line">          print &quot;Channel in &apos;confirm&apos; mode.&quot;</span><br><span class="line">      elif type(frame.method) == spec.Basic.Nack:</span><br><span class="line">          if frame.method.delivery_tag in msg_ids:</span><br><span class="line">              print &quot;Message lost!&quot;</span><br><span class="line">      elif type(frame.method) == spec.Basic.Ack:</span><br><span class="line">          if frame.method.delivery_tag in msg_ids:</span><br><span class="line">              print &quot;Confirm received!&quot;</span><br><span class="line">              msg_ids.remove(frame.method.delivery_tag)</span><br><span class="line">  # 将信道设置为confirm模式</span><br><span class="line">  channel.confirm_delivery(callback=confirm_handler)</span><br><span class="line">  # 重设消息ID追踪器</span><br><span class="line">  msg = sys.argv[1]</span><br><span class="line">  msg_props = pika.baseicProperties()</span><br><span class="line">  msg_props.content_type = &quot;text/plain&quot;</span><br><span class="line">  msg_ids = []</span><br><span class="line">  # 发布消息</span><br><span class="line">  channel.basic_publish(body=msg,exchange=&quot;hello-exchange&quot;,properties=msg_props,routing_key=&quot;hola&quot;)</span><br><span class="line">  msg_ids.append(len(msg_ids) + 1)</span><br><span class="line">  channel.close()</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/RabbitMQ-info/" data-id="cjazexza9000mqcoqpozttqpe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-flume-info" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/flume-info/" class="article-date">
  <time datetime="2017-03-20T04:08:20.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/flume/">flume</a>►<a class="article-category-link" href="/categories/hadoop/flume/flume-info/">flume info</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/flume-info/">flume info</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="flume-简介"><a href="#flume-简介" class="headerlink" title="flume 简介"></a>flume 简介</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Flume NG是什么?</span><br><span class="line">Flume NG是一个分布式,高可用,可靠的系统,它能将不同的海量数据收集,移动并存储到一个数据存储系统中.</span><br><span class="line">轻量,配置简单,适用于各种日志收集,并支持Failover和负载均衡.并且它拥有非常丰富的组件.</span><br><span class="line"></span><br><span class="line">Flume流程:</span><br><span class="line">Events(Client =&gt; Agent(source =&gt; channel =&gt; sink))</span><br><span class="line"></span><br><span class="line">Flume核心概念:</span><br><span class="line">1.Event：一个数据单元，带有一个可选的消息头</span><br><span class="line">2.Flow：Event从源点到达目的点的迁移的抽象</span><br><span class="line">3.Client：操作位于源点处的Event，将其发送到Flume Agent</span><br><span class="line">4.Agent：一个独立的Flume进程，包含组件Source、Channel、Sink</span><br><span class="line">5.Source：用来消费传递到该组件的Event</span><br><span class="line">6.Channel：中转Event的一个临时存储，保存有Source组件传递过来的Event</span><br><span class="line">7.Sink：从Channel中读取并移除Event，将Event传递到Flow Pipeline中的下一个Agent（如果有的话）</span><br><span class="line"></span><br><span class="line">Flume原理:</span><br><span class="line">Flume的核心是把数据从数据源收集过来,再送到目的地.为了保证输送一定成功,在送到目的地之前,会先缓存数据,待数据真正到达目的地后,删除自己缓存的数据</span><br><span class="line">Flume传输的数据的基本单位是Event,如果是文本文件,通常是一行记录,这也是事务的基本单位.Event从Source流向Channel,再到Sink,本身为一个byte 数组,并可携带headers信息.Event代表着一个数据流的最小完整单元,从外部数据源来,向外部的目的地去</span><br><span class="line">Flume运行的核心是Agent.它是一个完整的数据收集工具,含有三个核心组件,分别是source,channel,sink.通过这些组件,Event 可以从一个地方流向另一个地方.</span><br><span class="line"></span><br><span class="line">Flume Agent三大组件:</span><br><span class="line">1.source</span><br><span class="line">  可以接收外部源发送过来的数据.不同的source,可以接受不同的数据格式.</span><br><span class="line">  比如:有目录池(spooling directory)数据源,可以监控指定文件夹中的新文件变化,如果目录中有文件产生,就会立刻读取其内容</span><br><span class="line">2.channel</span><br><span class="line">  是一个存储地,接收source的输出,直到有sink消费掉channel中的数据</span><br><span class="line">  channel中的数据直到进入到下一个channel中或者进入终端才会被删除.当sink写入失败后,可以自动重启,不会造成数据丢失,因此很可靠.</span><br><span class="line">3.sink会消费channel中的数据,然后送给外部源或者其他source.如数据可以写入到HDFS或者HBase中</span><br></pre></td></tr></table></figure>
<hr>
<ol>
<li><p>flume 配置文件示例一</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">penn@ubuntu:/mnt/app/flume$ cat conf/test.conf</span><br><span class="line"><span class="comment"># name the components on this agent</span></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line"><span class="comment"># source</span></span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 4444</span><br><span class="line"></span><br><span class="line"><span class="comment"># channel</span></span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># sink</span></span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line"><span class="comment"># bind source and sink to the channel</span></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line">penn@ubuntu:/mnt/app/flume$ ./bin/flume-ng agent --conf ./conf --conf-file ./conf/test.conf --name a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>
</li>
<li><p>flume 配置文件示例二</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1.source instance can specify multiple channels, but a sink instance can only specify one channel. The format is as follows:</span><br><span class="line"><span class="comment"># list the sources, sinks and channels for the agent</span></span><br><span class="line">&lt;Agent&gt;.sources = &lt;Source&gt;</span><br><span class="line">&lt;Agent&gt;.sinks = &lt;Sink&gt;</span><br><span class="line">&lt;Agent&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># set channel for source</span></span><br><span class="line">&lt;Agent&gt;.sources.&lt;Source&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt; ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># set channel for sink</span></span><br><span class="line">&lt;Agent&gt;.sinks.&lt;Sink&gt;.channel = &lt;Channel1&gt;</span><br><span class="line"></span><br><span class="line">2.Adding multiple flows <span class="keyword">in</span> an agent</span><br><span class="line">&lt;Agent&gt;.sources = &lt;Source1&gt; &lt;Source2&gt;</span><br><span class="line">&lt;Agent&gt;.sinks = &lt;Sink1&gt; &lt;Sink2&gt;</span><br><span class="line">&lt;Agent&gt;.channels = &lt;Channel1&gt; &lt;Channel2&gt;</span><br><span class="line"></span><br><span class="line">3.In the replicating flow, the event is sent to all the configured channels. In <span class="keyword">case</span> of multiplexing, the event is sent to only a subset of qualifying channels.Once all required channels have consumed the events, <span class="keyword">then</span> the selector will attempt to write to the optional channels.</span><br><span class="line">Note that <span class="keyword">if</span> a header does not have any required channels, <span class="keyword">then</span> the event will be written to the default channels and will be attempted to be written to the optional channels <span class="keyword">for</span> that header. Specifying optional channels will still cause the event to be written to the default channels, <span class="keyword">if</span> no required channels are specified. If no channels are designated as default and there are no required, the selector will attempt to write the events to the optional channels. Any failures are simply ignored <span class="keyword">in</span> that <span class="keyword">case</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment"># list the sources, sinks and channels in the agent</span></span><br><span class="line">agent_foo.sources = avro-AppSrv-source1</span><br><span class="line">agent_foo.sinks = hdfs-Cluster1-sink1 avro-forward-sink2</span><br><span class="line">agent_foo.channels = mem-channel-1 file-channel-2</span><br><span class="line"></span><br><span class="line"><span class="comment"># set channels for source</span></span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.channels = mem-channel-1 file-channel-2</span><br><span class="line"></span><br><span class="line"><span class="comment"># set channel for sinks</span></span><br><span class="line">agent_foo.sinks.hdfs-Cluster1-sink1.channel = mem-channel-1</span><br><span class="line">agent_foo.sinks.avro-forward-sink2.channel = file-channel-2</span><br><span class="line"></span><br><span class="line"><span class="comment"># channel selector configuration</span></span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.type = multiplexing</span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.header = State</span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.mapping.CA = mem-channel-1</span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.mapping.AZ = file-channel-2</span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.mapping.NY = mem-channel-1 file-channel-2</span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.optional.CA = mem-channel-1 file-channel-2</span><br><span class="line">agent_foo.sources.avro-AppSrv-source1.selector.default = mem-channel-1</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/flume-info/" data-id="cjazexzcv002oqcoqh01szavp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-beats-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/beats-install/" class="article-date">
  <time datetime="2017-03-20T04:05:59.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>►<a class="article-category-link" href="/categories/hadoop/beats/">beats</a>►<a class="article-category-link" href="/categories/hadoop/beats/beats-install/">beats install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/beats-install/">beats install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="beats"><a href="#beats" class="headerlink" title="beats"></a><a href="https://www.elastic.co/products/beats" target="_blank" rel="noopener">beats</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Beats:</span><br><span class="line">Lightweight Data Shippers</span><br><span class="line">Beats is the platform for single-purpose data shippers. They install as lightweight agents and send data from hundreds or thousands of machines to Logstash or Elasticsearch.</span><br><span class="line"></span><br><span class="line">The Beats Family:</span><br><span class="line">1.Filebeat</span><br><span class="line">  Forget using SSH when you have tens, hundreds, or even thousands of servers, virtual machines, and containers generating logs. Filebeat helps you keep the simple things simple by offering a lightweight way to forward and centralize logs and files.</span><br><span class="line">2.Metricsbeat</span><br><span class="line">  Collect metrics from your systems and services. From CPU to memory, Redis to Nginx, and much more, Metricbeat is a lightweight way to send system statistics.</span><br><span class="line">3.Packetbeat</span><br><span class="line">  Know what’s going on across your applications by tapping into data traveling over the wire. Packetbeat is a lightweight network packet analyzer that sends data to Logstash or Elasticsearch.</span><br><span class="line">4.Winlogbeat</span><br><span class="line">  Keep a pulse on what’s happening across your Windows-based infrastructure. Winlogbeat live streams Windows event logs to Elasticsearch and Logstash in a lightweight way.</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">例子:</span><br><span class="line">filebeat.yml:</span><br><span class="line">filebeat.prospectors:</span><br><span class="line">- input_type: log</span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/apache/httpd-*.log</span><br><span class="line">  document_type: apache</span><br><span class="line"></span><br><span class="line">- input_type: log</span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/messages</span><br><span class="line">    - /var/log/*.log</span><br><span class="line"></span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [&quot;localhost:5044&quot;]</span><br><span class="line">  index: filebeat</span><br><span class="line"></span><br><span class="line">./filebeat -c filebeat.yml -configtest</span><br><span class="line">./filebeat -c filebeat.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Logstash loadbalance: https://www.elastic.co/guide/en/beats/filebeat/current/load-balancing.html</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [&quot;localhost:5044&quot;, &quot;localhost:5045&quot;]</span><br><span class="line">  loadbalance: true</span><br><span class="line">  worker: 2</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/beats-install/" data-id="cjazexzbk001bqcoqlltdu55h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-influxdb-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/influxdb-install/" class="article-date">
  <time datetime="2017-03-20T03:47:59.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/database/">database</a>►<a class="article-category-link" href="/categories/database/influxDB/">influxDB</a>►<a class="article-category-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/influxdb-install/">influxdb install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="influxdb-简介"><a href="#influxdb-简介" class="headerlink" title="influxdb 简介"></a>influxdb 简介</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">InfluxDB是用Go语言编写的一个开源分布式时序,事件和指标数据库,无需外部依赖.类似的数据库有Elasticsearch,Graphite等.</span><br><span class="line"></span><br><span class="line">特色:</span><br><span class="line">1.基于时间序列,支持与时间有关的相关函数(如最大,最小,求和等)</span><br><span class="line">2.可度量性：你可以实时对大量数据进行计算</span><br><span class="line">3.基于事件：它支持任意的事件数据</span><br><span class="line"></span><br><span class="line">特点:</span><br><span class="line">1.无结构（无模式）：可以是任意数量的列</span><br><span class="line">2.可拓展的</span><br><span class="line">3.支持min, max, sum, count, mean, median 等一系列函数，方便统计</span><br><span class="line">4.原生的HTTP支持，内置HTTP API</span><br><span class="line">5.强大的类SQL语法</span><br><span class="line">6.自带管理界面，方便使用</span><br><span class="line"></span><br><span class="line">By default, InfluxDB uses the following network ports:</span><br><span class="line">TCP port 8083 is used for InfluxDB’s Admin panel</span><br><span class="line">TCP port 8086 is used for client-server communication over InfluxDB’s HTTP API</span><br></pre></td></tr></table></figure>
<ol>
<li><p>influxdb 安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># wget https://dl.influxdata.com/influxdb/releases/influxdb-1.1.1_linux_amd64.tar.gz</span></span><br><span class="line">[root@xxx ~]<span class="comment"># tar xzf influxdb-1.1.1_linux_amd64.tar.gz</span></span><br><span class="line">[root@xxx ~]<span class="comment"># mv influxdb-1.1.1-1 /mnt/app/influxdb</span></span><br><span class="line">[root@xxx ~]<span class="comment"># mkdir -p /mnt/data/influxdb/&#123;meta,data,hh,wal&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>influxdb 环境变量设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># echo 'INFLUX_PATH=/mnt/app/influxdb'     |tee /etc/profile.d/influx.sh</span></span><br><span class="line">[root@xxx ~]<span class="comment"># echo 'INFLUX_BIN=$&#123;INFLUX_PATH&#125;/usr/bin' |tee -a /etc/profile.d/influx.sh</span></span><br><span class="line">[root@xxx ~]<span class="comment"># echo 'export PATH=$&#123;INFLUX_BIN&#125;:$PATH'   |tee -a /etc/profile.d/influx.sh</span></span><br><span class="line">[root@xxx ~]<span class="comment"># source  /etc/profile</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>influxdb 配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># vim /mnt/app/influxdb/etc/influxdb/influxdb.conf</span></span><br><span class="line">[admin]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":8083"</span></span><br><span class="line">[http]</span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":8086"</span></span><br><span class="line">[meta]</span><br><span class="line">  dir = <span class="string">"/mnt/data/influxdb/meta"</span></span><br><span class="line">[data]</span><br><span class="line">  dir = <span class="string">"/mnt/data/influxdb/data"</span></span><br><span class="line">  wal-dir = <span class="string">"/mnt/data/influxdb/wal"</span></span><br><span class="line">[[udp]]</span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":8089"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>influxdb 启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-90-45 ~]<span class="comment"># /mnt/app/influxdb/usr/bin/influxd -config /mnt/app/influxdb/etc/influxdb/influxdb.conf</span></span><br><span class="line">or:</span><br><span class="line">[root@ip-172-31-90-45 ~]<span class="comment"># /mnt/app/influxdb/usr/bin/influxd run -config /mnt/app/influxdb/etc/influxdb/influxdb.conf -pidfile /mnt/app/influxdb/run/influxdb.pid -cpuprofile /mnt/app/influxdb/run/influxdb.cpu -memprofile /mnt/app/influxdb/run/influxdb.memory &amp;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>influxdb通过浏览器访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://&#123;IP&#125;:8083</span><br></pre></td></tr></table></figure>
</li>
<li><p>grafana install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># tar xzf grafana-4.1.1-1484211277.linux-x64.tar.gz</span></span><br><span class="line">[root@xxx ~]<span class="comment"># mv grafana-4.1.1-1484211277 /mnt/app/grafana</span></span><br><span class="line">[root@xxx ~]<span class="comment"># cp /mnt/app/grafana/conf/&#123;sample.ini,custom.ini&#125;</span></span><br><span class="line"></span><br><span class="line">[root@xxx srv]<span class="comment"># vim /mnt/app/grafana/conf/custom.ini</span></span><br><span class="line">[root@xxx srv]<span class="comment"># mkdir -p /mnt/data/grafana</span></span><br><span class="line">[root@xxx srv]<span class="comment"># mkdir -p /mnt/log/grafana</span></span><br><span class="line">[root@xxx srv]<span class="comment"># mkdir -p  /mnt/app/grafana/plugins</span></span><br><span class="line"></span><br><span class="line">[root@xxx srv]<span class="comment"># /mnt/app/grafana/bin/grafana-server -homepath /mnt/app/grafana/ -config /mnt/app/grafana/conf/custom.ini  &amp;</span></span><br><span class="line"></span><br><span class="line">用户和密码默认都是admin</span><br><span class="line">[root@xxx conf]<span class="comment"># /mnt/app/grafana/bin/grafana-server -homepath /mnt/app/grafana -config /mnt/app/grafana/conf/custom.ini  -pidfile /mnt/app/grafana/run/grafana.pid &amp;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h4 id="influxdb-配置"><a href="#influxdb-配置" class="headerlink" title="influxdb 配置"></a>influxdb 配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># cat /mnt/app/influxdb/etc/influxdb/influxdb.conf</span></span><br><span class="line">reporting-disabled = <span class="literal">false</span></span><br><span class="line">hostname = <span class="string">"172.31.90.45"</span></span><br><span class="line">[meta]</span><br><span class="line">  dir = <span class="string">"/mnt/data/influxdb/meta"</span></span><br><span class="line">  retention-autocreate = <span class="literal">true</span></span><br><span class="line">  logging-enabled = <span class="literal">true</span></span><br><span class="line">[data]</span><br><span class="line">  dir = <span class="string">"/mnt/data/influxdb/data"</span></span><br><span class="line">  wal-dir = <span class="string">"/mnt/data/influxdb/wal"</span></span><br><span class="line">  trace-logging-enabled = <span class="literal">false</span></span><br><span class="line">  query-log-enabled = <span class="literal">true</span></span><br><span class="line">  cache-max-memory-size = 1048576000</span><br><span class="line">  cache-snapshot-memory-size = 26214400</span><br><span class="line">  cache-snapshot-write-cold-duration = <span class="string">"10m"</span></span><br><span class="line">  compact-full-write-cold-duration = <span class="string">"4h"</span></span><br><span class="line">  max-series-per-database = 1000000</span><br><span class="line">  max-values-per-tag = 100000</span><br><span class="line">[coordinator]</span><br><span class="line">  write-timeout = <span class="string">"10s"</span></span><br><span class="line">  max-concurrent-queries = 0</span><br><span class="line">  query-timeout = <span class="string">"0s"</span></span><br><span class="line">  <span class="built_in">log</span>-queries-after = <span class="string">"0s"</span></span><br><span class="line">  max-select-point = 0</span><br><span class="line">  max-select-series = 0</span><br><span class="line">  max-select-buckets = 0</span><br><span class="line">[retention]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  check-interval = <span class="string">"30m"</span></span><br><span class="line">[shard-precreation]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  check-interval = <span class="string">"10m"</span></span><br><span class="line">  advance-period = <span class="string">"30m"</span></span><br><span class="line">[monitor]</span><br><span class="line">  store-enabled = <span class="literal">true</span></span><br><span class="line">  store-database = <span class="string">"_internal"</span></span><br><span class="line">  store-interval = <span class="string">"10s"</span></span><br><span class="line">[admin]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":8083"</span></span><br><span class="line">  https-enabled = <span class="literal">false</span></span><br><span class="line">[http]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":8086"</span></span><br><span class="line">  auth-enabled = <span class="literal">false</span></span><br><span class="line">  <span class="built_in">log</span>-enabled = <span class="literal">true</span></span><br><span class="line">  write-tracing = <span class="literal">false</span></span><br><span class="line">  pprof-enabled = <span class="literal">true</span></span><br><span class="line">  https-enabled = <span class="literal">false</span></span><br><span class="line">  max-row-limit = 10000</span><br><span class="line">  max-connection-limit = 0</span><br><span class="line">  unix-socket-enabled = <span class="literal">false</span></span><br><span class="line">[subscriber]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  http-timeout = <span class="string">"30s"</span></span><br><span class="line">  insecure-skip-verify = <span class="literal">false</span></span><br><span class="line">  write-concurrency = 40</span><br><span class="line">  write-buffer-size = 1000</span><br><span class="line">[[collectd]]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":25826"</span></span><br><span class="line">  database = <span class="string">"collectd"</span></span><br><span class="line">  retention-policy = <span class="string">""</span></span><br><span class="line">  typesdb = <span class="string">"/mnt/data/collectd/types.db"</span></span><br><span class="line">  batch-size = 5000</span><br><span class="line">  batch-pending = 10</span><br><span class="line">  batch-timeout = <span class="string">"10s"</span></span><br><span class="line">  <span class="built_in">read</span>-buffer = 0</span><br><span class="line">[continuous_queries]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">log</span>-enabled = <span class="literal">true</span></span><br><span class="line">  run-interval = <span class="string">"1s"</span></span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@xxx ~]<span class="comment"># cat /mnt/app/influxdb/etc/influxdb/influxdb.conf |grep -v \#|grep -v ^$</span></span><br><span class="line">  reporting-disabled = <span class="literal">false</span></span><br><span class="line">  hostname = <span class="string">"172.31.90.45"</span></span><br><span class="line">  [meta]</span><br><span class="line">    dir = <span class="string">"/mnt/data/influxdb/meta"</span></span><br><span class="line">    retention-autocreate = <span class="literal">true</span></span><br><span class="line">    logging-enabled = <span class="literal">true</span></span><br><span class="line">  [data]</span><br><span class="line">    dir = <span class="string">"/mnt/data/influxdb/data"</span></span><br><span class="line">    wal-dir = <span class="string">"/mnt/data/influxdb/wal"</span></span><br><span class="line">    trace-logging-enabled = <span class="literal">false</span></span><br><span class="line">    query-log-enabled = <span class="literal">true</span></span><br><span class="line">    cache-max-memory-size = 1048576000</span><br><span class="line">    cache-snapshot-memory-size = 26214400</span><br><span class="line">    cache-snapshot-write-cold-duration = <span class="string">"10m"</span></span><br><span class="line">    compact-full-write-cold-duration = <span class="string">"4h"</span></span><br><span class="line">    max-series-per-database = 1000000</span><br><span class="line">    max-values-per-tag = 100000</span><br><span class="line">  [coordinator]</span><br><span class="line">    write-timeout = <span class="string">"10s"</span></span><br><span class="line">    max-concurrent-queries = 0</span><br><span class="line">    query-timeout = <span class="string">"0s"</span></span><br><span class="line">    <span class="built_in">log</span>-queries-after = <span class="string">"0s"</span></span><br><span class="line">    max-select-point = 0</span><br><span class="line">    max-select-series = 0</span><br><span class="line">    max-select-buckets = 0</span><br><span class="line">  [retention]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    check-interval = <span class="string">"30m"</span></span><br><span class="line">  [shard-precreation]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    check-interval = <span class="string">"10m"</span></span><br><span class="line">    advance-period = <span class="string">"30m"</span></span><br><span class="line">  [monitor]</span><br><span class="line">    store-enabled = <span class="literal">true</span></span><br><span class="line">    store-database = <span class="string">"_internal"</span></span><br><span class="line">    store-interval = <span class="string">"10s"</span></span><br><span class="line">  [admin]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">bind</span>-address = <span class="string">":8083"</span></span><br><span class="line">    https-enabled = <span class="literal">false</span></span><br><span class="line">  [http]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">bind</span>-address = <span class="string">":8086"</span></span><br><span class="line">    auth-enabled = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">log</span>-enabled = <span class="literal">true</span></span><br><span class="line">    write-tracing = <span class="literal">false</span></span><br><span class="line">    pprof-enabled = <span class="literal">true</span></span><br><span class="line">    https-enabled = <span class="literal">false</span></span><br><span class="line">    max-row-limit = 10000</span><br><span class="line">    max-connection-limit = 0</span><br><span class="line">    unix-socket-enabled = <span class="literal">false</span></span><br><span class="line">  [subscriber]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    http-timeout = <span class="string">"30s"</span></span><br><span class="line">    insecure-skip-verify = <span class="literal">false</span></span><br><span class="line">    write-concurrency = 40</span><br><span class="line">    write-buffer-size = 1000</span><br><span class="line">  [[collectd]]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">bind</span>-address = <span class="string">":25826"</span></span><br><span class="line">    database = <span class="string">"collectd"</span></span><br><span class="line">    retention-policy = <span class="string">""</span></span><br><span class="line">    typesdb = <span class="string">"/mnt/data/collectd/types.db"</span></span><br><span class="line">    batch-size = 5000</span><br><span class="line">    batch-pending = 10</span><br><span class="line">    batch-timeout = <span class="string">"10s"</span></span><br><span class="line">    <span class="built_in">read</span>-buffer = 0</span><br><span class="line">  [continuous_queries]</span><br><span class="line">    enabled = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">log</span>-enabled = <span class="literal">true</span></span><br><span class="line">    run-interval = <span class="string">"1s"</span></span><br></pre></td></tr></table></figure>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-172-31-90-45 ~]<span class="comment"># cat /mnt/data/collectd/types.db</span></span><br><span class="line">absolute                value:ABSOLUTE:0:U</span><br><span class="line">apache_bytes            value:DERIVE:0:U</span><br><span class="line">apache_connections      value:GAUGE:0:65535</span><br><span class="line">apache_idle_workers     value:GAUGE:0:65535</span><br><span class="line">apache_requests         value:DERIVE:0:U</span><br><span class="line">apache_scoreboard       value:GAUGE:0:65535</span><br><span class="line">ath_nodes               value:GAUGE:0:65535</span><br><span class="line">ath_stat                value:DERIVE:0:U</span><br><span class="line">backends                value:GAUGE:0:65535</span><br><span class="line">bitrate                 value:GAUGE:0:4294967295</span><br><span class="line">blocked_clients         value:GAUGE:0:U</span><br><span class="line">bucket                  value:GAUGE:0:U</span><br><span class="line">bytes                   value:GAUGE:0:U</span><br><span class="line">cache_eviction          value:DERIVE:0:U</span><br><span class="line">cache_operation         value:DERIVE:0:U</span><br><span class="line">cache_ratio             value:GAUGE:0:100</span><br><span class="line">cache_result            value:DERIVE:0:U</span><br><span class="line">cache_size              value:GAUGE:0:1125899906842623</span><br><span class="line">capacity                value:GAUGE:0:U</span><br><span class="line">ceph_bytes              value:GAUGE:U:U</span><br><span class="line">ceph_latency            value:GAUGE:U:U</span><br><span class="line">ceph_rate               value:DERIVE:0:U</span><br><span class="line">changes_since_last_save value:GAUGE:0:U</span><br><span class="line">charge                  value:GAUGE:0:U</span><br><span class="line">clock_last_meas         value:GAUGE:0:U</span><br><span class="line">clock_last_update       value:GAUGE:U:U</span><br><span class="line">clock_mode              value:GAUGE:0:U</span><br><span class="line">clock_reachability      value:GAUGE:0:U</span><br><span class="line">clock_skew_ppm          value:GAUGE:-2:2</span><br><span class="line">clock_state             value:GAUGE:0:U</span><br><span class="line">clock_stratum           value:GAUGE:0:U</span><br><span class="line">compression             uncompressed:DERIVE:0:U, compressed:DERIVE:0:U</span><br><span class="line">compression_ratio       value:GAUGE:0:2</span><br><span class="line">connections             value:DERIVE:0:U</span><br><span class="line">conntrack               value:GAUGE:0:4294967295</span><br><span class="line">contextswitch           value:DERIVE:0:U</span><br><span class="line">count                   value:GAUGE:0:U</span><br><span class="line">counter                 value:COUNTER:U:U</span><br><span class="line">cpu                     value:DERIVE:0:U</span><br><span class="line">cpufreq                 value:GAUGE:0:U</span><br><span class="line">current                 value:GAUGE:U:U</span><br><span class="line">current_connections     value:GAUGE:0:U</span><br><span class="line">current_sessions        value:GAUGE:0:U</span><br><span class="line">delay                   value:GAUGE:-1000000:1000000</span><br><span class="line">derive                  value:DERIVE:0:U</span><br><span class="line">df                      used:GAUGE:0:1125899906842623, free:GAUGE:0:1125899906842623</span><br><span class="line">df_complex              value:GAUGE:0:U</span><br><span class="line">df_inodes               value:GAUGE:0:U</span><br><span class="line">dilution_of_precision   value:GAUGE:0:U</span><br><span class="line">disk_io_time            io_time:DERIVE:0:U, weighted_io_time:DERIVE:0:U</span><br><span class="line">disk_latency            <span class="built_in">read</span>:GAUGE:0:U, write:GAUGE:0:U</span><br><span class="line">disk_merged             <span class="built_in">read</span>:DERIVE:0:U, write:DERIVE:0:U</span><br><span class="line">disk_octets             <span class="built_in">read</span>:DERIVE:0:U, write:DERIVE:0:U</span><br><span class="line">disk_ops                <span class="built_in">read</span>:DERIVE:0:U, write:DERIVE:0:U</span><br><span class="line">disk_ops_complex        value:DERIVE:0:U</span><br><span class="line">disk_time               <span class="built_in">read</span>:DERIVE:0:U, write:DERIVE:0:U</span><br><span class="line">dns_answer              value:DERIVE:0:U</span><br><span class="line">dns_notify              value:DERIVE:0:U</span><br><span class="line">dns_octets              queries:DERIVE:0:U, responses:DERIVE:0:U</span><br><span class="line">dns_opcode              value:DERIVE:0:U</span><br><span class="line">dns_qtype               value:DERIVE:0:U</span><br><span class="line">dns_qtype_cached        value:GAUGE:0:4294967295</span><br><span class="line">dns_query               value:DERIVE:0:U</span><br><span class="line">dns_question            value:DERIVE:0:U</span><br><span class="line">dns_rcode               value:DERIVE:0:U</span><br><span class="line">dns_reject              value:DERIVE:0:U</span><br><span class="line">dns_request             value:DERIVE:0:U</span><br><span class="line">dns_resolver            value:DERIVE:0:U</span><br><span class="line">dns_response            value:DERIVE:0:U</span><br><span class="line">dns_transfer            value:DERIVE:0:U</span><br><span class="line">dns_update              value:DERIVE:0:U</span><br><span class="line">dns_zops                value:DERIVE:0:U</span><br><span class="line">drbd_resource           value:DERIVE:0:U</span><br><span class="line">duration                seconds:GAUGE:0:U</span><br><span class="line">email_check             value:GAUGE:0:U</span><br><span class="line">email_count             value:GAUGE:0:U</span><br><span class="line">email_size              value:GAUGE:0:U</span><br><span class="line">energy                  value:GAUGE:U:U</span><br><span class="line">energy_wh               value:GAUGE:U:U</span><br><span class="line">entropy                 value:GAUGE:0:4294967295</span><br><span class="line">errors                  value:DERIVE:0:U</span><br><span class="line">evicted_keys            value:DERIVE:0:U</span><br><span class="line">expired_keys            value:DERIVE:0:U</span><br><span class="line">fanspeed                value:GAUGE:0:U</span><br><span class="line">file_handles            value:GAUGE:0:U</span><br><span class="line">file_size               value:GAUGE:0:U</span><br><span class="line">files                   value:GAUGE:0:U</span><br><span class="line">filter_result           value:DERIVE:0:U</span><br><span class="line">flow                    value:GAUGE:0:U</span><br><span class="line">fork_rate               value:DERIVE:0:U</span><br><span class="line">frequency               value:GAUGE:0:U</span><br><span class="line">frequency_error         value:GAUGE:-2:2</span><br><span class="line">frequency_offset        value:GAUGE:-1000000:1000000</span><br><span class="line">fscache_stat            value:DERIVE:0:U</span><br><span class="line">gauge                   value:GAUGE:U:U</span><br><span class="line">hash_collisions         value:DERIVE:0:U</span><br><span class="line">http_request_methods    value:DERIVE:0:U</span><br><span class="line">http_requests           value:DERIVE:0:U</span><br><span class="line">http_response_codes     value:DERIVE:0:U</span><br><span class="line">humidity                value:GAUGE:0:100</span><br><span class="line">if_collisions           value:DERIVE:0:U</span><br><span class="line">if_dropped              rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">if_errors               rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">if_multicast            value:DERIVE:0:U</span><br><span class="line">if_octets               rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">if_packets              rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">if_rx_dropped           value:DERIVE:0:U</span><br><span class="line">if_rx_errors            value:DERIVE:0:U</span><br><span class="line">if_rx_octets            value:DERIVE:0:U</span><br><span class="line">if_rx_packets           value:DERIVE:0:U</span><br><span class="line">if_tx_dropped           value:DERIVE:0:U</span><br><span class="line">if_tx_errors            value:DERIVE:0:U</span><br><span class="line">if_tx_octets            value:DERIVE:0:U</span><br><span class="line">if_tx_packets           value:DERIVE:0:U</span><br><span class="line">invocations             value:DERIVE:0:U</span><br><span class="line">io_octets               rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">io_packets              rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">ipc                     value:GAUGE:0:U</span><br><span class="line">ipt_bytes               value:DERIVE:0:U</span><br><span class="line">ipt_packets             value:DERIVE:0:U</span><br><span class="line">irq                     value:DERIVE:0:U</span><br><span class="line">latency                 value:GAUGE:0:U</span><br><span class="line">links                   value:GAUGE:0:U</span><br><span class="line">load                    shortterm:GAUGE:0:5000, midterm:GAUGE:0:5000, longterm:GAUGE:0:5000</span><br><span class="line">memory_bandwidth        value:DERIVE:0:U</span><br><span class="line">md_disks                value:GAUGE:0:U</span><br><span class="line">memcached_command       value:DERIVE:0:U</span><br><span class="line">memcached_connections   value:GAUGE:0:U</span><br><span class="line">memcached_items         value:GAUGE:0:U</span><br><span class="line">memcached_octets        rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">memcached_ops           value:DERIVE:0:U</span><br><span class="line">memory                  value:GAUGE:0:281474976710656</span><br><span class="line">memory_lua              value:GAUGE:0:281474976710656</span><br><span class="line">memory_throttle_count   value:DERIVE:0:U</span><br><span class="line">multimeter              value:GAUGE:U:U</span><br><span class="line">mutex_operations        value:DERIVE:0:U</span><br><span class="line">mysql_bpool_bytes       value:GAUGE:0:U</span><br><span class="line">mysql_bpool_counters    value:DERIVE:0:U</span><br><span class="line">mysql_bpool_pages       value:GAUGE:0:U</span><br><span class="line">mysql_commands          value:DERIVE:0:U</span><br><span class="line">mysql_handler           value:DERIVE:0:U</span><br><span class="line">mysql_innodb_data       value:DERIVE:0:U</span><br><span class="line">mysql_innodb_dblwr      value:DERIVE:0:U</span><br><span class="line">mysql_innodb_log        value:DERIVE:0:U</span><br><span class="line">mysql_innodb_pages      value:DERIVE:0:U</span><br><span class="line">mysql_innodb_row_lock   value:DERIVE:0:U</span><br><span class="line">mysql_innodb_rows       value:DERIVE:0:U</span><br><span class="line">mysql_locks             value:DERIVE:0:U</span><br><span class="line">mysql_log_position      value:DERIVE:0:U</span><br><span class="line">mysql_octets            rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">mysql_select            value:DERIVE:0:U</span><br><span class="line">mysql_sort              value:DERIVE:0:U</span><br><span class="line">mysql_sort_merge_passes value:DERIVE:0:U</span><br><span class="line">mysql_sort_rows         value:DERIVE:0:U</span><br><span class="line">mysql_slow_queries      value:DERIVE:0:U</span><br><span class="line">nfs_procedure           value:DERIVE:0:U</span><br><span class="line">nginx_connections       value:GAUGE:0:U</span><br><span class="line">nginx_requests          value:DERIVE:0:U</span><br><span class="line">node_octets             rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">node_rssi               value:GAUGE:0:255</span><br><span class="line">node_stat               value:DERIVE:0:U</span><br><span class="line">node_tx_rate            value:GAUGE:0:127</span><br><span class="line">objects                 value:GAUGE:0:U</span><br><span class="line">operations              value:DERIVE:0:U</span><br><span class="line">operations_per_second   value:GAUGE:0:U</span><br><span class="line">packets                 value:DERIVE:0:U</span><br><span class="line">pending_operations      value:GAUGE:0:U</span><br><span class="line">percent                 value:GAUGE:0:100.1</span><br><span class="line">percent_bytes           value:GAUGE:0:100.1</span><br><span class="line">percent_inodes          value:GAUGE:0:100.1</span><br><span class="line">pf_counters             value:DERIVE:0:U</span><br><span class="line">pf_limits               value:DERIVE:0:U</span><br><span class="line">pf_source               value:DERIVE:0:U</span><br><span class="line">pf_state                value:DERIVE:0:U</span><br><span class="line">pf_states               value:GAUGE:0:U</span><br><span class="line">pg_blks                 value:DERIVE:0:U</span><br><span class="line">pg_db_size              value:GAUGE:0:U</span><br><span class="line">pg_n_tup_c              value:DERIVE:0:U</span><br><span class="line">pg_n_tup_g              value:GAUGE:0:U</span><br><span class="line">pg_numbackends          value:GAUGE:0:U</span><br><span class="line">pg_scan                 value:DERIVE:0:U</span><br><span class="line">pg_xact                 value:DERIVE:0:U</span><br><span class="line">ping                    value:GAUGE:0:65535</span><br><span class="line">ping_droprate           value:GAUGE:0:100</span><br><span class="line">ping_stddev             value:GAUGE:0:65535</span><br><span class="line">players                 value:GAUGE:0:1000000</span><br><span class="line">power                   value:GAUGE:U:U</span><br><span class="line">pressure                value:GAUGE:0:U</span><br><span class="line">protocol_counter        value:DERIVE:0:U</span><br><span class="line">ps_code                 value:GAUGE:0:9223372036854775807</span><br><span class="line">ps_count                processes:GAUGE:0:1000000, threads:GAUGE:0:1000000</span><br><span class="line">ps_cputime              user:DERIVE:0:U, syst:DERIVE:0:U</span><br><span class="line">ps_data                 value:GAUGE:0:9223372036854775807</span><br><span class="line">ps_disk_octets          <span class="built_in">read</span>:DERIVE:0:U, write:DERIVE:0:U</span><br><span class="line">ps_disk_ops             <span class="built_in">read</span>:DERIVE:0:U, write:DERIVE:0:U</span><br><span class="line">ps_pagefaults           minflt:DERIVE:0:U, majflt:DERIVE:0:U</span><br><span class="line">ps_rss                  value:GAUGE:0:9223372036854775807</span><br><span class="line">ps_stacksize            value:GAUGE:0:9223372036854775807</span><br><span class="line">ps_state                value:GAUGE:0:65535</span><br><span class="line">ps_vm                   value:GAUGE:0:9223372036854775807</span><br><span class="line">pubsub                  value:GAUGE:0:U</span><br><span class="line">queue_length            value:GAUGE:0:U</span><br><span class="line">records                 value:GAUGE:0:U</span><br><span class="line">requests                value:GAUGE:0:U</span><br><span class="line">response_code           value:GAUGE:0:U</span><br><span class="line">response_time           value:GAUGE:0:U</span><br><span class="line">root_delay              value:GAUGE:U:U</span><br><span class="line">root_dispersion         value:GAUGE:U:U</span><br><span class="line">route_etx               value:GAUGE:0:U</span><br><span class="line">route_metric            value:GAUGE:0:U</span><br><span class="line">routes                  value:GAUGE:0:U</span><br><span class="line">satellites              value:GAUGE:0:U</span><br><span class="line">segments                value:GAUGE:0:65535</span><br><span class="line">serial_octets           rx:DERIVE:0:U, tx:DERIVE:0:U</span><br><span class="line">signal_noise            value:GAUGE:U:0</span><br><span class="line">signal_power            value:GAUGE:U:0</span><br><span class="line">signal_quality          value:GAUGE:0:U</span><br><span class="line">smart_attribute         current:GAUGE:0:255, worst:GAUGE:0:255, threshold:GAUGE:0:255, pretty:GAUGE:0:U</span><br><span class="line">smart_badsectors        value:GAUGE:0:U</span><br><span class="line">smart_powercycles       value:GAUGE:0:U</span><br><span class="line">smart_poweron           value:GAUGE:0:U</span><br><span class="line">smart_temperature       value:GAUGE:-300:300</span><br><span class="line">snr                     value:GAUGE:0:U</span><br><span class="line">spam_check              value:GAUGE:0:U</span><br><span class="line">spam_score              value:GAUGE:U:U</span><br><span class="line">spl                     value:GAUGE:U:U</span><br><span class="line">swap                    value:GAUGE:0:1099511627776</span><br><span class="line">swap_io                 value:DERIVE:0:U</span><br><span class="line">tcp_connections         value:GAUGE:0:4294967295</span><br><span class="line">temperature             value:GAUGE:U:U</span><br><span class="line">threads                 value:GAUGE:0:U</span><br><span class="line">time_dispersion         value:GAUGE:-1000000:1000000</span><br><span class="line">time_offset             value:GAUGE:-1000000:1000000</span><br><span class="line">time_offset_ntp         value:GAUGE:-1000000:1000000</span><br><span class="line">time_offset_rms         value:GAUGE:-1000000:1000000</span><br><span class="line">time_ref                value:GAUGE:0:U</span><br><span class="line">timeleft                value:GAUGE:0:U</span><br><span class="line">total_bytes             value:DERIVE:0:U</span><br><span class="line">total_connections       value:DERIVE:0:U</span><br><span class="line">total_objects           value:DERIVE:0:U</span><br><span class="line">total_operations        value:DERIVE:0:U</span><br><span class="line">total_requests          value:DERIVE:0:U</span><br><span class="line">total_sessions          value:DERIVE:0:U</span><br><span class="line">total_threads           value:DERIVE:0:U</span><br><span class="line">total_time_in_ms        value:DERIVE:0:U</span><br><span class="line">total_values            value:DERIVE:0:U</span><br><span class="line">uptime                  value:GAUGE:0:4294967295</span><br><span class="line">users                   value:GAUGE:0:65535</span><br><span class="line">vcl                     value:GAUGE:0:65535</span><br><span class="line">vcpu                    value:GAUGE:0:U</span><br><span class="line">virt_cpu_total          value:DERIVE:0:U</span><br><span class="line">virt_vcpu               value:DERIVE:0:U</span><br><span class="line">vmpage_action           value:DERIVE:0:U</span><br><span class="line">vmpage_faults           minflt:DERIVE:0:U, majflt:DERIVE:0:U</span><br><span class="line">vmpage_io               <span class="keyword">in</span>:DERIVE:0:U, out:DERIVE:0:U</span><br><span class="line">vmpage_number           value:GAUGE:0:4294967295</span><br><span class="line">volatile_changes        value:GAUGE:0:U</span><br><span class="line">voltage                 value:GAUGE:U:U</span><br><span class="line">voltage_threshold       value:GAUGE:U:U, threshold:GAUGE:U:U</span><br><span class="line">vs_memory               value:GAUGE:0:9223372036854775807</span><br><span class="line">vs_processes            value:GAUGE:0:65535</span><br><span class="line">vs_threads              value:GAUGE:0:65535</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Legacy types</span></span><br><span class="line"><span class="comment"># (required for the v5 upgrade target)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">arc_counts              demand_data:COUNTER:0:U, demand_metadata:COUNTER:0:U, prefetch_data:COUNTER:0:U, prefetch_metadata:COUNTER:0:U</span><br><span class="line">arc_l2_bytes            <span class="built_in">read</span>:COUNTER:0:U, write:COUNTER:0:U</span><br><span class="line">arc_l2_size             value:GAUGE:0:U</span><br><span class="line">arc_ratio               value:GAUGE:0:U</span><br><span class="line">arc_size                current:GAUGE:0:U, target:GAUGE:0:U, minlimit:GAUGE:0:U, maxlimit:GAUGE:0:U</span><br><span class="line">mysql_qcache            hits:COUNTER:0:U, inserts:COUNTER:0:U, not_cached:COUNTER:0:U, lowmem_prunes:COUNTER:0:U, queries_in_cache:GAUGE:0:U</span><br><span class="line">mysql_threads           running:GAUGE:0:U, connected:GAUGE:0:U, cached:GAUGE:0:U, created:COUNTER:0:U</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/influxdb-install/" data-id="cjazexze60040qcoqw9krsqdj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-log4j" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/java-log4j/" class="article-date">
  <time datetime="2017-03-20T03:43:45.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/java-log4j/">java log4j</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/java-log4j/">java log4j</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="log4j-简介"><a href="#log4j-简介" class="headerlink" title="log4j 简介"></a>log4j 简介</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Apache的开源项目log4j是一个功能强大的日志组件,提供方便的日志记录</span><br></pre></td></tr></table></figure>
<ol>
<li><p>Log4j基本使用方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Log4j由三个重要的组件构成:日志信息的优先级,日志信息的输出目的地,日志信息的输出格式</span><br><span class="line">1.日志信息的优先级从高到低有ERROR,WARN,INFO,DEBUG,分别用来指定这条日志信息的重要程度</span><br><span class="line">2.日志信息的输出目的地指定了日志将打印到控制台还是文件中</span><br><span class="line">3.输出格式则控制了日志信息的显示内容</span><br><span class="line"></span><br><span class="line">1.定义配置文件</span><br><span class="line">Log4j支持两种配置文件格式:一种是XML格式的文件;一种是Java特性文件(键=值)</span><br><span class="line"></span><br><span class="line">Java特性文件做为配置文件的方法:</span><br><span class="line">//配置根Logger</span><br><span class="line">log4j.rootLogger = [ level ] , appenderName, appenderName, …</span><br><span class="line"></span><br><span class="line">level是日志记录的优先级,分为OFF,FATAL,ERROR,WARN,INFO,DEBUG,ALL或者您定义的级别.Log4j建议只使用四个级别,优先级从高到低分别是ERROR,WARN,INFO,DEBUG.通过在这里定义的级别,您可以控制到应用程序中相应级别的日志信息的开关.比如在这里定义了INFO级别,则应用程序中所有DEBUG级别的日志信息将不被打印出来.</span><br><span class="line">appenderName就是指B日志信息输出到哪个地方.您可以同时指定多个输出目的地.</span><br><span class="line"></span><br><span class="line">//配置日志信息输出目的地Appender</span><br><span class="line">log4j.appender.appenderName = fully.qualified.name.of.appender.class  </span><br><span class="line">log4j.appender.appenderName.option1 = value1</span><br><span class="line">... ...</span><br><span class="line">log4j.appender.appenderName.option = valueN</span><br><span class="line"></span><br><span class="line">Log4j提供的appender有以下几种:</span><br><span class="line">1.org.apache.log4j.ConsoleAppender(控制台)  </span><br><span class="line">2.org.apache.log4j.FileAppender(文件)</span><br><span class="line">3.org.apache.log4j.DailyRollingFileAppender(每天产生一个日志文件)</span><br><span class="line">4.org.apache.log4j.RollingFileAppender(文件大小到达指定尺寸的时候产生一个新的文件)  </span><br><span class="line">5.org.apache.log4j.WriterAppender(将日志信息以流格式发送到任意指定的地方)</span><br><span class="line"></span><br><span class="line">//配置日志信息的格式(布局)</span><br><span class="line">log4j.appender.appenderName.layout = fully.qualified.name.of.layout.class  </span><br><span class="line">log4j.appender.appenderName.layout.option1 = value1  </span><br><span class="line">…  </span><br><span class="line">log4j.appender.appenderName.layout.option = valueN</span><br><span class="line"></span><br><span class="line">Log4j提供的layout有以e几种:</span><br><span class="line">1.org.apache.log4j.HTMLLayout(以HTML表格形式布局)  </span><br><span class="line">2.org.apache.log4j.PatternLayout(可以灵活地指定布局模式)  </span><br><span class="line">3.org.apache.log4j.SimpleLayout(包含日志信息的级别和信息字符串)  </span><br><span class="line">4.org.apache.log4j.TTCCLayout(包含日志产生的时间、线程、类别等等信息)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Log4J采用类似C语言中的printf函数的打印格式格式化日志信息,打印参数如下:</span><br><span class="line">%m 输出代码中指定的消息</span><br><span class="line">%p 输出优先级,即DEBUG，INFO，WARN，ERROR，FATAL  </span><br><span class="line">%r 输出自应用启动到输出该log信息耗费的毫秒数  </span><br><span class="line">%c 输出所属的类目,通常就是所在类的全名  </span><br><span class="line">%t 输出产生该日志事件的线程名  </span><br><span class="line">%n 输出一个回车换行符,Windows平台为&quot;rn&quot;,Unix平台为&quot;n&quot;  </span><br><span class="line">%d 输出日志时间点的日期或时间,默认格式为ISO8601,也可以在其后指定格式,比如: %d&#123;yyy MMM dd HH:mm:ss,SSS&#125;,输出类似:2002年10月18日 22:10:28,921  </span><br><span class="line">%l 输出日志事件的发生位置,包括类目名,发生的线程,以及在代码中的行数.举例:Testlog4.main(TestLog4.java:10)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在代码中使用log4j</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.得到记录器,这个记录器将负责控制日志信息</span><br><span class="line">public static Logger getLogger( String name)</span><br><span class="line"></span><br><span class="line">Name一般取本类的名字,比如:</span><br><span class="line">static Logger logger = Logger.getLogger(ServerWithLog4j.class.getName())</span><br><span class="line"></span><br><span class="line">2.读取配置文件</span><br><span class="line">BasicConfigurator.configure ()  自动快速地使用缺省Log4j环境</span><br><span class="line">PropertyConfigurator.configure ( String configFilename) 读取使用Java的特性文件编写的配置文件</span><br><span class="line">DOMConfigurator.configure ( String filename ) 读取XML形式的配置文件</span><br><span class="line"></span><br><span class="line">3.插入记录信息(格式化日志信息)</span><br><span class="line">Logger.debug ( Object message ) ;  </span><br><span class="line">Logger.info ( Object message ) ;  </span><br><span class="line">Logger.warn ( Object message ) ;  </span><br><span class="line">Logger.error ( Object message ) ;</span><br><span class="line"></span><br><span class="line">日志级别:</span><br><span class="line">每个Logger都被了一个日志级别(log level)用来控制日志信息的输出.</span><br><span class="line">日志级别从高到低分为：</span><br><span class="line">A：off   最高等级,用于关闭所有日志记录</span><br><span class="line">B：fatal 指出每个严重的错误事件将会导致应用程序的退出</span><br><span class="line">C：error 指出虽然发生错误事件,但仍然不影响系统的继续运行</span><br><span class="line">D：warm  表明会出现潜在的错误情形</span><br><span class="line">E：info  一般和在粗粒度级别上,强调应用程序的运行全程</span><br><span class="line">F：debug 一般用于细粒度级别上,对调试应用程序非常有帮助</span><br><span class="line">G：all   最低等级,用于打开所有日志记录</span><br><span class="line"></span><br><span class="line">上面这些级别是定义在org.apache.log4j.Level类中.</span><br><span class="line">Log4j只建议使用4个级别,优先级从高到低分别是error,warn,info和debug.</span><br><span class="line">通过使用日志级别,可以控制应用程序中相应级别日志信息的输出.例如:如果使用b了info级别,则应用程序中所有低于info级别的日志信息(如debug)将不会被打印出来</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/java-log4j/" data-id="cjazexzel0046qcoqr7xi6y8f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-salt-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/salt-install/" class="article-date">
  <time datetime="2017-03-20T03:36:39.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/automation/">automation</a>►<a class="article-category-link" href="/categories/automation/salt/">salt</a>►<a class="article-category-link" href="/categories/automation/salt/salt-install/">salt install</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/salt-install/">salt install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="saltstack-安装"><a href="#saltstack-安装" class="headerlink" title="saltstack 安装"></a><a href="http://repo.saltstack.com/yum/redhat/7/x86_64/" target="_blank" rel="noopener">saltstack 安装</a></h3><ol>
<li><p>基础软件安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@saltstack ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum -y install gcc gcc-c++ make cmake bison libtool autoconf automake zip unzip bzip2 zlib zlib-devel openssl openssl-devel openssl-static pcre pcre-devel bison-devel ncurses-devel tcl tcl-devel perl-Digest-SHA1 GeoIP GeoIP-devel gperftools gperftools-devel libatomic_ops-devel gtest gtest-devel glibc-devel unixODBC-devel fop libperl libpython readline readline-devel python2-pip readline readline-devel readline-static sqlite-devel bzip2-devel bzip2-libs openldap-devel</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum -y install git lftp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span></span><br><span class="line"></span><br><span class="line">[root@saltstack ~]<span class="comment"># rpm -e --nodeps python2-pycryptodomex</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum -y install python-crypto</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt yum repo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@saltstack ~]<span class="comment"># yum -y install https://repo.saltstack.com/yum/redhat/salt-repo-latest-2.el7.noarch.rpm</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum -y install https://repo.saltstack.com/yum/redhat/salt-repo-latest-2.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum clean expire-cache</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum makecache</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt master install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@saltstack ~]<span class="comment"># yum -y install salt-master</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># yum -y install salt-cloud salt-api salt-repo salt-ssh salt-syndic</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># pip install raet</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt minion install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@saltstack ~]<span class="comment"># yum -y install salt-minion</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt-master 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls -1d /etc/salt/master*</span></span><br><span class="line">/etc/salt/master</span><br><span class="line">/etc/salt/master.d</span><br><span class="line"></span><br><span class="line">[root@saltstack salt]<span class="comment"># vim /etc/salt/master</span></span><br><span class="line">default_include: master.d/*.conf</span><br><span class="line">interface: 0.0.0.0</span><br><span class="line">publish_port: 4505</span><br><span class="line">user: root</span><br><span class="line">ret_port: 4506</span><br></pre></td></tr></table></figure>
</li>
<li><p>salt-minion 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls -1d /etc/salt/minion*</span></span><br><span class="line">/etc/salt/minion</span><br><span class="line">/etc/salt/minion.d</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/salt/minion</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt-master 启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@saltstack ~]<span class="comment"># systemctl start salt-master</span></span><br><span class="line">[root@saltstack ~]<span class="comment"># systemctl enable salt-master</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>salt-minion 启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl start salt-minion</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl enable salt-minion</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>错误信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install salt-minion</span><br><span class="line">... ...</span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">Importing GPG key 0x352C64E5:</span><br><span class="line"> Userid     : &quot;Fedora EPEL (7) &lt;epel@fedoraproject.org&gt;&quot;</span><br><span class="line"> Fingerprint: 91e9 7d7c 4a5e 96f1 7f3e 888f 6a2f aea2 352c 64e5</span><br><span class="line"> Package    : epel-release-7-9.noarch (@wisdom_CentOS_7_extras)</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/saltstack-signing-key</span><br><span class="line"></span><br><span class="line">The GPG keys listed for the &quot;SaltStack Latest Release Channel for RHEL/Centos 7&quot; repository are already installed but they are not correct for this package.</span><br><span class="line">Check that the correct key URLs are configured for this repository.</span><br><span class="line"></span><br><span class="line"> Failing package is: python-jinja2-2.7.2-2.el7.noarch</span><br><span class="line"> GPG Keys are configured as: file:///etc/pki/rpm-gpg/saltstack-signing-key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解决方法:</span><br><span class="line">[root@localhost ~]# wget https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line">[root@localhost ~]# rpm --import RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>
</li>
<li><p>salt minion config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'default_include: minion.d/*.conf'</span>|tee -a /etc/salt/minion</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'master: 10.0.1.90'</span>|tee /etc/salt/minion.d/minion.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'id: 10.0.3.39'</span>|tee -a /etc/salt/minion.d/minion.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>systemctl start salt-minion</p>
<p>systemctl enable salt-master.service<br>systemctl start salt-master.service</p>
<p>systemctl enable salt-minion.service<br>systemctl start salt-minion.service</p>
<p>slat-key -L<br>slat-key -A<br>salt-key -a key</p>
<p>salt “*” test.ping<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">### salt install(多master + syndic架构)</span><br><span class="line">1. 基础环境初始化</span><br><span class="line">```text</span><br><span class="line">192.168.13.217 saltserver1</span><br><span class="line">192.168.13.218 saltserver2</span><br><span class="line">192.168.13.212 saltsyndic</span><br><span class="line"></span><br><span class="line">//修改主机名</span><br><span class="line">hostname saltserver1 &amp;&amp; echo saltserver1 |tee /etc/hostname</span><br><span class="line">hostname saltserver2 &amp;&amp; echo saltserver1 |tee /etc/hostname</span><br><span class="line">hostname saltsyndic  &amp;&amp; echo saltsyndic  |tee /etc/hostname</span><br><span class="line"></span><br><span class="line">//修改hosts文件</span><br><span class="line">echo &apos;192.168.13.217 saltserver1&apos; |tee -a /etc/hosts</span><br><span class="line">echo &apos;192.168.13.218 saltserver2&apos; |tee -a /etc/hosts</span><br><span class="line">echo &apos;192.168.13.212 saltsyndic&apos;  |tee -a /etc/hosts</span><br><span class="line"></span><br><span class="line">//格式化磁盘</span><br><span class="line">mkfs.xfs /dev/vdb</span><br><span class="line">echo &apos;/dev/vdb /mnt xfs defaults 0 0&apos; |tee -a /etc/fstab</span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line">//修改最大文件描述符</span><br><span class="line">echo &apos;* - nproc  65535&apos; | tee -a /etc/security/limits.conf</span><br><span class="line">echo &apos;* - nofile 65535&apos; | tee -a /etc/security/limits.conf</span><br><span class="line">ls /etc/security/limits.d/|xargs rm -f</span><br><span class="line"></span><br><span class="line">//修改yum源</span><br><span class="line">mkdir /etc/yum.repos.d/backup &amp;&amp; mv /etc/yum.repos.d/&#123;*,backup&#125;</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">rpm --import http://yum.jwops.cn/wisdom/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line">yum -y install epel-release</span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line"></span><br><span class="line">yum -y install gcc gcc-c++ make cmake bison libtool autoconf automake zip unzip bzip2 zlib zlib-devel openssl openssl-devel openssl-static pcre pcre-devel bison-devel ncurses-devel tcl tcl-devel perl-Digest-SHA1 GeoIP GeoIP-devel gperftools gperftools-devel libatomic_ops-devel gtest gtest-devel glibc-devel unixODBC-devel fop libperl libpython readline readline-devel python-devel python-pip python-crypto readline readline-devel readline-static sqlite-devel bzip2-devel bzip2-libs openldap-devel gdk-pixbuf2 gdk-pixbuf2-devel libffi libffi-devel libcurl libcurl-devel http-parser http-parser-devel libssh2 libssh2-devel git lftp ntp ntpdate vim wget telnet dstat tree lrzsz net-tools nmap-ncat nmap sysstat</span><br><span class="line"></span><br><span class="line">//关闭selinux</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i s/&apos;SELINUX=enforcing&apos;/&apos;SELINUX=disabled&apos;/g /etc/selinux/config</span><br><span class="line"></span><br><span class="line">//关闭防火墙</span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">//时间设置</span><br><span class="line">[ -f /etc/localtime ] &amp;&amp; cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">[ -f /etc/sysconfig/clock ] &amp;&amp; echo &apos;ZONE=&quot;Asia/Shanghai&quot;&apos; | tee /etc/sysconfig/clock</span><br><span class="line">[ -f /etc/timezone ] &amp;&amp; echo &apos;Asia/Shanghai&apos; | tee /etc/timezone</span><br><span class="line">[ -f /etc/sysconfig/ntpd ] &amp;&amp; echo &apos;SYNC_HWCLOCK=yes&apos; | tee -a /etc/sysconfig/ntpd</span><br><span class="line"></span><br><span class="line">ntpdate cn.pool.ntp.org</span><br><span class="line"></span><br><span class="line">cp -f /etc/&#123;ntp.conf,ntp.conf.bak&#125;</span><br><span class="line">cat &gt; /etc/ntp.conf &lt;&lt;EOF</span><br><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line">restrict default nomodify notrap nopeer noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict ::1</span><br><span class="line">server cn.pool.ntp.org prefer</span><br><span class="line">server 0.centos.pool.ntp.org iburst</span><br><span class="line">server 1.centos.pool.ntp.org iburst</span><br><span class="line">server 2.centos.pool.ntp.org iburst</span><br><span class="line">server 3.centos.pool.ntp.org iburst</span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line">disable monitor</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cp -f /etc/ntp/&#123;step-tickers,step-tickers.bak&#125;</span><br><span class="line">cat &gt; /etc/ntp/step-tickers &lt;&lt;EOF</span><br><span class="line">cn.pool.ntp.org</span><br><span class="line">0.centos.pool.ntp.org</span><br><span class="line">1.centos.pool.ntp.org</span><br><span class="line">2.centos.pool.ntp.org</span><br><span class="line">3.centos.pool.ntp.org</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl start ntpd &amp;&amp; systemctl enable ntpd</span><br><span class="line"></span><br><span class="line">//创建基础目录</span><br><span class="line">mkdir -p /mnt/&#123;app,data,log,web,ops/&#123;app,data,cron&#125;&#125;</span><br><span class="line"></span><br><span class="line">//挂载一块共享存储(nfs)</span><br><span class="line">mkdir /mnt/data/salt</span><br><span class="line">yum -y install nfs-utils</span><br><span class="line">echo &apos;192.168.13.201:/mnt/data/nfs /mnt/data/salt  nfs  nfsvers=3 0 0&apos; | tee -a /etc/fstab</span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line">//pip更新源和升级</span><br><span class="line">mkdir ~/.pip</span><br><span class="line">cat &gt; ~/.pip/pip.conf &lt;&lt;EOF</span><br><span class="line">[global]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br><span class="line">index-url=http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">[list]</span><br><span class="line">format=columns</span><br><span class="line">EOF</span><br><span class="line">pip install --upgrade pip</span><br><span class="line">pip install urllib urllib3</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>salt-master install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">//salt源安装</span><br><span class="line">CentOS 7:</span><br><span class="line">yum -y install https://repo.saltstack.com/yum/redhat/salt-repo-latest-2.el7.noarch.rpm</span><br><span class="line">CentoS 6:</span><br><span class="line">yum -y install https://repo.saltstack.com/yum/redhat/salt-repo-latest-2.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum clean expire-cache</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">//安装pygit2</span><br><span class="line">wget https://codeload.github.com/libgit2/libgit2/tar.gz/v0.26.0</span><br><span class="line">tar xzf v0.26.0</span><br><span class="line"><span class="built_in">cd</span> libgit2-0.26.0/</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/usr/local/lib'</span> | tee /etc/ld.so.conf.d/libgit2.conf</span><br><span class="line">ldconfig</span><br><span class="line">pip install pygit2</span><br><span class="line"></span><br><span class="line">//安装raet</span><br><span class="line">pip install raet</span><br><span class="line"></span><br><span class="line">//salt-master 和 salt-syndic 安装</span><br><span class="line">yum -y install salt-master salt salt-repo</span><br><span class="line">yum -y install salt-api salt-ssh salt-syndic salt-cloud</span><br><span class="line"></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># salt --versions-report</span></span><br><span class="line">Salt Version:</span><br><span class="line">           Salt: 2017.7.0</span><br><span class="line"></span><br><span class="line">Dependency Versions:</span><br><span class="line">           cffi: 1.6.0</span><br><span class="line">       cherrypy: unknown</span><br><span class="line">       dateutil: Not Installed</span><br><span class="line">      docker-py: Not Installed</span><br><span class="line">          gitdb: 0.6.4</span><br><span class="line">      gitpython: Not Installed</span><br><span class="line">          ioflo: 1.6.9</span><br><span class="line">         Jinja2: 2.7.2</span><br><span class="line">        libgit2: 0.26.0</span><br><span class="line">        libnacl: 1.5.2</span><br><span class="line">       M2Crypto: Not Installed</span><br><span class="line">           Mako: Not Installed</span><br><span class="line">   msgpack-pure: Not Installed</span><br><span class="line"> msgpack-python: 0.4.8</span><br><span class="line">   mysql-python: Not Installed</span><br><span class="line">      pycparser: 2.14</span><br><span class="line">       pycrypto: 2.6.1</span><br><span class="line">   pycryptodome: Not Installed</span><br><span class="line">         pygit2: 0.26.0</span><br><span class="line">         Python: 2.7.5 (default, Nov  6 2016, 00:28:07)</span><br><span class="line">   python-gnupg: Not Installed</span><br><span class="line">         PyYAML: 3.11</span><br><span class="line">          PyZMQ: 15.3.0</span><br><span class="line">           RAET: 0.6.8</span><br><span class="line">          smmap: 0.9.0</span><br><span class="line">        timelib: Not Installed</span><br><span class="line">        Tornado: 4.2.1</span><br><span class="line">            ZMQ: 4.1.4</span><br><span class="line"></span><br><span class="line">System Versions:</span><br><span class="line">           dist: centos 7.0.1406 Core</span><br><span class="line">         locale: UTF-8</span><br><span class="line">        machine: x86_64</span><br><span class="line">        release: 3.10.0-123.el7.x86_64</span><br><span class="line">         system: Linux</span><br><span class="line">        version: CentOS Linux 7.0.1406 Core</span><br><span class="line"></span><br><span class="line">//saltserver1配置启动</span><br><span class="line">[root@saltserver1 ~]<span class="comment"># mkdir -p /mnt/data/salt/conf</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># mkdir -p /mnt/data/salt/pki/master</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># mkdir -p /mnt/data/salt/file/&#123;base,dev,prod&#125;</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># mkdir -p /mnt/data/salt/pillar/&#123;base,dev,prod&#125;</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># mkdir -p /mnt/data/salt-master</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># mkdir -p /mnt/log/salt</span></span><br><span class="line"></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># cp /etc/salt/master /mnt/data/salt/conf/master.conf</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># ln -sf /mnt/data/salt/conf/master.conf /etc/salt/master.d/master.conf</span></span><br><span class="line"></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># vim /etc/salt/master.d/master.conf</span></span><br><span class="line">conf_file: /etc/salt/master</span><br><span class="line">pki_dir: /mnt/data/salt/pki/master</span><br><span class="line">file_roots:</span><br><span class="line">   base:</span><br><span class="line">     - /mnt/data/salt/file/base</span><br><span class="line">   dev:</span><br><span class="line">     - /mnt/data/salt/file/dev</span><br><span class="line">   prod:</span><br><span class="line">     - /mnt/data/salt/file/prod</span><br><span class="line">pillar_roots:</span><br><span class="line">   base:</span><br><span class="line">     - /mnt/data/salt/pillar/base</span><br><span class="line">   dev:</span><br><span class="line">     - /mnt/data/salt/pillar/dev</span><br><span class="line">   prod:</span><br><span class="line">     - /mnt/data/salt/pillar/prod</span><br><span class="line">[root@saltserver1 ~]<span class="comment"># systemctl start salt-master</span></span><br><span class="line">[root@saltserver1 ~]<span class="comment"># systemctl enable salt-master</span></span><br><span class="line"></span><br><span class="line">//saltserver2配置启动(将saltserver1配置文件同步到saltserver2上)</span><br><span class="line">[root@saltserver2 ~]<span class="comment"># systemctl start salt-master</span></span><br><span class="line">[root@saltserver2 ~]<span class="comment"># systemctl enable salt-master</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>saltsyndic安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.smallasa.com/2017/03/20/salt-install/" data-id="cjazexzlj00a0qcoqqd1jwyz9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/18/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/20/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/">AliCloud</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/">SDK</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AliCloud/SDK/Python-SDK/">Python SDK</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/">Android install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-install/Android-studio-install/">Android studio install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/">Doc</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP-严格传输安全HSTS/">HTTP 严格传输安全HSTS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/HTTP协议/">HTTP协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP-协议详解/">TCP 协议详解</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/TCP与socket区别/">TCP与socket区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件描述符与打开文件之间的关系/">linux 文件描述符与打开文件之间的关系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/linux-文件系统inode/">linux 文件系统inode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/Doc/一次完整的HTTP请求/">一次完整的HTTP请求</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/">Disk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-io-performance/">disk io performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Disk/disk-iostat/">disk iostat</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/">Distributed storage</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/">GlusterFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-architecture/">GlusterFS architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-info/">GlusterFS info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-install/">GlusterFS install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-storage/GlusterFS/GlusterFS-workflow/">GlusterFS workflow</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/">Domain</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/nslookup-dns-search/">nslookup dns search</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/">DRBD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/DRBD/DRBD-install/">DRBD install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/">keepalived</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HA/keepalived/keepalived-install/">keepalived install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/">Intellij</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/Intellij/Intellij-setting/">Intellij setting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/">vim</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-shortcut-key/">vim shortcut key</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/vim/vim-vimrc/">vim vimrc</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/">Kernel</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/">kernel memory</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel/kernel-memory/kernel-共享内存/">kernel 共享内存</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/">Monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/">ganglia</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/ganglia/ganglia-install/">ganglia install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/">hmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/hmonitor/hmonitor-install/">hmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/">htmonitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/htmonitor/htmonitor-install/">htmonitor install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/">smokeping</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/smokeping/smokeping-install/">smokeping install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/">zabbix</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/">monitor</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-cpu/">zabbix monitor cpu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/monitor/zabbix-monitor-mem/">zabbix monitor mem</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-auto-discover/">zabbix auto discover</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-grafana-install/">zabbix grafana install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install/">zabbix install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-install-distributed/">zabbix install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-item-and-tigger/">zabbix item and tigger</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-java-gateway/">zabbix java gateway</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-modify-login-user-passwd/">zabbix modify login user passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-optimization/">zabbix optimization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-proxy-install/">zabbix proxy install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-server-support-chinese/">zabbix server support chinese</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/zabbix/zabbix-windows-agent/">zabbix windows agent</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/树莓派/树莓派-GSM-语音短信报警/">树莓派 GSM 语音短信报警</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/">监控</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Monitor/监控/监控知识体系/">监控知识体系</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/">Python Framework</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django/">Python Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-Django-setting/">Python Django setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Framework/Python-tornado-install/">Python tornado install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/">Python Learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-上下文管理器/">python 上下文管理器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-内存管理/">python 内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-函数编程/">python 函数编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-变量/">python 变量</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象使用/">python 对象使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象的属性/">python 对象的属性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-对象编程/">python 对象编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-数据类型/">python 数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-流程控制/">python 流程控制</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-爬虫/">python 爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊方法/">python 特殊方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-特殊说明/">python 特殊说明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-装饰器/">python 装饰器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-过程编程/">python 过程编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-进阶/">python 进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-Learn/python-闭包/">python 闭包</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/">Python install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-error-info/">python error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-source-image/">python pip source image</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pip-use/">python pip use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-pyenv-install/">python pyenv install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-setup-py/">python setup.py</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-source-install/">python source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-install/python-virtualenv/">python virtualenv</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/">Python library</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/MySQLdb/">MySQLdb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/memory-profiler/">memory_profiler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-library/time-datetime-calendar/">time datetime calendar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/">Python modules</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-path/">python modules path</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-modules/python-modules-pylint-and-ipython/">python modules pylint and ipython</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/">Python other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Python-other/python-import-and-reload/">python import and reload</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/">Ruby install</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/Ruby-install/Ruby-install/">Ruby install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP.IP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-状态/">TCP 状态</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/TCP-IP模型/">TCP/IP模型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/Wireshark-use/">Wireshark use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/">WeChat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/">WeChat enterprise</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WeChat/WeChat-enterprise/WeChat-enterprise-API/">WeChat enterprise API</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/">automation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/">git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-command/">git command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-error/">git error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitlab/">git gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gitolite/">git gitolite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs/">git gogs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-gogs-source-install/">git gogs source install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-init/">git init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/git/git-workflow/">git workflow</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/">jenkins</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-info/">jenkins info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/jenkins/jenkins-install/">jenkins install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/">kvm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/kvm/kvm-install/">kvm install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/">maven</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/maven/maven-install/">maven install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/">nexus</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-install/">nexus install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/nexus/nexus-proxy-maven/">nexus proxy maven</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/">rpm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpm-package-build/">rpm package build</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/rpm/rpmbuild-spec/">rpmbuild spec</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/">salt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-advanced-topic/">salt advanced topic</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-highstate/">salt highstate</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-info/">salt info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install/">salt install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-HA/">salt install HA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-distributed/">salt install distributed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-install-standard/">salt install standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-jinja2-grain-pillar-module/">salt jinja2 grain pillar module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-event-reactor/">salt manage event reactor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-grains/">salt manage grains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-job/">salt manage job</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-module/">salt manage module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-pillar/">salt manage pillar</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-return/">salt manage return</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-states/">salt manage states</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-manage-target/">salt manage target</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-syndic-install/">salt master syndic install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-master-conf/">salt master.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-minion-conf/">salt minion.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-raet/">salt raet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-state-module/">salt state module</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-syndic-conf/">salt syndic.conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/salt/salt-write-module-code/">salt write module code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/">svn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-auto-update/">svn auto update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-checkout-bat/">svn checkout bat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/svn/svn-server-for-windows/">svn server for windows</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/">yum</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/automation/yum/yum-server-install/">yum server install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/">Mongo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-auth/">mongo auth</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-error/">mongo error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-auth-install/">mongo replication auth install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-replication-standard-install/">mongo replication standard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mongo/mongo-standard-install/">mongo standard install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/">Mysql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-command/">mysql command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-error-info/">mysql error info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-explain/">mysql explain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-grant/">mysql grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-index-options/">mysql index options</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-innodb-buffer-pool-flush/">mysql innodb buffer pool flush</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave/">mysql master slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-master-slave-switch/">mysql master slave switch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-partition/">mysql partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-select-join/">mysql select join</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-slow-log/">mysql slow log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-standard/">mysql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-table-size/">mysql table size</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Mysql/mysql-use-memory-as-disk/">mysql use memory as disk</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/">Postgresql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-book-use/">postgresql book use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave-info/">postgresql master slave info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-master-slave/">postgresql master/slave</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-plugin-install/">postgresql plugin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-standard/">postgresql standard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-tablespace-database-schema-table-user-role-relation/">postgresql tablespace database schema table user role relation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-yum-install/">postgresql yum install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-常用命令/">postgresql 常用命令</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库对象/">postgresql 数据库对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Postgresql/postgresql-数据库管理/">postgresql 数据库管理</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/">Redis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-error/">redis error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-install/">redis install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-redis-trib-rb/">redis redis-trib.rb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-status/">redis status</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/Redis/redis-use/">redis use</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/">influxDB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/database/influxDB/influxDB-install/">influxDB install</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/golang/">golang</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/golang/go-env/">go env</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/">RabbitMQ</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-cluster/">RabbitMQ cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-high-availability/">RabbitMQ high availability</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-info/">RabbitMQ info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-install/">RabbitMQ install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-python-pika/">RabbitMQ python pika</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-user-and-grant/">RabbitMQ user and grant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/RabbitMQ/RabbitMQ-working-principle/">RabbitMQ working principle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/">beats</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/beats/beats-install/">beats install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/">datax</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-info/">datax info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-install/">datax install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/datax/datax-job/">datax job</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/">elasticsearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-backup-and-restore/">elasticsearch backup and restore</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-command/">elasticsearch command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-core-component/">elasticsearch core component</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-cluster/">elasticsearch exploring your cluster</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-exploring-your-data/">elasticsearch exploring your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-four-search-type/">elasticsearch four search type</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-full-cluster-restart-upgrade/">elasticsearch full cluster restart upgrade</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-install/">elasticsearch install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-modifying-your-data/">elasticsearch modifying your data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-rolling-upgrades/">elasticsearch rolling upgrades</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-safe-restart/">elasticsearch safe restart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/elasticsearch-shard/">elasticsearch shard</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-indexing-speed/">how to tune for indexing speed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/elasticsearch/how-to-tune-for-search-speed/">how to tune for search speed</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/">flume</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-info/">flume info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/flume/flume-install/">flume install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/">grafana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/grafana/grafana-install/">grafana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/">hadoop</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/hadoop/hadoop-简介/">hadoop 简介</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/">kafka</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-partition/">kafka add topic partition</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-add-topic-replicats/">kafka add topic replicats</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-broker-config/">kafka broker config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-high-throughput/">kafka high throughput</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-info/">kafka info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-install/">kafka install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-manage-web/">kafka manage web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-migrate-and-scale/">kafka migrate and scale</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-offset-monitor/">kafka offset monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-optimize/">kafka optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-use/">kafka use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-web-console/">kafka web console</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kafka/kafka-with-zookeeper/">kafka with zookeeper</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/">kibana</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/kibana/kibana-install/">kibana install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/">logstash</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-config-file/">logstash config file</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-filter-grok/">logstash filter grok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-info/">logstash info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/logstash/logstash-install/">logstash install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/">mycat</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-jvm-optimize/">mycat jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/mycat/mycat-web-install/">mycat web install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/">nsq</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-command/">nsq command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-info/">nsq info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/nsq/nsq-install/">nsq install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/">zookeeper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-install/">zookeeper install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-monitor/">zookeeper monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-optimize/">zookeeper optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-use/">zookeeper use</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/zookeeper/zookeeper-zab-protocol/">zookeeper zab protocol</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-env/">java env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-optimize/">java jvm optimize</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-opts/">java jvm opts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-jvm-原理/">java jvm 原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/">java learn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-learn/java-学习笔记/">java 学习笔记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-log4j/">java log4j</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/">java performance analysis</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/java-performance-analysis/jps/">jps</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-dashboard-install/">k8s dashboard install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-install/">k8s install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/k8s-registry-install/">k8s registry install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/node-install/">node install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/other/ACID/">ACID</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/分布式二阶段和三阶段提交协议/">分布式二阶段和三阶段提交协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/开源许可协议/">开源许可协议</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/网络带宽/">网络带宽</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/">system service</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/">Atlassian</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-https/">confluence https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-install/">confluence install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-reset-passwd/">confluence reset passwd</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/confluence-update/">confluence update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-https/">jira https</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-install/">jira install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/jira-update/">jira update</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Atlassian/mariadb-install/">mariadb install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/">CentOS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/Base-env/">Base env</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-common-use-scripts/">linux common use scripts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-history-info-setting/">linux history info setting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-login-info/">linux login info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-nginx-install/">linux nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-skill/">linux skill</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-system-init/">linux system init</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-内存插槽-内存信息/">linux 内存插槽 内存信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-扩容swap分区/">linux 扩容swap分区</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-物理CPU-CPU核数-逻辑CPU/">linux 物理CPU CPU核数 逻辑CPU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-磁盘系统block区别/">linux 磁盘系统block区别</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/linux-设置-包含头文件路径-和-动态库链接路径/">linux 设置 包含头文件路径 和 动态库链接路径</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/CentOS/make提高源码编译速度/">make提高源码编译速度</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/">NFS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-exports-command/">nfs exports command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/NFS/nfs-install/">nfs install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/">Samba</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-conf/">samba conf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/Samba/samba-install/">samba install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/">command</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/grep/">grep</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/pigz/">pigz</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/sed/">sed</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/split/">split</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/command/tr/">tr</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/">haproxy</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/haproxy/haproxy-install/">haproxy install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/">nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-install/">nginx install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-location/">nginx location</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-rewrite/">nginx rewrite</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/nginx/nginx-status/">nginx status</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/">ntpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/ntpd/ntpd-install/">ntpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/">openssl</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openssl/openssl-certificate/">openssl certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/">openvpn</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/openvpn/openvpn-install/">openvpn install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/">rsync</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/rsync/rsync-install/">rsync install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/">supersord</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/supersord/supersord-install/">supersord install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/">vsftpd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/ftp-proxy/">ftp proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-error/">vsftpd error</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-info/">vsftpd info</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/vsftpd/vsftpd-install/">vsftpd install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/">windows</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/cygwin-install/">cygwin install</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/ipsec-set/">ipsec set</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system-service/windows/windows-modify-hosts/">windows modify hosts</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/">SSL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/SSL/SSL-certificate/">SSL certificate</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/">angular</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/angular/angular-install/">angular install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/">hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/hexo/hexo-install/">hexo install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/">sass</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/sass/sass-install/">sass install</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/">xml</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/web/xml/xml-format/">xml format</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/hello-everyone/">Hello Everyone</a>
          </li>
        
          <li>
            <a href="/2017/12/08/svn-checkout-bat/">svn checkout bat</a>
          </li>
        
          <li>
            <a href="/2017/12/08/svn-server-for-windows/">svn server for windows</a>
          </li>
        
          <li>
            <a href="/2017/12/08/nslookup-dns-search/">nslookup dns search</a>
          </li>
        
          <li>
            <a href="/2017/11/28/kafka-web-console/">kafka web console</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 penn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>